<?xml version="1.0" encoding="utf-8"?>
<statements>

  <!-- ************************ -->
  <!-- 내부 기본 판매오더 등록 -->
  <!-- ************************ -->
  <!-- 고객오더오류목록조회 --> 
  
  <statement name="retrieveCustOrdErrList">
	  SELECT A.CUST_CD
		   , A.CUST_ORD_NO
		   , A.CUST_ORD_TYPE_CD
		   , A.CUST_MOVE_TYPE_CD
		   , A.WORK_SCTN_CD
		   , A.DPT_AR_CD
		   , A.ARV_AR_CD 
		   , A.APTD_REQ_YMD
		   , A.APTD_REQ_HM
		   , A.CUST_OF_CUST_CD
		   , A.SUP_PL_CD
		   , A.CUST_OFCR_NM
		   , A.CUST_OFCR_TEL_NO
		   , A.WORK_CNTR_CD
		   , A.SAVE_LOC_CD
		   , A.IF_ID
		   , A.ERR_CD
		   , A.ERR_CONTS
		   , TO_CHAR(A.REG_DATE, 'YYYY/MM/DD HH24:MI')  REG_DATE    
	   FROM TB_OM01004 A
	  WHERE 1 = 1
       {#1}{#2}{#3}
	  ORDER BY A.REG_DATE DESC
    <append condition="${custCd}.notempty" id="#1">
        AND A.CUST_CD  LIKE  ${custCd} || '%'
    </append>
    <append condition="${custOrdNo}.notempty" id="#2">
        AND A.CUST_ORD_NO  LIKE  ${custOrdNo} || '%'
    </append> 
	<append condition="${strtDate}.NOTEMPTY" id="#3">
	    AND A.REG_DATE between to_date(CONCAT(${strtDate},'000000'), 'yyyymmddhh24miss') 
			               and to_date(CONCAT(${endDate},'235959'), 'yyyymmddhh24miss')
	</append>    
       
  </statement>
    
  <!-- 고객오더목록조회(임시) --> 
  <statement name="retrieveCustOrdList">
	  SELECT A.CUST_CD
		   , A.CUST_ORD_NO
		   , A.CUST_ORD_TYPE_CD
		   , A.CUST_MOVE_TYPE_CD
		   , A.WORK_SCTN_CD
		   , A.DPT_AR_CD
		   , A.ARV_AR_CD 
		   , A.APTD_REQ_YMD
		   , A.CUST_OF_CUST_CD
		   , A.SUP_PL_CD
		   , A.WORK_CNTR_CD
		   , A.SAVE_LOC_CD
		   , A.IF_ID
		   , (SELECT COUNT(*)
			    FROM TB_OM01002 X
			   WHERE X.CUST_CD     = A.CUST_CD
			     AND X.CUST_ORD_NO = A.CUST_ORD_NO) ITEM_CNT  
		   , (SELECT COUNT(*)
			    FROM TB_OM02001 X
			   WHERE X.CUST_CD     = A.CUST_CD
			     AND X.CUST_ORD_NO = A.CUST_ORD_NO) ORDER_CNT  
		   , TO_CHAR(A.CUST_ORD_RECP_DATE, 'YYYY/MM/DD HH24:MI')  CUST_ORD_RECP_DATE    
		   , (SELECT MAX(SALES_ORD_NO)
			    FROM TB_OM02001 X
			   WHERE X.CUST_CD     = A.CUST_CD
			     AND X.CUST_ORD_NO = A.CUST_ORD_NO) SALES_ORD_NO  
	   FROM TB_OM01001 A
	  WHERE 1 = 1
       {#1}{#2}{#3}{#4}{#5}{#6}
	  ORDER BY A.CUST_ORD_RECP_DATE
    <append condition="${custCd}.notempty" id="#1">
        AND A.CUST_CD  LIKE '%' || ${custCd} || '%'
    </append>
    <append condition="${ifId}.notempty" id="#2">
        AND A.IF_ID LIKE '%' || ${ifId} || '%'
    </append>
    <append condition="${creatYmd}.notempty" id="#3">
        AND TO_CHAR(A.CUST_ORD_RECP_DATE, 'YYYYMMDD') LIKE ${creatYmd} || '%'
    </append>
    <append condition="${custOrdNo}.notempty" id="#4">
        AND A.CUST_ORD_NO LIKE '%' || ${custOrdNo} || '%'
    </append>    
    <append condition="${custOrdTypeCd}.notempty" id="#5">
        AND A.CUST_ORD_TYPE_CD = ${custOrdTypeCd}
    </append>    
    <append condition="${custMoveTypeCd}.notempty" id="#6">
        AND A.CUST_MOVE_TYPE_CD = ${custMoveTypeCd}
    </append>    
  </statement>
  
<!-- 내부 기본 판매 오더 조회 -->
  <statement name="retrieveIsdBasisCopyTgtOrd">
	  SELECT  /* 내부기본판매오더등록 createIsdBAsisSalesOrd.jsp 2007.10.08 */
		     sales_ord_no
	       , sales_ord_stat_cd
	       , MACOMM_GETCD_FN('ORD_STAT_CD', a.sales_ord_stat_cd ) AS sales_ord_stat_nm
	       , sales_ord_creat_ymd
	       , sales_ord_creat_hms
	       , ctrt_cust_cd
	       , rpt_cust_cd as upper_ptn_cd
--	       , (select upper_ptn_cd from tb_ma01002 where ptn_cd = a.ctrt_cust_cd) as upper_ptn_cd
	       , MACOMM_GETPTNNM_FN(a.ctrt_cust_cd ) AS ctrt_cust_nm
	       , bilg_cust_cd
	       , MACOMM_GETPTNNM_FN( a.bilg_cust_cd ) AS bilg_cust_nm
	       , ord_type_cd
	       , ( SELECT ord_type_nm
	    	     FROM TB_MA01006
	    	    WHERE ord_type_cd = a.ord_type_cd) as ord_type_nm
	       , ctrt_no
	       , ( SELECT y.ctrt_nm
			     FROM tb_sm04110 x, tb_sm07110 y
			    WHERE x.corp_cd 	 = y.corp_cd
			      AND x.prmt_biz_no = y.prmt_biz_no
			      AND x.cust_cd 	 = a.ctrt_cust_cd
			      AND x.sell_ctrt_no = a.ctrt_no) as ctrt_nm
	       , LTrim(ord_mngt_exce_dept_cd, '0') as ord_mngt_exce_dept_cd
	       , MACOMM_GETDEPTNM_FN(a.corp_cd, a.ord_mngt_exce_dept_cd) AS ord_mngt_exce_dept_nm
	       , ord_mngt_exce_ofcr_id
	       , MACOMM_GETUSERNM_FN( a.ord_mngt_exce_ofcr_id ) AS ord_mngt_exce_ofcr_nm
	       , LTrim(sell_dept_cd, '0') as sell_dept_cd
	       , MACOMM_GETDEPTNM_FN( a.corp_cd, a.sell_dept_cd ) AS sell_dept_nm
	       , sales_ofcr_id
	       , MACOMM_GETUSERNM_FN( a.sales_ofcr_id ) AS sales_ofcr_nm
	       , cargo_form_cd
	       , MACOMM_GETCD_FN( 'CARGO_FORM_CD', a.cargo_form_cd) cargo_form_nm
	       , exp_imp_dom_sctn_cd
	       , (SELECT decode(f.AVAIL_STOCK_CONF_YN, 'Y', z.avail_stock_conf_yn, f.avail_stock_conf_yn)
                FROM tb_ma01002 f
                   , tb_ma01006 z
                   , tb_om02001 x
               WHERE f.ptn_cd = x.ctrt_cust_cd
                 AND z.ord_type_cd = x.ord_type_cd
                 AND x.sales_ord_no = a.sales_ord_no) AS avail_stock_conf_yn
	       , dpt_ar_cd
	       , dpt_ar_type_cd
	       , case when a.dpt_ar_type_cd = '02' then
	    	          (select name 
	    	             from vw_ma01_01 
	    	            where code = a.dpt_ar_cd 
	    	              AND PTN_CD = a.RPT_CUST_CD
	    	              and work_sctn_cd = a.dpt_ar_type_cd) 
		          else 	    	
	    	          (select name 
	    	             from vw_ma01_01 
	    	            where code = a.dpt_ar_cd 
	    	              and work_sctn_cd = a.dpt_ar_type_cd
	    	              and rownum = 1) 
	    	 end  as dpt_ar_nm
    	   , dpt_ar_zip_cd
    	   , dpt_ar_zip_addr
    	   , dpt_ar_dtl_addr
           , nvl((select wm_yn from tb_ma01005 where work_pl_cd = a.dpt_ar_cd), 'N') as dpt_wm_yn
	       , arv_ar_cd
	       , arv_ar_type_cd
	       , case when a.arv_ar_type_cd = '02' then
	    	          (select name 
	    	             from vw_ma01_01 
	    	            where code = a.arv_ar_cd 
	    	              AND PTN_CD = a.RPT_CUST_CD
	    	              and work_sctn_cd = a.arv_ar_type_cd) 
	    	      else 	    	
	    	          (select name 
	    	             from vw_ma01_01 
	    	            where code = a.arv_ar_cd 
	    	              and work_sctn_cd = a.arv_ar_type_cd
	    	              and rownum = 1) 
	    	 end  as arv_ar_nm
    	   , arv_ar_zip_cd
    	   , arv_ar_zip_addr
    	   , arv_ar_dtl_addr
    	   , nvl((select wm_yn from tb_ma01005 where work_pl_cd = a.arv_ar_cd), 'N') as arv_wm_yn
	       , strt_req_ymd
	       , strt_req_hm
	       , aptd_req_ymd
	       , aptd_req_hm
	       , rmk
           , WORK_INFO_MNGT_TYPE_CD
           , LINE_SCTN_CD
           , load_dly_yn
           , load_Dly_Rltd_Sales_Ord_No
           , (SELECT ocean_air_sctn_cd FROM TB_OM02003 B WHERE B.sales_ord_no = A.sales_ord_no) ocean_air_sctn_cd
           , MACOMM_GETCD_FN( 'OCEAN_AIR_SCTN_CD', (SELECT ocean_air_sctn_cd FROM TB_OM02003 B WHERE B.sales_ord_no = A.sales_ord_no)) ocean_air_sctn_nm
	   FROM TB_OM02001 A
      WHERE 1 = 1 {#1}
   <append condition="${salesOrdNo}.NOTEMPTY" id="#1">
        AND sales_ord_no = ${salesOrdNo}
   </append>
  </statement>
  <!-- 판매오더번호 채번 -->
  <statement name="retrieveNewSalesOrdNo">
  	  SELECT 'S' || lpad(sq_om02001_01.nextVal, 9, 0) AS sales_ord_no 
  	    FROM DUAL
  </statement>
  <statement name="retrieveNewDcnctOrdNo">
  	  SELECT 'Z' || lpad(sq_om02001_02.nextVal, 9, 0) AS sales_ord_no 
  	    FROM DUAL
  </statement>
  <!-- 아이템 조회 팝업용 -->
  <statement name="retrieveItemCdList">
	  SELECT /* 아이템팝업  itemPopup.jsp 2007.10.08 */
		     a.item_cd
	       , a.item_nm
		   , a.wgt_unit_cd
		   , a.qty_unit_cd
		   , ( SELECT FLTR_CONTS1
	             FROM tb_ma01015
	            WHERE clas_cd = 'QTY_UNIT_CD'
	              AND COMN_CD = A.QTY_UNIT_CD) QTY_UNIT_ATTR
	       , a.cbm
	       , a.basis_unit_cd
	       , ( select fltr_conts1
	     	     from tb_ma01015
	     	    where clas_cd = 'BASIC_UNIT_CD'
	     	      AND comn_cd = a.basis_unit_cd ) basis_unit_attr
	       , b.QTY_CONV_STD_CD
	   FROM tb_ma02010 a
		  , tb_ma01002 b
      WHERE 1 = 1 
        AND a.ptn_cd = b.ptn_cd
       {#1}
   <append condition="${entpCd}.NOTEMPTY" id="#1">
	    AND a.ptn_cd = ${entpCd}
   </append>
  </statement>
  
  <!-- 내부 기본 판매오더 라인 아이템 조회 -->
  <statement name="retrieveIsdBasisCopyTgtOrdDetail">
	  SELECT /* 내부기본판매오더등록 라인아이템조회 createIsdBAsisSalesOrd.jsp 2007.10.08 */
		     a.sales_ord_no
		   , a.line_no
		   , a.item_cd
		   , a.basis_item_cd
		   , b.item_nm
  		   , a.cust_cd
		   , a.item_grade_cd
		   , a.ord_qty
		   , a.qty_unit_cd
		   , ( SELECT fltr_conts1 
	             FROM tb_ma01015 
	            WHERE clas_cd = 'QTY_UNIT_CD' 
	              AND comn_cd = a.qty_unit_cd ) AS qty_unit_attr
		   , a.ord_wgt
		   , a.wgt_unit_cd
		   , a.ord_cbm
		   , a.admt as ord_admt
		   , a.bat_no
		   , a.basis_unit_cd
		   , ( SELECT fltr_conts1 
	             FROM tb_ma01015 
	            WHERE clas_cd = 'BASIC_UNIT_CD' 
	              AND comn_cd = a.basis_unit_cd ) AS basis_unit_attr
		   , 0 avail_Stock_Cnt
		   , b.cbm AS tot_cbm
		   , a.cntr_no
		   , d.QTY_CONV_STD_CD
		   , a.fe_sctn_cd
		   , a.plant_cd
		   , a.pcul_cd
		   , a.mn_cd
		   , a.ord_qty as org_ord_qty
		   , a.ord_wgt as org_ord_wgt
		   , a.ord_cbm as org_ord_cbm
	   FROM  TB_OM02002 A
		   , TB_MA02010 B
		   , TB_OM02001 C
		   , TB_MA01002 D
	   WHERE a.cust_cd 		= b.ptn_cd
	     AND a.item_cd 		= b.item_cd
	     AND a.sales_ord_no = c.sales_ord_no
 	     AND a.cust_cd 		= d.ptn_cd
	    {#1}
	   ORDER BY to_number(a.line_no)
   <append condition="${salesOrdNo}.NOTEMPTY" id="#1">
         AND a.sales_ord_no = ${salesOrdNo}
   </append>
  </statement>
  
  <!-- 고객별 오더유형 조회 -->
  <statement name="retrieveCustCtrtIsdOrdType">
	  SELECT /* 내부기본판매오더등록 오더유형콤보조회 createIsdBasisSalesOrd.jsp 2007.10.08 */
		     cust_cd 
		   , ord_type_cd code
		   , ord_type_nm val
		   , avail_stock_conf_yn 
		   , ctrt_no 
		   , LTrim(sell_dept_cd, '0') as sell_dept_cd
	       , ( SELECT dept_nm 
		         FROM tb_ma01009 
		        WHERE dept_cd = a.sell_dept_cd ) as sell_dept_nm
		   , sales_ofcr_id 
	       , ( SELECT user_nm 
		         FROM tb_ma01011 
		        WHERE user_id = a.sales_ofcr_id ) as sales_ofcr_nm
		   , exp_imp_dom_sctn_cd 
		   , logis_svc_sctn_cd 
		   , except_ord_yn
	   FROM  tb_om_imsi a
      WHERE 1 = 1 {#1}
   <append condition="${ctrtCustCd}.NOTEMPTY" id="#1">
        AND CUST_CD = ${ctrtCustCd}
   </append>
  </statement>

  <statement name="retrieveChangeOrderTypeList">
  	  SELECT * 
  	    FROM (
	  SELECT 'F' as chk
		   , '' as flag
		   , a.sales_ord_no
		   , a.ord_type_cd
		   , (select logis_Svc_Sctn_Cd from tb_ma01006 where ord_type_cd = a.ord_type_cd) logis_Svc_Sctn_Cd 
		   , (select ord_type_nm from tb_ma01006 where ord_type_cd = a.ord_type_cd) ord_type_nm
		   , a.cust_ord_no
           , a.rpt_cust_cd upper_ptn_cd
	       , a.ctrt_cust_cd
	       , ( SELECT ptn_nm 
	    	     FROM tb_ma01002 
	    	    WHERE ptn_cd = a.ctrt_cust_cd ) as ctrt_cust_nm
	       , a.ord_mngt_exce_ofcr_id
	       , ( SELECT user_nm 
	    	     FROM tb_ma01011 
	    	    WHERE user_id = a.ord_mngt_exce_ofcr_id ) as ord_mngt_exce_ofcr_nm
	       , a.sales_ord_creat_ymd || a.sales_ord_creat_hms AS sales_ord_creat_time
	       , a.aptd_req_ymd || a.aptd_req_hm AS aptd_req_time
	       , a.dpt_ar_cd
	       , a.dpt_ar_type_cd
		   , case when a.dpt_ar_type_cd = '02' then
		              (select name 
		    	         from vw_ma01_01 
		    	        where code = a.dpt_ar_cd 
		    	          AND PTN_CD = a.RPT_CUST_CD
		    	          and work_sctn_cd = a.dpt_ar_type_cd) 
		          else 	    	
		              (select name 
		    	         from vw_ma01_01 
		    	        where code = a.dpt_ar_cd 
		    	          and work_sctn_cd = a.dpt_ar_type_cd
		    	          and rownum = 1) 
		     end  as dpt_ar_nm
		   , a.dpt_ar_zip_cd
	       , a.dpt_ar_zip_addr
	       , a.dpt_ar_dtl_addr
	       , a.arv_ar_cd
	       , a.arv_ar_type_cd
		   , case when a.arv_ar_type_cd = '99' then 
		               c.col01
		          when a.arv_ar_type_cd = '02' then
		              (select name 
		    	         from vw_ma01_01 
		    	        where code = a.arv_ar_cd 
		    	          AND PTN_CD = a.RPT_CUST_CD
		    	          and work_sctn_cd = a.arv_ar_type_cd) 
		          else 	    	
		              (select name 
		    	         from vw_ma01_01 
		    	        where code = a.arv_ar_cd 
		    	          and work_sctn_cd = a.arv_ar_type_cd
		    	          and rownum = 1) 
		     end  as arv_ar_nm
		   , a.arv_ar_zip_cd
	       , a.arv_ar_zip_addr
	       , a.arv_ar_dtl_addr
	       , a.cargo_form_cd
	       , a.exp_imp_dom_sctn_cd
	       , a.WORK_INFO_MNGT_TYPE_CD
	       , a.rmk
	       , a.aptd_dly_cd 
		   , a.sales_ord_stat_cd 
	       , ( SELECT comn_cd_nm
	    	     FROM tb_ma01015 
	    	    WHERE clas_cd = 'ORD_STAT_CD' 
	    	      AND comn_cd = a.sales_ord_stat_cd ) as sales_ord_stat_nm
		   , a.move_type_cd 
	       , ( SELECT comn_cd_nm
	    	     FROM tb_ma01015 
	    	    WHERE clas_cd = 'MOVE_TYPE_CD' 
	    	      AND comn_cd = a.move_type_cd ) as move_type_nm
		   , a.cust_of_cust_cd 
	       , ( SELECT cust_nm 
	    	     FROM tb_ma02020
	    	    WHERE ptn_cd = a.rpt_cust_cd
			      AND cust_ptn_cd = a.cust_of_cust_cd ) as cust_of_cust__nm
		   , a.cust_ord_type_cd 
	       , ( SELECT comn_cd_nm
	    	     FROM tb_ma01015 
	    	    WHERE clas_cd = 'CUST_ORD_TYPE_CD' 
	    	      AND comn_cd = a.cust_ord_type_cd ) as cust_ord_type_nm
		   , a.cust_expr_yn 
		   , a.ord_reason_cd
	       , IDUSR.OMCOMM_GETCUSTREASONNM_FN(a.rpt_cust_cd, a.ord_reason_cd) as ord_reason_nm
	       , LTrim(a.ord_mngt_exce_dept_cd, '0') as ord_mngt_exce_dept_cd
	       , MACOMM_GETDEPTNM_FN(a.corp_cd, a.ord_mngt_exce_dept_cd) AS ord_mngt_exce_dept_nm
	       , decode(a.rpt_cust_cd,'P1000',decode(c.col08,'','N','Y'),'P1591',decode(c.col08,'','N','Y'),'N') col08
	       , (select max(SALES_ORD_CHG_SEQ) from tb_om02011h where sales_ord_no=A.SALES_ORD_NO) max_chg_seq
	       , (select decode(count(*),0,'N','Y') from tb_om03022 where sales_ord_no=a.sales_ord_no) dcsn_yn
		   , (select max(nvl(DANGER_SCTN_CD,'N')) from tb_om02002 where sales_ord_no=a.sales_ord_no) as car_tack_sctn_cd
	    FROM TB_OM02001 A, TB_MA02020 b, TB_om02004 c
       WHERE a.sales_ord_no = c.sales_ord_no
         --AND A.BACK_ORD_YN = 'Y'
         AND A.SALES_ORD_CNCL_YN = 'N'
         AND A.SALES_ORD_STAT_CD in ('02','03')
        {#1}
         AND exists (select 'Y' 
                       from tb_ma01002 
                      where ptn_cd = a.ctrt_cust_cd
                        and LTM_YN = 'Y')
         AND exists ( select 'Y'
                        from tb_om02102
                       where cust_cd = a.ctrt_cust_cd
                         and cust_ord_type_cd = a.cust_ord_type_cd
                         and ORD_TYPE_CHG_YN ='Y')    
         AND not exists ( select 'Y'
                            from tb_om03022
                           where sales_ord_no = a.sales_ord_no)                          
 	     AND a.rpt_cust_cd = b.PTN_CD(+)
 	     AND a.cust_of_cust_cd = b.CUST_PTN_CD(+)
  	  ) WHERE 1=1
  	   	{#2}     
	<append condition="${selGbn}.EQ.B&amp;${ordNoGbn}.EQ.S" id="#1">
	     AND a.sales_ord_no = ${ordNo}
	</append>
	<append condition="${salesOrdNo}.NOTEMPTY" id="#1">
	     AND a.sales_ord_no = ${salesOrdNo}
	</append>
	<append condition="${selGbn}.EQ.B&amp;${ordNoGbn}.EQ.C" id="#1">
	     AND a.cust_ord_no = ${ordNo}
	</append>
    <append condition="${selGbn}.EQ.D&amp;${salesOrdStatCd}.NOTEMPTY" id="#1">
         AND a.sales_ord_stat_cd = ${salesOrdStatCd}
    </append> 
    <append condition="${selGbn}.EQ.D&amp;${ordTypeCd}.NOTEMPTY" id="#1">
         AND a.ord_type_cd = ${ordTypeCd}
    </append> 
	<append condition="${selGbn}.EQ.D&amp;${dateGbn}.EQ.CD" id="#1">
	     AND a.sales_ord_creat_ymd between ${startDate} and ${endDate}
	</append>
	<append condition="${selGbn}.EQ.D&amp;${dateGbn}.EQ.RD" id="#1">
	     AND a.aptd_req_ymd between ${startDate} and ${endDate}
	</append>
    <append condition="${selGbn}.EQ.D&amp;${rptCustCd}.NOTEMPTY" id="#1">
         AND a.rpt_cust_cd = ${rptCustCd}
    </append> 
    <append condition="${selGbn}.EQ.D&amp;${custOfCustCd}.NOTEMPTY" id="#1">
         AND a.cust_of_cust_cd = ${custOfCustCd}
    </append> 
    <append condition="${selGbn}.EQ.D&amp;${moveTypeCd}.NOTEMPTY" id="#1">
         AND a.move_type_cd = ${moveTypeCd}
    </append> 
    <append condition="${selGbn}.EQ.D&amp;${custOrdTypeCd}.NOTEMPTY" id="#1">
         AND a.cust_ord_type_cd = ${custOrdTypeCd}
    </append> 
    <append condition="${selGbn}.EQ.D&amp;${rmk}.NOTEMPTY" id="#1">
	     AND exists (SELECT 1
	                   FROM tb_om02002 z
	                  WHERE z.sales_ord_no   = a.sales_ord_no
	                    AND z.rmk Like '%'||${rmk}||'%')
    </append>
    <append condition="${selGbn}.EQ.D&amp;${ordMngtExceDeptCd}.NOTEMPTY" id="#1">
	     AND A.ord_mngt_exce_dept_cd = lpad(${ordMngtExceDeptCd}, 10, '0')
    </append>
	<append condition="${selGbn}.EQ.D&amp;${aptdDlyCd}.EQ.Y&amp;${aptdDlyCd}.NOTEMPTY" id="#1">
	     AND (a.aptd_dly_cd IS NOT NULL AND a.aptd_dly_cd != 'ZZ')
	</append>
	<append condition="${selGbn}.EQ.D&amp;${aptdDlyCd}.EQ.N&amp;${aptdDlyCd}.NOTEMPTY" id="#1">
	     AND (a.aptd_dly_cd IS NULL OR a.aptd_dly_cd = 'ZZ')
	</append>

   <append condition="${preOrdGubun}.EQ.Y&amp;${preOrdGubun}.NOTEMPTY" id="#1">
         AND c.col08 is not null
    </append>

   <append condition="${preOrdGubun}.EQ.N&amp;${preOrdGubun}.NOTEMPTY" id="#1">
         AND c.col08 is null
    </append>
    
    <append condition="${col01}.NOTEMPTY" id="#1">
	     AND c.col01 like ${col01}||'%'
	</append>

	<append condition="${carTackSctnCd}.NOTEMPTY" id="#2">
	     AND car_tack_sctn_cd = ${carTackSctnCd}
	</append>
        
  </statement>

<!-- 대기오더 목록 -->
  <statement name="retrieveBackOrderList">
	  SELECT /* 대기오더관리 manageBackOrder.jsp 2007.10.23 */
	        'F' as chk
		   , '' as flag
		   , a.sales_ord_no
		   , a.ord_type_cd
		   , (select ord_type_nm from tb_ma01006 where ord_type_cd = a.ord_type_cd) ord_type_nm
		   , a.cust_ord_no
		   , a.rpt_cust_cd upper_ptn_cd
	       , a.ctrt_cust_cd
	       , ( SELECT ptn_nm 
	    	     FROM tb_ma01002 
	    	    WHERE ptn_cd = a.ctrt_cust_cd ) as ctrt_cust_nm
	       , a.ord_mngt_exce_ofcr_id
	       , ( SELECT user_nm 
	    	     FROM tb_ma01011 
	    	    WHERE user_id = a.ord_mngt_exce_ofcr_id ) as ord_mngt_exce_ofcr_nm
	       , a.sales_ord_creat_ymd || a.sales_ord_creat_hms AS sales_ord_creat_time
	       , a.aptd_req_ymd || a.aptd_req_hm AS aptd_req_time
	       , a.dpt_ar_cd
	       , a.dpt_ar_type_cd
		   , case when a.dpt_ar_type_cd = '02' then
		              (select name 
		    	         from vw_ma01_01 
		    	        where code = a.dpt_ar_cd 
		    	          AND PTN_CD = a.RPT_CUST_CD
		    	          and work_sctn_cd = a.dpt_ar_type_cd) 
		          else 	    	
		              (select name 
		    	         from vw_ma01_01 
		    	        where code = a.dpt_ar_cd 
		    	          and work_sctn_cd = a.dpt_ar_type_cd
		    	          and rownum = 1) 
		     end  as dpt_ar_nm
		   , a.dpt_ar_zip_cd
	       , a.dpt_ar_zip_addr
	       , a.dpt_ar_dtl_addr
	       , a.arv_ar_cd
	       , a.arv_ar_type_cd
		   , case when a.arv_ar_type_cd = '02' then
		              (select name 
		    	         from vw_ma01_01 
		    	        where code = a.arv_ar_cd 
		    	          AND PTN_CD = a.RPT_CUST_CD
		    	          and work_sctn_cd = a.arv_ar_type_cd) 
		          else 	    	
		              (select name 
		    	         from vw_ma01_01 
		    	        where code = a.arv_ar_cd 
		    	          and work_sctn_cd = a.arv_ar_type_cd
		    	          and rownum = 1) 
		     end  as arv_ar_nm
		   , a.arv_ar_zip_cd
	       , a.arv_ar_zip_addr
	       , a.arv_ar_dtl_addr
	       , a.cargo_form_cd
	       , a.exp_imp_dom_sctn_cd
	       , a.WORK_INFO_MNGT_TYPE_CD
	       , a.rmk
	       , a.aptd_dly_cd 
		   , a.sales_ord_stat_cd 
	       , ( SELECT comn_cd_nm
	    	     FROM tb_ma01015 
	    	    WHERE clas_cd = 'ORD_STAT_CD' 
	    	      AND comn_cd = a.sales_ord_stat_cd ) as sales_ord_stat_nm
		   , a.move_type_cd 
	       , ( SELECT comn_cd_nm
	    	     FROM tb_ma01015 
	    	    WHERE clas_cd = 'MOVE_TYPE_CD' 
	    	      AND comn_cd = a.move_type_cd ) as move_type_nm
		   , a.cust_of_cust_cd 
	       , ( SELECT cust_nm 
	    	     FROM tb_ma02020
	    	    WHERE ptn_cd = a.rpt_cust_cd
			      AND cust_ptn_cd = a.cust_of_cust_cd ) as cust_of_cust__nm
		   , a.cust_ord_type_cd 
	       , ( SELECT comn_cd_nm
	    	     FROM tb_ma01015 
	    	    WHERE clas_cd = 'CUST_ORD_TYPE_CD' 
	    	      AND comn_cd = a.cust_ord_type_cd ) as cust_ord_type_nm
		   , a.cust_expr_yn 
		   , a.ord_reason_cd
	       , IDUSR.OMCOMM_GETCUSTREASONNM_FN(a.rpt_cust_cd, a.ord_reason_cd) as ord_reason_nm
	       , LTrim(a.ord_mngt_exce_dept_cd, '0') as ord_mngt_exce_dept_cd
	       , MACOMM_GETDEPTNM_FN(a.corp_cd, a.ord_mngt_exce_dept_cd) AS ord_mngt_exce_dept_nm
	       , decode(a.rpt_cust_cd,'P1000',decode(c.col08,'','N','Y'),'P1591',decode(c.col08,'','N','Y'),'N') col08
	       , (select max(SALES_ORD_CHG_SEQ) from tb_om02011h where sales_ord_no=A.SALES_ORD_NO) max_chg_seq
	       , (SELECT decode(count(*),0,'N','Y')
	            FROM tb_om02002 z
	           WHERE z.sales_ord_no   = a.sales_ord_no
	             {#2}
	          ) as dawn_yn
	        , (SELECT sum(ORD_WGT)
	            FROM tb_om02002 z
	           WHERE z.sales_ord_no   = a.sales_ord_no
	             AND z.ord_reason_cd is null
	             AND z.del_yn = 'N' 
	          ) as tot_ord_wgt
	        , (SELECT sum(ORD_QTY)
                FROM tb_om02002 z
               WHERE z.sales_ord_no   = a.sales_ord_no
                 AND z.ord_reason_cd is null
                 AND z.del_yn = 'N' 
              ) as tot_ord_qty
            , IDUSR.OMBACK_ORD_AVAIL_FN( A.DPT_AR_CD, A.RPT_CUST_CD, A.SALES_ORD_NO) AS tot_avail_wgt  
	   FROM TB_OM02001 A, TB_MA02020 b, TB_om02004 c
      WHERE 1 = 1 
        and a.sales_ord_no = c.sales_ord_no
        AND A.BACK_ORD_YN = 'Y'
        AND A.SALES_ORD_CNCL_YN = 'N'
        AND A.SALES_ORD_STAT_CD != '06'
        {#1}
 	    AND a.rpt_cust_cd = b.PTN_CD(+)
 	    AND a.cust_of_cust_cd = b.CUST_PTN_CD(+)
	<append condition="${selGbn}.EQ.B&amp;${ordNoGbn}.EQ.S" id="#1">
	    AND a.sales_ord_no = ${ordNo}
	</append>
	<append condition="${selGbn}.EQ.B&amp;${ordNoGbn}.EQ.C" id="#1">
	    AND a.cust_ord_no = ${ordNo}
	</append>
    <append condition="${selGbn}.EQ.D&amp;${salesOrdStatCd}.NOTEMPTY" id="#1">
        AND a.sales_ord_stat_cd = ${salesOrdStatCd}
    </append> 
    <append condition="${selGbn}.EQ.D&amp;${ordTypeCd}.NOTEMPTY" id="#1">
        AND a.ord_type_cd = ${ordTypeCd}
    </append> 
	<append condition="${selGbn}.EQ.D&amp;${dateGbn}.EQ.CD" id="#1">
	    AND a.sales_ord_creat_ymd between ${startDate} and ${endDate}
	</append>
	<append condition="${selGbn}.EQ.D&amp;${dateGbn}.EQ.RD" id="#1">
	    AND a.aptd_req_ymd between ${startDate} and ${endDate}
	</append>
    <append condition="${selGbn}.EQ.D&amp;${rptCustCd}.NOTEMPTY" id="#1">
        AND a.rpt_cust_cd = ${rptCustCd}
    </append> 
    <append condition="${selGbn}.EQ.D&amp;${custOfCustCd}.NOTEMPTY" id="#1">
        AND a.cust_of_cust_cd = ${custOfCustCd}
    </append> 
    <append condition="${selGbn}.EQ.D&amp;${moveTypeCd}.NOTEMPTY" id="#1">
        AND a.move_type_cd = ${moveTypeCd}
    </append> 
    <append condition="${selGbn}.EQ.D&amp;${custOrdTypeCd}.NOTEMPTY" id="#1">
        AND a.cust_ord_type_cd = ${custOrdTypeCd}
    </append> 
    <append condition="${selGbn}.EQ.D&amp;${rmk}.NOTEMPTY" id="#1">
	    AND exists (SELECT 1
	                  FROM tb_om02002 z
	                 WHERE z.sales_ord_no   = a.sales_ord_no
	                   AND z.rmk Like '%'||${rmk}||'%')
    </append>
    <append condition="${selGbn}.EQ.D&amp;${ordMngtExceDeptCd}.NOTEMPTY" id="#1">
	    AND A.ord_mngt_exce_dept_cd = lpad(${ordMngtExceDeptCd}, 10, '0')
    </append>
	<append condition="${selGbn}.EQ.D&amp;${aptdDlyCd}.EQ.Y&amp;${aptdDlyCd}.NOTEMPTY" id="#1">
	    AND (a.aptd_dly_cd IS NOT NULL AND a.aptd_dly_cd != 'ZZ')
	</append>
	<append condition="${selGbn}.EQ.D&amp;${aptdDlyCd}.EQ.N&amp;${aptdDlyCd}.NOTEMPTY" id="#1">
	    AND (a.aptd_dly_cd IS NULL OR a.aptd_dly_cd = 'ZZ')
	</append>

   <append condition="${preOrdGubun}.EQ.Y&amp;${preOrdGubun}.NOTEMPTY" id="#1">
        AND c.col08 is not null
    </append>

   <append condition="${preOrdGubun}.EQ.N&amp;${preOrdGubun}.NOTEMPTY" id="#1">
        AND c.col08 is null
    </append>

   <append condition="${ordMngtExceDeptCd}.EQ.160070&amp;${ordMngtExceDeptCd}.NOTEMPTY" id="#2">
        AND (z.rmk Like '%새벽%' OR z.rmk Like '%길로틴%' OR z.rmk Like '%재단%')
   </append>
        
   <append condition="${ordMngtExceDeptCd}.NE.160070&amp;${ordMngtExceDeptCd}.NOTEMPTY" id="#2">
        AND z.rmk Like '%새벽%'
   </append>
        
  </statement>


<!-- 대기오더 목록 : 배치Job 처리 -->
  <statement name="retrieveBatchBackOrderList">
	  SELECT /* 대기오더 분배 처리 Batch Job처리 */
		      '' as flag
		    , a.sales_ord_no
		    , a.ord_type_cd
		    , (select ord_type_nm from tb_ma01006 where ord_type_cd = a.ord_type_cd) ord_type_nm
		    , a.cust_ord_no
     		, a.rpt_cust_cd upper_ptn_cd
	        , a.ctrt_cust_cd
	        , ( SELECT ptn_nm 
	    	      FROM tb_ma01002 
	    	     WHERE ptn_cd = a.ctrt_cust_cd ) as ctrt_cust_nm
	        , a.ord_mngt_exce_ofcr_id
	        , ( SELECT user_nm 
	    	      FROM tb_ma01011 
	    	     WHERE user_id = a.ord_mngt_exce_ofcr_id ) as ord_mngt_exce_ofcr_nm
	        , a.sales_ord_creat_ymd || a.sales_ord_creat_hms AS sales_ord_creat_time
	        , a.aptd_req_ymd || a.aptd_req_hm AS aptd_req_time
	        , a.dpt_ar_cd
	        , a.dpt_ar_type_cd
		    , case when a.dpt_ar_type_cd = '02' then
		               (select name 
		    	          from vw_ma01_01 
		    	         where code = a.dpt_ar_cd 
		    	           AND PTN_CD = a.RPT_CUST_CD
		    	           and work_sctn_cd = a.dpt_ar_type_cd) 
		           else 	    	
		               (select name 
		    	          from vw_ma01_01 
		    	         where code = a.dpt_ar_cd 
		    	           and work_sctn_cd = a.dpt_ar_type_cd
		    	           and rownum = 1) 
		      end  as dpt_ar_nm
		    , a.dpt_ar_zip_cd
	        , a.dpt_ar_zip_addr
	        , a.dpt_ar_dtl_addr
	        , a.arv_ar_cd
	        , a.arv_ar_type_cd
		    , case when a.arv_ar_type_cd = '02' then
		               (select name 
		    	          from vw_ma01_01 
		    	         where code = a.arv_ar_cd 
		    	           AND PTN_CD = a.RPT_CUST_CD
		    	           and work_sctn_cd = a.arv_ar_type_cd) 
		           else 	    	
		               (select name 
		    	          from vw_ma01_01 
		    	         where code = a.arv_ar_cd 
		    	           and work_sctn_cd = a.arv_ar_type_cd
		    	           and rownum = 1) 
		      end  as arv_ar_nm
		    , a.arv_ar_zip_cd
	        , a.arv_ar_zip_addr
	        , a.arv_ar_dtl_addr
	        , a.cargo_form_cd
	        , a.exp_imp_dom_sctn_cd
	        , a.WORK_INFO_MNGT_TYPE_CD
	        , a.rmk
	        , a.aptd_dly_cd 
	    	, a.sales_ord_stat_cd 
	        , ( SELECT comn_cd_nm
	    	      FROM tb_ma01015 
	    	     WHERE clas_cd = 'ORD_STAT_CD' 
	    	       AND comn_cd = a.sales_ord_stat_cd ) as sales_ord_stat_nm
	    	, a.move_type_cd 
	        , ( SELECT comn_cd_nm
	    	      FROM tb_ma01015 
	    	     WHERE clas_cd = 'MOVE_TYPE_CD' 
	    	       AND comn_cd = a.move_type_cd ) as move_type_nm
		    , a.cust_of_cust_cd 
	        , ( SELECT cust_nm 
	    	      FROM tb_ma02020
	    	     WHERE ptn_cd = a.rpt_cust_cd
			       AND cust_ptn_cd = a.cust_of_cust_cd ) as cust_of_cust__nm
		    , a.cust_ord_type_cd 
	        , ( SELECT comn_cd_nm
	    	      FROM tb_ma01015 
	    	     WHERE clas_cd = 'CUST_ORD_TYPE_CD' 
	    	       AND comn_cd = a.cust_ord_type_cd ) as cust_ord_type_nm
		    , a.cust_expr_yn 
		    , a.ord_reason_cd
	        , IDUSR.OMCOMM_GETCUSTREASONNM_FN(a.rpt_cust_cd, a.ord_reason_cd) as ord_reason_nm
	        , LTrim(a.ord_mngt_exce_dept_cd, '0') as ord_mngt_exce_dept_cd
	        , MACOMM_GETDEPTNM_FN(a.corp_cd, a.ord_mngt_exce_dept_cd) AS ord_mngt_exce_dept_nm
	        , a.MDFR_ID
	        , a.regr_Id
	     FROM TB_OM02001 A, TB_MA02020 b
        WHERE 1 = 1 
          AND A.BACK_ORD_YN = 'Y'
          AND A.SALES_ORD_CNCL_YN != 'Y'
          AND A.SALES_ORD_STAT_CD = '02'
 	      AND a.rpt_cust_cd = b.PTN_CD(+)
 	      AND a.cust_of_cust_cd = b.CUST_PTN_CD(+)
	      AND nvl(a.aptd_dly_cd,'ZZ') = 'ZZ'
	      AND A.SALES_ORD_NO = ${salesOrdNo}

  </statement>

  <statement name="retrieveBatchBackOrderSalesOrdNoList">
      select distinct sales_ord_No /* BackOrd Divide Process BactchJob 2008.09.18 */
        from (
               SELECT distinct a.SALES_ORD_NO
 	             FROM TB_OM02001 a, tb_om02002 b
                WHERE a.sales_ord_no          = b.sales_ord_no
                  and a.BACK_ORD_YN           = 'Y'
                  AND a.SALES_ORD_CNCL_YN    != 'Y'
                  AND a.SALES_ORD_STAT_CD     = '02'
 	              AND nvl(a.aptd_dly_cd,'ZZ') = 'ZZ' 
 	         )
 	    order by sales_ord_No
  </statement>


  <statement name="retrieveBackOrdYn">
  
	  SELECT /* BackOrd Divide Process BactchJob 2008.09.18 */
	         decode(count(*),0,'N','Y') as BACK_ORD_YN
 	    FROM TB_OM02001 
       WHERE SALES_ORD_NO = ${salesOrdNo}
         AND BACK_ORD_YN = 'Y'
         AND SALES_ORD_CNCL_YN != 'Y'
         AND SALES_ORD_STAT_CD = '02'
 	     AND nvl(aptd_dly_cd,'ZZ') = 'ZZ' 
 	   
  </statement>
	

<!-- 대기오더 아이템 목록 -->
  <statement name="retrieveBackOrderItemList">
  <![CDATA[
	  SELECT /* 대기오더관리 라인아이템조회 manageBackOrder.jsp 2007.10.23 */
		     'F' as chk
		   , a.sales_ord_no
		   , a.line_no
		   , a.cust_cd
		   , a.item_cd
		   , b.item_nm
		   , a.basis_item_cd
		   , DECODE(NVL(a.item_grade_cd, ''), '', DECODE(A.CUST_CD, 'P1000', (SELECT GRADE_CD FROM TB_MA02010 WHERE PTN_CD = A.CUST_CD AND ITEM_CD = A.ITEM_CD)
															      , 'P1591', (SELECT GRADE_CD FROM TB_MA02010 WHERE PTN_CD = A.CUST_CD AND ITEM_CD = A.ITEM_CD)
															      , 'P1100', (SELECT GRADE_CD FROM TB_MA02011 WHERE PTN_CD = A.CUST_CD AND ITEM_CD = A.ITEM_CD AND CUST_BAT_NO = A.BAT_NO)
															      , 'P1200', (SELECT GRADE_CD FROM TB_MA02011 WHERE PTN_CD = A.CUST_CD AND ITEM_CD = A.ITEM_CD AND CUST_BAT_NO = A.BAT_NO)
															      , A.ITEM_GRADE_CD)
											    , A.ITEM_GRADE_CD) AS ITEM_GRADE_CD
		   , a.basis_unit_cd
		   , a.bat_no
		   , ord_qty
		   , ord_wgt
		   , ord_CBM
		   , CASE WHEN c.rpt_cust_cd = 'P1100' AND (SELECT ptn_gds_sctn_cd FROM tb_ma02010 WHERE ptn_cd = a.cust_cd AND item_cd = a.item_cd) = 'R' 
		  	   	  THEN ROUND(ord_qty * 1.1, 3)
		  	      ELSE ord_qty END max_qty
		   , CASE WHEN c.rpt_cust_cd = 'P1100' AND (SELECT ptn_gds_sctn_cd FROM tb_ma02010 WHERE ptn_cd = a.cust_cd AND item_cd = a.item_cd) = 'R' 
		  	   	  THEN ROUND(ord_wgt * 1.1, 3)
		  	      ELSE ord_wgt END max_wgt
		   , CASE WHEN c.rpt_cust_cd = 'P1100' AND (SELECT ptn_gds_sctn_cd FROM tb_ma02010 WHERE ptn_cd = a.cust_cd AND item_cd = a.item_cd) = 'R' 
		  	   	  THEN ROUND(ord_cbm * 1.1, 3)
		  	      ELSE ord_cbm END max_cbm
		   , ord_qty - NVL( ( SELECT sum(ord_qty) 
							    FROM tb_om03001 x
                  				    ,tb_om03002 y 
							   WHERE x.sales_ord_no   = a.sales_ord_no
              				     AND x.sales_ord_no   = y.sales_ord_no
							     AND y.line_no 	 	= a.line_no
				                 AND x.work_route_seq = y.work_route_seq
				                 AND X.DEL_YN != 'Y'
							), 0)  as remain_qty
		   , ord_wgt - NVL( ( SELECT sum(ord_wgt) 
							    FROM tb_om03001 x
                  				    ,tb_om03002 y 
							   WHERE x.sales_ord_no   = a.sales_ord_no
              				     AND x.sales_ord_no   = y.sales_ord_no
							     AND y.line_no 	 	 = a.line_no
				                 AND x.work_route_seq = y.work_route_seq
				                 AND X.DEL_YN != 'Y'
              			), 0)  as remain_wgt
		   , ord_CBM - NVL( ( SELECT sum(ord_CBM) 
							    FROM tb_om03001 x
                  				    ,tb_om03002 y 
							   WHERE x.sales_ord_no   = a.sales_ord_no
              				     AND x.sales_ord_no   = y.sales_ord_no
							     AND y.line_no 	 	 = a.line_no
				                 AND x.work_route_seq = y.work_route_seq
				                 AND X.DEL_YN != 'Y'
							), 0)  as remain_cbm
		   , 0 avail_stock_cnt
		   , ord_qty - NVL( ( SELECT sum(ord_qty) 
							    FROM tb_om03001 x
                  				    ,tb_om03002 y 
							   WHERE x.sales_ord_no   = a.sales_ord_no
              				     AND x.sales_ord_no   = y.sales_ord_no
							     AND y.line_no 	 	  = a.line_no
				                 AND x.work_route_seq = y.work_route_seq
				                 AND X.DEL_YN != 'Y'
							), 0)  as divide_qty
		   , ord_wgt - NVL( ( SELECT sum(ord_wgt) 
							    FROM tb_om03001 x
                  				    ,tb_om03002 y 
							   WHERE x.sales_ord_no   = a.sales_ord_no
              				     AND x.sales_ord_no   = y.sales_ord_no
							     AND y.line_no 	 	  = a.line_no
				                 AND x.work_route_seq = y.work_route_seq
				                 AND X.DEL_YN != 'Y'
							), 0)  as divide_wgt
		   , ord_CBM - NVL( ( SELECT sum(ord_CBM) 
							    FROM tb_om03001 x
                  				    ,tb_om03002 y 
							   WHERE x.sales_ord_no   = a.sales_ord_no
              				     AND x.sales_ord_no   = y.sales_ord_no
							     AND y.line_no 	 	 = a.line_no
				                 AND x.work_route_seq = y.work_route_seq
				                 AND X.DEL_YN != 'Y'
							), 0)  as divide_cbm
		   , a.aptd_req_ymd || a.aptd_req_hm  AS aptd_req_time
		   , a.aptd_req_ymd
		   , a.aptd_req_hm
	       , a.dpt_ar_cd
	       , a.dpt_ar_type_cd
	       , case when a.dpt_ar_type_cd = '02' then
			         ( SELECT name
			             FROM vw_ma01_01
			            WHERE code = a.dpt_ar_cd
			    	      and ptn_cd = c.rpt_cust_cd
			    	      and work_sctn_cd = a.dpt_ar_type_cd ) 
			      else		
			         ( SELECT name
			             FROM vw_ma01_01
			            WHERE code = a.dpt_ar_cd
			    	      and work_sctn_cd = a.dpt_ar_type_cd
			    	      and rownum = 1 ) 
			 end  	as dpt_ar_nm
	       , a.arv_ar_cd
	       , a.arv_ar_type_cd
	       , case when a.arv_ar_type_cd = '02' then
		             ( SELECT name
		    	         FROM vw_ma01_01
		    	        WHERE code = a.arv_ar_cd
		    	          AND PTN_CD = C.RPT_CUST_CD
		    	          and work_sctn_cd = a.arv_ar_type_cd ) 
		          else 
		              ( SELECT name
		    	          FROM vw_ma01_01
		    	         WHERE code = a.arv_ar_cd
		    	           and work_sctn_cd = a.arv_ar_type_cd
		    	           and rownum = 1 ) 
		     end  as arv_ar_nm
	       , b.wgt_unit_cd
	       , b.qty_unit_cd
	       , b.cbm
	       , ( SELECT fltr_conts1 
	    	     FROM tb_ma01015 
	    	    WHERE clas_cd = 'BASIC_UNIT_CD' 
	    	      AND comn_cd = a.basis_unit_cd ) as basis_unit_attr
		   , C.DPT_AR_CD AS MASTER_DPT_AR_CD
		   , C.DPT_AR_ZIP_CD
		   , C.DPT_AR_ZIP_ADDR
		   , C.DPT_AR_DTL_ADDR
		   , C.ARV_AR_CD AS MASTER_ARV_AR_CD
		   , C.ARV_AR_ZIP_CD
		   , C.ARV_AR_ZIP_ADDR
		   , C.ARV_AR_DTL_ADDR
		   , C.ORD_TYPE_CD
		   , C.STRT_REQ_YMD
		   , C.STRT_REQ_HM
		   , C.APTD_REQ_YMD as master_aptd_req_ymd
		   , C.APTD_REQ_HM as master_aptd_req_hm
		   , C.rpt_cust_cd
		   , a.plant_cd
		   , A.deliv_dly_yn
		   , a.pcul_cd
		   , a.mn_cd
		   , a.rmk
		   , e.col01
		   , e.col03
	    FROM TB_OM02002 A, TB_OM02001 C, TB_MA02010 B, TB_MA01015 D, TB_OM02005 E
       WHERE 1 = 1 
         AND A.SALES_ORD_NO = C.SALES_ORD_NO
         and a.sales_ord_no  = e.sales_ord_no(+)
         and a.line_no       = e.line_no(+)
         AND C.SALES_ORD_CNCL_YN != 'Y'
         AND A.CUST_CD = B.PTN_CD
         AND A.ITEM_CD = B.ITEM_CD
         AND D.clas_cd = 'BASIC_UNIT_CD'
         AND A.basis_unit_cd = d.comn_cd
         AND a.ORD_REASON_CD IS NULL
         AND A.DEL_YN != 'Y'
        {#1}
        {#2}
       ORDER BY to_number(a.line_no)
    ]]>
   <append condition="${salesOrdNo}.NOTEMPTY" id="#1">
         AND A.sales_ord_no = ${salesOrdNo}
   </append>
   <append condition="${lineNo}.NOTEMPTY" id="#2">
         AND A.line_no = ${lineNo}
   </append>
  </statement>
  
  <statement name="retrieveBackOrderMultiList">
  <![CDATA[
	  SELECT 
		     a.chk
		   , a.flag
		   , a.sales_ord_no
		   , a.ord_type_cd
		   , a.ord_type_nm
		   , a.cust_ord_no
		   , a.upper_ptn_cd
	       , a.ctrt_cust_cd
	       , a.ctrt_cust_nm
	       , a.ord_mngt_exce_ofcr_id
	       , a.ord_mngt_exce_ofcr_nm
	       , a.sales_ord_creat_time
	       , a.cargo_form_cd
	       , a.exp_imp_dom_sctn_cd
	       , a.WORK_INFO_MNGT_TYPE_CD
	       , a.header_dpt_ar_cd
	       , a.header_dpt_ar_type_cd
		   , a.header_dpt_ar_nm
	       , a.header_dpt_ar_zip_cd
	       , a.header_dpt_ar_zip_addr
	       , a.header_dpt_ar_dtl_addr
	       , a.header_arv_ar_cd
	       , a.header_arv_ar_type_cd
		   , a.header_arv_ar_nm
	       , a.header_arv_ar_zip_cd
	       , a.header_arv_ar_zip_addr
	       , a.header_arv_ar_dtl_addr
	       , a.HEADER_rmk
	       , a.aptd_dly_cd 
		   , a.sales_ord_stat_cd 
	       , a.sales_ord_stat_nm
	       , a.move_type_cd 
	       , a.move_type_nm
		   , a.cust_of_cust_cd 
	       , a.cust_of_cust__nm
		   , a.cust_ord_type_cd 
	       , a.cust_ord_type_nm
		   , a.cust_expr_yn 
		   , a.ord_reason_cd
	       , a.ord_reason_nm
	       , a.ord_mngt_exce_dept_cd
	       , a.ord_mngt_exce_dept_nm
	       , a.line_no
		   , a.cust_cd
		   , a.item_cd
		   , a.item_nm
		   , a.basis_item_cd
		   , a.ITEM_GRADE_CD
		   , a.basis_unit_cd
		   , a.bat_no
		   , a.ord_qty
		   , a.ord_wgt
		   , a.ord_CBM
		   , a.max_qty
		   , a.max_wgt
		   , a.max_cbm
		   , a.remain_qty
		   , a.remain_wgt
		   , a.remain_cbm
		   , a.avail_stock_cnt
		   , a.divide_qty
		   , a.divide_wgt
		   , a.divide_cbm
		   , a.aptd_req_time
		   , a.aptd_req_ymd
		   , a.aptd_req_hm
	       , a.dpt_ar_cd
	       , a.dpt_ar_type_cd
	       , a.dpt_ar_nm
	       , a.arv_ar_cd
	       , a.arv_ar_type_cd
	       , a.arv_ar_nm
	       , a.wgt_unit_cd
	       , a.qty_unit_cd
	       , a.cbm
	       , a.basis_unit_attr
	       , a.MASTER_DPT_AR_CD
		   , a.DPT_AR_ZIP_CD
		   , a.DPT_AR_ZIP_ADDR
		   , a.DPT_AR_DTL_ADDR
		   , a.MASTER_ARV_AR_CD
		   , a.ARV_AR_ZIP_CD
		   , a.ARV_AR_ZIP_ADDR
		   , a.ARV_AR_DTL_ADDR
		   , a.STRT_REQ_YMD
		   , a.STRT_REQ_HM
		   , a.master_aptd_req_ymd
		   , a.master_aptd_req_hm
		   , a.rpt_cust_cd
		   , a.plant_cd
		   , A.deliv_dly_yn
		   , a.pcul_cd
		   , a.mn_cd
		   , a.rmk
		   , a.col08
		   , a.col01
		   , a.col03
		   , a.lot_no
		   ,(select max(SALES_ORD_CHG_SEQ) from tb_om02011h where sales_ord_no=A.SALES_ORD_NO) max_chg_seq 
        FROM (
			   SELECT 
				      'F' as chk
				    , '' as flag
				    , c.sales_ord_no
				    , c.ord_type_cd
				    , (select ord_type_nm from tb_ma01006 where ord_type_cd = c.ord_type_cd) ord_type_nm
				    , c.cust_ord_no
				    , c.rpt_cust_cd upper_ptn_cd
				    , c.ctrt_cust_cd
				    , ( SELECT ptn_nm 
					      FROM tb_ma01002 
					     WHERE ptn_cd = c.ctrt_cust_cd ) as ctrt_cust_nm
				    , c.ord_mngt_exce_ofcr_id
				    , ( SELECT user_nm 
					      FROM tb_ma01011 
					     WHERE user_id = c.ord_mngt_exce_ofcr_id ) as ord_mngt_exce_ofcr_nm
				    , c.sales_ord_creat_ymd || c.sales_ord_creat_hms AS sales_ord_creat_time
				    , c.cargo_form_cd
				    , c.exp_imp_dom_sctn_cd
				    , c.WORK_INFO_MNGT_TYPE_CD
				    , c.dpt_ar_cd header_dpt_ar_cd
				    , c.dpt_ar_type_cd header_dpt_ar_type_cd
				    , case when c.dpt_ar_type_cd = '02' then
					           (select name 
						          from vw_ma01_01 
						         where code = c.dpt_ar_cd 
						           AND PTN_CD = c.RPT_CUST_CD
						           and work_sctn_cd = c.dpt_ar_type_cd) 
				           else 	    	
					           (select name 
						          from vw_ma01_01 
						         where code = c.dpt_ar_cd 
						           and work_sctn_cd = c.dpt_ar_type_cd
						           and rownum = 1) 
				      end  as header_dpt_ar_nm
				    , c.dpt_ar_zip_cd header_dpt_ar_zip_cd
				    , c.dpt_ar_zip_addr header_dpt_ar_zip_addr
				    , c.dpt_ar_dtl_addr header_dpt_ar_dtl_addr
				    , c.arv_ar_cd header_arv_ar_cd
				    , c.arv_ar_type_cd header_arv_ar_type_cd
				    , case when c.arv_ar_type_cd = '02' then
					           (select name 
						          from vw_ma01_01 
						         where code = c.arv_ar_cd 
						           AND PTN_CD = c.RPT_CUST_CD
						           and work_sctn_cd = c.arv_ar_type_cd) 
				           else 	    	
					           (select name 
						          from vw_ma01_01 
						         where code = c.arv_ar_cd 
						           and work_sctn_cd = c.arv_ar_type_cd
						           and rownum = 1) 
				      end  as header_arv_ar_nm
				    , c.arv_ar_zip_cd header_arv_ar_zip_cd
				    , c.arv_ar_zip_addr header_arv_ar_zip_addr
				    , c.arv_ar_dtl_addr header_arv_ar_dtl_addr
				    , c.rmk AS HEADER_RMK
				    , c.aptd_dly_cd 
				    , c.sales_ord_stat_cd 
				    , ( SELECT comn_cd_nm
					      FROM tb_ma01015 
					     WHERE clas_cd = 'ORD_STAT_CD' 
					       AND comn_cd = c.sales_ord_stat_cd ) as sales_ord_stat_nm
				    , c.move_type_cd 
				    , ( SELECT comn_cd_nm
					      FROM tb_ma01015 
					     WHERE clas_cd = 'MOVE_TYPE_CD' 
					       AND comn_cd = c.move_type_cd ) as move_type_nm
				    , c.cust_of_cust_cd 
				    , ( SELECT cust_nm 
					   FROM tb_ma02020
					  WHERE ptn_cd = c.rpt_cust_cd
					    AND cust_ptn_cd = c.cust_of_cust_cd ) as cust_of_cust__nm
				    , c.cust_ord_type_cd 
				    , case when c.rpt_cust_cd = 'R1209' OR c.rpt_cust_cd = 'R1728' then 
				               (SELECT comn_cd_nm
					              FROM tb_ma01015 
					             WHERE clas_cd = 'EVE_CUST_ORD_TYPE_CD' 
					               AND comn_cd = c.cust_ord_type_cd ) 				
				           else 
				               (SELECT comn_cd_nm
					              FROM tb_ma01015 
					             WHERE clas_cd = 'CUST_ORD_TYPE_CD' 
					               AND comn_cd = c.cust_ord_type_cd ) 
                      end  cust_ord_type_nm
				    , c.cust_expr_yn 
				    , c.ord_reason_cd
				    , IDUSR.OMCOMM_GETCUSTREASONNM_FN(c.rpt_cust_cd, c.ord_reason_cd) as ord_reason_nm
				    , LTrim(c.ord_mngt_exce_dept_cd, '0') as ord_mngt_exce_dept_cd
				    , MACOMM_GETDEPTNM_FN(c.corp_cd, c.ord_mngt_exce_dept_cd) AS ord_mngt_exce_dept_nm
				    , a.line_no
				    , a.cust_cd
				    , a.item_cd
				    , b.item_nm
				    , a.basis_item_cd
				    , DECODE(NVL(a.item_grade_cd, ''), '', DECODE(A.CUST_CD, 'P1000', (SELECT GRADE_CD FROM TB_MA02010 WHERE PTN_CD = A.CUST_CD AND ITEM_CD = A.ITEM_CD)
																	       , 'P1591', (SELECT GRADE_CD FROM TB_MA02010 WHERE PTN_CD = A.CUST_CD AND ITEM_CD = A.ITEM_CD)
																	       , 'P1100', (SELECT GRADE_CD FROM TB_MA02011 WHERE PTN_CD = A.CUST_CD AND ITEM_CD = A.ITEM_CD AND CUST_BAT_NO = A.BAT_NO)
																	       , 'P1200', (SELECT GRADE_CD FROM TB_MA02011 WHERE PTN_CD = A.CUST_CD AND ITEM_CD = A.ITEM_CD AND CUST_BAT_NO = A.BAT_NO)
																	       , A.ITEM_GRADE_CD)
													     , A.ITEM_GRADE_CD) AS ITEM_GRADE_CD
				    , a.basis_unit_cd
				    , a.bat_no
				    , ord_qty
				    , ord_wgt
				    , ord_CBM
				    , CASE WHEN c.rpt_cust_cd = 'P1100' AND (SELECT ptn_gds_sctn_cd FROM tb_ma02010 WHERE ptn_cd = a.cust_cd AND item_cd = a.item_cd) = 'R' 
						   THEN ROUND(ord_qty * 1.1, 3)
					       ELSE ord_qty END max_qty
				    , CASE WHEN c.rpt_cust_cd = 'P1100' AND (SELECT ptn_gds_sctn_cd FROM tb_ma02010 WHERE ptn_cd = a.cust_cd AND item_cd = a.item_cd) = 'R' 
						   THEN ROUND(ord_wgt * 1.1, 3)
					       ELSE ord_wgt END max_wgt
				    , CASE WHEN c.rpt_cust_cd = 'P1100' AND (SELECT ptn_gds_sctn_cd FROM tb_ma02010 WHERE ptn_cd = a.cust_cd AND item_cd = a.item_cd) = 'R' 
						   THEN ROUND(ord_cbm * 1.1, 3)
					       ELSE ord_cbm END max_cbm
				    , ord_qty - NVL( ( SELECT sum(ord_qty) 
									     FROM tb_om03001 x
										    , tb_om03002 y 
									    WHERE x.sales_ord_no   = a.sales_ord_no
									      AND x.sales_ord_no   = y.sales_ord_no
									      AND y.line_no 	 	 = a.line_no
									      AND x.work_route_seq = y.work_route_seq
									      AND X.DEL_YN != 'Y'
									 ), 0)  as remain_qty
				    , ord_wgt - NVL( ( SELECT sum(ord_wgt) 
									     FROM tb_om03001 x
										    , tb_om03002 y 
									    WHERE x.sales_ord_no   = a.sales_ord_no
									      AND x.sales_ord_no   = y.sales_ord_no
									      AND y.line_no 	 	 = a.line_no
									      AND x.work_route_seq = y.work_route_seq
									      AND X.DEL_YN != 'Y'
									 ), 0)  as remain_wgt
				    , ord_CBM - NVL( ( SELECT sum(ord_CBM) 
									     FROM tb_om03001 x
										    , tb_om03002 y 
									    WHERE x.sales_ord_no   = a.sales_ord_no
									      AND x.sales_ord_no   = y.sales_ord_no
									      AND y.line_no 	 	 = a.line_no
									      AND x.work_route_seq = y.work_route_seq
									      AND X.DEL_YN != 'Y'
									 ), 0)  as remain_cbm
				    , 0 avail_stock_cnt
				    , ord_qty - NVL( ( SELECT sum(ord_qty) 
									     FROM tb_om03001 x
									        , tb_om03002 y 
									    WHERE x.sales_ord_no   = a.sales_ord_no
									      AND x.sales_ord_no   = y.sales_ord_no
									      AND y.line_no 	 	 = a.line_no
									      AND x.work_route_seq = y.work_route_seq
									      AND X.DEL_YN != 'Y'
								      ), 0)  as divide_qty
				    , ord_wgt - NVL( ( SELECT sum(ord_wgt) 
									     FROM tb_om03001 x
										    , tb_om03002 y 
									    WHERE x.sales_ord_no   = a.sales_ord_no
									      AND x.sales_ord_no   = y.sales_ord_no
									      AND y.line_no 	 	 = a.line_no
									      AND x.work_route_seq = y.work_route_seq
									      AND X.DEL_YN != 'Y'
								      ), 0)  as divide_wgt
				    , ord_CBM - NVL( ( SELECT sum(ord_CBM) 
									     FROM tb_om03001 x
									        , tb_om03002 y 
									    WHERE x.sales_ord_no   = a.sales_ord_no
									      AND x.sales_ord_no   = y.sales_ord_no
									      AND y.line_no 	 	 = a.line_no
									      AND x.work_route_seq = y.work_route_seq
									      AND X.DEL_YN != 'Y'
								      ), 0)  as divide_cbm
				    , a.aptd_req_ymd || a.aptd_req_hm  AS aptd_req_time
				    , a.aptd_req_ymd
				    , a.aptd_req_hm
				    , a.dpt_ar_cd
				    , a.dpt_ar_type_cd
				    , case when a.dpt_ar_type_cd = '02' then
					           (SELECT name
						          FROM vw_ma01_01
						         WHERE code = a.dpt_ar_cd
						           and ptn_cd = c.rpt_cust_cd
						           and work_sctn_cd = a.dpt_ar_type_cd ) 
				           else		
					           (SELECT name
						          FROM vw_ma01_01
						         WHERE code = a.dpt_ar_cd
						           and work_sctn_cd = a.dpt_ar_type_cd
						           and rownum = 1 ) 
				      end  	as dpt_ar_nm
				    , a.arv_ar_cd
				    , a.arv_ar_type_cd
				    , case when a.arv_ar_type_cd = '02' then
					           (SELECT name
						          FROM vw_ma01_01
						         WHERE code = a.arv_ar_cd
						           AND PTN_CD = C.RPT_CUST_CD
						           and work_sctn_cd = a.arv_ar_type_cd ) 
				           else 
					           (SELECT name
						          FROM vw_ma01_01
						         WHERE code = a.arv_ar_cd
						           and work_sctn_cd = a.arv_ar_type_cd
						           and rownum = 1 ) 
				      end  as arv_ar_nm
				    , b.wgt_unit_cd
				    , b.qty_unit_cd
				    , b.cbm
				    , ( SELECT fltr_conts1 
					      FROM tb_ma01015 
					     WHERE clas_cd = 'BASIC_UNIT_CD' 
					       AND comn_cd = a.basis_unit_cd ) as basis_unit_attr
				    , C.DPT_AR_CD AS MASTER_DPT_AR_CD
				    , C.DPT_AR_ZIP_CD
				    , C.DPT_AR_ZIP_ADDR
				    , C.DPT_AR_DTL_ADDR
				    , C.ARV_AR_CD AS MASTER_ARV_AR_CD
				    , C.ARV_AR_ZIP_CD
				    , C.ARV_AR_ZIP_ADDR
				    , C.ARV_AR_DTL_ADDR
				    , C.STRT_REQ_YMD
				    , C.STRT_REQ_HM
				    , C.APTD_REQ_YMD as master_aptd_req_ymd
				    , C.APTD_REQ_HM as master_aptd_req_hm
				    , C.rpt_cust_cd
				    , a.plant_cd
				    , A.deliv_dly_yn
				    , a.pcul_cd
				    , a.mn_cd
				    , a.rmk
				    , decode(c.rpt_cust_cd,'P1000',decode(e.col08,'','N','Y'),'P1591',decode(e.col08,'','N','Y'),'N') col08
				    , f.col01
				    , f.col03
				    , a.lot_no
			     FROM TB_OM02002 A, TB_OM02001 C, TB_MA02010 B, TB_MA01015 D, TB_OM02004 E, TB_OM02005 F
			    WHERE 1 = 1 
			      AND A.SALES_ORD_NO = C.SALES_ORD_NO
			      AND A.SALES_ORD_NO = E.SALES_ORD_NO
			      and a.sales_ord_no = f.sales_ord_no
			      and a.line_no      = f.line_no
			      AND A.CUST_CD = B.PTN_CD
			      AND A.ITEM_CD = B.ITEM_CD
			      AND D.clas_cd = 'BASIC_UNIT_CD'
			      AND A.basis_unit_cd = d.comn_cd
			      AND a.ORD_REASON_CD IS NULL
			      AND A.DEL_YN != 'Y'
			      AND c.BACK_ORD_YN = 'Y'
			      AND c.SALES_ORD_CNCL_YN = 'N'
			      AND c.SALES_ORD_STAT_CD != '06'
			     {#1}
			     {#2}
			 ) A
	   WHERE DECODE(A.BASIS_UNIT_ATTR, 'QTY_UNIT_CD', A.REMAIN_QTY, 'WGT_UNIT_CD', A.REMAIN_WGT, A.REMAIN_CBM) > 0
       ORDER BY A.sales_ord_no, to_number(a.line_no)
    ]]>
	<append condition="${selGbn}.EQ.B&amp;${ordNoGbn}.EQ.S" id="#1">
		          AND c.sales_ord_no = ${ordNo}
	</append>
	<append condition="${selGbn}.EQ.B&amp;${ordNoGbn}.EQ.C" id="#1">
		          AND c.cust_ord_no = ${ordNo}
	</append>
    <append condition="${selGbn}.EQ.D&amp;${salesOrdStatCd}.NOTEMPTY" id="#1">
    	          AND c.sales_ord_stat_cd = ${salesOrdStatCd}
    </append> 
    <append condition="${selGbn}.EQ.D&amp;${ordTypeCd}.NOTEMPTY" id="#1">
    	          AND c.ord_type_cd = ${ordTypeCd}
    </append> 
	<append condition="${selGbn}.EQ.D&amp;${dateGbn}.EQ.CD" id="#1">
		          AND c.sales_ord_creat_ymd between ${startDate} and ${endDate}
	</append>
	<append condition="${selGbn}.EQ.D&amp;${dateGbn}.EQ.RD" id="#1">
		          AND c.aptd_req_ymd between ${startDate} and ${endDate}
	</append>
    <append condition="${selGbn}.EQ.D&amp;${rptCustCd}.NOTEMPTY" id="#1">
    	          AND c.rpt_cust_cd = ${rptCustCd}
    </append> 
    <append condition="${selGbn}.EQ.D&amp;${custOfCustCd}.NOTEMPTY" id="#1">
    	          AND c.cust_of_cust_cd = ${custOfCustCd}
    </append> 
    <append condition="${selGbn}.EQ.D&amp;${moveTypeCd}.NOTEMPTY" id="#1">
    	          AND c.move_type_cd = ${moveTypeCd}
    </append> 
    <append condition="${selGbn}.EQ.D&amp;${custOrdTypeCd}.NOTEMPTY" id="#1">
    	          AND c.cust_ord_type_cd = ${custOrdTypeCd}
    </append> 
    <append condition="${selGbn}.EQ.D&amp;${rmk}.NOTEMPTY" id="#1">
	              AND exists (SELECT 1
	                            FROM tb_om02002 z
	                           WHERE z.sales_ord_no   = c.sales_ord_no
	                             AND z.rmk Like '%'||${rmk}||'%')
    </append>
    <append condition="${selGbn}.EQ.D&amp;${ordMngtExceDeptCd}.NOTEMPTY" id="#1">
		          AND c.ord_mngt_exce_dept_cd = lpad(${ordMngtExceDeptCd}, 10, '0')
    </append>
	<append condition="${selGbn}.EQ.D&amp;${aptdDlyCd}.EQ.Y&amp;${aptdDlyCd}.NOTEMPTY" id="#1">
		          AND (c.aptd_dly_cd IS NOT NULL AND c.aptd_dly_cd != 'ZZ')
	</append>
	<append condition="${selGbn}.EQ.D&amp;${aptdDlyCd}.EQ.N&amp;${aptdDlyCd}.NOTEMPTY" id="#1">
		          AND (c.aptd_dly_cd IS NULL OR c.aptd_dly_cd = 'ZZ')
	</append>
   <append condition="${lineNo}.NOTEMPTY" id="#2">
                  AND A.line_no = ${lineNo}
   </append>
 
   <append condition="${preOrdGubun}.EQ.Y&amp;${preOrdGubun}.NOTEMPTY" id="#2">
    	          AND e.col08 is not null
    </append>

   <append condition="${preOrdGubun}.EQ.N&amp;${preOrdGubun}.NOTEMPTY" id="#2">
    	          AND e.col08 is null
    </append>
   
  </statement>  
  
  <!-- 대기오더분배완료 여부 조회 -->
  <statement name="retrieveBackOrdDivCmptYn">
      SELECT COUNT(*) cnt
        FROM 
            (SELECT a.sales_ord_no
                  , a.line_no
                  , sum(a.divide_qty)
                  , sum(b.divide_qty)
               FROM 
                   (SELECT a.sales_ord_no
                         , a.line_no
                         , nvl(
                                SUM(
                                     decode( b.FLTR_CONTS1 
                                           , 'QTY_UNIT_CD', a.ord_qty
                                           , 'WGT_UNIT_CD', a.ord_wgt
                                           , 'CBM',         a.ord_cbm ) 
                                    )
                         , 0)   AS divide_qty
                      FROM  tb_om02002 a
                          , tb_ma01015 b
                     WHERE  a.sales_ord_no = ${salesOrdNo}
                       AND  b.clas_cd = 'BASIC_UNIT_CD'
                       AND  a.basis_unit_cd = b.comn_cd
                       AND  a.del_yn = 'N'
                       AND  a.ord_reason_cd IS NULL
                     GROUP BY a.sales_ord_no, a.line_no ) a
                 , (SELECT a.sales_ord_no
                         , a.line_no
                         , nvl(
                               SUM(
                                    decode( b.FLTR_CONTS1 
                                            , 'QTY_UNIT_CD', a.ord_qty
                                            , 'WGT_UNIT_CD', a.ord_wgt
                                            , 'CBM',         a.ord_cbm ) 
                                   )
                          , 0)   AS divide_qty
                       FROM  tb_om03002 a
                           , tb_ma01015 b
                           , tb_om02002 c
                           , TB_OM03001 D
                       WHERE a.sales_ord_no = ${salesOrdNo}
                         AND a.sales_ord_no = c.sales_ord_no
                         AND A.SALES_ORD_NO = D.SALES_ORD_NO
                         AND A.WORK_ROUTE_SEQ = D.WORK_ROUTE_SEQ
                         AND D.DEL_YN != 'Y'
                         AND a.line_no = c.line_no
                         AND b.clas_cd = 'BASIC_UNIT_CD'
                         AND c.basis_unit_cd = b.comn_cd
                         AND c.del_yn = 'N'
                         AND c.ord_reason_cd IS NULL
                       GROUP BY a.sales_ord_no, a.line_no ) b
           WHERE a.sales_ord_no = b.sales_ord_no(+)
             AND a.line_no = b.line_no(+)
           GROUP BY a.sales_ord_no, a.line_no
           HAVING SUM(a.divide_qty) != NVL(SUM(b.divide_qty), 0)
          )
  </statement>
  
  <!-- 창고정산 예외오더 조회 -->
  <statement name="retrieveWrhsExcaExceptOrd">
	  SELECT rownum    rnum
	       , ( select logis_domn_cd
	             from tb_ma01006
	            where ord_type_cd = om.ord_type_cd) as logis_domn_cd	 -- 물류영역코드(오더유형으로 추출)
	       , om.corp_cd				      -- 법인코드
	       , om.work_pl_cd			      -- 작업센터코드
	       , (select work_pl_nm from tb_ma01005 
		       where work_pl_cd = om.work_pl_cd) work_pl_nm
	       , om.sales_ord_no			      -- 판매오더번호
	       , om.ord_type_cd				  -- 오더유형코드
	       , om.ctrt_no				      -- 계약번호
	       , om.ctrt_cust_cd			      -- 계약고객코드
	       , (select ptn_nm from tb_ma01002 
		       where ptn_cd = ctrt_cust_cd ) ctrt_cust_nm
	       , LTrim(om.sell_dept_cd, '0') as sell_dept_cd    -- 매출부서코드
	       , (select dept_nm from tb_ma01009 
		       where dept_cd = om.sell_dept_cd  ) sell_dept_nm
	       , om.bilg_cust_cd			      -- 청구고객코드
	       , (select ptn_nm from tb_ma01002 
		       where ptn_cd = bilg_cust_cd ) bilg_cust_nm
	       , om.add_svc_type_cd			  -- 추가서비스유형코드
	       ,(select comn_cd_nm from tb_ma01015 
		      where clas_cd = 'ADD_SVC_TYPE_CD'
		        and comn_cd = om.add_svc_type_cd) add_svc_type_nm
	       , om.sales_ord_creat_ymd 	      -- 판매오더생성일자
		   , mbl.mbl_no
		   , om.sales_ord_stat_cd
	    FROM  tb_om02001 om, tb_om02003 mbl
	   WHERE 1 = 1
        {#1}
        {#2}
        {#3}
        {#4}
        {#5}
        {#6}
        {#7}
        {#8}
        {#9}
        {#10}
        {#11}
        {#12}
        {#13}
         AND om.sales_ord_no = mbl.sales_ord_no(+)
    <append condition="${corpCd}.notempty" id="#1">
         AND om.corp_cd  = ${corpCd}
    </append>
    <append condition="${salesOrdNo}.notempty" id="#2">
         AND om.sales_ord_no  = ${salesOrdNo}
    </append>
    <append condition="${ordMngtExceDeptCd}.notempty" id="#3">
         AND om.ord_mngt_exce_dept_cd  = LPAD(${ordMngtExceDeptCd}, 10, '0')
    </append>
    <append condition="${addSvcTypeCdFlag}.EQ.Y" id="#4">
         AND om.add_svc_type_cd is not null
    </append>
    <append condition="${bilgCustCd}.notempty" id="#5">
         AND om.bilg_cust_cd = ${bilgCustCd}
    </append>
    <append condition="${ctrtCustCd}.notempty" id="#6">
         AND om.ctrt_cust_cd = ${ctrtCustCd}
    </append>
    <append condition="${workPlCd}.notempty" id="#7">
         AND om.work_pl_cd = ${workPlCd}
    </append>
    <append condition="${sellDeptCd}.notempty" id="#8">
         AND om.sell_dept_cd = LPAD(${sellDeptCd}, 10, '0')
    </append>
    <append condition="${addSvcTypeCd}.notempty" id="#9">
         AND om.add_svc_type_cd = ${addSvcTypeCd}
    </append>
    <append condition="${cmptOrd}.EQ.Y" id="#10">
         AND om.sales_ord_stat_cd  &lt;> '06'
    </append>
    <append condition="${ymdFrom}.notempty" id="#11">
         AND om.sales_ord_creat_ymd  >= ${ymdFrom}
    </append>
    <append condition="${ymdTo}.notempty" id="#12">
         AND om.sales_ord_creat_ymd  &lt;= ${ymdTo}
    </append>
    <append condition="${mblNo}.notempty" id="#13">
         AND mbl.mbl_no = ${mblNo}
    </append>
  </statement>

  <!-- 운송정보조회(통합매출입생성 프로그램) -->
  <statement name="retrieveTranInfo">
	  SELECT dpt_ar_type_cd,	  -- 출발지유형코드
	         dpt_ar_cd,			  -- 출발지코드
		     arv_ar_type_cd,	  -- 도착지유형코드
	         arv_ar_cd			  -- 도착지코드
	    FROM tb_om02001
	   WHERE sales_ord_no = ${salesOrdNo}
  </statement>

  <!-- 계약고객조회(통합매출입생성 프로그램) -->
  <statement name="retrieveCtrtCustCd">
      SELECT ctrt_cust_cd FROM tb_om02001 WHERE sales_ord_no = ${salesOrdNo}
  </statement>
  
<!-- 내수판매 오더 실행관리 헤더조회 -->
  <statement name="retrieveDomSalesOrdExceMngtOrdBasisInfo">
  <![CDATA[
  	SELECT 
			  a.sales_ord_no 	                          --판매오더번호
			, a.corp_cd
			, a.rpt_cust_cd
			, a.ord_type_cd 	                          --오더유형코드
			, b.ord_type_nm	                            --오더유형명
			, a.add_svc_type_cd
			, b.logis_svc_sctn_cd			                  --물류서비스구분코드
			, ( SELECT upper_comn_cd
			      FROM Tb_Ma01015
			     WHERE clas_cd = 'LOGIS_AR_CD'
			       AND comn_cd = b.logis_ar_cd)	AS exp_imp_dom_sctn_cd  				               --수출입내수구분코드
			, a.cargo_form_cd
			, LTrim(a.ord_mngt_exce_dept_cd, '0') as ord_mngt_exce_dept_cd 				             --오더관리실행부서코드
			, MACOMM_GETDEPTNM_FN(a.corp_cd, a.ord_mngt_exce_dept_cd) AS ord_mngt_exce_dept_nm --오더관리실행부서명
			, a.ord_mngt_fwd_dept_cd
			, a.ord_mngt_exce_ofcr_id                                                          --오더관리실행담당자아이디
			, MACOMM_GETUSERNM_FN( a.ord_mngt_exce_ofcr_id ) AS ord_mngt_exce_ofcr_nm          --오더관리실행담당자명
			, a.ord_mngt_fwd_ofcr_id
			, a.tran_plan_cntr_cd
			, a.sales_ord_stat_cd                                                              --판매오더상태코드
			, MACOMM_GETCD_FN('ORD_STAT_CD', a.sales_ord_stat_cd ) AS sales_ord_stat_nm        --판매오더상태명
			, a.cust_ord_no 	                                                                 --고객오더번호
			, a.cust_cd
			, a.cust_ord_type_cd 			                                                         --고객오더유형코드
			, case when a.rpt_cust_cd='R1209' OR a.rpt_cust_cd='R1728' then
			  	MACOMM_GETCD_FN( 'EVE_CUST_ORD_TYPE_CD', a.cust_ord_type_cd) 			
			  else
			  	MACOMM_GETCD_FN( 'CUST_ORD_TYPE_CD', a.cust_ord_type_cd) 
              end cust_ord_type_nm     --고객오더유형명
			, a.cust_move_type_cd 			                                                       --고객이동유형코드
			, decode(rpt_cust_cd, 'P1000', (select comn_cd_nm from tb_ma01015 where clas_cd = 'HPP_MOVE_TYPE_CD' and comn_cd = a.cust_move_type_cd)
								, 'P1591', (select comn_cd_nm from tb_ma01015 where clas_cd = 'HPP_MOVE_TYPE_CD' and comn_cd = a.cust_move_type_cd)
								, 'P1200', (select comn_cd_nm from tb_ma01015 where clas_cd = 'HHP_MOVE_TYPE_CD' and comn_cd = a.cust_move_type_cd) 
								, '') as cust_move_type_nm
			, to_char(a.cust_ord_recp_date, 'YYYYMMDD') as cust_ord_recp_ymd		               --고객오더접수일시
			, to_char(a.cust_ord_recp_date, 'HH24MI') as cust_ord_recp_hm		                 --고객오더접수일시
			, a.cust_ord_recp_chn_cd 	                                                         --고객오더접수채널코드
			, MACOMM_GETCD_FN( 'CUST_ORD_RECP_CHN_CD', a.cust_ord_recp_chn_cd) as cust_ord_recp_chn_nm	--고객오더접수채널명
			, a.ctrt_cust_cd                                                                            --계약고객코드
			, MACOMM_GETPTNNM_FN(a.ctrt_cust_cd ) AS ctrt_cust_nm	                                      --계약고객명
			, a.ctrt_no 			                                                                          --계약번호
			, ( SELECT y.ctrt_nm
			      FROM tb_sm04110 x
			         , tb_sm07110 y
			     WHERE x.corp_cd 	    = y.corp_cd
			       AND x.prmt_biz_no  = y.prmt_biz_no
			       AND x.cust_cd 	    = a.ctrt_cust_cd
			       AND x.sell_ctrt_no = a.ctrt_no) as ctrt_nm
			, a.ord_req_cust_cd 			                                                                  --오더요청고객코드
			, MACOMM_GETPTNNM_FN( a.ord_req_cust_cd) as ord_req_cust_nm			                            --오더요청고객명
			, a.bilg_cust_cd 				                                                                    --청구고객코드
			, MACOMM_GETPTNNM_FN( a.bilg_cust_cd ) AS bilg_cust_nm 				                              --청구고객명
			, a.cust_ofcr_nm 				                                                                    --고객담당자명
			, a.cust_ofcr_tel_no 			                                                                  --고객담당자전화번호
			, a.cust_of_cust_cd 			                                                                  --고객거래선코드
			, ( SELECT cust_nm 
			      from tb_ma02020 
			     where ptn_cd = ( select upper_ptn_cd 
			                        from tb_ma01002 
			                       where ptn_cd      = a.ctrt_cust_cd) 
			       and cust_ptn_cd = a.cust_of_cust_cd ) as cust_of_cust_nm		                        --고객거래선명
			, a.sup_pl_cd 				                                                                      --공급지코드
			, ( SELECT cust_nm 
			      from tb_ma02020 
			     where ptn_cd = ( select upper_ptn_cd 
			                        from tb_ma01002 
			                       where ptn_cd = a.ctrt_cust_cd) 
			       and cust_ptn_cd = a.sup_pl_cd ) as sup_pl_nm		                                      --공급지명
			, a.plant_cd
			, a.cust_ref_no 				                                                                    --고객참조번호
			, a.dpt_ar_cd 				                                                                      --출발지코드
			, a.dpt_ar_type_cd 				                                                                  --출발지코드
			, case when a.dpt_ar_type_cd = '02' then
			          ( select name 
			              from vw_ma01_01 
			             where code         = a.dpt_ar_cd 
			               AND PTN_CD       = A.RPT_CUST_CD
			               and work_sctn_cd = a.dpt_ar_type_cd) 
			       else 
			          ( select name 
			              from vw_ma01_01 
			             where code         = a.dpt_ar_cd 
			               and work_sctn_cd = a.dpt_ar_type_cd
			               and rownum       = 1) 
			  end as dpt_AR_NM   
			, a.dpt_ar_zip_cd 			                                                                    --출발지우편번호
			, a.dpt_ar_zip_addr 			                                                                  --출발지우편주소
			, a.dpt_ar_dtl_addr 			                                                                  --출발지상세주소
			, a.dpt_ar_ofcr_nm 			                                                                    --출발지 담당자명
			, a.dpt_ar_ofcr_tel_no 		                                                                  --출발지 전화번호
			, a.arv_ar_cd 				                                                                      --도착지 코드
			, a.arv_ar_type_cd 				                                                                  --도착지 코드
			, CASE WHEN a.arv_ar_type_cd = '02' THEN
			          ( select name 
			              from vw_ma01_01 
			             where code         = a.arv_ar_cd 
			               AND PTN_CD       = A.RPT_CUST_CD
			               and work_sctn_cd = a.arv_ar_type_cd) 
			      ELSE 
			          ( select name 
			              from vw_ma01_01 
			             where code         = a.arv_ar_cd 
			               and work_sctn_cd = a.arv_ar_type_cd
			               and rownum       = 1) 
			  END as ARV_AR_NM   
			, a.arv_ar_zip_cd 			                                                                    --도착지우편번호
			, a.arv_ar_zip_addr 			                                                                  --도착지우편주소
			, a.arv_ar_dtl_addr 			                                                                  --도착지상세주소
			, a.arv_ar_ofcr_nm 			                                                                    --도착지담당자명
			, a.arv_ar_ofcr_tel_no 		                                                                  --도착지전화번호
			, a.work_pl_cd
			, a.strt_req_ymd 				                                                                    --시작요청일자
			, a.strt_req_hm 				                                                                    --시작요청시간
			, a.aptd_req_ymd 				                                                                    --납기요청일자
			, a.aptd_req_hm 				                                                                    --납기요청시간
			, LTrim(a.sell_dept_cd, '0') as sell_dept_cd 							                                  --매출부서코드
			, MACOMM_GETDEPTNM_FN( a.corp_cd, a.sell_dept_cd ) AS sell_dept_nm 	                        --매출부서명
			, a.sales_ofcr_id 			                                                                    --영업사원아이디
			, MACOMM_GETUSERNM_FN( a.sales_ofcr_id ) AS sales_ofcr_nm 			                            --영업사원명
			, a.sell_dcsn_sctn_cd 		                                                                        --매출확정구분코드
			, CASE WHEN (select NVL(MAX(d.dcsn_sctn_cd),'0') 
	             	  	   from tb_is01001 d 
	             	  	  where d.sales_ord_no = A.SALES_ORD_NO) < 2 THEN
	             	  	 '1'
	               ELSE '2' 
	          END  sell_dcsn_sctn_nm																				--매출확정구분명
			, a.cust_expr_yn 				                                                                    --고객긴급여부
			, a.cls_expr_yn 				                                                                    --마감긴급여부
			, a.lead_time_expr_yn 		                                                                  --리드타임긴급여부
			, a.dtod_yn      
			, a.rmk 						                                                                        --비고
			, a.load_dly_yn
			, a.load_dly_rltd_sales_ord_no
			, a.back_ord_yn 				                                                                    --대기오더여부
			, a.aft_ord_yn				                                                                      --사후오더여부
			, a.chg_aptd_ymd
			, a.chg_aptd_hm
			, a.sales_ord_creat_ymd 		                                                                --판매오더생성일자
			, a.sales_ord_creat_hms 		                                                                --판매오더생성시간
			, a.sales_ord_cncl_yn
			, to_char(a.sales_ord_cncl_date, 'yyyymmdd') as sales_ord_cncl_ymd		                      --판매오더취소일시
			, to_char(a.sales_ord_cncl_date, 'hh24miss') as sales_ord_cncl_Hms		                      --판매오더취소일시
			, a.SALES_ORD_CNCL_REASON		                                                                --판매오더취소사유
			, a.sales_ord_cmpt_sctn_cd 	                                                                --판매오더완료구분코드
			, MACOMM_GETCD_FN( 'SALES_ORD_CMPT_SCTN_CD', a.sales_ord_cmpt_sctn_cd) as sales_ord_cmpt_sctn_nm	--판매오더완료구분명
			, to_char(a.sales_ord_cmpt_date, 'yyyymmdd') as sales_ord_cmpt_ymd		                            --판매오더완료일시
			, to_char(a.sales_ord_cmpt_date, 'hh24miss') as sales_ord_cmpt_Hms		                            --판매오더완료일시
			, a.ORD_REASON_CD				                                                                          --오더사유
			, IDUSR.OMCOMM_GETCUSTREASONNM_FN(a.rpt_cust_cd, a.ord_reason_cd) as ORD_REASON_NM      
			, a.RLTD_GI_ORD_NO			                                                                          --관련출고오더번호
			, a.work_info_mngt_type_cd 	                                                                      --작업정보관리유형코드
			, a.if_id
			, a.tran_eo_no
			, a.LTRM_ORD_YN				                                                                            --장기오더여부
			, a.rltd_gi_eo_no
			, DECODE( ( SELECT COUNT(*) 
			              FROM TB_OM02002 
			             WHERE SALES_ORD_NO = A.SALES_ORD_NO 
			               AND (NVL(DPT_AR_CD, 'X') != nvl(A.DPT_AR_CD, 'X')
		                         OR NVL(DPT_AR_ZIP_CD, 'X') != nvl(A.DPT_AR_ZIP_CD, 'X') 
		                         OR NVL(DPT_AR_ZIP_CD, 'X') != nvl(A.DPT_AR_ZIP_CD, 'X')
		                         OR NVL(DPT_AR_ZIP_ADDR, 'X') != nvl(A.DPT_AR_ZIP_ADDR, 'X')
		                         OR NVL(DPT_AR_DTL_ADDR, 'X') != nvl(A.DPT_AR_DTL_ADDR, 'X')
		                         OR NVL(ARV_AR_CD, 'X') != nvl(A.ARV_AR_CD, 'X')
		                         OR NVL(ARV_AR_ZIP_CD, 'X') != nvl(A.ARV_AR_ZIP_CD, 'X')
		                         OR NVL(ARV_AR_ZIP_ADDR, 'X') != nvl(A.ARV_AR_ZIP_ADDR, 'X')
		                         OR NVL(ARV_AR_DTL_ADDR, 'X') != nvl(A.ARV_AR_DTL_ADDR, 'X')
		                         OR NVL(STRT_REQ_YMD, 'X') || NVL(STRT_REQ_HM, 'X') != nvl(A.STRT_REQ_YMD, 'X') || nvl(A.STRT_REQ_HM, 'X')
		                         OR NVL(APTD_REQ_YMD, 'X') || NVL(APTD_REQ_HM, 'X') != nvl(A.APTD_REQ_YMD, 'X') || nvl(A.APTD_REQ_HM, 'X') )  ), 0, 'N', 'Y') ITEM_DIFF_YN
			, A.LINE_SCTN_CD
			, A.DCNCT_ORD_YN
			, A.PAY_COND_CD	
			, A.MOVE_TYPE_CD	
			, (select comn_cd_nm from tb_ma01015 where clas_cd = 'MOVE_TYPE_CD' and comn_cd = a.move_type_cd) move_type_nm
			, A.TRAN_COND_CD		
			, A.GI_CNCL_REASON_CD
			, A.ORD_VERIFY_YN
			, A.APTD_DLY_CD
			, A.SELF_TRAN_YN
			, (select ord_kind_cd
            	 from tb_ma01006
            	where ord_type_cd = a.ord_type_cd) as ord_kind_cd
			, C.col01
			, C.col02
			, C.col03
			, C.col04
			, C.col05
			, C.col06
			, C.col07
			, C.col08
			, C.col09
			, C.col10
			, C.col11
			, C.col12
			, C.col13
			, C.col14
			, C.col15
			, C.col16
			, C.col17
			, C.col18
			, C.col19
			, C.col20
			, C.col21
			, C.col22
			, C.col23
			, C.col24
			, C.col25
			, C.col26
			, C.col27
			, C.col28
			, C.col29
			, C.col30
		    , '' as UPD_FLAG
		    , decode(a.rpt_cust_cd,'P1000',decode(c.col08,'','N','Y'),'P1591',decode(c.col08,'','N','Y'),'N') preOrdYn
		    , (select max(SALES_ORD_CHG_SEQ) 
		         from tb_om02011h 
		        where sales_ord_no=A.SALES_ORD_NO) max_chg_seq 
  	    FROM TB_OM02001 A
  		   , TB_OM02004 C
  		   , TB_MA01006 B
  	   WHERE A.ord_type_cd = B.ord_type_cd
  	     AND A.SALES_ORD_NO = C.SALES_ORD_NO(+)
  	     {#1}
  	]]>
    <append condition="${salesOrdNo}.NOTEMPTY" id="#1">
         AND A.SALES_ORD_NO  = ${salesOrdNo}
    </append>
  </statement>

<!-- 내수판매 오더 실행관리 헤더조회 -->
  <statement name="retrieveSimpleDomSalesOrdExceMngtOrdBasisInfo">
  	  SELECT a.sales_ord_no
		   , a.corp_cd
	       , a.rpt_cust_cd
		   , a.ord_type_cd 	                          
	       , a.cust_ord_no                                     
  	    FROM TB_OM02001 A
  	   WHERE A.SALES_ORD_NO  = ${salesOrdNo}
  </statement>
      
  <statement name="retrieveWorkRouteSalesOrdBasisInfo">
  	  SELECT  a.sales_ord_no
			, a.corp_cd
			, a.rpt_cust_cd
			, a.ord_type_cd 	                          
			, (SELECT x.ord_type_nm	                            
			     FROM tb_ma01006 x
			    WHERE x.ord_type_cd = a.ord_type_cd) ord_type_nm
			, a.ctrt_cust_cd                                                                            
			, MACOMM_GETPTNNM_FN(a.ctrt_cust_cd ) AS ctrt_cust_nm	
			, a.cust_ord_no                                     
  	    FROM TB_OM02001 A
  	   WHERE A.SALES_ORD_NO  = ${salesOrdNo}
  </statement>
  
<!-- 내수판매 오더 실행관리 라인아이템 조회 -->
  <statement name="retrieveDomSalesOrdExceMngtItemList">
	SELECT 
			  a.sales_ord_no 
			, a.line_no 
			, a.cust_cd
			, a.item_cd 
			, b.item_nm
			, a.basis_item_cd
			, a.cust_ord_line_no
			, DECODE(NVL(a.item_grade_cd, ''), '', idusr.OMCOMM_GET_ITEM_INFO_FN(A.CUST_CD, A.ITEM_CD, 'ITEM_GRADE_CD', A.BAT_NO, A.ITEM_GRADE_CD)
											 , A.ITEM_GRADE_CD) AS ITEM_GRADE_CD_MST
		    , a.item_grade_cd
			, a.ord_qty 			
			, trunc(ord_qty) as R_CNT           
			, decode(MOD(ord_qty, 1),0,0,decode(B.pckg_qty ,0,500,B.pckg_qty)*MOD(ord_qty, 1))  as PAPER_CNT			           
			, a.ord_qty as org_ord_qty
			, a.qty_unit_cd 
			, NVL(f.rslt_qty, 0) rslt_qty 
			, a.ord_qty - NVL(f.rslt_qty, 0) remain_qty
			, a.ord_wgt 
			, a.ord_wgt as org_ord_wgt
			, a.wgt_unit_cd 
			, NVL(f.rslt_wgt, 0) rslt_wgt 
			, a.ord_wgt - NVL(f.rslt_wgt, 0) remain_wgt
			, a.admt
			, a.ord_cbm 
			, a.ord_cbm as org_ord_cbm
			, NVL(f.rslt_cbm , 0) rslt_cbm
			, a.ord_cbm - NVL(f.rslt_cbm, 0) remain_cbm
			, a.basis_unit_cd
			, (select x.fltr_conts1 from tb_ma01015 x where x.clas_cd = 'BASIC_UNIT_CD' and x.comn_cd = a.basis_unit_cd) unit_cd
			, a.bat_no 
			, a.cust_bat_no
			, a.mnf_no
			, a.lot_no 
			, a.prdt_req_no 
			, a.prdt_prar_ymd 
			, DECODE(NVL(a.plant_cd, ''), '', idusr.OMCOMM_GET_ITEM_INFO_FN(A.CUST_CD, A.ITEM_CD, 'PLANT_CD', A.BAT_NO, A.plant_cd)
											, A.plant_cd) AS plant_cd
			, MACOMM_GETCD_FN('PLANT_CD', DECODE(NVL(a.plant_cd, ''), '', idusr.OMCOMM_GET_ITEM_INFO_FN(A.CUST_CD, A.ITEM_CD, 'PLANT_CD', A.BAT_NO, A.plant_cd)
											, A.plant_cd)) AS plant_nm								
			, a.sales_uprice 
			, case when c.cust_ord_type_cd in ('ZC1','ZC2', 'ZC3') then ( select cust_ord_no 
																		from tb_om02001 ia, tb_om02002 ib 
																	   where ia.sales_ord_no = ib.sales_ord_no 
																	     and ib.cust_ref_no = c.cust_ord_no 
																	     and rownum = 1 ) 
			       else a.cust_ref_no  
			  end cust_ref_no
			, a.fe_sctn_cd
			, a.cntr_size_cd
			, a.cntr_no
			, a.danger_sctn_cd
			, a.seal_no1
			, a.seal_no2
			, a.pckg_unit_cd
			, a.pckg_qty
			, a.max_tmpt
			, a.min_tmpt
			, a.dpt_ar_cd 
			, a.dpt_ar_type_cd 
			, CASE WHEN a.dpt_ar_type_cd = '02' THEN
			          ( SELECT name 
			              FROM vw_ma01_01 
			             WHERE code         = a.dpt_ar_cd 
			               AND PTN_CD       = C.RPT_CUST_CD
			               AND work_sctn_cd = a.dpt_ar_type_cd) 
			       ELSE
			          ( SELECT name 
			              FROM vw_ma01_01 
			             WHERE code         = a.dpt_ar_cd 
			               AND work_sctn_cd = a.dpt_ar_type_cd
			               AND ROWNUM       = 1) 
			  END  as dpt_ar_nm
			, a.dpt_ar_zip_cd 
			, a.dpt_ar_zip_addr 
			, a.dpt_ar_dtl_addr 
			, a.dpt_ar_ofcr_nm 
			, a.dpt_ar_ofcr_tel_no 
			, a.arv_ar_cd 
			, a.arv_ar_type_cd 
			, CASE WHEN a.arv_ar_type_cd = '02' THEN
			          ( SELECT name 
			              FROM vw_ma01_01 
			             WHERE code         = a.arv_ar_cd 
			               AND PTN_CD       = C.RPT_CUST_CD
			               AND work_sctn_cd = a.arv_ar_type_cd) 
			       ELSE
			          ( SELECT name 
			              FROM vw_ma01_01 
			             WHERE code         = a.arv_ar_cd 
			               AND work_sctn_cd = a.arv_ar_type_cd
			               AND ROWNUM       = 1) 
			  END  as arv_ar_nm
			, a.arv_ar_zip_cd 
			, a.arv_ar_zip_addr 
			, a.arv_ar_dtl_addr 
			, a.arv_ar_ofcr_nm 
			, a.arv_ar_ofcr_tel_no 
			, a.strt_req_ymd 
			, a.strt_req_hm 
			, a.strt_req_ymd || a.strt_req_hm strt_req_date
			, a.aptd_req_ymd 
			, a.aptd_req_hm 
			, a.aptd_req_ymd || a.aptd_req_hm aptd_req_date	    
			, a.ord_reason_cd
			, IDUSR.OMCOMM_GETCUSTREASONNM_FN(c.rpt_cust_cd, a.ord_reason_cd) AS ord_reason_nm
			, a.booking_no
			, a.prog_stat_cd 
			, MACOMM_GETCD_FN('EXP_PROG_STAT_CD', a.prog_stat_cd) AS prog_stat_nm			
			, a.vanning_grp_id
			, a.prdt_ymd
			, a.pol_cd
			, a.schd_no
			, a.sctn_cd
			, a.rpt_item_nm
			, a.cls_expr_yn
			, a.lead_time_expr_yn
			, a.ltrm_ord_yn
			, a.rmk
			, a.exp_ord_no
			, a.dpt_port_prar_ymd
			, a.gi_req_ymd
			, a.std_wgt
			, a.pallet_qty
			, a.more_pmsr
			, a.less_pmsr
			, a.cntr_dcsn_ofcr_id
			, to_char(a.cntr_dcsn_date, 'yyyymmddhh24miss') cntr_dcsn_date
			, DECODE(NVL(a.pcul_cd, ''), '', idusr.OMCOMM_GET_ITEM_INFO_FN(A.CUST_CD, A.ITEM_CD, 'PCUL_CD', A.BAT_NO, A.pcul_cd)
										   , A.PCUL_CD) PCUL_CD_MST
			, DECODE(NVL(a.mn_cd, ''), '', idusr.OMCOMM_GET_ITEM_INFO_FN(A.CUST_CD, A.ITEM_CD, 'MN_CD', A.BAT_NO, A.mn_cd)
										   , A.mn_cd) mn_cd_MST
			, a.pcul_cd
			, a.mn_cd
			, a.cmpt_ymd
			, a.dcsn_yn
			, a.del_yn
			, nvl(a.ord_verify_yn, 'Y') ord_verify_yn
			, c.cust_ord_no
			, b.ITEM_LVL2_CD
			, d.col01
			, d.col02
			, d.col03
			, d.col04
			, d.col05
			, d.col06
			, d.col07
			, d.col08
			, d.col09
			, d.col10
			, d.col11
			, d.col12
			, d.col13
			, d.col14
			, d.col15
			, d.col16
			, d.col17
			, d.col18
			, d.col19
			, d.col20
			, d.col21
			, d.col22
			, d.col23
			, d.col24
			, d.col25
			, d.col26
			, d.col27
			, d.col28
			, d.col29
			, decode(a.ord_verify_yn, 'N', d.col30, '') col30
			, '' as UPD_FLAG
			, 0 as sales_ord_chg_seq
			, a.rmk2
	    FROM  TB_OM02002 A
	        , TB_MA02010 B 
	        , TB_OM02001 C
	        , TB_OM02005 D
 		    , (SELECT ee.line_no, SUM(ee.rslt_qty) rslt_qty, SUM(ee.rslt_wgt) rslt_wgt, SUM(ee.rslt_cbm) rslt_cbm
		  	     FROM tb_om03001 e, tb_om03002 ee
 		        WHERE e.SALES_ORD_NO = ${salesOrdNo}
 		          AND e.SALES_ORD_NO = ee.SALES_ORD_NO
 		          AND e.WORK_ROUTE_SEQ = ee.WORK_ROUTE_SEQ
 		          AND e.del_yn = 'N'
		        GROUP BY ee.line_no) F
	   WHERE A.cust_cd = B.Ptn_Cd
	     AND A.item_cd = B.Item_Cd
	     AND A.DEL_YN  != 'Y'
	     AND A.Sales_Ord_No = C.Sales_Ord_No
	     AND A.SALES_ORD_NO = D.SALES_ORD_NO(+)
	     AND A.LINE_NO		 = D.LINE_NO(+)
	     AND A.LINE_NO		 = F.LINE_NO(+)
  	     {#1}
  	     {#2}
  	   ORDER BY TO_NUMBER(A.LINE_NO)
    <append condition="${salesOrdNo}.NOTEMPTY" id="#1">
         AND A.SALES_ORD_NO  = ${salesOrdNo}
    </append>
    <append condition="${lineNo}.NOTEMPTY" id="#2">
         AND A.LINE_NO  = ${lineNo}
    </append> 
  </statement>
  <statement name="retrieveDomSalesOrdExceMngtOrdPrclTitle">
  	  SELECT  IF_ID
			, WORK_INFO_MNGT_TYPE_CD
			, COL_NM01
			, COL_NM02
			, COL_NM03
			, COL_NM04
			, COL_NM05
			, COL_NM06
			, COL_NM07
			, COL_NM08
			, COL_NM09
			, COL_NM10
			, COL_NM11
			, COL_NM12
			, COL_NM13
			, COL_NM14
			, COL_NM15
			, COL_NM16
			, COL_NM17
			, COL_NM18
			, COL_NM19
			, COL_NM20
			, COL_NM21
			, COL_NM22
			, COL_NM23
			, COL_NM24
			, COL_NM25
			, COL_NM26
			, COL_NM27
			, COL_NM28
			, COL_NM29
			, COL_NM30
	    FROM TB_OM01003
	   WHERE IF_ID = (SELECT IF_ID FROM TB_OM02001 WHERE SALES_ORD_NO = ${salesOrdNo} )
	     AND WORK_INFO_MNGT_TYPE_CD = '01'
  </statement>
  <statement name="retrieveDomSalesOrdExceMngtItemPrclTitle">
  	  SELECT  IF_ID
			, WORK_INFO_MNGT_TYPE_CD
			, COL_NM01
			, COL_NM02
			, COL_NM03
			, COL_NM04
			, COL_NM05
			, COL_NM06
			, COL_NM07
			, COL_NM08
			, COL_NM09
			, COL_NM10
			, COL_NM11
			, COL_NM12
			, COL_NM13
			, COL_NM14
			, COL_NM15
			, COL_NM16
			, COL_NM17
			, COL_NM18
			, COL_NM19
			, COL_NM20
			, COL_NM21
			, COL_NM22
			, COL_NM23
			, COL_NM24
			, COL_NM25
			, COL_NM26
			, COL_NM27
			, COL_NM28
			, COL_NM29
			, COL_NM30
	    FROM  TB_OM01003
	   WHERE  IF_ID = (SELECT IF_ID FROM TB_OM02001 WHERE SALES_ORD_NO = ${salesOrdNo}  	 )
	     AND  WORK_INFO_MNGT_TYPE_CD = '02'
  </statement>  

<!-- TPL 해상수출판매오더포워딩 조회 -->
  <statement name="retrieveTplOceanExpSalesOrdFwd">
	  SELECT 
		       a.sales_ord_no       														--판매오더번호
			  , a.sales_ord_stat_cd 														--판매오더상태코드
			  , MACOMM_GETCD_FN('ORD_STAT_CD', a.sales_ord_stat_cd ) AS sales_ord_stat_nm 	--판매오더상태명
		      , a.sales_ord_creat_ymd 														--판매오더생성일자
		      , a.sales_ord_creat_hms 														--판매오더생성시간
		      , a.rpt_cust_cd
		      , a.ctrt_cust_cd        														--계약고객코드
		      , MACOMM_GETPTNNM_FN(a.ctrt_cust_cd ) AS ctrt_cust_nm 						--계약고객명
			  , a.ord_req_cust_cd 															--오더요청고객코드
			  , MACOMM_GETPTNNM_FN( a.ord_req_cust_cd) as ord_req_cust_nm					--오더요청고객명
		      , a.ord_type_cd  																--오더형태
	 	      , d.ord_type_nm						--오더명
	 	      , d.logis_svc_sctn_cd
		      , EXP_IMP_DOM_SCTN_CD
		      , a.ctrt_no      																--계약번호
		      , ( SELECT y.ctrt_nm
				    FROM tb_sm04110 x, tb_sm07110 y
				   WHERE x.corp_cd 	 	= y.corp_cd
				     AND x.prmt_biz_no 	= y.prmt_biz_no
				     AND x.cust_cd 	 	= a.ctrt_cust_cd
				     AND x.sell_ctrt_no = a.ctrt_no) as ctrt_nm 							--계약명
		  	  , a.bilg_cust_cd 																--청구고객코드
			  , MACOMM_GETPTNNM_FN( a.bilg_cust_cd ) AS bilg_cust_nm 						--청구고객명
			  , a.cust_ofcr_nm
			  , a.cust_ofcr_tel_no
			  , a.cust_exca_ofcr_nm
			  , LTrim(a.sell_dept_cd, '0') as sell_dept_cd 									--매출부서코드
			  , MACOMM_GETDEPTNM_FN( a.corp_cd, a.sell_dept_cd ) AS sell_dept_nm 			--매출부서명
			  , a.sales_ofcr_id 															--영업사원아이디
			  , MACOMM_GETUSERNM_FN( a.sales_ofcr_id ) AS sales_ofcr_nm 					--영업사원명
			  , (SELECT COMN_CD 
			  	   FROM TB_MA01015 X
			  	 	  , TB_OM04002 Y
			  	  WHERE	X.CLAS_CD 		= 'FWD_RSLT_SCTN_CD'
			  	    AND X.COMN_CD 		= Y.RSLT_SCTN_CD
			  	    AND Y.SALES_ORD_NO  = A.SALES_ORD_NO
			  	    AND Y.RSLT_SCTN_CD  = (SELECT MAX(RSLT_SCTN_CD) 
			  	 						     FROM TB_OM04002 
			  	 						    WHERE SALES_ORD_NO = Y.SALES_ORD_NO) ) FWD_STAT_CD
			  , (SELECT COMN_CD_NM 
			  	   FROM TB_MA01015 X
			  	 	  , TB_OM04002 Y
			  	  WHERE X.CLAS_CD 		= 'FWD_RSLT_SCTN_CD'
			  	    AND X.COMN_CD 		= Y.RSLT_SCTN_CD
			  	    AND Y.SALES_ORD_NO  = A.SALES_ORD_NO
			  	    AND Y.RSLT_SCTN_CD  = (SELECT MAX(RSLT_SCTN_CD) 
			  	 						     FROM TB_OM04002 
			  	 						    WHERE SALES_ORD_NO = Y.SALES_ORD_NO) ) FWD_STAT_NM
			  , LTrim(a.ord_mngt_exce_dept_cd, '0') as ord_mngt_exce_dept_cd
			  , MACOMM_GETDEPTNM_FN( a.corp_cd, a.ord_mngt_exce_dept_cd ) AS ord_mngt_exce_dept_nm 	--오더관리실행부서명
			  , a.ord_mngt_exce_ofcr_id
		      , LTrim(a.ord_mngt_fwd_dept_cd, '0') as ord_mngt_fwd_dept_cd 					--오더관리포워딩부서코드
			  , MACOMM_GETDEPTNM_FN( a.corp_cd, a.ord_mngt_fwd_dept_cd ) AS ord_mngt_fwd_dept_nm 	--오더관리포워딩부서명
			  , a.ord_mngt_fwd_ofcr_id 														--오더관리포워딩담당자아이디
			  , MACOMM_GETUSERNM_FN( a.ord_mngt_fwd_ofcr_id ) AS ord_mngt_fwd_ofcr_nm 		--오더관리포워딩담당자명
		      , c.fwd_eo_no          						--포워딩오더번호
		      , a.cust_ofcr_nm
		      , a.cust_ofcr_tel_no
		      , a.sales_ord_cncl_yn  						--취소여부
		      , a.cargo_form_cd      						--Cargo Type
		      , b.fcl_lcl_sctn_cd    						--FCL/LCL
		      , b.bl_kind_cd         						--B/L Type
		      , b.incoterms_cd       						--INCOTERMS
		      , b.dpt_svc_term_cd    						--출발ServiceTerm
		      , b.arv_svc_term_cd    						--도착ServiceTerm
		      , b.cnee_cd            						--Consignee코드
		      , b.cnee_nm            						--Consignee명
		      , b.pol_cd             						--POL코드
		      , b.pol_nm             						--POL명
		      , b.pod_cd             						--POD코드
		      , b.pod_nm             						--POD명
		      , b.dlv_pl_cd          						--Place of Delivery코드
		      , b.dlv_pl_nm          						--Place of Delivery먕
		      , b.dpt_port_prar_ymd  						--ETD
		      , b.arv_port_prar_ymd  						--ETA
		      , b.fdest_cd           						--F.Destination코드
		      , b.fdest_nm           						--F.Destination명
		      , b.pckg_qty           						--Total Package수량
		      , b.pckg_unit_cd       						--Total Package코드
		      , MACOMM_GETCD_FN('PCKG_UNIT_CD', b.pckg_unit_cd) as pckg_unit_nm       						--Total Package코드
		      , b.tot_wgt            						--Gross Wgt
		      , b.tot_cbm            						--CBM
		      , b.danger_sctn_cd     						--DGR
		      , a.cust_ref_no        						--Ref No
		      , b.lc_no              						--L/C No
		      , b.ci_no              						--C/I No
		      , a.rmk                						--비고
		      , c.booking_no         						--Booking No
		      , c.ship_co_booking_no
		      , c.booking_ymd        						--Booking Date
		      , c.ship_co_cd         						--Liner 코드
			  , c.ship_co_nm			--Liner명
		      , c.ship_co_ofcr_nm   						--Liner PIC
		      , c.ship_co_tel_no
		      , c.ship_co_fax_no
		      , c.ship_nm           						--Vessel
		      , c.port_cnt          						--Voyage
		      , c.cy_cls_ymd        						--CY Closing 일자
		      , c.cy_cls_hms        						--CY Closing 시간
		      , c.sr_cls_ymd        						--SR Closing 일자
		      , c.sr_cls_hms        						--SR Closing 시간
		      , c.cntr_kind_cd1     
		      , c.cntr_qty1 
		      , c.cntr_kind_cd2 
		      , c.cntr_qty2 
		      , c.cntr_kind_cd3 
		      , c.cntr_qty3 
		      , c.cntr_kind_cd4 
		      , c.cntr_qty4 
		      , c.cntr_kind_cd5 
		      , c.cntr_qty5 
		      , c.cy_dtl_conts      						--CY/CFS Detail
		      , a.dpt_ar_cd         						--Door코드
		      , a.dpt_ar_type_cd         						--Door코드
		    , case when a.dpt_ar_type_cd = '02' then
		    	  (select name 
		    	    from vw_ma01_01 
		    	   where code = a.dpt_ar_cd 
		    	     AND PTN_CD = a.RPT_CUST_CD
		    	     and work_sctn_cd = a.dpt_ar_type_cd) 
			  else 	    	
		    	  (select name 
		    	     from vw_ma01_01 
		    	    where code = a.dpt_ar_cd 
		    	      and work_sctn_cd = a.dpt_ar_type_cd
		    	      and rownum = 1) 
		      end  as dpt_ar_nm
		      , a.dpt_ar_zip_cd     						--Door 우편번호
		      , a.dpt_ar_zip_addr   						--Door 우편주소
		      , a.dpt_ar_dtl_addr   						--Door 상세주소
		      , a.dpt_ar_ofcr_nm    						--Door PIC
		      , a.dpt_ar_ofcr_tel_no 						--Door Tel
		      , a.strt_req_ymd       						--Door Date
		      , a.strt_req_hm        						--Door Time
		      , a.arv_ar_cd
		      , a.arv_ar_type_cd
		      , a.aptd_req_ymd
		      , a.aptd_req_hm
	          , WORK_INFO_MNGT_TYPE_CD
	          , LINE_SCTN_CD
	          , b.shipper_cd
	          , b.shipper_nm
	          , b.rpt_item_nm
	          , b.ocean_air_sctn_cd
	          , a.tran_plan_cntr_cd
	          , '' as upd_flag
		  FROM  tb_om02001 a
		      , tb_om02003 b
		      , tb_om02019 c
		      , tb_ma01006 d
		 WHERE a.sales_ord_no = b.sales_ord_no(+)
		   AND a.sales_ord_no = c.sales_ord_no(+)
		   and a.ord_type_cd = d.ord_type_cd
		{#1}
    <append condition="${salesOrdNo}.NOTEMPTY" id="#1">
           AND A.SALES_ORD_NO  = ${salesOrdNo}
    </append>
  </statement>

<!-- TPL 해상수출판매오더포워딩 라인아이템 조회 -->
  <statement name="retrieveTplOceanExpSalesOrdFwdItemList">
	  SELECT   a.sales_ord_no
		     , a.line_no
		     , a.cust_cd
		     , a.item_cd
		     , a.item_nm
		     , a.pckg_unit_cd
		     , a.pckg_unit_nm
		     , a.pckg_qty
		     , b.cntr_no
		     , b.seal_no1
		     , b.seal_no2
		     , a.basis_unit_cd
		     , a.ord_qty
		     , a.qty_unit_cd
		     , a.ord_wgt
		     , a.wgt_unit_cd
		     , a.ord_cbm
		     , a.trans_div_yn
		     , a.dpt_ar_cd
		     , a.dpt_ar_type_cd
		     , a.dpt_ar_nm
		     , a.dpt_ar_zip_cd
		     , a.dpt_ar_zip_addr
		     , a.dpt_ar_dtl_addr
		     , a.strt_req_ymd
		     , a.strt_req_hm
		     , a.arv_ar_cd
		     , a.arv_ar_type_cd
		     , a.aptd_req_ymd
		     , a.aptd_req_hm
		     , a.danger_sctn_cd 
		     , a.max_tmpt 
		     , a.min_tmpt 
		     , a.fe_sctn_cd
		     , a.inland_Port_Cd
		     , a.inland_Port_Nm
		     , a.flag
		     , a.upd_flag
		     , a.dcsn_yn 
		FROM
		   (SELECT a.sales_ord_no
			     , a.line_no
			     , a.cust_cd
			     , a.item_cd
			     , decode(b.cargo_form_cd, 'C', MACOMM_GETCD_FN('CNTR_SIZ_TYP_SCTN', a.item_cd )
										 , 'B', (SELECT item_nm 
										           FROM tb_ma02010 
										          WHERE item_cd = a.item_cd 
										            AND ptn_cd = a.cust_cd) ) AS item_nm
			     , a.pckg_unit_cd
		         , MACOMM_GETCD_FN('PCKG_UNIT_CD', a.pckg_unit_cd) as pckg_unit_nm       						--Total Package코드
			     , a.pckg_qty
			     , a.basis_unit_cd
			     , a.ord_qty
			     , a.qty_unit_cd
			     , a.ord_wgt
			     , a.wgt_unit_cd
			     , a.ord_cbm
			     
			     , DECODE((SELECT COUNT(line_no)
			                 FROM tb_om03002
			                WHERE sales_ord_no = a.sales_ord_no
			                  AND LINE_NO		= A.LINE_NO
			                  and work_route_seq in (select work_route_seq
			               							   from tb_om03001
			               							  where sales_ord_no = a.sales_ord_no
			               							    and del_yn = 'N') ), 0, 'N', 'Y') AS trans_div_yn
			     , a.dpt_ar_cd
			     , a.dpt_ar_type_cd
				 , case when a.dpt_ar_type_cd = '02' then
				    	(select name 
				    	   from vw_ma01_01 
				    	  where code = a.dpt_ar_cd 
				    	    AND PTN_CD = b.RPT_CUST_CD
				    	    and work_sctn_cd = a.dpt_ar_type_cd) 
				   else 	    	
				    	(select name 
				    	   from vw_ma01_01 
				    	  where code = a.dpt_ar_cd 
				    	    and work_sctn_cd = a.dpt_ar_type_cd
				    	    and rownum = 1) 
				   end  as dpt_ar_nm
			     , a.dpt_ar_zip_cd
			     , a.dpt_ar_zip_addr
			     , a.dpt_ar_dtl_addr
			     , a.strt_req_ymd
			     , a.strt_req_hm
			     , a.arv_ar_cd
			     , a.arv_ar_type_cd
			     , a.aptd_req_ymd
			     , a.aptd_req_hm
			     , a.danger_sctn_cd 
			     , a.max_tmpt 
			     , a.min_tmpt 
			     , a.fe_sctn_cd
			     , '' inland_Port_Cd
			     , '' inland_Port_Nm
			     , '' as flag
			     , '' as upd_flag
			     , dcsn_yn 
			 FROM  tb_om02002 a
			     , tb_om02001 b
			WHERE a.sales_ord_no = b.sales_ord_no  
			  and a.del_yn = 'N'   
		      AND A.SALES_ORD_NO  = ${salesOrdNo} ) a
		, (SELECT c.sales_ord_no
		        , c.line_no
			    , d.cntr_no
			    , d.seal_no1
			    , d.seal_no2
		    FROM  tb_om03001 a
		        , tb_om03002 c
		        , tb_om03014 d
		   WHERE  a.sales_ord_no = c.sales_ord_no
		     AND  a.work_route_seq = c.work_route_seq
		     AND  a.del_yn = 'N'
		     AND  c.sales_ord_no = d.sales_ord_no
		     AND  c.work_route_seq = d.work_route_seq
		     AND  a.sales_ord_no = ${salesOrdNo}) b
	WHERE a.sales_ord_no = b.sales_ord_no(+)
	  AND a.line_no      = b.line_no(+)    
	ORDER BY TO_NUMBER(a.line_no)
  </statement>
  
<!-- 해상수입판매오더포워딩 조회 -->
  <statement name="retrieveOceanImpSalesOrd">
		SELECT 
		       a.sales_ord_no       														--판매오더번호
			  , a.sales_ord_stat_cd 														--판매오더상태코드
			  , MACOMM_GETCD_FN('ORD_STAT_CD', a.sales_ord_stat_cd ) AS sales_ord_stat_nm 	--판매오더상태명
		      , a.sales_ord_creat_ymd 														--판매오더생성일자
		      , a.sales_ord_creat_hms 														--판매오더생성시간
		      , a.ctrt_cust_cd        														--계약고객코드
		      , MACOMM_GETPTNNM_FN(a.ctrt_cust_cd ) AS ctrt_cust_nm 						--계약고객명
			  , a.ord_req_cust_cd 															--오더요청고객코드
			  , MACOMM_GETPTNNM_FN( a.ord_req_cust_cd) as ord_req_cust_nm					--오더요청고객명
		      , a.ord_type_cd  																--오더형태
	 	      , d.ord_type_nm						--오더명
	 	      , d.logis_svc_sctn_cd
		      , a.ctrt_no      																--계약번호
		      , a.ctrt_no||' '||( SELECT y.ctrt_nm
				                    FROM tb_sm04110 x, tb_sm07110 y
				                   WHERE x.corp_cd 	 	= y.corp_cd
				                     AND x.prmt_biz_no 	= y.prmt_biz_no
				                     AND x.cust_cd 	 	= a.ctrt_cust_cd
				                     AND x.sell_ctrt_no = a.ctrt_no) as ctrt_nm 							--계약명
		  	  , a.bilg_cust_cd 																--청구고객코드
			  , MACOMM_GETPTNNM_FN( a.bilg_cust_cd ) AS bilg_cust_nm 						--청구고객명
			  , LTrim(a.sell_dept_cd, '0') as sell_dept_cd 									--매출부서코드
			  , MACOMM_GETDEPTNM_FN( a.corp_cd, a.sell_dept_cd ) AS sell_dept_nm 			--매출부서명
			  , a.sales_ofcr_id 															--영업사원아이디
			  , MACOMM_GETUSERNM_FN( a.sales_ofcr_id ) AS sales_ofcr_nm 					--영업사원명
		      , LTrim(a.ord_mngt_fwd_dept_cd, '0') as ord_mngt_fwd_dept_cd 					--오더관리포워딩부서코드
			  , MACOMM_GETDEPTNM_FN( a.corp_cd, a.ord_mngt_fwd_dept_cd ) AS ord_mngt_fwd_dept_nm 	--오더관리포워딩부서명
			  , a.ord_mngt_fwd_ofcr_id 														--오더관리포워딩담당자아이디
			  , MACOMM_GETUSERNM_FN( a.ord_mngt_fwd_ofcr_id ) AS ord_mngt_fwd_ofcr_nm 		--오더관리포워딩담당자명
		      , b.fwd_eo_no          						--포워딩오더번호
		      , a.sales_ord_cncl_yn  						--취소여부
		      , b.hbl_no									--House BL
		      , b.bl_kind_cd         						--B/L Type
		      , b.ci_no              						--C/I No (Invoice No)
		      , b.mbl_no									--Master BL
		      , a.cargo_form_cd      						--Cargo Type
			  --, macomm_getcd_fn( 'CARGO_FORM_CD', a.cargo_form_cd) cargo_form_nm
			  , decode(a.cargo_form_cd,'C','Container','B','Bulk') cargo_form_nm
		      , b.fcl_lcl_sctn_cd    						--FCL/LCL
		      , b.dpt_svc_term_cd    						--출발ServiceTerm
		      , b.arv_svc_term_cd    						--도착ServiceTerm
		      , b.incoterms_cd       						--INCOTERMS
		      , b.PTN_CD
		      , b.PTN_NM									-- Partner
		      , b.PTN_OFCR_NM							-- Partner PIC
		      , b.ship_co_cd         						--Liner 코드
		      , b.ship_nm           						--Vessel
		      , b.port_cnt          						--Voyage
		      , b.pol_cd             						--POL코드
		      , b.pol_nm             						--POL명
		      , b.pod_cd             						--POD코드
		      , b.pod_nm             						--POD명
		      , b.dpt_port_prar_ymd  						--ETD
		      , b.arv_port_prar_ymd  						--ETA
		      , b.pckg_qty           						--Total Package수량
		      , b.pckg_unit_cd       						--Total Package코드
		      , MACOMM_GETCD_FN('PCKG_UNIT_CD', b.pckg_unit_cd) as pckg_unit_nm       						--Total Package코드
		      , b.tot_wgt            						--Gross Wgt
		      , b.tot_cbm            						--CBM
		      , b.RPT_ITEM_NM						-- Main Item
		      , a.cust_ref_no        						--Ref No
		      , b.lc_no              						--L/C No
		      , decode(b.BOND_TRAN_YN,'Y','1','0') bond_tran_yn					-- Bonded Trans
		      , decode(b.MNFEST_DCLR_TGT_YN,'Y','1','0') MNFEST_DCLR_TGT_YN		-- Target on Declation
		      , a.rmk                						--비고
		      , b.SHIPPER_CD							--Shipper
		      , b.SHIPPER_NM
		      , b.SHIPPER_ADDR1
		      , b.SHIPPER_ADDR2
		      , b.SHIPPER_ADDR3
		      , b.SHIPPER_ADDR4
		      , b.cnee_cd            						--Consignee코드
		      , b.cnee_nm            						--Consignee명
		      , b.cnee_addr1
		      , b.cnee_addr2
		      , b.cnee_addr3
		      , b.cnee_addr4
		      , b.NTFY_CD								-- NOTiFY
		      , b.NTFY_NM
		      , b.NTFY_ADDR1
		      , b.NTFY_ADDR2
		      , b.NTFY_ADDR3
		      , b.NTFY_ADDR4
		      , b.cntr_kind_cd1     
		      , b.cntr_qty1 
		      , b.cntr_kind_cd2 
		      , b.cntr_qty2 
		      , b.cntr_kind_cd3 
		      , b.cntr_qty3 
		      , b.cntr_kind_cd4 
		      , b.cntr_qty4 
		      , b.cntr_kind_cd5 
		      , b.cntr_qty5
		      , a.dpt_ar_cd         						--Door코드
		      , a.dpt_ar_type_cd         						--Door코드
		      , case when a.dpt_ar_type_cd = '02' then
		    	  (select name 
		    	     from vw_ma01_01 
		    	    where code = a.dpt_ar_cd 
		    	      AND PTN_CD = a.RPT_CUST_CD
		    	      and work_sctn_cd = a.dpt_ar_type_cd) 
			         else 	    	
		    	  (select name 
		    	     from vw_ma01_01 
		    	    where code = a.dpt_ar_cd 
		    	      and work_sctn_cd = a.dpt_ar_type_cd
		    	      and rownum = 1) 
		        end  as dpt_ar_nm
		      , a.dpt_ar_zip_cd     						--Door 우편번호
		      , a.dpt_ar_zip_addr   						--Door 우편주소
		      , a.dpt_ar_dtl_addr   						--Door 상세주소
		      , a.dpt_ar_ofcr_nm    						--Door PIC
		      , a.dpt_ar_ofcr_tel_no 						--Door Tel
		      , a.strt_req_ymd       						--Door Date
		      , a.strt_req_hm        						--Door Time
		      , b.TRAN_COST_PAY_COND_CD
		      , b.EXTR_EXPN_PAY_COND_CD
		      , a.rpt_cust_cd as upper_ptn_cd 				--대표고객코드
		      , a.cust_ofcr_nm --고객담당자명
		      , a.cust_ofcr_tel_no --고객담당자연락번호
		      , a.sales_ord_cncl_reason --오더취소사유
		      , a.cust_expr_yn --고객긴급여부
		      , a.cls_expr_yn --마감긴급여부
		      , a.lead_time_expr_yn --리드타임긴급여부
		      , a.dtod_yn --택배여부
		      , a.load_dly_yn --상차지연여부
		      , a.back_ord_yn --대기오더여부
		      , a.aft_ord_yn --사후오더여부
		      , a.ltrm_ord_yn --장기오더여부
		      , a.arv_ar_cd
		      , a.arv_ar_type_cd
		      , a.arv_ar_zip_cd
		      ,	a.arv_ar_zip_addr
		      ,	a.arv_ar_dtl_addr
		      ,	a.arv_ar_ofcr_nm
		      ,	a.arv_ar_ofcr_tel_no
		      , a.aptd_req_ymd
		      , a.aptd_req_hm
		      , a.work_info_mngt_type_cd
		      , a.line_sctn_cd
		      ,	a.ord_mngt_exce_ofcr_id
		      ,	a.rpt_cust_cd
		      , LTrim(a.ord_mngt_exce_dept_cd, '0') as ord_mngt_exce_dept_cd
		      , MACOMM_GETDEPTNM_FN( a.corp_cd, a.ord_mngt_exce_dept_cd ) AS ord_mngt_exce_dept_nm
		      , '' flag
			  , case when a.dpt_ar_type_cd = '02' then
		    	    (select name 
		    	       from vw_ma01_01 
		    	      where code = a.arv_ar_cd 
		    	        AND	PTN_CD = a.RPT_CUST_CD
		    	        and work_sctn_cd = a.arv_ar_type_cd) 
			    else 	    	
		    	    (select name 
		    	       from vw_ma01_01 
		    	      where code = a.arv_ar_cd 
		    	        and work_sctn_cd = a.arv_ar_type_cd
		    	        and rownum = 1) 
		        end  as arv_ar_nm
		     ,  ( select ENG_SHIP_CO_NM as ship_co_nm
					FROM tb_ma01017 
					where ship_co_sign_cd = b.ship_co_cd
				) ship_co_nm	
	     	 , (SELECT COMN_CD_NM 
			  	 FROM TB_MA01015 X
			  	 	, TB_OM04002 Y
			  	 WHERE X.CLAS_CD 	   = 'FWD_RSLT_SCTN_CD'
			  	   AND X.COMN_CD 	   = Y.RSLT_SCTN_CD
			  	   AND Y.SALES_ORD_NO  = A.SALES_ORD_NO
			  	   AND Y.RSLT_SCTN_CD  = (SELECT MAX(RSLT_SCTN_CD) 
			  	 						    FROM TB_OM04002 
			  	 						   WHERE SALES_ORD_NO = Y.SALES_ORD_NO) ) FWD_STAT_NM
	     	 , (SELECT COMN_CD
			  	  FROM TB_MA01015 X
			  	 	 , TB_OM04002 Y
			  	 WHERE X.CLAS_CD 		= 'FWD_RSLT_SCTN_CD'
			  	   AND X.COMN_CD 		= Y.RSLT_SCTN_CD
			  	   AND Y.SALES_ORD_NO  = A.SALES_ORD_NO
			  	   AND Y.RSLT_SCTN_CD  = (SELECT MAX(RSLT_SCTN_CD) 
			  	 						    FROM TB_OM04002 
			  	 						   WHERE SALES_ORD_NO = Y.SALES_ORD_NO) ) FWD_STAT_CD
			  , a.exp_imp_dom_sctn_cd
			  , b.ocean_air_sctn_cd
			  , a.tran_plan_cntr_cd
			  , '' upd_flag
		  FROM  tb_om02001 a
		      , tb_om02003 b
		      , tb_ma01006 d
		 WHERE  a.sales_ord_no = b.sales_ord_no(+)
		   and  a.ord_type_cd = d.ord_type_cd
		   {#1}
    <append condition="${salesOrdNo}.NOTEMPTY" id="#1">
           AND   A.SALES_ORD_NO  = ${salesOrdNo}
    </append>
  </statement>

<!-- 해상수입판매오더포워딩 라인아이템 조회 -->
  <statement name="retrieveOceanImpSalesOrdItemList">
	  SELECT a.sales_ord_no
		    ,0 chk
	        , a.line_no
	        , a.cust_cd
	        , a.item_cd
	        ,(select x.item_nm
	            from tb_ma02010 x
	           where x.ptn_cd  = a.cust_cd
	             and x.item_cd = a.item_cd) item_nm
	        , a.pckg_unit_cd
            , MACOMM_GETCD_FN('PCKG_UNIT_CD', a.pckg_unit_cd) as pckg_unit_nm    --Total Package코드
	        , a.pckg_qty
	        , a.qty_unit_cd
 	        , a.ord_qty
	        , a.wgt_unit_cd
	        , a.ord_wgt
	        , a.cntr_no
	        , a.seal_no1
	        , a.seal_no2
	        , DECODE((SELECT COUNT(line_no)
		                FROM tb_om03002
		               WHERE sales_ord_no = a.sales_ord_no
		                 AND LINE_NO	  = A.LINE_NO
		                 and work_route_seq in (select work_route_seq
		               				              from tb_om03001
		               						     where sales_ord_no = a.sales_ord_no
		               							   and del_yn = 'N') ), 0, 'N', 'Y') AS trans_div_yn
	        , a.dpt_ar_cd
	        , a.dpt_ar_type_cd
		    , case when a.dpt_ar_type_cd = '02' then
		    	       (select name 
		    	          from vw_ma01_01 
		    	         where code = a.dpt_ar_cd 
		    	           AND PTN_CD = b.RPT_CUST_CD
		    	           and work_sctn_cd = a.dpt_ar_type_cd) 
		           else 	    	
		    	       (select name 
		    	          from vw_ma01_01 
		    	         where code = a.dpt_ar_cd 
		    	           and work_sctn_cd = a.dpt_ar_type_cd
		    	           and rownum = 1) 
		      end  as dpt_ar_nm
		    , a.dpt_ar_zip_cd
	        , a.dpt_ar_zip_addr
	        , a.dpt_ar_dtl_addr
	        , a.strt_req_ymd
	        , a.strt_req_hm
	        , '' as flag
		    , a.arv_ar_cd		
		    , a.arv_ar_zip_cd		
		    , a.arv_ar_type_cd
		    , a.arv_ar_zip_addr		
		    , a.arv_ar_dtl_addr		
		    , a.arv_ar_ofcr_nm		
		    , a.arv_ar_ofcr_tel_no	
		    , a.strt_req_ymd		
		    , a.strt_req_hm		
		    , a.aptd_req_ymd		
		    , a.aptd_req_hm	
		    , a.ord_cbm
		    , a.basis_item_cd
		    , a.basis_unit_cd
		    , a.fe_sctn_cd 	 
		    , case when a.arv_ar_type_cd = '02' then
		    	       (select name 
		    	          from vw_ma01_01 
		    	         where code = b.arv_ar_cd 
		    	           AND PTN_CD = b.RPT_CUST_CD
		    	           and work_sctn_cd = b.arv_ar_type_cd) 
		           else 	    	
		    	       (select name 
		    	          from vw_ma01_01 
		    	         where code = b.arv_ar_cd 
		    	           and work_sctn_cd = b.arv_ar_type_cd
		    	           and rownum = 1) 
		      end  as arv_ar_nm
		    , rpt_item_nm as main_item_cd
		    , rpt_item_nm
		    , '' upd_flag
		    , a.dcsn_yn --확정여부
	    FROM  tb_om02002 a
	        , tb_om02001 b
	   WHERE  a.sales_ord_no = b.sales_ord_no     
	     and  del_yn='N'
	
  	     {#1}
  	   order by to_number(a.line_no)
    <append condition="${salesOrdNo}.NOTEMPTY" id="#1">
         AND A.SALES_ORD_NO  = ${salesOrdNo}
    </append>
  </statement>
  
<!-- 내수 출고실행오더전송용 기본정보 조회 -->
  <statement name="retrieveTransferGiEo">
	SELECT ${eoNo} as wrhs_eo_no
		 , ${trmsSctnCd} as trms_sctn_cd	 
	     , (SELECT nvl(MAX(trms_seq), 0) + 1 FROM tb_om03009i WHERE wrhs_eo_no = ${eoNo}) AS trms_seq
		 , a.corp_cd
	     , c.dpt_ar_cd as work_pl_cd
	     , a.ord_mngt_exce_ofcr_id 
	     , (SELECT ofcr_tel_no 
	          FROM tb_ma01011 
	         WHERE user_id = a.ord_mngt_exce_ofcr_id) 
	       AS ord_mngt_exce_ofcr_tel_no
	     , a.sales_ord_no
	     , a.cust_ord_no 
	     , a.ord_type_cd 
         , a.rpt_cust_cd
	     , a.ctrt_cust_cd
	     , nvl(a.cust_ord_type_cd, a.cust_move_type_cd) as cust_ord_type_cd
	     , a.cust_move_type_cd
	     , a.ord_req_cust_cd 
	     , a.cust_of_cust_cd 
	     , a.cust_ref_no
	     , case when b.arv_ar_type_cd = '02' then
			    	(select name 
			    	   from vw_ma01_01 
			    	  where code = b.arv_ar_cd 
			    	    AND PTN_CD = a.RPT_CUST_CD
			    	    and work_sctn_cd = b.arv_ar_type_cd) 
		  	    when b.arv_ar_type_cd = '01' then 	    	
			    	(select name 
			    	   from vw_ma01_01 
			    	  where code = b.arv_ar_cd 
			    	    and work_sctn_cd = b.arv_ar_type_cd
			    	    and rownum = 1) 
			    when b.arv_ar_type_cd = '99' then    	
			    	(select name 
			    	   from vw_ma01_01 
			    	  where code = a.cust_of_cust_cd 
			    	    and work_sctn_cd = '02'
			    	    and rownum = 1)			
			    when b.arv_ar_type_cd = '03' then
				     b.arv_ar_cd
	       end  as cust_nm
	     , b.arv_ar_cd
	     , b.arv_ar_zip_cd
	     , b.arv_ar_zip_addr 
	     , b.arv_ar_dtl_addr 
	     , a.arv_ar_ofcr_nm 
	     , a.arv_ar_ofcr_tel_no 
	     , b.aptd_req_ymd 
	     , b.aptd_req_hm 
		 , idusr.omcomm_makermk_fn(a.sales_ord_no) as rmk
	     , a.cust_expr_yn 
	     , a.cls_expr_yn 
	     , a.lead_time_expr_yn 
	     , a.ltrm_ord_yn 
         --, b.bl_no
         , decode(a.rpt_cust_cd,'R1209',a.tran_eo_no, b.bl_no) as bl_no
         , b.bl_cust_ord_no
         , b.load_dly_yn
         , c.move_type_cd
         , case when e.exp_type_cd = '01' then
         			(select ship_co_booking_no from tb_om02019 where booking_no = b.booking_no and sales_ord_no = a.sales_ord_no)
         	    when e.exp_type_cd = '02' OR e.exp_type_cd = '03' THEN
         	        a.cust_ord_no
                else
                    ''
            end as booking_no
         , a.cargo_form_cd
         , decode((SELECT max(work_step_cd)
                     FROM tb_om03003
                    WHERE sales_ord_no = b.sales_ord_no
                      AND work_route_seq = b.work_route_seq
                      AND work_step_cd = '00003')
                  ,NULL,'N','Y') AS tran_yn
	     , a.tran_eo_no
	     , d.col01
	     , d.col02
	     , d.col03
	     , d.col04
	     , d.col05
	     , d.col06
	     , d.col07
	     , d.col08
	     , case when a.rpt_cust_cd='E1181' then
	        a.CUST_OFCR_TEL_NO
	       else
	       	d.col09
	       end as col09
	     , d.col10
	     , d.col11
	     , d.col12
	     , d.col13
	     , d.col14
	     , d.col15
	     , d.col16
	     , d.col17
	     , d.col18
	     , d.col19
	     , d.col20
	     , d.col21
	     , d.col22
	     , d.col23
	     , d.col24
	     , d.col25
	     , d.col26
	     , d.col27
	     , d.col28
	     , d.col29
	     , d.col30
	     , 'N' as if_yn
	     , ${regrId} as regr_id
	     , ${mdfrId} as mdfr_id
	     , a.sup_pl_cd
	FROM   tb_om02001 a
	     , tb_om03001 b
	     , tb_om03003 c
	     , tb_om02004 d
	     , tb_om02003 e
	WHERE  a.sales_ord_no 	= b.sales_ord_no
	AND    a.sales_ord_no 	= c.sales_ord_no
	AND    a.sales_ord_no 	= d.sales_ord_no(+)
	AND    a.sales_ord_no 	= e.sales_ord_no(+)
	AND    b.work_route_seq = c.work_route_seq      
	AND    a.sales_ord_no 	= ${salesOrdNo}
	AND    b.work_route_seq = ${workRouteSeq}
	AND    c.work_step_seq 	= ${workStepSeq}
  </statement>

  <statement name="retrieveSimpleTransferGiEo">
	SELECT ${eoNo} as wrhs_eo_no
		 , ${trmsSctnCd} as trms_sctn_cd	 
	     , (SELECT nvl(MAX(trms_seq), 0) + 1 FROM tb_om03009i WHERE wrhs_eo_no = ${eoNo}) AS trms_seq
		 , a.corp_cd
	     , c.dpt_ar_cd as work_pl_cd
	     , a.ord_mngt_exce_ofcr_id 
	     , a.sales_ord_no
	     , a.cust_ord_no 
	     , a.ord_type_cd 
         , a.rpt_cust_cd
	     , a.ctrt_cust_cd
	     , nvl(a.cust_ord_type_cd, a.cust_move_type_cd) as cust_ord_type_cd
	     , a.cust_move_type_cd
	     , a.ord_req_cust_cd 
	     , a.cust_of_cust_cd 
	     , a.cust_ref_no
	    , case when b.arv_ar_type_cd = '02' then
			    	(select name 
			    	   from vw_ma01_01 
			    	  where code = b.arv_ar_cd 
			    	    AND	PTN_CD = a.RPT_CUST_CD
			    	    and work_sctn_cd = b.arv_ar_type_cd) 
		  	   when b.arv_ar_type_cd = '01' then 	    	
			    	(select name 
			    	   from vw_ma01_01 
			    	  where code = b.arv_ar_cd 
			    	    and work_sctn_cd = b.arv_ar_type_cd
			    	    and rownum = 1) 
			   when b.arv_ar_type_cd = '03' then
				    b.arv_ar_cd
	      end  as cust_nm
	     , b.arv_ar_cd
	     , b.arv_ar_zip_cd
	     , b.arv_ar_zip_addr 
	     , b.arv_ar_dtl_addr 
	     , a.arv_ar_ofcr_nm 
	     , a.arv_ar_ofcr_tel_no 
	     , b.aptd_req_ymd 
	     , b.aptd_req_hm 
	     , a.cust_expr_yn 
	     , a.cls_expr_yn 
	     , a.lead_time_expr_yn 
	     , a.ltrm_ord_yn 
         , b.bl_no
         , b.bl_cust_ord_no
         , b.load_dly_yn
         , c.move_type_cd
         , a.cargo_form_cd
         , 'N' as tran_yn
	     , d.col01
	     , d.col02
	     , d.col03
	     , d.col04
	     , d.col05
	     , d.col06
	     , d.col07
	     , d.col08
	     , d.col09
	     , d.col10
	     , d.col11
	     , d.col12
	     , d.col13
	     , d.col14
	     , d.col15
	     , d.col16
	     , d.col17
	     , d.col18
	     , d.col19
	     , d.col20
	     , d.col21
	     , d.col22
	     , d.col23
	     , d.col24
	     , d.col25
	     , d.col26
	     , d.col27
	     , d.col28
	     , d.col29
	     , d.col30
	     , 'N' as if_yn
	     , ${regrId} as regr_id
	     , ${mdfrId} as mdfr_id
	 FROM  tb_om02001 a
	     , tb_om03001 b
	     , tb_om03003 c
	     , tb_om02004 d
	     , tb_om02003 e
	WHERE  a.sales_ord_no 	= b.sales_ord_no
	  AND  a.sales_ord_no 	= c.sales_ord_no
	  AND  a.sales_ord_no 	= d.sales_ord_no(+)
	  AND  a.sales_ord_no 	= e.sales_ord_no(+)
	  AND  b.work_route_seq = c.work_route_seq      
	  AND  a.sales_ord_no 	= ${salesOrdNo}
	  AND  b.work_route_seq = ${workRouteSeq}
	  AND  c.work_step_seq 	= ${workStepSeq}
  </statement>

<!-- 수입 출고실행오더전송용 기본정보 조회 -->
  <statement name="retrieveTransferImpPortGiEo">
	SELECT ${eoNo} as wrhs_eo_no
		, ${trmsSctnCd} as trms_sctn_cd	 
		, (SELECT nvl(MAX(trms_seq), 0) + 1 FROM tb_om03009i WHERE wrhs_eo_no = ${eoNo}) AS trms_seq
		, A.CORP_CD
		, C.DPT_AR_CD AS WORK_PL_CD
		, A.ORD_MNGT_EXCE_OFCR_ID
	     , (SELECT ofcr_tel_no 
	        FROM   tb_ma01011 
	        WHERE  user_id = a.ord_mngt_exce_ofcr_id) AS ord_mngt_exce_ofcr_tel_no
		, A.SALES_ORD_NO
		, A.CUST_ORD_NO
		, C.MOVE_TYPE_CD
		, A.ORD_TYPE_CD
		, A.RPT_CUST_CD
		, A.CTRT_CUST_CD
        , nvl(a.cust_ord_type_cd, a.cust_move_type_cd) as cust_ord_type_cd
		, A.ORD_REQ_CUST_CD
		, A.CUST_OF_CUST_CD
	    , case when b.arv_ar_type_cd = '02' then
			    	(select name 
			    	from vw_ma01_01 
			    	where code = b.arv_ar_cd 
			    	AND	  PTN_CD = a.RPT_CUST_CD
			    	and work_sctn_cd = b.arv_ar_type_cd) 
		  	when b.arv_ar_type_cd = '01' then 	    	
			    	(select name 
			    	from vw_ma01_01 
			    	where code = b.arv_ar_cd 
			    	and work_sctn_cd = b.arv_ar_type_cd
			    	and rownum = 1) 
			when b.arv_ar_type_cd = '03' then
				b.arv_ar_cd
	      end  as cust_nm
		, B.ARV_AR_CD
		, B.ARV_AR_ZIP_CD
		, B.ARV_AR_ZIP_ADDR
		, B.ARV_AR_DTL_ADDR
		, A.ARV_AR_OFCR_NM
		, A.ARV_AR_OFCR_TEL_NO
		, B.APTD_REQ_YMD
		, B.APTD_REQ_HM
		, idusr.omcomm_makermk_fn(a.sales_ord_no) as RMK
		, A.CUST_EXPR_YN
		, B.CLS_EXPR_YN
		, B.LEAD_TIME_EXPR_YN
		, B.LTRM_ORD_YN
		, B.BL_NO
		, B.BL_CUST_ORD_NO
		, B.LOAD_DLY_YN
		, (SELECT CARGO_FORM_CD 
		     FROM TB_OM02001
		    WHERE CUST_ORD_NO = B.BL_CUST_ORD_NO
		      AND SALES_ORD_CNCL_YN = 'N'
		      AND RPT_CUST_CD = A.RPT_CUST_CD ) CARGO_FORM_CD
		, ( SELECT TOT_WGT
			  FROM TB_OM02003
			 WHERE SALES_ORD_NO = (SELECT SALES_ORD_NO
								     FROM TB_OM02001
								    WHERE CUST_ORD_NO = B.BL_CUST_ORD_NO
								      AND SALES_ORD_CNCL_YN = 'N'
								      AND RPT_CUST_CD = A.RPT_CUST_CD ) ) BL_TOT_WGT
		, ( SELECT TOT_ADMT
			  FROM TB_OM02003
			 WHERE SALES_ORD_NO = (SELECT SALES_ORD_NO
								     FROM TB_OM02001
								    WHERE CUST_ORD_NO = B.BL_CUST_ORD_NO
								      AND SALES_ORD_CNCL_YN = 'N'
								      AND RPT_CUST_CD = A.RPT_CUST_CD) ) BL_TOT_ADMT
        , case when a.ctrt_cust_cd='P2070' and a.cust_move_type_cd='Z37' then 
                     'N'
               else
			         decode((SELECT max(work_step_cd)
			                   FROM tb_om03003
			                  WHERE sales_ord_no = b.sales_ord_no
			                    AND work_route_seq = b.work_route_seq
			                    AND work_step_cd = '00003')
			                 ,NULL,'N','Y') 
			    end AS tran_yn
		, d.col01
		, d.col02
		, d.col03
		, d.col04
		, d.col05
		, d.col06
		, d.col07
		, d.col08
		, d.col09
		, d.col10
		, d.col11
		, d.col12
		, d.col13
		, d.col14
		, d.col15
		, d.col16
		, d.col17
		, d.col18
		, d.col19
		, d.col20
		, d.col21
		, d.col22
		, d.col23
		, d.col24
		, d.col25
		, d.col26
		, d.col27
		, d.col28
		, d.col29
		, d.col30
		, 'N' as if_yn
		, ${regrId} as regr_id
		, ${mdfrId} as mdfr_id
	FROM   tb_om02001 a
	     , tb_om03001 b
	     , tb_om03003 c
	     , tb_om02004 d
	WHERE  a.sales_ord_no 	= b.sales_ord_no
	  AND  a.sales_ord_no 	= c.sales_ord_no
	  AND  a.sales_ord_no 	= d.sales_ord_no(+)
	  AND  b.work_route_seq = c.work_route_seq      
	  AND  a.sales_ord_no 	= ${salesOrdNo}
	  AND  b.work_route_seq = ${workRouteSeq}
	  AND  c.work_step_seq 	= ${workStepSeq}
  </statement>  
  
<!-- 수출 출고실행오더전송용 기본정보 조회 -->
  <statement name="retrieveTransferExpPortGiEo">
	 SELECT ${eoNo} as wrhs_eo_no
		  , ${trmsSctnCd} as trms_sctn_cd	 
		  , (SELECT nvl(MAX(trms_seq), 0) + 1 FROM tb_om03009i WHERE wrhs_eo_no = ${eoNo}) AS trms_seq
		  , A.CORP_CD
		  , C.DPT_AR_CD AS WORK_PL_CD
		  , A.ORD_MNGT_EXCE_OFCR_ID
	      , (SELECT ofcr_tel_no 
	           FROM tb_ma01011 
	          WHERE user_id = a.ord_mngt_exce_ofcr_id) AS ord_mngt_exce_ofcr_tel_no
		  , A.SALES_ORD_NO
		  , A.CUST_ORD_NO
		  , C.MOVE_TYPE_CD
		  , A.ORD_TYPE_CD
		  , A.RPT_CUST_CD
		  , A.CTRT_CUST_CD
          , nvl(a.cust_ord_type_cd, a.cust_move_type_cd) as cust_ord_type_cd
		  , A.ORD_REQ_CUST_CD
		  , A.CUST_OF_CUST_CD
	      , case when b.arv_ar_type_cd = '02' then
			    	 (select name 
			    	    from vw_ma01_01 
			    	   where code = b.arv_ar_cd 
			    	     AND PTN_CD = a.RPT_CUST_CD
			    	     and work_sctn_cd = b.arv_ar_type_cd) 
		  	     when b.arv_ar_type_cd = '01' then 	    	
			    	 (select name 
			    	    from vw_ma01_01 
			    	   where code = b.arv_ar_cd 
			    	     and work_sctn_cd = b.arv_ar_type_cd
			    	     and rownum = 1) 
			     when b.arv_ar_type_cd = '03' then
				      b.arv_ar_cd
	        end  as cust_nm
		  , B.ARV_AR_CD
		  , B.ARV_AR_ZIP_CD
		  , B.ARV_AR_ZIP_ADDR
		  , B.ARV_AR_DTL_ADDR
		  , A.ARV_AR_OFCR_NM
		  , A.ARV_AR_OFCR_TEL_NO
		  , B.APTD_REQ_YMD
		  , B.APTD_REQ_HM
		  , idusr.omcomm_makermk_fn(a.sales_ord_no) as rmk
		  , A.CUST_EXPR_YN
		  , B.CLS_EXPR_YN
		  , B.LEAD_TIME_EXPR_YN
		  , B.LTRM_ORD_YN
          , case when e.exp_type_cd = '01' then
         		     (select ship_co_booking_no 
         		        from tb_om02019 
         		       where booking_no = b.booking_no 
         		         and sales_ord_no = a.sales_ord_no)
        		 else
        			  a.cust_ord_no
         	end as booking_no
		  , B.LOAD_DLY_YN
		  , A.CARGO_FORM_CD
		  , 'N' tran_yn
		  , d.col01
		  , d.col02
		  , d.col03
		  , d.col04
		  , d.col05
		  , d.col06
		  , d.col07
		  , d.col08
		  , d.col09
		  , d.col10
		  , d.col11
		  , d.col12
		  , d.col13
		  , d.col14
		  , d.col15
		  , d.col16
		  , d.col17
		  , d.col18
		  , d.col19
		  , (select min(eo_no) 
		       from tb_om03015 
		      where sales_ord_no=a.sales_ord_no 
		        and work_route_seq = b.work_route_seq 
		      --  and work_step_seq=30
		        and GI_WORK_STEP_SEQ is not null) col20   -- 포트출고에 대한 포트입고실행오더 번호 추출
		  , d.col21
		  , d.col22
		  , d.col23
		  , d.col24
		  , d.col25
		  , d.col26
		  , d.col27
		  , d.col28
		  , d.col29
		  , d.col30
		  , 'N' as if_yn
		  , ${regrId} as regr_id
		  , ${mdfrId} as mdfr_id
	   FROM  tb_om02001 a
	      , tb_om03001 b
	      , tb_om03003 c
	      , tb_om02004 d
	      , tb_om02003 e
	  WHERE a.sales_ord_no 	 = b.sales_ord_no
	    AND a.sales_ord_no 	 = c.sales_ord_no
	    AND a.sales_ord_no 	 = d.sales_ord_no(+)
	    AND a.sales_ord_no 	 = e.sales_ord_no(+)
	    AND b.work_route_seq = c.work_route_seq      
	    AND a.sales_ord_no 	 = ${salesOrdNo}
	    AND b.work_route_seq = ${workRouteSeq}
	    AND c.work_step_seq  = ${workStepSeq}
  </statement>
  
<!-- 수출 출고실행오더전송용 기본정보 조회 청원 포트오더 -->
  <statement name="retrieveTransferExpPortGiEoChungwon">
	SELECT ${eoNo} as wrhs_eo_no
		, ${trmsSctnCd} as trms_sctn_cd	 
		, (SELECT nvl(MAX(trms_seq), 0) + 1 FROM tb_om03009i WHERE wrhs_eo_no = ${eoNo}) AS trms_seq
		, A.CORP_CD
		, C.DPT_AR_CD AS WORK_PL_CD
		, A.ORD_MNGT_EXCE_OFCR_ID
	     , (SELECT ofcr_tel_no 
	          FROM tb_ma01011 
	         WHERE user_id = a.ord_mngt_exce_ofcr_id) AS ord_mngt_exce_ofcr_tel_no
		, A.SALES_ORD_NO
		, A.cust_ref_no as CUST_ORD_NO
		, C.MOVE_TYPE_CD
		, A.ORD_TYPE_CD
		, A.RPT_CUST_CD
		, A.CTRT_CUST_CD
        , nvl(a.cust_ord_type_cd, a.cust_move_type_cd) as cust_ord_type_cd
		, A.ORD_REQ_CUST_CD
		, A.CUST_OF_CUST_CD
	    , case when b.arv_ar_type_cd = '02' then
			    	(select name 
			    	  from vw_ma01_01 
			    	 where code = b.arv_ar_cd 
			    	   AND PTN_CD = a.RPT_CUST_CD
			    	   and work_sctn_cd = b.arv_ar_type_cd) 
		  	when b.arv_ar_type_cd = '01' then 	    	
			    	(select name 
			    	   from vw_ma01_01 
			    	  where code = b.arv_ar_cd 
			    	    and work_sctn_cd = b.arv_ar_type_cd
			    	    and rownum = 1) 
			when b.arv_ar_type_cd = '03' then
				b.arv_ar_cd
	      end  as cust_nm
		, B.ARV_AR_CD
		, B.ARV_AR_ZIP_CD
		, B.ARV_AR_ZIP_ADDR
		, B.ARV_AR_DTL_ADDR
		, A.ARV_AR_OFCR_NM
		, A.ARV_AR_OFCR_TEL_NO
		, B.APTD_REQ_YMD
		, B.APTD_REQ_HM
		, idusr.omcomm_makermk_fn(a.sales_ord_no) as rmk
		, A.CUST_EXPR_YN
		, B.CLS_EXPR_YN
		, B.LEAD_TIME_EXPR_YN
		, B.LTRM_ORD_YN
        ,(select ship_co_booking_no
          from tb_om02019
          where booking_no = b.booking_no
          and sales_ord_no = a.sales_ord_no) as booking_no
		, B.LOAD_DLY_YN
		, A.CARGO_FORM_CD
		, d.col01
		, d.col02
		, d.col03
		, d.col04
		, d.col05
		, d.col06
		, d.col07
		, d.col08
		, d.col09
		, d.col10
		, d.col11
		, d.col12
		, d.col13
		, d.col14
		, d.col15
		, d.col16
		, d.col17
		, d.col18
		, d.col19
		, d.col20
		, d.col21
		, d.col22
		, d.col23
		, d.col24
		, d.col25
		, d.col26
		, d.col27
		, d.col28
		, d.col29
		, d.col30
		, 'N' as if_yn
		, ${regrId} as regr_id
		, ${mdfrId} as mdfr_id
	FROM   tb_om02001 a
	     , tb_om03001 b
	     , tb_om03003 c
	     , tb_om02004 d
	     , tb_om02003 e
	WHERE  a.sales_ord_no 	= b.sales_ord_no
	  AND  a.sales_ord_no 	= c.sales_ord_no
	  AND  a.sales_ord_no 	= d.sales_ord_no(+)
	  AND  a.sales_ord_no 	= e.sales_ord_no(+)
	  AND  b.work_route_seq = c.work_route_seq      
	  AND  a.sales_ord_no 	= ${salesOrdNo}
	  AND  b.work_route_seq = ${workRouteSeq}
	  AND  c.work_step_seq 	= ${workStepSeq}
  </statement>   
  
<!-- 내수 출고실행오더전송용 아이템정보 조회 -->
   <statement name="retrieveTransferGiEoItemList">
	SELECT ${eoNo} as wrhs_eo_no
	     , ${trmsSeq} as trms_seq
	     , decode(nvl(${shipmentNo}, ''), '', b.line_no, c.line_no) line_no
	     , a.cust_cd
	     , a.basis_item_cd as item_cd
	     , ${workPlCd} as work_pl_cd
	     , a.bat_no
	     , a.item_grade_cd
         , case when a.cust_cd = 'P1100' and g.ITEM_LVL2_CD = '160100' then
         			decode(f.exp_imp_dom_sctn_cd, '03', 
												       decode(nvl(${shipmentNo}, '') , '', CASE WHEN e.fltr_conts1 = 'QTY_UNIT_CD' THEN
                                                                                                     b.ord_qty
                                                                                                WHEN e.fltr_conts1 = 'WGT_UNIT_CD' THEN
                                                                                                  /*   b.ord_wgt + least(1404, b.ord_wgt*0.1) */
                                                                                                     b.ord_wgt
                                                                                                WHEN e.fltr_conts1 = 'CBM' THEN
                                                                                                     b.ord_cbm
                                                                                                END
                                                                                         , CASE WHEN e.fltr_conts1 = 'QTY_UNIT_CD' THEN
                                                                                                     c.plan_qty
                                                                                                WHEN e.fltr_conts1 = 'WGT_UNIT_CD' THEN
                                                                                                  /*   c.plan_wgt + least(1404, c.plan_wgt*0.1) */
                                                                                                  	 c.plan_wgt
                                                                                                WHEN e.fltr_conts1 = 'CBM' THEN
                                                                                                     c.plan_cbm
                                                                                           END )
												     , decode(nvl(${shipmentNo}, '') , '', CASE WHEN e.fltr_conts1 = 'QTY_UNIT_CD' THEN
												                                                     b.ord_qty
												                                                WHEN e.fltr_conts1 = 'WGT_UNIT_CD' THEN
												                                                     b.ord_wgt
												                                                WHEN e.fltr_conts1 = 'CBM' THEN
												                                                     b.ord_cbm
												                                            END
												                                         , CASE WHEN e.fltr_conts1 = 'QTY_UNIT_CD' THEN
												                                                     c.plan_qty
												                                                WHEN e.fltr_conts1 = 'WGT_UNIT_CD' THEN
												                                                     c.plan_wgt
												                                                WHEN e.fltr_conts1 = 'CBM' THEN
												                                                     c.plan_cbm
												                                            END )
						)

				 else 
				       decode(nvl(${shipmentNo}, '') , '', CASE WHEN e.fltr_conts1 = 'QTY_UNIT_CD' THEN
				                                                     b.ord_qty
				                                                WHEN e.fltr_conts1 = 'WGT_UNIT_CD' THEN
				                                                     b.ord_wgt
				                                                WHEN e.fltr_conts1 = 'CBM' THEN
				                                                     b.ord_cbm
				                                            END
				                                         , CASE WHEN e.fltr_conts1 = 'QTY_UNIT_CD' THEN
				                                                     c.plan_qty
				                                                WHEN e.fltr_conts1 = 'WGT_UNIT_CD' THEN
				                                                     c.plan_wgt
				                                                WHEN e.fltr_conts1 = 'CBM' THEN
				                                                     c.plan_cbm
				                                            END ) 
			end as std_ord_qty				 	                                            	       
          , CASE WHEN e.fltr_conts1 = 'QTY_UNIT_CD' THEN
	                  a.ord_QTY        
	             WHEN e.fltr_conts1 = 'WGT_UNIT_CD' THEN
	                  a.ord_WGT        
	             WHEN e.fltr_conts1 = 'CBM' THEN
	                  a.ord_cbm        
	             END AS ORIGIN_ORD_QTY
         , decode(nvl(${shipmentNo}, ''), '', b.ord_qty, c.plan_qty) as ord_qty
         , a.qty_unit_cd
         , case when a.cust_cd = 'P1100' and g.ITEM_LVL2_CD = '160100' then
       			decode(f.exp_imp_dom_sctn_cd, '03', decode(nvl(${shipmentNo}, ''), '', b.ord_wgt , c.plan_wgt ) /* , b.ord_wgt + least(1404, b.ord_wgt*0.1), c.plan_wgt + least(1404, c.plan_wgt*0.1)) */
								          		  ,	decode(nvl(${shipmentNo}, ''), '', b.ord_wgt, c.plan_wgt)
					)
          		else 
          			decode(nvl(${shipmentNo}, ''), '', b.ord_wgt, c.plan_wgt) 
          	end as ord_wgt
         , a.wgt_unit_cd
         ,  a.PRDT_REQ_NO
         , decode(a.cust_cd, 'P1300', a.lot_no
                           , 'E8001', a.lot_no
                           , 'E1383', a.lot_no
                                    , '') as lot_no
	     , a.plant_cd 
	     , a.ord_reason_cd
         , a.cust_ord_line_no
         , a.line_no as SALES_ORD_LINE_NO 
         , case when a.cust_cd = 'P1100' then
	         		case when trim(a.pcul_cd) is null and trim(a.mn_cd) is null then
	         				''
	         			else 
	         				trim(a.pcul_cd) || '-' || trim(a.mn_cd)
	         		end
				else 
					''
			end as pcul_mn_cd 
		  , a.SALES_UPRICE
	      , d.col01
	      , d.col02
	      , d.col03
	      , d.col04
	      , d.col05
	      , d.col06
	      , d.col07
	      , d.col08
	      , d.col09
	      , d.col10
	      , d.col11
	      , d.col12
	      , d.col13
	      , d.col14
	      , d.col15
	      , d.col16
	      , d.col17
	      , d.col18
	      , d.col19
	      , d.col20
	      , d.col21
	      , d.col22
	      , d.col23
	      , d.col24
	      , d.col25
	      , d.col26
	      , d.col27
	      , d.col28
	      , d.col29
	      , d.col30
	     , ${regrId} as regr_id
	     , ${mdfrId} as mdfr_id
	     , decode(a.cust_cd,'R1206',a.ord_qty,a.pckg_qty)  as bl_unit_admt
	     , a.rmk
	     , a.CUST_REF_NO
	FROM   tb_om02002 a
	     , (SELECT sales_ord_no
	             , work_route_seq
	             , line_no
	             , ord_qty
	             , ord_wgt
	             , ord_cbm
	         FROM  tb_om03002 x
	        WHERE  x.sales_ord_no = ${salesOrdNo}
	          AND  x.work_route_seq = ${workRouteSeq}
	        {#2}
	        ) b
	     , (SELECT sales_ord_no
	             , work_route_seq
	             , shipment_no
	             , line_no
	             , sum(plan_qty) plan_qty
	             , sum(plan_wgt) plan_wgt
	             , sum(plan_cbm) plan_cbm
	          FROM tb_om03017 x
	         WHERE x.sales_ord_no = ${salesOrdNo}
	           AND work_route_seq = ${workRouteSeq}
	           AND shipment_no    = ${shipmentNo}
            GROUP BY sales_ord_no, work_route_seq, shipment_no, line_no) c
	     , tb_om02005 d
	     , tb_ma01015 e
	     , tb_om02001 f
	     , tb_ma02010 g
	WHERE  a.sales_ord_no   = b.sales_ord_no     
	  AND  a.line_no        = b.line_no
	  AND  a.sales_ord_no   = d.sales_ord_no(+)
	  AND  a.line_no        = d.line_no(+)
	  AND  a.sales_ord_no   = f.sales_ord_no
	  AND  b.sales_ord_no   = c.sales_ord_no(+)
	  AND  b.line_no        = c.line_no(+)
	  AND  b.work_route_seq = c.work_route_seq(+)
	  AND  e.clas_cd 	    = 'BASIC_UNIT_CD'
	  AND  a.basis_unit_cd  = e.comn_cd
	  and  a.cust_cd	    = g.ptn_cd
	  and  a.item_cd		= g.item_cd
	  AND  a.sales_ord_no   = ${salesOrdNo}
	  AND  b.WORK_route_seq = ${workRouteSeq}
		{#1}
    <append condition="${trmsSctnCd}.NOTEMPTY&amp;${trmsSctnCd}.EQ.Z" id="#1">
      AND  A.LINE_NO  = ${lineNo}
    </append>

    <append condition="${shipmentNo}.NOTEMPTY" id="#2">
      AND  exists (SELECT 1
                     FROM tb_om03017 z
                    WHERE z.sales_ord_no   = x.sales_ord_no
                      AND z.work_route_seq = x.work_route_seq
                      AND z.line_no        = x.line_no
                      AND z.shipment_no    = ${shipmentNo})
    </append>                         
  </statement>

<!-- 내수 출고실행오더전송용 BOM 아이템정보 조회 -->
   <statement name="retrieveTransferGiEoBomItemList">
	     SELECT ${eoNo} as wrhs_eo_no
	          , ${trmsSeq} as trms_seq
	          , to_char(rownum*10) as line_no
	          , a.cust_cd
	          , h.SET_BOM_ITEM_CD as item_cd
	          , ${workPlCd} as work_pl_cd
	          , a.bat_no
	          , a.item_grade_cd
              , a.ord_qty*h.set_qty as std_ord_qty                     
              , a.ord_qty*h.set_qty AS ORIGIN_ORD_QTY
              , a.ord_qty*h.set_qty as ord_qty
              , h.unit_cd as qty_unit_cd
              , a.ord_qty*h.set_qty as ord_wgt
              , a.wgt_unit_cd
              , a.PRDT_REQ_NO
              , '' as lot_no
	          , a.plant_cd 
	          , a.ord_reason_cd
              , a.cust_ord_line_no
              , a.line_no as SALES_ORD_LINE_NO 
              , '' as pcul_mn_cd 
	     	  , a.SALES_UPRICE
	          , d.col01
	          , d.col02
	          , d.col03
	          , d.col04
	          , d.col05
	          , d.col06
	          , d.col07
	          , d.col08
	          , d.col09
	          , d.col10
	          , d.col11
	          , d.col12
	          , d.col13
	          , d.col14
	          , d.col15
	          , d.col16
	          , d.col17
	          , d.col18
	          , d.col19
	          , d.col20
	          , d.col21
	          , d.col22
	          , d.col23
	          , d.col24
	          , d.col25
	          , d.col26
	          , d.col27
	          , d.col28
	          , d.col29
	          , d.col30
	          , ${regrId} as regr_id
	          , ${mdfrId} as mdfr_id
	          , a.pckg_qty as bl_unit_admt
	          , a.rmk
	     FROM   tb_om02002 a
	          , tb_om02005 d
	          , tb_ma01015 e
	          , tb_om02001 f
	          , tb_ma02010 g
	          , tb_ma02013 h
	     WHERE  a.sales_ord_no   = f.sales_ord_no
	       and  a.sales_ord_no   = d.sales_ord_no(+)
	       AND  a.line_no        = d.line_no(+)
	       AND  e.clas_cd 	     = 'BASIC_UNIT_CD'
	       AND  a.basis_unit_cd  = e.comn_cd
	       and  a.cust_cd	     = g.ptn_cd
	       and  a.item_cd		 = g.item_cd
	       and  f.rpt_cust_cd    = h.ptn_cd
	       and  a.item_cd        = h.set_item_cd
	       AND  a.sales_ord_no   = ${salesOrdNo}
	       {#1}
     <append condition="${trmsSctnCd}.NOTEMPTY&amp;${trmsSctnCd}.EQ.Z" id="#1">
           AND  A.LINE_NO  = ${lineNo}
     </append>
                      
  </statement>
  
<!-- 내수 출고실행오더전송용 아이템정보 조회 -->
   <statement name="retrieveSimpleTransferGiEoItemList">
	SELECT ${eoNo} as wrhs_eo_no
	     , ${trmsSeq} as trms_seq
	     , b.line_no
	     , a.cust_cd
	     , a.basis_item_cd as item_cd
	     , ${workPlCd} as work_pl_cd
	     , a.bat_no
	     , a.item_grade_cd
        -- , CASE WHEN e.fltr_conts1 = 'QTY_UNIT_CD' THEN
		--	                        b.ord_qty
		--	    WHEN e.fltr_conts1 = 'WGT_UNIT_CD' THEN
		--	                        b.ord_wgt
		--	    WHEN e.fltr_conts1 = 'CBM' THEN
		--	                        b.ord_cbm
		--	END
		--	as std_ord_qty	
		 , 	b.ord_qty	as std_ord_qty	 	                                            	       
        -- , CASE WHEN e.fltr_conts1 = 'QTY_UNIT_CD' THEN
	    --              a.ord_QTY        
	    --         WHEN e.fltr_conts1 = 'WGT_UNIT_CD' THEN
	    --              a.ord_WGT        
	    --         WHEN e.fltr_conts1 = 'CBM' THEN
	    --              a.ord_cbm        
	    --         END AS ORIGIN_ORD_QTY
	     , a.ord_QTY AS ORIGIN_ORD_QTY
         , b.ord_qty
         , a.qty_unit_cd
         , b.ord_wgt
         , a.wgt_unit_cd
         , a.PRDT_REQ_NO
         , '' as lot_no
	     , a.plant_cd 
	     , a.ord_reason_cd
         , a.cust_ord_line_no
         , a.line_no as SALES_ORD_LINE_NO 
	  	 , '' as pcul_mn_cd 
		 , a.SALES_UPRICE
	     , d.col01
	     , d.col02
	     , d.col03
	     , d.col04
	     , d.col05
	     , d.col06
	     , d.col07
	     , d.col08
	     , d.col09
	     , d.col10
	     , d.col11
	     , d.col12
	     , d.col13
	     , d.col14
	     , d.col15
	     , d.col16
	     , d.col17
	     , d.col18
	     , d.col19
	     , d.col20
	     , d.col21
	     , d.col22
	     , d.col23
	     , d.col24
	     , d.col25
	     , d.col26
	     , d.col27
	     , d.col28
	     , d.col29
	     , d.col30
	     , ${regrId} as regr_id
	     , ${mdfrId} as mdfr_id
	     , a.pckg_qty  as bl_unit_admt
	     , a.rmk
	FROM   tb_om02002 a
	     , (SELECT sales_ord_no
	             , work_route_seq
	             , line_no
	             , ord_qty
	             , ord_wgt
	             , ord_cbm
	          FROM tb_om03002 x
	         WHERE x.sales_ord_no = ${salesOrdNo}
	           AND x.work_route_seq = ${workRouteSeq}
	        ) b
	     , tb_om02005 d
	     , tb_om02001 f
	WHERE  a.sales_ord_no   = b.sales_ord_no     
	  AND  a.line_no        = b.line_no
	  AND  a.sales_ord_no   = d.sales_ord_no(+)
	  AND  a.line_no        = d.line_no(+)
	  AND  a.sales_ord_no   = f.sales_ord_no
	  AND  a.sales_ord_no   = ${salesOrdNo}
	  AND  b.WORK_route_seq = ${workRouteSeq}
	  {#1}
    <append condition="${trmsSctnCd}.NOTEMPTY&amp;${trmsSctnCd}.EQ.Z" id="#1">
      AND  A.LINE_NO  = ${lineNo}
    </append>
                   
  </statement>  
  
  
<!-- 청원 수출반품 출고실행오더전송용 아이템정보 조회 -->
   <statement name="retrieveTransferGiEoItemReturnList">
	SELECT ${eoNo} as wrhs_eo_no
	     , ${trmsSeq} as trms_seq
	     , decode(nvl(${shipmentNo}, ''), '', b.line_no, c.line_no) line_no
	     , a.cust_cd
	     , a.basis_item_cd as item_cd
	     , ${workPlCd} as work_pl_cd
	     , a.bat_no
	     , a.item_grade_cd
         , case when a.cust_cd = 'P1100' and g.ITEM_LVL2_CD = '160100' then
         			decode(f.exp_imp_dom_sctn_cd, '03', 
												       decode(nvl(${shipmentNo}, '') , '', CASE WHEN e.fltr_conts1 = 'QTY_UNIT_CD' THEN
                                                                                                     b.ord_qty
                                                                                                WHEN e.fltr_conts1 = 'WGT_UNIT_CD' THEN
                                                                                                    /* b.ord_wgt + least(1404, b.ord_wgt*0.1) */
                                                                                                    b.ord_wgt
                                                                                                WHEN e.fltr_conts1 = 'CBM' THEN
                                                                                                     b.ord_cbm
                                                                                                END
                                                                                         , CASE WHEN e.fltr_conts1 = 'QTY_UNIT_CD' THEN
                                                                                                     c.plan_qty
                                                                                                WHEN e.fltr_conts1 = 'WGT_UNIT_CD' THEN
                                                                                                   /*  c.plan_wgt + least(1404, c.plan_wgt*0.1) */
                                                                                                     c.plan_wgt 
                                                                                                WHEN e.fltr_conts1 = 'CBM' THEN
                                                                                                     c.plan_cbm
                                                                                           END )
												     , decode(nvl(${shipmentNo}, '') , '', CASE WHEN e.fltr_conts1 = 'QTY_UNIT_CD' THEN
												                                                     b.ord_qty
												                                                WHEN e.fltr_conts1 = 'WGT_UNIT_CD' THEN
												                                                     b.ord_wgt
												                                                WHEN e.fltr_conts1 = 'CBM' THEN
												                                                     b.ord_cbm
												                                            END
												                                         , CASE WHEN e.fltr_conts1 = 'QTY_UNIT_CD' THEN
												                                                     c.plan_qty
												                                                WHEN e.fltr_conts1 = 'WGT_UNIT_CD' THEN
												                                                     c.plan_wgt
												                                                WHEN e.fltr_conts1 = 'CBM' THEN
												                                                     c.plan_cbm
												                                            END )
						)

				 else 
				       decode(nvl(${shipmentNo}, '') , '', CASE WHEN e.fltr_conts1 = 'QTY_UNIT_CD' THEN
				                                                     b.ord_qty
				                                                WHEN e.fltr_conts1 = 'WGT_UNIT_CD' THEN
				                                                     b.ord_wgt
				                                                WHEN e.fltr_conts1 = 'CBM' THEN
				                                                     b.ord_cbm
				                                            END
				                                         , CASE WHEN e.fltr_conts1 = 'QTY_UNIT_CD' THEN
				                                                     c.plan_qty
				                                                WHEN e.fltr_conts1 = 'WGT_UNIT_CD' THEN
				                                                     c.plan_wgt
				                                                WHEN e.fltr_conts1 = 'CBM' THEN
				                                                     c.plan_cbm
				                                            END ) 
			end as std_ord_qty				 	                                            	       
          , CASE WHEN e.fltr_conts1 = 'QTY_UNIT_CD' THEN
	                  a.ord_QTY        
	             WHEN e.fltr_conts1 = 'WGT_UNIT_CD' THEN
	                  a.ord_WGT        
	             WHEN e.fltr_conts1 = 'CBM' THEN
	                  a.ord_cbm        
	             END AS ORIGIN_ORD_QTY
         , decode(nvl(${shipmentNo}, ''), '', b.ord_qty, c.plan_qty) as ord_qty
         , a.qty_unit_cd
         , case when a.cust_cd = 'P1100' and g.ITEM_LVL2_CD = '160100' then
       			decode(f.exp_imp_dom_sctn_cd, '03', decode(nvl(${shipmentNo}, ''), '', b.ord_wgt, c.plan_wgt) /* , b.ord_wgt + least(1404, b.ord_wgt*0.1), c.plan_wgt + least(1404, c.plan_wgt*0.1)) */
								          		  ,	decode(nvl(${shipmentNo}, ''), '', b.ord_wgt, c.plan_wgt)
					)
          		else 
          			decode(nvl(${shipmentNo}, ''), '', b.ord_wgt, c.plan_wgt) 
          	end as ord_wgt
         , a.wgt_unit_cd
         ,  a.PRDT_REQ_NO
         , a.RETURN_GOODS_CUST_MNF_NO as lot_no
	     , a.plant_cd 
	     , a.ord_reason_cd
         , a.cust_ord_line_no
         , a.line_no as SALES_ORD_LINE_NO 
         , case when a.cust_cd = 'P1100' then
	         		case when trim(a.pcul_cd) is null and trim(a.mn_cd) is null then
	         				''
	         			else 
	         				trim(a.pcul_cd) || '-' || trim(a.mn_cd)
	         		end
				else 
					''
			end as pcul_mn_cd 
		  , (select decode(y.cargo_form_cd, 'C', col04 , '')
		  	 from 	tb_om02004 x
		  	 	  , tb_om02001 y 
		  	 where  x.sales_ord_no = y.sales_ord_no
		  	 and	y.cust_ord_no  = f.return_goods_cust_vdsp_no) cntr_no
	      , d.col01
	      , d.col02
	      , d.col03
	      , d.col04
	      , d.col05
	      , d.col06
	      , d.col07
	      , d.col08
	      , d.col09
	      , d.col10
	      , d.col11
	      , d.col12
	      , d.col13
	      , d.col14
	      , d.col15
	      , d.col16
	      , d.col17
	      , d.col18
	      , d.col19
	      , d.col20
	      , d.col21
	      , d.col22
	      , d.col23
	      , d.col24
	      , d.col25
	      , d.col26
	      , d.col27
	      , d.col28
	      , d.col29
	      , d.col30
	     , ${regrId} as regr_id
	     , ${mdfrId} as mdfr_id
	FROM   tb_om02002 a
	     , (SELECT sales_ord_no
	             , work_route_seq
	             , line_no
	             , ord_qty
	             , ord_wgt
	             , ord_cbm
	        FROM   tb_om03002 x
	        WHERE  x.sales_ord_no = ${salesOrdNo}
	        AND    x.work_route_seq = ${workRouteSeq}
	        {#2}
	        ) b
	     , (SELECT sales_ord_no
	             , work_route_seq
	             , shipment_no
	             , line_no
	             , sum(plan_qty) plan_qty
	             , sum(plan_wgt) plan_wgt
	             , sum(plan_cbm) plan_cbm
	        FROM   tb_om03017 x
	        WHERE  x.sales_ord_no = ${salesOrdNo}
	        AND    work_route_seq = ${workRouteSeq}
	        AND    shipment_no    = ${shipmentNo}
            GROUP BY sales_ord_no, work_route_seq, shipment_no, line_no) c
	     , tb_om02005 d
	     , tb_ma01015 e
	     , tb_om02001 f
	     , tb_ma02010 g
	WHERE  a.sales_ord_no   = b.sales_ord_no     
	AND    a.line_no        = b.line_no
	AND    a.sales_ord_no   = d.sales_ord_no(+)
	AND    a.line_no        = d.line_no(+)
	AND    a.sales_ord_no   = f.sales_ord_no
	AND    b.sales_ord_no   = c.sales_ord_no(+)
	AND    b.line_no        = c.line_no(+)
	AND    b.work_route_seq = c.work_route_seq(+)
	AND    e.clas_cd 	    = 'BASIC_UNIT_CD'
	AND    a.basis_unit_cd  = e.comn_cd
	and	   a.cust_cd	    = g.ptn_cd
	and	   a.item_cd		= g.item_cd
	AND    a.sales_ord_no   = ${salesOrdNo}
	AND    b.WORK_route_seq = ${workRouteSeq}
		{#1}
    <append condition="${trmsSctnCd}.NOTEMPTY&amp;${trmsSctnCd}.EQ.Z" id="#1">
    AND   A.LINE_NO  = ${lineNo}
    </append>

    <append condition="${shipmentNo}.NOTEMPTY" id="#2">
     AND    exists (SELECT 1
                    FROM tb_om03017 z
                    WHERE z.sales_ord_no   = x.sales_ord_no
                    AND   z.work_route_seq = x.work_route_seq
                    AND   z.line_no        = x.line_no
                    AND   z.shipment_no    = ${shipmentNo})
    </append>                         
  </statement>
<!-- 수출 출고실행오더전송용 아이템정보 조회 -->
   <statement name="retrieveTransferExpPortGiEoItemList">
	SELECT ${eoNo} as wrhs_eo_no
	  	, ${trmsSeq} as trms_seq
	  	, ${workPlCd} as work_pl_cd 
	  	, a.CUST_ORD_LINE_NO
	  	, a.CUST_CD
	  	, b.line_no
	  	, a.basis_item_cd as ITEM_CD
	  	, a.BAT_NO
	    , CASE WHEN e.fltr_conts1 = 'QTY_UNIT_CD' THEN
	           b.rslt_QTY
	      WHEN e.fltr_conts1 = 'WGT_UNIT_CD' THEN
	           b.rslt_WGT
	      WHEN e.fltr_conts1 = 'CBM' THEN
	           b.rslt_cbm
	      END AS std_ord_qty
	    , CASE WHEN e.fltr_conts1 = 'QTY_UNIT_CD' THEN
	           a.ord_QTY
	      WHEN e.fltr_conts1 = 'WGT_UNIT_CD' THEN
	           a.ord_WGT
	      WHEN e.fltr_conts1 = 'CBM' THEN
	           a.ord_cbm
	      END AS ORIGIN_ORD_QTY
	  	, b.rslt_QTY as ord_qty
	  	, a.QTY_UNIT_CD
	  	, b.rslt_WGT as ord_wgt
	  	, a.WGT_UNIT_CD
	  	, '' LOT_NO
	  	, a.PRDT_REQ_NO
	  	, a.PLANT_CD
	  	, a.ORD_REASON_CD
	--  	, (select CNTR_NO from tb_om03014 where shipment_no = c.shipment_no and trim(cntr_no) is not null) cntr_no
        , (select CNTR_NO 
             from tb_om03014 
            where sales_ord_no = a.sales_ord_no
              and shipment_no = c.shipment_no
              and to_char(reg_date,'yyyymmddhh24miss') = ( select to_char(max(REG_DATE),'yyyymmddhh24miss') 
                                                             from tb_om03014 
                                                            where sales_ord_no = a.sales_ord_no
                                                              and shipment_no  = c.shipment_no)) cntr_no
	  	, b.line_no as SALES_ORD_LINE_NO 
         , case when a.cust_cd = 'P1100' then
	         		case when trim(a.pcul_cd) is null and trim(a.mn_cd) is null then
	         				''
	         			else 
	         				trim(a.pcul_cd) || '-' || trim(a.mn_cd)
	         		end
				else 
					''
			end as pcul_mn_cd 
	    , d.col01
	    , d.col02
	    , d.col03
	    , d.col04
	    , d.col05
	    , d.col06
	    , d.col07
	    , d.col08
	    , d.col09
	    , d.col10
	    , d.col11
	    , d.col12
	    , d.col13
	    , d.col14
	    , d.col15
	    , d.col16
	    , d.col17
	    , d.col18
	    , d.col19
	    , d.col20
	    , d.col21
	    , d.col22
	    , d.col23
	    , d.col24
	    , d.col25
	    , d.col26
	    , d.col27
	    , d.col28
	    , d.col29
	    , d.col30
	    , ${regrId} as regr_id
	    , ${mdfrId} as mdfr_id
	from  tb_om02002 a
      , (SELECT sales_ord_no
              , line_no
              , work_route_seq
              , work_step_seq
              , rslt_dgr_cnt
              , cncl_ord_no
              , sum(rslt_qty) rslt_qty
              , sum(rslt_wgt) rslt_wgt
              , sum(rslt_cbm) rslt_cbm
         FROM   tb_om04003 
         WHERE  sales_ord_no = ${salesOrdNo}
         AND    work_route_seq = ${workRouteSeq}
         AND    work_step_seq  = ${rsltWorkStepSeq}
         AND    rslt_dgr_cnt   = ${rsltDgrCnt}
         GROUP BY sales_ord_no
              , line_no
              , work_route_seq
              , work_step_seq
              , rslt_dgr_cnt 
              , cncl_ord_no ) b
	  	, tb_om04001 c
	    , tb_om02005 d
	    , tb_ma01015 e
	    , tb_om03001 f
	WHERE  a.sales_ord_no     = b.sales_ord_no
	AND    b.sales_ord_no     = c.sales_ord_no
	AND    b.work_route_seq   = c.work_route_seq
	AND    b.work_step_seq    = c.work_step_seq
	AND    b.rslt_dgr_cnt     = c.rslt_dgr_cnt
	AND    a.sales_ord_no     = d.sales_ord_no(+)
	AND    a.line_no          = b.line_no
	AND    a.line_no          = d.line_no(+)
	AND    a.sales_ord_no     = f.sales_ord_no
	AND    b.Work_Route_Seq   = f.work_route_seq
	AND    f.del_yn           = 'N'
	AND    e.clas_cd          = 'BASIC_UNIT_CD'
	AND    a.basis_unit_cd    = e.comn_cd
	AND    a.sales_ord_no     = ${salesOrdNo}
	AND    c.Work_Route_Seq   = ${workRouteSeq}
	AND    c.Work_Step_Seq    = ${rsltWorkStepSeq} 
	AND    c.rslt_dgr_cnt     = ${rsltDgrCnt}
	AND	   b.cncl_ord_no is null
		{#1}
    <append condition="${trmsSctnCd}.NOTEMPTY&amp;${trmsSctnCd}.EQ.Z" id="#1">
    AND   A.LINE_NO  = ${lineNo}
    </append>
	</statement>
	
<!-- 수출 출고실행오더전송용 청원오더용 아이템정보 조회 -->
   <statement name="retrieveTransferExpPortGiEoItemListChungwon">
	SELECT ${eoNo} as wrhs_eo_no
	  	, ${trmsSeq} as trms_seq
	  	, ${workPlCd} as work_pl_cd 
	  	, d.col01 as CUST_ORD_LINE_NO
	  	, a.CUST_CD
	  	, to_char(rownum * 10) line_no
	  	, a.basis_item_cd as ITEM_CD
	  	, a.BAT_NO
	    , CASE WHEN e.fltr_conts1 = 'QTY_UNIT_CD' THEN
	           b.ord_QTY
	      WHEN e.fltr_conts1 = 'WGT_UNIT_CD' THEN
	           b.ord_WGT
	      WHEN e.fltr_conts1 = 'CBM' THEN
	           b.ord_cbm
	      END AS std_ord_qty
	    , CASE WHEN e.fltr_conts1 = 'QTY_UNIT_CD' THEN
	           a.ord_QTY
	      WHEN e.fltr_conts1 = 'WGT_UNIT_CD' THEN
	           a.ord_WGT
	      WHEN e.fltr_conts1 = 'CBM' THEN
	           a.ord_cbm
	      END AS ORIGIN_ORD_QTY
	  	, b.ord_QTY as ord_qty
	  	, a.QTY_UNIT_CD
	  	, b.ord_WGT as ord_wgt
	  	, a.WGT_UNIT_CD
	  	, a.mnf_no as LOT_NO
	  	, a.PRDT_REQ_NO
	  	, a.PLANT_CD
	  	, a.ORD_REASON_CD
	  	, decode(g.cargo_form_cd, 'C', c.col04, '') as cntr_no
	  	, b.line_no as SALES_ORD_LINE_NO 
         , case when a.cust_cd = 'P1100' then
	         		case when trim(a.pcul_cd) is null and trim(a.mn_cd) is null then
	         				''
	         			else 
	         				trim(a.pcul_cd) || '-' || trim(a.mn_cd)
	         		end
				else 
					''
			end as pcul_mn_cd 
	    , d.col01
	    , d.col02
	    , d.col03
	    , d.col04
	    , d.col05
	    , d.col06
	    , d.col07
	    , d.col08
	    , d.col09
	    , d.col10
	    , d.col11
	    , d.col12
	    , d.col13
	    , d.col14
	    , d.col15
	    , d.col16
	    , d.col17
	    , d.col18
	    , d.col19
	    , d.col20
	    , d.col21
	    , d.col22
	    , d.col23
	    , d.col24
	    , d.col25
	    , d.col26
	    , d.col27
	    , d.col28
	    , d.col29
	    , d.col30
	    , ${regrId} as regr_id
	    , ${mdfrId} as mdfr_id
	from  tb_om02002 a
	  	, tb_om03002 b
	    , tb_om02005 d
	    , tb_ma01015 e
	    , tb_om03001 f
	    , tb_om02004 c
	    , tb_om02001 g
	WHERE  a.sales_ord_no     = b.sales_ord_no
	AND    a.sales_ord_no     = f.sales_ord_no
	and		a.sales_ord_no	  = g.sales_ord_no
	AND	   f.work_route_seq	  = b.work_route_seq
	AND	   a.line_no		  = b.line_no
	AND    a.sales_ord_no     = c.sales_ord_no(+)
	AND    a.sales_ord_no     = d.sales_ord_no(+)
	AND    a.line_no          = d.line_no(+)
	AND    f.del_yn           = 'N'
	AND    e.clas_cd          = 'BASIC_UNIT_CD'
	AND    a.basis_unit_cd    = e.comn_cd
	AND    a.sales_ord_no     = ${salesOrdNo}
	AND    f.Work_Route_Seq   = ${workRouteSeq}
		{#1}
    <append condition="${trmsSctnCd}.NOTEMPTY&amp;${trmsSctnCd}.EQ.Z" id="#1">
    AND   A.LINE_NO  = ${lineNo}
    </append>
	</statement>
		
   <statement name="retrieveTransferExpPortGiEoItemListChungwonNew">
	SELECT ${eoNo} as wrhs_eo_no
	  	, ${trmsSeq} as trms_seq
	  	, ${workPlCd} as work_pl_cd 
	  	, d.col01 as CUST_ORD_LINE_NO
	  	, a.CUST_CD
	  	, to_char(rownum * 10) line_no
	  	, a.basis_item_cd as ITEM_CD
	  	, a.BAT_NO
	    , CASE WHEN e.fltr_conts1 = 'QTY_UNIT_CD' THEN
	           h.ord_QTY
	      WHEN e.fltr_conts1 = 'WGT_UNIT_CD' THEN
	           h.ord_WGT
	      END AS std_ord_qty
	    , CASE WHEN e.fltr_conts1 = 'QTY_UNIT_CD' THEN
	           h.ord_QTY
	      WHEN e.fltr_conts1 = 'WGT_UNIT_CD' THEN
	           h.ord_WGT
	      END AS ORIGIN_ORD_QTY
	  	, h.ord_QTY as ord_qty
	  	, a.QTY_UNIT_CD
	  	, h.ord_WGT as ord_wgt
	  	, a.WGT_UNIT_CD
	  	, h.mnf_no as LOT_NO
	  	, a.PRDT_REQ_NO
	  	, a.PLANT_CD
	  	, a.ORD_REASON_CD
	  	, decode(g.cargo_form_cd, 'C', c.col04, '') as cntr_no
	  	, b.line_no as SALES_ORD_LINE_NO 
         , case when a.cust_cd = 'P1100' then
	         		case when trim(a.pcul_cd) is null and trim(a.mn_cd) is null then
	         				''
	         			else 
	         				trim(a.pcul_cd) || '-' || trim(a.mn_cd)
	         		end
				else 
					''
			end as pcul_mn_cd 
	    , d.col01
	    , d.col02
	    , d.col03
	    , d.col04
	    , d.col05
	    , d.col06
	    , d.col07
	    , d.col08
	    , d.col09
	    , d.col10
	    , d.col11
	    , d.col12
	    , d.col13
	    , d.col14
	    , d.col15
	    , d.col16
	    , d.col17
	    , d.col18
	    , d.col19
	    , d.col20
	    , d.col21
	    , d.col22
	    , d.col23
	    , d.col24
	    , d.col25
	    , d.col26
	    , d.col27
	    , d.col28
	    , d.col29
	    , d.col30
	    , ${regrId} as regr_id
	    , ${mdfrId} as mdfr_id
	from  tb_om02002 a
	  	, tb_om03002 b
	    , tb_om02005 d
	    , tb_ma01015 e
	    , tb_om03001 f
	    , tb_om02004 c
	    , tb_om02001 g
	    , tb_om01010 h
	WHERE  a.sales_ord_no     = b.sales_ord_no
	AND    a.sales_ord_no     = f.sales_ord_no
	and		a.sales_ord_no	  = g.sales_ord_no
	AND	   f.work_route_seq	  = b.work_route_seq
	AND	   a.line_no		  = b.line_no
	AND    a.sales_ord_no     = c.sales_ord_no(+)
	AND    a.sales_ord_no     = d.sales_ord_no(+)
	AND    a.line_no          = d.line_no(+)
	AND    f.del_yn           = 'N'
	AND    e.clas_cd          = 'BASIC_UNIT_CD'
	AND    a.basis_unit_cd    = e.comn_cd
	AND    a.sales_ord_no     = ${salesOrdNo}
	AND    f.Work_Route_Seq   = ${workRouteSeq}
    AND    g.cust_ord_no      = h.cust_ord_no
    AND    a.item_cd          = h.item_cd
    AND    a.bat_no||a.pcul_cd||a.mn_cd = h.bat_no
		{#1}
    <append condition="${trmsSctnCd}.NOTEMPTY&amp;${trmsSctnCd}.EQ.Z" id="#1">
    AND   A.LINE_NO  = ${lineNo}
    </append>
	</statement>
			
<!-- 수입 출고실행오더전송용 아이템정보 조회 -->
   <statement name="retrieveTransferImpPortGiEoItemList">
	SELECT ${eoNo} as wrhs_eo_no
	  	, ${trmsSeq} as trms_seq
	  	, ${workPlCd} as work_pl_cd
	  	, a.CUST_ORD_LINE_NO    
	  	, a.CUST_CD
	  	, b.line_no
	  	, a.basis_item_cd as ITEM_CD
	  	, a.BAT_NO
	    , B.ORD_QTY AS std_ord_qty    
	    , A.ORD_QTY AS ORIGIN_ORD_QTY 
	  	, b.ord_QTY            
	  	, (  SELECT Z.QTY_UNIT_CD
			  FROM   TB_OM02001 X
			       , TB_OM02002 Z
			  WHERE  X.CUST_ORD_NO    = f.BL_CUST_ORD_NO
			  AND    X.SALES_ORD_NO   = Z.SALES_ORD_NO
	          AND    X.SALES_ORD_CNCL_YN != 'Y'
			  AND    Z.ITEM_CD 		  = A.ITEM_CD 
			  AND    Z.DEL_YN         = 'N' ) AS QTY_UNIT_CD
	  	, b.ord_WGT            
	  	, (  SELECT Z.WGT_UNIT_CD
			  FROM   TB_OM02001 X
			       , TB_OM02002 Z
			  WHERE  X.CUST_ORD_NO    = f.BL_CUST_ORD_NO
			  AND    X.SALES_ORD_NO   = Z.SALES_ORD_NO
	          AND    X.SALES_ORD_CNCL_YN != 'Y'
			  AND    Z.ITEM_CD 		  = A.ITEM_CD 
			  AND    Z.DEL_YN         = 'N' ) AS WGT_UNIT_CD
	  	, a.PLANT_CD            
	  	, a.ORD_REASON_CD       
	  	, b.line_no as SALES_ORD_LINE_NO 
		, ( SELECT ORD_WGT
			FROM	TB_OM02002
			WHERE	SALES_ORD_NO = (SELECT SALES_ORD_NO
								   FROM	  TB_OM02001
								   WHERE  CUST_ORD_NO = ${blCustOrdNo}
								   AND	  SALES_ORD_CNCL_YN = 'N'
								   AND    RPT_CUST_CD = A.CUST_CD) 
			AND		ITEM_CD = A.ITEM_CD 
			AND     DEL_YN  = 'N' ) BL_TOT_WGT
		, ( SELECT ADMT
			FROM	TB_OM02002
			WHERE	SALES_ORD_NO = (SELECT SALES_ORD_NO
								   FROM	  TB_OM02001
								   WHERE  CUST_ORD_NO = ${blCustOrdNo}
								   AND	  SALES_ORD_CNCL_YN = 'N'
								   AND    RPT_CUST_CD = A.CUST_CD ) 
			AND		ITEM_CD = A.ITEM_CD 
			AND     DEL_YN  = 'N'  ) BL_TOT_ADMT
		, ( SELECT ORD_WGT / ORD_QTY
			FROM	TB_OM02002
			WHERE	SALES_ORD_NO = (SELECT SALES_ORD_NO
								   FROM	  TB_OM02001
								   WHERE  CUST_ORD_NO = ${blCustOrdNo}
								   AND	  SALES_ORD_CNCL_YN = 'N'
								   AND RPT_CUST_CD = A.CUST_CD) 
			AND		ITEM_CD = A.ITEM_CD 
			AND     DEL_YN  = 'N'  ) BL_UNIT_WGT
		, ( SELECT ADMT / ORD_QTY
			FROM	TB_OM02002
			WHERE	SALES_ORD_NO = (SELECT SALES_ORD_NO
								   FROM	  TB_OM02001
								   WHERE  CUST_ORD_NO = ${blCustOrdNo}
								   AND	  SALES_ORD_CNCL_YN = 'N'
								   AND RPT_CUST_CD = A.CUST_CD) 
			AND		ITEM_CD = A.ITEM_CD 
			AND     DEL_YN  = 'N'  ) BL_UNIT_ADMT
         , case when a.cust_cd = 'P1100' then
	         		case when trim(a.pcul_cd) is null and trim(a.mn_cd) is null then
	         				''
	         			else 
	         				trim(a.pcul_cd) || '-' || trim(a.mn_cd)
	         		end
				else 
					''
			end as pcul_mn_cd 
	    , d.col01
	    , d.col02
	    , d.col03
	    , d.col04
	    , d.col05
	    , d.col06
	    , d.col07
	    , d.col08
	    , d.col09
	    , d.col10
	    , d.col11
	    , d.col12
	    , d.col13
	    , d.col14
	    , d.col15
	    , d.col16
	    , d.col17
	    , d.col18
	    , d.col19
	    , d.col20
	    , d.col21
	    , d.col22
	    , d.col23
	    , d.col24
	    , d.col25
	    , d.col26
	    , d.col27
	    , d.col28
	    , d.col29
	    , d.col30
	    , ${regrId} as regr_id  
	    , ${mdfrId} as mdfr_id  
	from  tb_om02002 a          
	  	, tb_om03002 b          
	    , tb_om02005 d          
	    , tb_om03001 f          
	WHERE  a.sales_ord_no     = d.sales_ord_no(+)
	AND    a.line_no          = d.line_no(+)
	AND    a.sales_ord_no     = b.sales_ord_no
	AND    a.line_no          = b.line_no
	AND    a.sales_ord_no     = f.sales_ord_no
	AND    b.Work_Route_Seq   = f.work_route_seq
	AND    a.del_yn           = 'N'
	AND    f.del_yn           = 'N'
	AND    a.sales_ord_no     = ${salesOrdNo}
	AND    b.Work_Route_Seq   = ${workRouteSeq}
		{#1}
    <append condition="${trmsSctnCd}.NOTEMPTY&amp;${trmsSctnCd}.EQ.Z" id="#1">
    AND   A.LINE_NO  = ${lineNo}
    </append>

  </statement>
  
  
  <!-- 적송오더 차량번호 조회 -->
  <statement name="retrieveCarNo">
   SELECT  a.CAR_NO 
   		 , a.shipment_no
   FROM   TB_OM03016 a
   		, tb_om04001 b
   WHERE  a.SALES_ORD_NO = b.SALES_ORD_NO
   AND    a.SHIPMENT_NO  = b.SHIPMENT_NO
   AND	  B.SALES_ORD_NO = ${salesOrdNo}
   AND	  B.WORK_ROUTE_SEQ = ${workRouteSeq}
   AND	  B.WORK_STEP_SEQ = ${rsltWorkStepSeq}
   AND	  B.RSLT_DGR_CNT = ${rsltDgrCnt}
  </statement>

  <!-- 입고ASN 차량번호 조회 -->
  <statement name="retrieveCarNoAsn">
   SELECT CAR_NO 
   FROM   TB_OM03016 a
   WHERE  a.SALES_ORD_NO = ${salesOrdNo}
   AND	  a.work_route_seq = ${workRouteSeq}
   AND	  a.SHIPMENT_NO = ${shipmentNo}
  </statement>
  <!-- 입고ASN 차량번호 조회 -->
  <statement name="retrieveCarNoCancelGi">
   SELECT CAR_NO 
   FROM   TB_OM03016 a
   WHERE  a.SHIPMENT_NO = ${shipmentNo}
   AND  ROWNUM = 1
  </statement>
  <!-- 지류대리점 차량번호 조회 -->
  <statement name="retrieveCarNoCust">
  	SELECT SHIPMENT_NO, CAR_NO
  	FROM	TB_OM03016
  	WHERE	SHIPMENT_NO IN (SELECT SHIPMENT_NO
  							FROM	TB_OM04001
  							WHERE	EO_NO = ${rltdGiEoNo}
  							AND		RSLT_DGR_CNT = ${ordDivDgrCnt} )
    AND		ROWNUM = 1
  							
  </statement>
	
	<statement name="retrieveCustOrdNo">
		SELECT CUST_ORD_NO
		FROM	TB_OM02001
		WHERE	SALES_ORD_NO = ${salesOrdNo}
	</statement>  
	
<!-- 입고실행오더전송용 기본정보 조회 -->
  <statement name="retrieveTransferGrEo">
	SELECT ${eoNo} as wrhs_eo_no
	     , (SELECT nvl(MAX(trms_seq), 0) + 1 FROM tb_om03005i WHERE wrhs_eo_no = ${eoNo}) AS trms_seq
		 , ${trmsSctnCd} as trms_sctn_cd	 
		 , a.corp_cd
	     , decode(a.rpt_cust_cd,'R1209','2900','R1728','2900',c.arv_ar_cd) as work_pl_cd
	     , a.ord_mngt_exce_ofcr_id 
	     , (SELECT ofcr_tel_no 
	        FROM   tb_ma01011 
	        WHERE  user_id = a.ord_mngt_exce_ofcr_id) AS ord_mngt_exce_ofcr_tel_no
	     , a.sales_ord_no
	     , a.cust_ord_no 
	     , a.ord_type_cd 
	     , a.rpt_cust_cd
	     , a.ctrt_cust_cd
	     , nvl(a.cust_ord_type_cd, a.cust_move_type_cd) as cust_ord_type_cd
	     , a.cust_move_type_cd
	     , b.dpt_ar_cd
		, case when b.dpt_ar_type_cd = '02' then
		          ( select name 
		            from   vw_ma01_01 
		            where  code         = b.dpt_ar_cd 
		            AND	   PTN_CD       = A.RPT_CUST_CD
		            and    work_sctn_cd = b.dpt_ar_type_cd) 
		       else 
		          ( select name 
		            from   vw_ma01_01 
		            where  code         = b.dpt_ar_cd 
		            and    work_sctn_cd = b.dpt_ar_type_cd
		            and    rownum       = 1) 
		  end as dpt_AR_NM   
	     , b.dpt_ar_zip_cd
	     , b.dpt_ar_zip_addr 
	     , b.dpt_ar_dtl_addr 
	     , a.dpt_ar_ofcr_nm 
	     , a.dpt_ar_ofcr_tel_no 
	     , b.aptd_req_ymd 
	     , b.aptd_req_hm 
	     , idusr.omcomm_makermk_fn(a.sales_ord_no) as rmk
         , a.rltd_gi_ord_no as rltd_gi_ord_no
         , a.ord_reason_cd
         , IDUSR.OMCOMM_GETCUSTREASONNM_FN(a.rpt_cust_cd, a.ord_reason_cd) ord_reason_nm
         , decode(nvl(a.rltd_gi_ord_no, ''), '', 'N', 'Y') GI_CNCL_REGR_YN
         , a.RLTD_GI_EO_NO
         , a.ORD_DIV_DGR_CNT
	     , case when a.rltd_gi_ord_no is not null then
	                (SELECT x.bl_no          FROM tb_om03001 x WHERE x.sales_ord_no = a.rltd_gi_ord_no AND del_yn = 'N' AND ROWNUM = 1) 
	            else e.mbl_no end bl_no
	     , case when a.rltd_gi_ord_no is not null then
	                (SELECT x.bl_cust_ord_no FROM tb_om03001 x WHERE x.sales_ord_no = a.rltd_gi_ord_no AND del_yn = 'N' AND ROWNUM = 1)
	            else a.cust_ord_no end bl_cust_ord_no
         , case when a.rpt_cust_cd = 'P2070'  then
                    (select ord_qty from tb_om02002 where sales_ord_no=a.sales_ord_no)
                else
                    e.tot_qty end as tot_qty
         , case when a.rpt_cust_cd = 'P2070'  then
                    (select ord_wgt from tb_om02002 where sales_ord_no=a.sales_ord_no)
                else
                    e.tot_wgt end as tot_wgt                    
         , case when a.rpt_cust_cd = 'P2070'  then
                    (select ord_wgt from tb_om02002 where sales_ord_no=a.sales_ord_no)
                else
                    e.tot_admt end as tot_admt
         --, e.tot_qty           
         --, e.tot_wgt
         --, e.tot_admt
         , case when e.tot_qty is not null and e.tot_qty > 0 and e.tot_wgt is not null and e.tot_wgt > 0 then
         			e.tot_wgt/e.tot_qty
         		else 0 
           end  bl_wgt
         , case when e.tot_qty is not null and e.tot_qty > 0 and e.tot_wgt is not null and e.tot_wgt > 0 then
         			e.tot_wgt/e.tot_qty
         		else 0 
           end  bl_admt
         , c.move_type_cd
         , (select ord_kind_cd
            from   tb_ma01006
            where  ord_type_cd = a.ord_type_cd) as ord_kind_cd
         --, case when (select count(*) from tb_ma02020 where cust_mpng_cd = a.rpt_cust_cd and ptn_cd = 'P1000') > 0 then
         , case when (select count(*) from tb_ma02020 where cust_mpng_cd = a.rpt_cust_cd and ptn_cd in ( 'P1000', 'P1591') ) > 0 then
         	'Y'
         	else
         		'N'
         	end as cust_mpng_yn
	     , d.col01
	     , d.col02
	     , d.col03
	     , d.col04
	     , d.col05
	     , d.col06
	     , d.col07
	     , d.col08
	     , d.col09
	     , d.col10
	     , d.col11
	     , d.col12
	     , d.col13
	     , d.col14
	     , d.col15
	     , d.col16
	     , d.col17
	     , d.col18
	     , d.col19
	     , d.col20
	     , d.col21
	     , d.col22
	     , d.col23
	     , d.col24
	     , d.col25
	     , d.col26
	     , d.col27
	     , d.col28
	     , d.col29
	     , d.col30
	     , 'N' as if_yn
	     , ${regrId} as regr_id
	     , ${mdfrId} as mdfr_id
	     , a.cust_ref_no
	     , decode(a.rpt_cust_cd,'R1209',a.cust_ref_no,'R1728',a.cust_ref_no,'') as booking_no
	     , decode(a.rpt_cust_cd,'R1209',a.tran_eo_no, '') as tran_eo_no
	FROM   tb_om02001 a
	     , tb_om03001 b
	     , tb_om03003 c
	     , tb_om02004 d
	     , tb_om02003 e
	WHERE  a.sales_ord_no 	= b.sales_ord_no
	AND    a.sales_ord_no 	= c.sales_ord_no
	AND    a.sales_ord_no 	= d.sales_ord_no(+)
	AND    b.work_route_seq = c.work_route_seq      
	AND	   a.sales_ord_no	= e.sales_ord_no(+)
	AND    a.sales_ord_no 	= ${salesOrdNo}
	AND    b.work_route_seq = ${workRouteSeq}
	AND    c.work_step_seq 	= ${workStepSeq}
  </statement>
  
<!-- 입고실행오더전송용 아이템정보 조회 시작 -->
  <statement name="retrieveTransferGrEoSalesOrdItem">
	SELECT a.sales_ord_no
	     , a.line_no
	     , a.cust_cd
	     , a.basis_item_cd  as item_cd
	     , a.item_grade_cd
	     , a.bat_no
	     , a.plant_cd
	     , a.lot_no
	     , a.prdt_req_no
	     , a.prdt_ymd
	     , (SELECT FLTR_CONTS1 FROM tb_ma01015 WHERE clas_cd = 'BASIC_UNIT_CD' AND comn_cd = a.basis_unit_cd) basis_unit_attr
	     , a.qty_unit_cd
	     , a.wgt_unit_cd
	     , a.ord_reason_cd
	     , a.cntr_no
	     , a.cust_ord_line_no
         , case when a.cust_cd = 'P1100' then
	         		case when trim(a.pcul_cd) is null and trim(a.mn_cd) is null then
	         				''
	         			else 
	         				trim(a.pcul_cd) || '-' || trim(a.mn_cd)
	         		end
				else 
					''
			end as pcul_mn_cd 
	     , b.rpt_cust_cd
	     , (SELECT x.ord_type_cd FROM tb_om02001 x WHERE x.sales_ord_no = b.rltd_gi_ord_no) gi_ord_type_cd
	     , a.sales_uprice
	     , a.rmk
	     , a.cust_ref_no
	     , decode(b.rpt_cust_cd,'R1209',b.tran_eo_no, '') as eve_id
	FROM   tb_om02002 a
	     , tb_om02001 b
	WHERE  a.sales_ord_no = b.sales_ord_no
	AND    a.sales_ord_no = ${salesOrdNo}  
	AND	   a.line_no	  = ${lineNo}	
  </statement>

<!-- 입고실행오더전송용 아이템정보 조회 시작 : 이브자리-->
  <statement name="retrieveTransferGrEoSalesOrdItemEve">
	SELECT a.sales_ord_no
	     , a.line_no
	     , a.cust_cd
	     , a.basis_item_cd  as item_cd
	     , a.item_grade_cd
	     , a.bat_no
	     , a.plant_cd
	     , a.lot_no
	     , a.prdt_req_no
	     , a.prdt_ymd
	     , (SELECT FLTR_CONTS1 FROM tb_ma01015 WHERE clas_cd = 'BASIC_UNIT_CD' AND comn_cd = a.basis_unit_cd) basis_unit_attr
	     , a.qty_unit_cd
	     , a.wgt_unit_cd
	     , a.ord_reason_cd
	     , a.cntr_no
	     , a.cust_ord_line_no
         , case when a.cust_cd = 'P1100' then
	         		case when trim(a.pcul_cd) is null and trim(a.mn_cd) is null then
	         				''
	         			else 
	         				trim(a.pcul_cd) || '-' || trim(a.mn_cd)
	         		end
				else 
					''
			end as pcul_mn_cd 
	     , b.rpt_cust_cd
	     , (SELECT x.ord_type_cd FROM tb_om02001 x WHERE x.sales_ord_no = b.rltd_gi_ord_no) gi_ord_type_cd
	     , a.sales_uprice
	     , (select round(cbm,3) from tb_ma02010 where ptn_cd = a.cust_cd and item_cd=a.item_cd) eve_cbm
	FROM   tb_om02002 a
	     , tb_om02001 b
	WHERE  a.sales_ord_no = b.sales_ord_no
	AND    a.sales_ord_no = ${salesOrdNo}  
	AND	   a.line_no	  = ${lineNo}	
  </statement>

  <statement name="retrieveTransferGrEoSalesOrdBomItem">
	SELECT a.sales_ord_no
	     , a.line_no
	     , a.cust_cd
	     , a.basis_item_cd  as item_cd
	     , c.set_bom_item_cd 
	     , a.item_grade_cd
	     , a.bat_no
	     , a.plant_cd
	     , a.lot_no
	     , a.prdt_req_no
	     , a.prdt_ymd
	     , (SELECT FLTR_CONTS1 FROM tb_ma01015 WHERE clas_cd = 'BASIC_UNIT_CD' AND comn_cd = a.basis_unit_cd) basis_unit_attr
	    -- , a.qty_unit_cd
	     , c.unit_cd as qty_unit_cd
	     , a.wgt_unit_cd
	     , a.ord_reason_cd
	     , a.cntr_no
	     , a.cust_ord_line_no
         , case when a.cust_cd = 'P1100' then
	         		case when trim(a.pcul_cd) is null and trim(a.mn_cd) is null then
	         				''
	         			else 
	         				trim(a.pcul_cd) || '-' || trim(a.mn_cd)
	         		end
				else 
					''
			end as pcul_mn_cd 
	     , b.rpt_cust_cd
	     , (SELECT x.ord_type_cd FROM tb_om02001 x WHERE x.sales_ord_no = b.rltd_gi_ord_no) gi_ord_type_cd
	     , c.set_qty
	FROM   tb_om02002 a
	     , tb_om02001 b
	     , tb_ma02013 c
	WHERE  a.sales_ord_no = b.sales_ord_no
	AND    a.sales_ord_no = ${salesOrdNo}  
	AND	   a.line_no	  = ${lineNo}
	and    a.cust_cd      = c.ptn_cd
	and    a.basis_item_cd = c.set_item_cd	
  </statement>

  
  <statement name="retrieveTransferGrEoSalesOrdItemList">
	SELECT a.sales_ord_no
		 , a.line_no
	     , b.cust_cd
	     , b.basis_item_cd  as item_cd
	     , b.item_cd as full_item_cd
	     , b.item_grade_cd
	     , b.bat_no
	     , a.ord_qty
	     , a.ord_wgt
	     , a.ord_cbm
	     , (SELECT FLTR_CONTS1 FROM tb_ma01015 WHERE clas_cd = 'BASIC_UNIT_CD' AND comn_cd = b.basis_unit_cd) basis_unit_attr
	     , b.qty_unit_cd
	     , b.wgt_unit_cd
	     , b.plant_cd
     	 , b.lot_no
	     , b.prdt_req_no
	     , b.prdt_ymd
	     , b.ord_reason_cd
	     , b.cntr_no
	     , b.cust_ord_line_no
	     , b.pallet_qty
	     , b.mnf_no
         , case when b.cust_cd = 'P1100' then
	         		case when trim(b.pcul_cd) is null and trim(b.mn_cd) is null then
	         				''
	         			else 
	         				trim(b.pcul_cd) || '-' || trim(b.mn_cd)
	         		end
				else 
					''
			end as pcul_mn_cd 
		 , case when b.cust_cd = 'P2070' then
		             b.ord_wgt
		        else
		            decode(b.cust_cd,'R1206',b.ord_qty,b.pckg_qty) end as bl_unit_admt
		 , b.rmk
		 , b.cust_ref_no	
	FROM   tb_om03002 a
	     , tb_om02002 b
	WHERE  a.sales_ord_no = b.sales_ord_no
	AND	   A.LINE_NO = B.LINE_NO
	AND	   a.sales_ord_no = ${salesOrdNo}
	AND    a.work_route_seq = ${workRouteSeq}
		{#1}
    <append condition="${trmsSctnCd}.NOTEMPTY&amp;${trmsSctnCd}.EQ.Z" id="#1">
    AND   A.LINE_NO  = ${lineNo}
    </append>
  </statement>
  
  <statement name="retrieveTransferGrEoSalesOrdItemListByPalletNo">
	SELECT a.sales_ord_no
		-- , a.line_no
		 , to_char(rownum * 10) line_no
	     , b.cust_cd
	     , b.basis_item_cd  as item_cd
   	     , b.item_cd  as full_item_cd
	     , b.item_grade_cd
	     , b.bat_no
	     --, a.ord_qty
	     , nvl(c.ord_qty,a.ord_qty) ord_qty
	     --, a.ord_wgt
	     , nvl(c.ord_wgt,a.ord_wgt) ord_wgt
	     , a.ord_cbm	  
	     , (SELECT FLTR_CONTS1 FROM tb_ma01015 WHERE clas_cd = 'BASIC_UNIT_CD' AND comn_cd = b.basis_unit_cd) basis_unit_attr
	     , b.qty_unit_cd
	     , b.wgt_unit_cd
	     , b.plant_cd
     	 --, b.lot_no
	     , b.prdt_req_no
	     , c.pallet_no as lot_no
	     , b.prdt_ymd
	     , b.ord_reason_cd
	     , b.cntr_no
	     , b.cust_ord_line_no
	     , a.line_no as sales_ord_line_no
	     , b.pallet_qty
	     , b.mnf_no
		 , b.rmk	
	FROM   tb_om03002 a
	     , tb_om02002 b
	     , tb_om01011 c
	     , tb_om02001 d
	WHERE  a.sales_ord_no   = ${salesOrdNo}
	AND    a.sales_ord_no   = b.sales_ord_no
	AND    A.sales_ord_no   = d.sales_ord_no
	AND	   A.LINE_NO        = B.LINE_NO
	and    b.del_yn         = 'N'
	AND    D.cust_ord_no    = c.cust_ord_no
	AND    B.BASIS_ITEM_CD  = c.item_cd
	AND    B.cust_ord_line_no = c.line_no
--	AND    B.BAT_NO         = c.bat_no
	AND    a.work_route_seq = ${workRouteSeq}

  </statement>  
  
  
  <statement name="retrieveTransferGrEoSalesOrdItemShipment">
	SELECT a.sales_ord_no
		 , a.line_no
	     , b.cust_cd
	     , b.basis_item_cd  as item_cd
	     , b.item_grade_cd
	     , b.bat_no
	     , a.ord_qty
	     , a.ord_wgt
	     , a.ord_cbm
	     , (SELECT FLTR_CONTS1 FROM tb_ma01015 WHERE clas_cd = 'BASIC_UNIT_CD' AND comn_cd = b.basis_unit_cd) basis_unit_attr
	     , b.qty_unit_cd
	     , b.wgt_unit_cd
	     , b.plant_cd
     	 , b.lot_no
	     , b.prdt_req_no
	     , b.prdt_ymd
	     , b.ord_reason_cd
	     , b.cntr_no
	     , b.cust_ord_line_no
	     , b.pallet_qty
         , case when b.cust_cd = 'P1100' then
	         		case when trim(b.pcul_cd) is null and trim(b.mn_cd) is null then
	         				''
	         			else 
	         				trim(b.pcul_cd) || '-' || trim(b.mn_cd)
	         		end
				else 
					''
			end as pcul_mn_cd 
	FROM   (select sales_ord_no
				 , line_no
				 , shipment_no
				 , sum(plan_qty) ord_qty
				 , sum(plan_wgt) ord_wgt
				 , sum(plan_cbm) ord_cbm
		    from   tb_om03017 
		    where  sales_ord_no   = ${salesOrdNo}
			AND    work_route_seq = ${workRouteSeq}
			and	   shipment_no	  = ${shipmentNo}
		    AND    LINE_NO  	  = ${lineNo}
		    group by sales_ord_no, line_no, shipment_no) a
		 , tb_om02002 b
	WHERE  a.sales_ord_no 	= b.sales_ord_no
	AND	   A.LINE_NO 		= B.LINE_NO
  </statement>

  <statement name="retrieveTransferGrEoSalesOrdItemShipmentByCy">
	SELECT a.sales_ord_no
		 , a.line_no
	     , b.cust_cd
	     , b.basis_item_cd  as item_cd
	     , b.item_grade_cd
	     , b.bat_no
	     , a.ord_qty
	     , a.ord_wgt
	     , a.ord_cbm
	     , (SELECT FLTR_CONTS1 FROM tb_ma01015 WHERE clas_cd = 'BASIC_UNIT_CD' AND comn_cd = b.basis_unit_cd) basis_unit_attr
	     , b.qty_unit_cd
	     , b.wgt_unit_cd
	     , b.plant_cd
     	 , b.lot_no
	     , b.prdt_req_no
	     , b.prdt_ymd
	     , b.ord_reason_cd
	     , b.cntr_no
	     , b.cust_ord_line_no
	     , b.pallet_qty
         , case when b.cust_cd = 'P1100' then
	         		case when trim(b.pcul_cd) is null and trim(b.mn_cd) is null then
	         				''
	         			else 
	         				trim(b.pcul_cd) || '-' || trim(b.mn_cd)
	         		end
				else 
					''
			end as pcul_mn_cd 
		 , c.col01
		 , c.col02
		 , c.col03
		 , c.col04
		 , c.col05
		 , c.col06
		 , c.col07
		 , c.col08
		 , c.col09
		 , c.col10
		 , c.col11
		 , c.col12
		 , c.col13
		 , c.col14
		 , c.col15
		 , c.col16
		 , c.col17
		 , c.col18
		 , c.col19
		 , c.col20
		 , c.col21
		 , c.col22
		 , c.col23
		 , c.col24
		 , c.col25
		 , c.col26
		 , c.col27
		 , c.col28
		 , c.col29
		 , c.col30
	FROM   (select sales_ord_no
				 , line_no
				 , shipment_no
				 , sum(plan_qty) ord_qty
				 , sum(plan_wgt) ord_wgt
				 , sum(plan_cbm) ord_cbm
		    from   tb_om03017 
		    where  sales_ord_no   = ${salesOrdNo}
			AND    work_route_seq = ${workRouteSeq}
			and	   shipment_no	  = ${shipmentNo}
		    AND    LINE_NO  	  = ${lineNo}
		    group by sales_ord_no, line_no, shipment_no) a
		 , tb_om02002 b
		 , tb_om02005 c
	WHERE  a.sales_ord_no 	= b.sales_ord_no
	AND	   A.LINE_NO 		= B.LINE_NO
	and    b.sales_ord_no   = c.sales_ord_no(+)
	and    b.line_no        = c.line_no(+)
  </statement>

  <statement name="retrieveTransferGrEoSalesOrdItemShipmentByPallet">
	SELECT b.sales_ord_no
		 --, b.line_no
		 , to_char(rownum * 10) line_no
	     , b.cust_cd
	     , b.basis_item_cd  as item_cd
	     , b.item_grade_cd
	     , b.bat_no
	     --, a.ord_qty
	     , d.ord_qty
	     --, a.ord_wgt
	     , d.ord_wgt
	     , a.ord_cbm
	     , (SELECT FLTR_CONTS1 FROM tb_ma01015 WHERE clas_cd = 'BASIC_UNIT_CD' AND comn_cd = b.basis_unit_cd) basis_unit_attr
	     , b.qty_unit_cd
	     , b.wgt_unit_cd
	     , b.plant_cd
     	-- , b.lot_no
	     , b.prdt_req_no
	     , d.pallet_no  as lot_no
	     , b.prdt_ymd
	     , b.ord_reason_cd
	     , b.cntr_no
	     , b.cust_ord_line_no
	     , b.line_no as sales_ord_line_no
	     , b.pallet_qty
         , case when b.cust_cd = 'P1100' then
	         		case when trim(b.pcul_cd) is null and trim(b.mn_cd) is null then
	         				''
	         			else 
	         				trim(b.pcul_cd) || '-' || trim(b.mn_cd)
	         		end
				else 
					''
			end as pcul_mn_cd 
	FROM   (select sales_ord_no
				 , line_no
				 , shipment_no
				 , sum(plan_qty) ord_qty
				 , sum(plan_wgt) ord_wgt
				 , sum(plan_cbm) ord_cbm
		    from   tb_om03017 
		    where  sales_ord_no   = ${salesOrdNo}
			AND    work_route_seq = ${workRouteSeq}
			and	   shipment_no	  = ${shipmentNo}
		    AND    LINE_NO  	  = ${lineNo}
		    group by sales_ord_no, line_no, shipment_no) a
		 , tb_om02002 b
		 , tb_om02001 c
		 , tb_om01011 d
	WHERE  a.sales_ord_no 	= b.sales_ord_no
	AND    a.sales_ord_no   = c.sales_ord_no
	and    b.sales_ord_no   = c.sales_ord_no
	AND	   A.LINE_NO 		= B.LINE_NO
	and    b.del_yn='N'
	and    c.cust_ord_no    = d.cust_ord_no
	and    b.basis_item_cd  = d.item_cd
	and    b.cust_ord_line_no  = d.line_no
	--and    b.bat_no         = d.bat_no
  </statement>

  <statement name="retrieveTransferGrEoSalesOrdItemShipmentByPalletAll">
	SELECT b.sales_ord_no
		 --, b.line_no
		 , to_char(rownum * 10) line_no
	     , b.cust_cd
	     , b.basis_item_cd  as item_cd
	     , b.item_grade_cd
	     , b.bat_no
	     --, a.ord_qty
	     , d.ord_qty
	     --, a.ord_wgt
	     , d.ord_wgt
	     , a.ord_cbm
	     , (SELECT FLTR_CONTS1 FROM tb_ma01015 WHERE clas_cd = 'BASIC_UNIT_CD' AND comn_cd = b.basis_unit_cd) basis_unit_attr
	     , b.qty_unit_cd
	     , b.wgt_unit_cd
	     , b.plant_cd
	     --, b.lot_no
     	 , d.pallet_no  as lot_no
	     , b.prdt_req_no
	     , b.prdt_ymd
	     , b.ord_reason_cd
	     , b.cntr_no
	     , b.cust_ord_line_no
	     , b.line_no as sales_ord_line_no
	     , b.pallet_qty
         , case when b.cust_cd = 'P1100' then
	         		case when trim(b.pcul_cd) is null and trim(b.mn_cd) is null then
	         				''
	         			else 
	         				trim(b.pcul_cd) || '-' || trim(b.mn_cd)
	         		end
				else 
					''
			end as pcul_mn_cd 
	     , c.ord_type_cd
	FROM   (select sales_ord_no
				 , shipment_no
				 , sum(plan_qty) ord_qty
				 , sum(plan_wgt) ord_wgt
				 , sum(plan_cbm) ord_cbm
		    from   tb_om03017 
		    where  sales_ord_no   = ${salesOrdNo}
			AND    work_route_seq = ${workRouteSeq}
			and	   shipment_no	  = ${shipmentNo}
		    group by sales_ord_no, shipment_no) a
		 , tb_om02002 b
		 , tb_om02001 c
		 , tb_om01011 d
	WHERE  a.sales_ord_no 	= b.sales_ord_no
	AND    a.sales_ord_no   = c.sales_ord_no
	and    b.sales_ord_no   = c.sales_ord_no
--	AND	   A.LINE_NO 		= B.LINE_NO
	and    b.del_yn='N'
	and    c.cust_ord_no    = d.cust_ord_no
	and    b.basis_item_cd  = d.item_cd
	and    b.cust_ord_line_no  = d.line_no
--	and    b.bat_no         = d.bat_no
  </statement>
  
  <statement name="retrieveTransferGrEoRsltItemList">
	SELECT a.sales_ord_no
	     , a.line_no
	     , a.rslt_qty
	     , a.rslt_wgt
	     , a.rslt_cbm
	     , a.lot_no
	     , a.prdt_ymd
	     , a.PRDT_LOT_NO
	     , a.DIA_SUPL
	     , a.PAPSTYLE_GDS_SUPL
	     , a.prdt_req_no
	     , to_char(b.work_date, 'yyyymmddHH24miss') work_date
	     , a.PCUL_MN_CD
	     , substr(a.DIA_SUPL,1,8) org_dia_supl
	     , substr(a.DIA_SUPL,9)   org_cntr_no
	     , b.bl_no
	FROM   tb_om04003 a
		 , tb_om04001 b
	WHERE  a.sales_ord_no 	 = b.sales_ord_no
	and	   a.work_route_seq  = b.work_route_seq
	and	   a.work_step_seq 	 = b.work_step_seq
	and	   a.rslt_dgr_cnt 	 = b.rslt_dgr_cnt
	AND    b.sales_ord_no 	 = ${salesOrdNo}
	AND    b.work_route_seq  = ${workRouteSeq}
	AND    b.work_step_seq 	 = ${rsltWorkStepSeq}
	and    b.rslt_dgr_cnt	 = ${rsltDgrCnt}
	and	   a.CNCL_ORD_NO is null
		{#1}
    <append condition="${trmsSctnCd}.NOTEMPTY&amp;${trmsSctnCd}.EQ.Z" id="#1">
    AND   A.LINE_NO  = ${lineNo}
    </append>
  </statement>

  <statement name="retrieveTransferGrEoRsltBomItemList">
	SELECT a.sales_ord_no
	     , a.line_no
         , trunc(sum(a.rslt_qty)/max(d.sum_set_qty)) as rslt_qty	     
	     , sum(a.rslt_wgt) rslt_wgt
	     , sum(a.rslt_cbm) rslt_cbm
	     , max(a.lot_no) lot_no
	     , max(a.prdt_ymd) prdt_ymd
	     , max(a.PRDT_LOT_NO) PRDT_LOT_NO
	     , max(a.DIA_SUPL) DIA_SUPL
	     , max(a.PAPSTYLE_GDS_SUPL) PAPSTYLE_GDS_SUPL
	     , max(a.prdt_req_no) prdt_req_no
	     , to_char(max(b.work_date), 'yyyymmddHH24miss') work_date
	     , max(a.PCUL_MN_CD) PCUL_MN_CD	
	FROM   tb_om04003 a
		 , tb_om04001 b
	     , (select x.line_no
	              ,y.set_item_cd
	              ,x.sales_ord_no
	              ,sum(set_qty) sum_set_qty 
	          from tb_om02002 x,tb_ma02013 y  
	         where x.sales_ord_no = ${salesOrdNo}
	           {#2}
	           and x.item_cd = y.set_item_cd
	         group by x.line_no
	                 ,x.sales_ord_no
	                 ,y.set_item_cd) d  		 
	WHERE  a.sales_ord_no 	 = b.sales_ord_no
	  and  a.work_route_seq  = b.work_route_seq
	  and  a.work_step_seq 	 = b.work_step_seq
	  and  a.rslt_dgr_cnt 	 = b.rslt_dgr_cnt
	  AND  b.sales_ord_no 	 = ${salesOrdNo}
	  AND  b.work_route_seq  = ${workRouteSeq}
	  AND  b.work_step_seq 	 = ${rsltWorkStepSeq}
	  and  b.rslt_dgr_cnt	 = ${rsltDgrCnt}
      and  a.sales_ord_no    = d.sales_ord_no
      and  a.line_no         = d.line_no 
	  and  a.CNCL_ORD_NO is null
	 {#1}
    group by a.sales_ord_no
	       , a.line_no 
	       
   <append condition="${trmsSctnCd}.NOTEMPTY&amp;${trmsSctnCd}.EQ.Z" id="#1">
    AND   A.LINE_NO  = ${lineNo}
    </append>	       

   <append condition="${trmsSctnCd}.NOTEMPTY&amp;${trmsSctnCd}.EQ.Z" id="#2">
    AND   x.LINE_NO  = ${lineNo}
    </append>
    	       
  </statement>
   
  <statement name="retrieveTransferGrEoSalesOrdItemPrclList">
  	SELECT   SALES_ORD_NO
			, LINE_NO
			, COL01
			, COL02
			, COL03
			, COL04
			, COL05
			, COL06
			, COL07
			, COL08
			, COL09
			, COL10
			, COL11
			, COL12
			, COL13
			, COL14
			, COL15
			, COL16
			, COL17
			, COL18
			, COL19
			, COL20
			, COL21
			, COL22
			, COL23
			, COL24
			, COL25
			, COL26
			, COL27
			, COL28
			, COL29
			, COL30
  	FROM	TB_OM02005
  	WHERE	SALES_ORD_NO = ${salesOrdNo}
		{#1}
    <append condition="${trmsSctnCd}.NOTEMPTY&amp;${trmsSctnCd}.EQ.Z" id="#1">
    AND     LINE_NO  = ${lineNo}
    </append>
  </statement>
<!-- 입고실행오더전송용 아이템정보 조회 끝 -->

<!-- 수출 입고실행오더전송용 기본정보 조회 -->
  <statement name="retrieveTransferExpPortGrEo">
	  SELECT  ${eoNo} as wrhs_eo_no
			, ${trmsSctnCd} as trms_sctn_cd	 
			, (SELECT nvl(MAX(trms_seq), 0) + 1 FROM tb_om03005i WHERE wrhs_eo_no = ${eoNo}) AS trms_seq
			, A.CORP_CD
			, (SELECT X.ARV_AR_CD 
	           FROM TB_OM03003 X
	           WHERE X.SALES_ORD_NO 	= C.SALES_ORD_NO
	           AND   X.WORK_ROUTE_SEQ 	= C.WORK_ROUTE_SEQ
	           AND   X.WORK_STEP_SEQ  	= C.WORK_STEP_SEQ) WORK_PL_CD  
			, A.ORD_MNGT_EXCE_OFCR_ID
		     , (SELECT ofcr_tel_no 
		        FROM   tb_ma01011 
		        WHERE  user_id = a.ord_mngt_exce_ofcr_id) AS ord_mngt_exce_ofcr_tel_no
			, A.SALES_ORD_NO
			, A.CUST_ORD_NO
			, C.MOVE_TYPE_CD
			, A.ORD_TYPE_CD
			, A.RPT_CUST_CD
			, A.CTRT_CUST_CD
			, A.CUST_ORD_TYPE_CD
			, (SELECT CAR_NO 
			   FROM   TB_OM03016 
			   WHERE  SALES_ORD_NO = E.SALES_ORD_NO
			   AND    SHIPMENT_NO  = E.SHIPMENT_NO
			   AND    ROWNUM = 1) CAR_NO
			, e.shipment_no
			, A.CARGO_FORM_CD
			, B.DPT_AR_CD
			, case when b.dpt_ar_type_cd = '02' then
			          ( select name 
			            from   vw_ma01_01 
			            where  code         = b.dpt_ar_cd 
			            AND	   PTN_CD       = A.RPT_CUST_CD
			            and    work_sctn_cd = b.dpt_ar_type_cd) 
			       else 
			          ( select name 
			            from   vw_ma01_01 
			            where  code         = b.dpt_ar_cd 
			            and    work_sctn_cd = b.dpt_ar_type_cd
			            and    rownum       = 1) 
			  end as dpt_AR_NM   
			, B.DPT_AR_ZIP_CD
			, B.DPT_AR_ZIP_ADDR
			, B.DPT_AR_DTL_ADDR
			, A.DPT_AR_OFCR_NM
			, A.DPT_AR_OFCR_TEL_NO
			, decode(nvl((SELECT TO_CHAR(ARV_PRAR_DATE, 'YYYYMMDD') 
						   FROM   TB_OM03018 
						   WHERE  SALES_ORD_NO   = A.SALES_ORD_NO
						   AND	  WORK_ROUTE_SEQ = B.WORK_ROUTE_SEQ
						   AND	  SHIPMENT_NO	 = E.SHIPMENT_NO
						   AND	  DPT_ARV_AR_CD  = (SELECT X.ARV_AR_CD 
										           FROM TB_OM03003 X
										           WHERE X.SALES_ORD_NO   = C.SALES_ORD_NO
										           AND   X.WORK_ROUTE_SEQ = C.WORK_ROUTE_SEQ
										           AND   X.WORK_STEP_SEQ  = C.WORK_STEP_SEQ)
						   AND    ARV_PRAR_DATE IS NOT NULL
						   AND    ROWNUM = 1)
					, '')
				, '', to_char(e.work_date, 'yyyymmdd')
				, (SELECT TO_CHAR(ARV_PRAR_DATE, 'YYYYMMDD') 
				   FROM   TB_OM03018 
				   WHERE  SALES_ORD_NO   = A.SALES_ORD_NO
				   AND	  WORK_ROUTE_SEQ = B.WORK_ROUTE_SEQ
				   AND	  SHIPMENT_NO	 = E.SHIPMENT_NO
				   AND	  DPT_ARV_AR_CD  = (SELECT X.ARV_AR_CD 
								           FROM TB_OM03003 X
								           WHERE X.SALES_ORD_NO   = C.SALES_ORD_NO
								           AND   X.WORK_ROUTE_SEQ = C.WORK_ROUTE_SEQ
								           AND   X.WORK_STEP_SEQ  = C.WORK_STEP_SEQ)
				   AND    ARV_PRAR_DATE IS NOT NULL
				   AND    ROWNUM = 1) 
			  ) APTD_REQ_YMD
			, decode(nvl((SELECT TO_CHAR(ARV_PRAR_DATE, 'HH24MI') 
						   FROM   TB_OM03018 
						   WHERE  SALES_ORD_NO   = A.SALES_ORD_NO
						   AND	  WORK_ROUTE_SEQ = B.WORK_ROUTE_SEQ
						   AND	  SHIPMENT_NO	 = E.SHIPMENT_NO
						   AND	  DPT_ARV_AR_CD  = (SELECT X.ARV_AR_CD 
										           FROM TB_OM03003 X
										           WHERE X.SALES_ORD_NO   = C.SALES_ORD_NO
										           AND   X.WORK_ROUTE_SEQ = C.WORK_ROUTE_SEQ
										           AND   X.WORK_STEP_SEQ  = C.WORK_STEP_SEQ)
						   AND    ARV_PRAR_DATE IS NOT NULL
						   AND    ROWNUM = 1)
					, '')
			  , '', '2359'
			  , (SELECT TO_CHAR(ARV_PRAR_DATE, 'HH24MI') 
				   FROM   TB_OM03018 
				   WHERE  SALES_ORD_NO   = A.SALES_ORD_NO
				   AND	  WORK_ROUTE_SEQ = B.WORK_ROUTE_SEQ
				   AND	  SHIPMENT_NO	 = E.SHIPMENT_NO
				   AND	  DPT_ARV_AR_CD  = (SELECT X.ARV_AR_CD 
								           FROM TB_OM03003 X
								           WHERE X.SALES_ORD_NO   = C.SALES_ORD_NO
								           AND   X.WORK_ROUTE_SEQ = C.WORK_ROUTE_SEQ
								           AND   X.WORK_STEP_SEQ  = C.WORK_STEP_SEQ)
				   AND    ARV_PRAR_DATE IS NOT NULL
				   AND    ROWNUM = 1) 
				) APTD_REQ_HM
			, idusr.omcomm_makermk_fn(a.sales_ord_no) as rmk
			, A.RLTD_GI_EO_NO
			, A.ORD_REASON_CD
			, IDUSR.OMCOMM_GETCUSTREASONNM_FN(A.RPT_CUST_CD, A.ORD_REASON_CD) ORD_REASON_CD_NM
			, DECODE(NVL(A.RLTD_GI_EO_NO, ''), '', 'N', 'Y') AS GI_CNCL_REGR_YN
	         , case when f.exp_type_cd = '01' then
	         		  (select ship_co_booking_no from tb_om02019 where booking_no = b.booking_no and sales_ord_no = a.sales_ord_no)
	        		else
	        			a.cust_ord_no
	         	end as booking_no
	         , to_char(e.work_date, 'yyyymmddHH24miss') gi_date
		     , d.col01
		     , d.col02
		     , d.col03
		     , d.col04
		     , d.col05
		     , d.col06
		     , d.col07
		     , d.col08
		     , d.col09
		     , d.col10
		     , d.col11
		     , d.col12
		     , d.col13
		     , d.col14
		     , d.col15
		     , d.col16
		     , d.col17
		     , d.col18
		     , d.col19
		     , d.col20
		     , d.col21
		     , d.col22
		     , d.col23
		     , d.col24
		     , d.col25
		     , d.col26
		     , d.col27
		     , d.col28
		     , d.col29
		     , d.col30
		     , 'N' as if_yn
		     , ${regrId} as regr_id
		     , ${mdfrId} as mdfr_id
		FROM  TB_OM02001 A
			, TB_OM03001 B
			, TB_OM03003 C
			, TB_OM02004 D
			, TB_OM04001 E
			, tb_om02003 f
		WHERE A.SALES_ORD_NO 	= B.SALES_ORD_NO
		  AND A.SALES_ORD_NO 	= D.SALES_ORD_NO(+)
		  AND A.SALES_ORD_NO 	= f.SALES_ORD_NO(+)
		  AND B.SALES_ORD_NO 	= C.SALES_ORD_NO
		  AND B.WORK_ROUTE_SEQ 	= C.WORK_ROUTE_SEQ
		  AND B.SALES_ORD_NO 	= E.SALES_ORD_NO
		  AND B.WORK_ROUTE_SEQ 	= E.WORK_ROUTE_SEQ
		  AND A.SALES_ORD_NO   	= ${salesOrdNo}
		  AND B.WORK_ROUTE_SEQ 	= ${workRouteSeq}
		  AND C.WORK_STEP_SEQ 	= ${workStepSeq}
		  AND E.WORK_STEP_SEQ  	= ${rsltWorkStepSeq}
		  AND E.RSLT_DGR_CNT 	= ${rsltDgrCnt}
		 {#1}
	    <append condition="${shipmentNo}.NOTEMPTY" id="#1">
	      AND E.SHIPMENT_NO  	= ${shipmentNo}
	    </append>		
  	</statement>
  	
<!-- 수출 입고실행오더전송용 아이템정보 조회 -->
   <statement name="retrieveTransferExpPortGrEoItemList">
	   SELECT ${eoNo} as wrhs_eo_no
	  	    , ${trmsSeq} as trms_seq
	  	    , ${workPlCd} as work_pl_cd 
	     	, a.CUST_ORD_LINE_NO
	    	, a.CUST_CD
	  	    , to_char(rownum * 10) line_no
	  	    , a.basis_item_cd as ITEM_CD
	    	, a.BAT_NO
	        , CASE WHEN e.fltr_conts1 = 'QTY_UNIT_CD' THEN
	                    b.rslt_QTY
	               WHEN e.fltr_conts1 = 'WGT_UNIT_CD' THEN
	                    b.rslt_WGT
	               WHEN e.fltr_conts1 = 'CBM' THEN
	                    b.rslt_cbm
	          END AS std_ord_qty
	  	    , b.rslt_QTY ord_qty
	  	    , a.QTY_UNIT_CD
	  	    , b.rslt_WGT ord_wgt
	  	    , a.WGT_UNIT_CD
	  	    , b.LOT_NO
	     	, a.ORD_REASON_CD
	     	, a.PLANT_CD
	     	, a.PRDT_REQ_NO
	  	    , b.PRDT_LOT_NO
		    , b.DIA_SUPL
		    , b.PAPSTYLE_GDS_SUPL
--	  	    , (select CNTR_NO 
--	  	         from tb_om03014 
--	  	        where shipment_no  = c.shipment_no
--	  	          and sales_ord_no = c.sales_ord_no
--	  	          and work_route_seq = c.work_route_seq
--	  	          and rownum = 1 ) cntr_no

            , (select CNTR_NO 
                 from tb_om03014 
                where sales_ord_no = a.sales_ord_no
                  and shipment_no = c.shipment_no
                  and to_char(reg_date,'yyyymmddhh24miss') = ( select to_char(max(REG_DATE),'yyyymmddhh24miss') 
                                                                 from tb_om03014 
                                                                where sales_ord_no = a.sales_ord_no
                                                                  and shipment_no  = c.shipment_no)) cntr_no
            , b.line_no as SALES_ORD_LINE_NO 
            , case when a.cust_cd = 'P1100' then
	         		    case when trim(a.pcul_cd) is null and trim(a.mn_cd) is null then
	         				      ''
	         			     else 
	         				      trim(a.pcul_cd) || '-' || trim(a.mn_cd)
	         		    end
				   else 
					    ''
			  end as pcul_mn_cd 
            , d.col01
	        , d.col02
	        , d.col03
	        , d.col04
	        , d.col05
	        , d.col06
	        , d.col07
	        , d.col08
	        , d.col09
	        , d.col10
	        , d.col11
	        , d.col12
	        , d.col13
	        , d.col14
	        , d.col15
	        , d.col16
	        , d.col17
	        , d.col18
	        , d.col19
	        , d.col20
	        , d.col21
	        , d.col22
	        , d.col23
	        , d.col24
	        , d.col25
	        , d.col26
	        , d.col27
	        , d.col28
	        , d.col29
	        , d.col30
	        , ${regrId} as regr_id
	        , ${mdfrId} as mdfr_id
	    from  tb_om02002 a
	  	    , tb_om04003 b
	  	    , tb_om04001 c
	        , tb_om02005 d
	        , tb_ma01015 e
	        , tb_om03001 f
	   WHERE  a.sales_ord_no     = b.sales_ord_no
	     AND  b.sales_ord_no     = c.sales_ord_no
	     AND  b.work_route_seq   = c.work_route_seq
	     AND  b.work_step_seq    = c.work_step_seq
	     AND  b.rslt_dgr_cnt     = c.rslt_dgr_cnt
	     AND  a.sales_ord_no     = d.sales_ord_no(+)
	     AND  a.line_no          = b.line_no
	     AND  a.line_no          = d.line_no(+)
	     AND  a.sales_ord_no     = f.sales_ord_no
	     AND  b.Work_Route_Seq   = f.work_route_seq
	     AND  f.del_yn           = 'N'
	     AND  e.clas_cd          = 'BASIC_UNIT_CD'
	     AND  a.basis_unit_cd    = e.comn_cd
	     AND  a.sales_ord_no     = ${salesOrdNo}
	     AND  c.Work_Route_Seq   = ${workRouteSeq}
	     AND  c.Work_Step_Seq    = ${rsltWorkStepSeq} 
	     AND  c.rslt_dgr_cnt     = ${rsltDgrCnt}
	     and  b.cncl_ord_no is null
	    {#1}
    <append condition="${shipmentNo}.NOTEMPTY" id="#1">
         AND  c.shipment_no      = ${shipmentNo}
    </append>		
	
  </statement>  	  	
<!-- 수출 입고실행오더전송용 청원 오더용 기본정보 조회 -->
  <statement name="retrieveTransferExpPortGrEoChungwon">
	  SELECT  ${eoNo} as wrhs_eo_no
			, ${trmsSctnCd} as trms_sctn_cd	 
			, (SELECT nvl(MAX(trms_seq), 0) + 1 FROM tb_om03005i WHERE wrhs_eo_no = ${eoNo}) AS trms_seq
			, A.CORP_CD
			, (SELECT X.ARV_AR_CD 
	           FROM TB_OM03003 X
	           WHERE X.SALES_ORD_NO 	= C.SALES_ORD_NO
	           AND   X.WORK_ROUTE_SEQ 	= C.WORK_ROUTE_SEQ
	           AND   X.WORK_STEP_SEQ  	= C.WORK_STEP_SEQ) WORK_PL_CD  
			, A.ORD_MNGT_EXCE_OFCR_ID
		    , (SELECT ofcr_tel_no 
		         FROM tb_ma01011 
		        WHERE user_id = a.ord_mngt_exce_ofcr_id) AS ord_mngt_exce_ofcr_tel_no
			, A.SALES_ORD_NO
			, A.CUST_REF_NO as cust_ord_no
			, C.MOVE_TYPE_CD
			, A.ORD_TYPE_CD
			, A.RPT_CUST_CD
			, A.CTRT_CUST_CD
			, A.CUST_ORD_TYPE_CD
			, d.col08 AS CAR_NO
			, A.CARGO_FORM_CD
			, B.DPT_AR_CD
			, case when b.dpt_ar_type_cd = '02' then
			          ( select name 
			              from vw_ma01_01 
			             where code         = b.dpt_ar_cd 
			               AND PTN_CD       = A.RPT_CUST_CD
			               and work_sctn_cd = b.dpt_ar_type_cd) 
			       else 
			          ( select name 
			              from vw_ma01_01 
			             where code         = b.dpt_ar_cd 
			               and work_sctn_cd = b.dpt_ar_type_cd
			               and rownum       = 1) 
			  end as dpt_AR_NM   
			, B.DPT_AR_ZIP_CD
			, B.DPT_AR_ZIP_ADDR
			, B.DPT_AR_DTL_ADDR
			, A.DPT_AR_OFCR_NM
			, A.DPT_AR_OFCR_TEL_NO
			, a.APTD_REQ_YMD
			, a.APTD_REQ_HM
		    , idusr.omcomm_makermk_fn(a.sales_ord_no) as rmk
			, A.RLTD_GI_EO_NO
			, A.ORD_REASON_CD
			, IDUSR.OMCOMM_GETCUSTREASONNM_FN(A.RPT_CUST_CD, A.ORD_REASON_CD) ORD_REASON_CD_NM
			, DECODE(NVL(A.RLTD_GI_EO_NO, ''), '', 'N', 'Y') AS GI_CNCL_REGR_YN
			, (select ship_co_booking_no from tb_om02019 where booking_no = B.BOOKING_NO and sales_ord_no = a.sales_ord_no) booking_no
		    , d.col01
		    , d.col02
		    , d.col03
		    , d.col04
		    , d.col05
		    , d.col06
		    , d.col07
		    , d.col08
		    , d.col09
		    , d.col10
		    , d.col11
		    , d.col12
		    , d.col13
		    , d.col14
		    , d.col15
		    , d.col16
		    , d.col17
		    , d.col18
		    , d.col19
		    , d.col20
		    , d.col21
		    , d.col22
		    , d.col23
		    , d.col24
		    , d.col25
		    , d.col26
		    , d.col27
		    , d.col28
		    , d.col29
		    , d.col30
		    , 'N' as if_yn
		    , ${regrId} as regr_id
		    , ${mdfrId} as mdfr_id
		FROM  TB_OM02001 A
			, TB_OM03001 B
			, TB_OM03003 C
			, TB_OM02004 D
		WHERE A.SALES_ORD_NO 	= B.SALES_ORD_NO
		  AND A.SALES_ORD_NO 	= D.SALES_ORD_NO(+)
		  AND B.SALES_ORD_NO 	= C.SALES_ORD_NO
		  AND B.WORK_ROUTE_SEQ 	= C.WORK_ROUTE_SEQ
		  AND A.SALES_ORD_NO   	= ${salesOrdNo}
		  AND B.WORK_ROUTE_SEQ 	= ${workRouteSeq}
		  AND C.WORK_STEP_SEQ 	= ${workStepSeq}
  	</statement>  	
  	
<!-- 수출 입고실행오더전송용 아이템정보 조회 -->
   <statement name="retrieveTransferExpPortGrEoItemListChungwon">
	   SELECT ${eoNo} as wrhs_eo_no
	  	    , ${trmsSeq} as trms_seq
	  	    , ${workPlCd} as work_pl_cd 
	  	    , d.col01 as CUST_ORD_LINE_NO
	  	    , a.CUST_CD
	     	, to_char(rownum * 10) line_no
	     	, a.basis_item_cd as ITEM_CD
	  	    , a.BAT_NO
	        , CASE WHEN e.fltr_conts1 = 'QTY_UNIT_CD' THEN
	                    b.ord_QTY
	               WHEN e.fltr_conts1 = 'WGT_UNIT_CD' THEN
	                    b.ord_WGT
	               WHEN e.fltr_conts1 = 'CBM' THEN
	                    b.ord_cbm
	          END AS std_ord_qty
	  	    , b.ord_QTY 
	  	    , a.QTY_UNIT_CD
	      	, b.ord_WGT 
	     	, a.WGT_UNIT_CD
	     	, a.mnf_no AS lot_no
	     	, a.ORD_REASON_CD
	     	, a.PLANT_CD
		    , (SELECT A4.PRDT_REQ_NO
			     FROM TB_OM02001 A1
			         ,TB_OM02005 A2
			         ,TB_OM02001 A3
			         ,TB_OM02002 A4
			    WHERE A1.SALES_ORD_NO = A.SALES_ORD_NO
			      AND A1.SALES_ORD_NO = A2.SALES_ORD_NO  
			      AND A2.LINE_NO      = A.LINE_NO
			      AND A1.CUST_REF_NO  = A3.CUST_ORD_NO
			      AND A3.SALES_ORD_NO = A4.SALES_ORD_NO
			      AND A4.CUST_ORD_LINE_NO = A2.COL01
			      AND ROWNUM = 1) PRDT_REQ_NO
		    , '' AS PRDT_LOT_NO
		    , '' AS DIA_SUPL
		    , '' AS PAPSTYLE_GDS_SUPL
	  	    , decode(g.cargo_form_cd, 'C', c.col04, '') AS cntr_no
	      	, b.line_no as SALES_ORD_LINE_NO 
            , case when a.cust_cd = 'P1100' then
	         		    case when trim(a.pcul_cd) is null and trim(a.mn_cd) is null then
	         				      ''
	         			     else 
	         				      trim(a.pcul_cd) || '-' || trim(a.mn_cd)
	         		    end
				   else 
					    ''
	          end as pcul_mn_cd 
	        , d.col01
	        , d.col02
	        , d.col03
	        , d.col04
	        , d.col05
	        , d.col06
	        , d.col07
	        , d.col08
	        , d.col09
	        , d.col10
	        , d.col11
	        , d.col12
	        , d.col13
	        , d.col14
	        , d.col15
	        , d.col16
	        , d.col17
	        , d.col18
	        , d.col19
	        , d.col20
	        , d.col21
	        , d.col22
	        , d.col23
	        , d.col24
	        , d.col25
	        , d.col26
	        , d.col27
	        , d.col28
	        , d.col29
	        , d.col30
	        , ${regrId} as regr_id
	        , ${mdfrId} as mdfr_id
	    from  tb_om02002 a
	        , tb_om02005 d
	        , tb_ma01015 e
	        , tb_om03001 f
            , tb_om03002 b
            , tb_om02004 c
            , tb_om02001 g
	   WHERE  a.sales_ord_no     = d.sales_ord_no(+)
	     and  a.sales_ord_no	 = g.sales_ord_no
	     AND  a.line_no          = d.line_no(+)
	     AND  a.sales_ord_no     = f.sales_ord_no
         AND  f.sales_ord_no     = b.sales_ord_no
         AND  f.work_route_seq   = b.work_route_seq
         AND  a.line_no          = b.line_no
         AND  a.sales_ord_no     = c.sales_ord_no(+)
	     AND  f.del_yn           = 'N'
	     AND  e.clas_cd          = 'BASIC_UNIT_CD'
	     AND  a.basis_unit_cd    = e.comn_cd
	     AND  a.sales_ord_no     = ${salesOrdNo}
	     AND  f.Work_Route_Seq   = ${workRouteSeq}
  </statement>  	

   <statement name="retrieveTransferExpPortGrEoItemListChungwonNew">
	   SELECT ${eoNo} as wrhs_eo_no
	  	    , ${trmsSeq} as trms_seq
	  	    , ${workPlCd} as work_pl_cd 
	  	    , d.col01 as CUST_ORD_LINE_NO
	     	, a.CUST_CD
	     	, to_char(rownum * 10) line_no
	     	, a.basis_item_cd as ITEM_CD
	     	, a.BAT_NO
	        , CASE WHEN e.fltr_conts1 = 'QTY_UNIT_CD' THEN
	                    h.ord_QTY
	               WHEN e.fltr_conts1 = 'WGT_UNIT_CD' THEN
	                    h.ord_WGT
	          END AS std_ord_qty
	  	    , h.ord_QTY 
	  	    , a.QTY_UNIT_CD
	  	    , h.ord_WGT 
	    	, a.WGT_UNIT_CD
	  	    , h.mnf_no AS lot_no
	  	    , a.ORD_REASON_CD
	     	, a.PLANT_CD
		    , (SELECT A4.PRDT_REQ_NO
			     FROM TB_OM02001 A1
			         ,TB_OM02005 A2
			         ,TB_OM02001 A3
			         ,TB_OM02002 A4
			    WHERE A1.SALES_ORD_NO = A.SALES_ORD_NO
			      AND A1.SALES_ORD_NO = A2.SALES_ORD_NO  
			      AND A2.LINE_NO      = A.LINE_NO
			      AND A1.CUST_REF_NO  = A3.CUST_ORD_NO
			      AND A3.SALES_ORD_NO = A4.SALES_ORD_NO
			      AND A4.CUST_ORD_LINE_NO = A2.COL01
			      AND ROWNUM = 1) PRDT_REQ_NO
		    , '' AS PRDT_LOT_NO
		    , '' AS DIA_SUPL
		    , '' AS PAPSTYLE_GDS_SUPL
	  	    , decode(g.cargo_form_cd, 'C', c.col04, '') AS cntr_no
	  	    , b.line_no as SALES_ORD_LINE_NO 
            , case when a.cust_cd = 'P1100' then
	         		    case when trim(a.pcul_cd) is null and trim(a.mn_cd) is null then
	         				      ''
	         			     else 
	         				      trim(a.pcul_cd) || '-' || trim(a.mn_cd)
	         		    end
				   else 
					    ''
			  end as pcul_mn_cd 
	        , d.col01
	        , d.col02
	        , d.col03
	        , d.col04
	        , d.col05
	        , d.col06
	        , d.col07
	        , d.col08
	        , d.col09
	        , d.col10
	        , d.col11
	        , d.col12
	        , d.col13
	        , d.col14
	        , d.col15
	        , d.col16
	        , d.col17
	        , d.col18
	        , d.col19
	        , d.col20
	        , d.col21
	        , d.col22
	        , d.col23
	        , d.col24
	        , d.col25
	        , d.col26
	        , d.col27
	        , d.col28
	        , d.col29
	        , d.col30
	        , ${regrId} as regr_id
	        , ${mdfrId} as mdfr_id
	    from  tb_om02002 a
	        , tb_om02005 d
	        , tb_ma01015 e
	        , tb_om03001 f
            , tb_om03002 b
            , tb_om02004 c
            , tb_om02001 g
		    , tb_om01010 h        
	   WHERE  a.sales_ord_no     = d.sales_ord_no(+)
	     and  a.sales_ord_no	 = g.sales_ord_no
	     AND  a.line_no          = d.line_no(+)
	     AND  a.sales_ord_no     = f.sales_ord_no
         AND  f.sales_ord_no     = b.sales_ord_no
         AND  f.work_route_seq   = b.work_route_seq
         AND  a.line_no          = b.line_no
         AND  a.sales_ord_no     = c.sales_ord_no(+)
	     AND  f.del_yn           = 'N'
	     AND  e.clas_cd          = 'BASIC_UNIT_CD'
	     AND  a.basis_unit_cd    = e.comn_cd
	     AND  a.sales_ord_no     = ${salesOrdNo}
	     AND  f.Work_Route_Seq   = ${workRouteSeq}
         AND  g.cust_ord_no      = h.cust_ord_no
         AND  a.item_cd          = h.item_cd
         AND  a.bat_no||a.pcul_cd||a.mn_cd = h.bat_no	
  </statement>  	
  
<!-- 수입 입고실행오더전송용 기본정보 조회 -->
  <statement name="retrieveTransferImpPortGrEo">
	  SELECT  ${eoNo} as WRHS_EO_NO
			, ${trmsSctnCd} as TRMS_SCTN_CD
			, (SELECT nvl(MAX(trms_seq), 0) + 1 FROM tb_om03005i WHERE wrhs_eo_no = ${eoNo}) AS trms_seq
			, A.CORP_CD
			, D.ARV_AR_CD AS WORK_PL_CD
			, A.ORD_MNGT_EXCE_OFCR_ID
		     , (SELECT ofcr_tel_no 
		          FROM tb_ma01011 
		         WHERE user_id = a.ord_mngt_exce_ofcr_id) AS ord_mngt_exce_ofcr_tel_no
			, A.SALES_ORD_NO
			, A.CUST_ORD_NO
			, D.MOVE_TYPE_CD
			, A.ORD_TYPE_CD
			, A.RPT_CUST_CD
			, A.CTRT_CUST_CD
			, A.CUST_ORD_TYPE_CD
			, A.CARGO_FORM_CD
			, C.APTD_REQ_YMD
			, C.APTD_REQ_HM
		    , idusr.omcomm_makermk_fn(a.sales_ord_no) as rmk
			, A.RLTD_GI_EO_NO
			, A.ORD_REASON_CD
			, IDUSR.OMCOMM_GETCUSTREASONNM_FN(A.RPT_CUST_CD, A.ORD_REASON_CD) ORD_REASON_CD_NM
			, DECODE(NVL(A.RLTD_GI_EO_NO, ''), '', 'N', 'Y') GI_CNCL_REGR_YN
			, B.MBL_NO AS BL_NO
			, A.CUST_ORD_NO AS BL_CUST_ORD_NO
			, B.TOT_QTY
			, B.TOT_WGT
			, B.TOT_ADMT
			, e.col01
			, e.col02
			, e.col03
			, e.col04
			, e.col05
			, e.col06
			, e.col07
			, e.col08
			, e.col09
			, decode(a.ctrt_cust_cd,'P2070',a.cust_ref_no,e.col10) col10
			, e.col11
			, e.col12
			, e.col13
			, e.col14
			, e.col15
			, e.col16
			, e.col17
			, e.col18
			, e.col19
			, e.col20
			, e.col21
			, e.col22
			, e.col23
			, e.col24
			, e.col25
			, e.col26
			, e.col27
			, e.col28
			, e.col29
			, e.col30
			, 'N' as if_yn
			, ${regrId} as regr_id
			, ${mdfrId} as mdfr_id
		FROM  TB_OM02001 A
			, TB_OM02003 B
			, TB_OM03001 C
			, TB_OM03003 D	
			, TB_OM02004 E
		WHERE A.SALES_ORD_NO = B.SALES_ORD_NO
		  AND A.SALES_ORD_NO = C.SALES_ORD_NO
		  AND A.SALES_ORD_NO = E.SALES_ORD_NO(+)
		  AND C.SALES_ORD_NO = D.SALES_ORD_NO
		  AND C.WORK_ROUTE_SEQ = D.WORK_ROUTE_SEQ
	      AND C.DEL_YN = 'N'
	      AND A.SALES_ORD_NO = ${salesOrdNo}
	      AND C.WORK_ROUTE_SEQ = ${workRouteSeq}
	      AND D.WORK_STEP_SEQ = ${workStepSeq}
	</statement>

<!-- 수입 입고실행오더전송용 아이템 정보 벌크 조회 -->
	<statement name="retrieveTransferImpPortGrEoItemBulkList">
		SELECT ${eoNo} as WRHS_EO_NO
		     , ${trmsSeq} as trms_seq
		  	 , ${workPlCd} as work_pl_cd 
			 , A.CUST_ORD_LINE_NO
			 , A.CUST_CD
			 , B.LINE_NO
			 , a.basis_item_cd as ITEM_CD
			 , A.BAT_NO
             , CASE WHEN e.fltr_conts1 = 'QTY_UNIT_CD' THEN
	                  b.ord_QTY        
	             WHEN e.fltr_conts1 = 'WGT_UNIT_CD' THEN
	                  b.ord_WGT        
	             WHEN e.fltr_conts1 = 'CBM' THEN
	                  b.ord_cbm        
	             END AS std_ord_qty	      
		     , B.ORD_QTY
		     , A.QTY_UNIT_CD
		     , B.ORD_WGT
		     , A.WGT_UNIT_CD
		     , A.ORD_REASON_CD
		     , A.PLANT_CD
		     , A.LINE_NO AS SALES_ORD_LINE_NO
			 , DECODE(A.ORD_QTY, 0, 0, (A.ORD_WGT/A.ORD_QTY)) BL_UNIT_WGT
			 , DECODE(A.ORD_QTY, 0, 0, (A.ADMT/A.ORD_QTY)) BL_UNIT_ADMT
             , case when a.cust_cd = 'P1100' then
	         		     case when trim(a.pcul_cd) is null and trim(a.mn_cd) is null then
	         				       ''
	         			      else 
	         				       trim(a.pcul_cd) || '-' || trim(a.mn_cd)
	         		     end
				    else 
					     ''
			   end as pcul_mn_cd 
			 , a.PRDT_REQ_NO
             , d.col01
		     , d.col02
		     , d.col03
		     , d.col04
		     , d.col05
		     , d.col06
		     , d.col07
		     , d.col08
		     , d.col09
		     , d.col10
		     , d.col11
		     , d.col12
		     , d.col13
		     , d.col14
		     , d.col15
		     , d.col16
		     , d.col17
		     , d.col18
		     , d.col19
		     , d.col20
		     , d.col21
		     , d.col22
		     , d.col23
		     , d.col24
		     , d.col25
		     , d.col26
		     , d.col27
		     , d.col28
		     , d.col29
		     , d.col30
		     , ${regrId} as regr_id
		     , ${mdfrId} as mdfr_id    
		FROM   TB_OM02002 A
			 , TB_OM03002 B
			 , TB_OM03001 C
			 , TB_OM02005 D
		     , tb_ma01015 e
	         , tb_ma02010 g
		WHERE  A.SALES_ORD_NO   = D.SALES_ORD_NO(+)
		  AND  A.LINE_NO 	    = D.LINE_NO(+)
		  AND  A.SALES_ORD_NO   = C.SALES_ORD_NO
		  AND  C.SALES_ORD_NO   = B.SALES_ORD_NO
		  AND  C.WORK_ROUTE_SEQ = B.WORK_ROUTE_SEQ
		  AND  A.LINE_NO	    = B.LINE_NO
		  
	      AND  e.clas_cd 	    = 'BASIC_UNIT_CD'
	      AND  a.basis_unit_cd  = e.comn_cd
	      and  a.cust_cd	    = g.ptn_cd
	      and  a.item_cd		= g.item_cd	
	      	  
		  AND  C.DEL_YN 	    = 'N'
		  AND  A.SALES_ORD_NO   = ${salesOrdNo}
		  AND  C.WORK_ROUTE_SEQ = ${workRouteSeq}
	</statement>

	<statement name="retrieveTransferImpPortGrEoItemBulkList_bak_20150922">
		SELECT ${eoNo} as WRHS_EO_NO
		     , ${trmsSeq} as trms_seq
		  	 , ${workPlCd} as work_pl_cd 
			 , A.CUST_ORD_LINE_NO
			 , A.CUST_CD
			 , B.LINE_NO
			 , a.basis_item_cd as ITEM_CD
			 , A.BAT_NO
	         , b.ORD_QTY AS std_ord_qty
		     , B.ORD_QTY
		     , A.QTY_UNIT_CD
		     , B.ORD_WGT
		     , A.WGT_UNIT_CD
		     , A.ORD_REASON_CD
		     , A.PLANT_CD
		     , A.LINE_NO AS SALES_ORD_LINE_NO
			 , DECODE(A.ORD_QTY, 0, 0, (A.ORD_WGT/A.ORD_QTY)) BL_UNIT_WGT
			 , DECODE(A.ORD_QTY, 0, 0, (A.ADMT/A.ORD_QTY)) BL_UNIT_ADMT
             , case when a.cust_cd = 'P1100' then
	         		     case when trim(a.pcul_cd) is null and trim(a.mn_cd) is null then
	         				       ''
	         			      else 
	         				       trim(a.pcul_cd) || '-' || trim(a.mn_cd)
	         		     end
				    else 
					     ''
			   end as pcul_mn_cd 
			 , a.PRDT_REQ_NO
             , d.col01
		     , d.col02
		     , d.col03
		     , d.col04
		     , d.col05
		     , d.col06
		     , d.col07
		     , d.col08
		     , d.col09
		     , d.col10
		     , d.col11
		     , d.col12
		     , d.col13
		     , d.col14
		     , d.col15
		     , d.col16
		     , d.col17
		     , d.col18
		     , d.col19
		     , d.col20
		     , d.col21
		     , d.col22
		     , d.col23
		     , d.col24
		     , d.col25
		     , d.col26
		     , d.col27
		     , d.col28
		     , d.col29
		     , d.col30
		     , ${regrId} as regr_id
		     , ${mdfrId} as mdfr_id    
		FROM   TB_OM02002 A
			 , TB_OM03002 B
			 , TB_OM03001 C
			 , TB_OM02005 D
		WHERE  A.SALES_ORD_NO   = D.SALES_ORD_NO(+)
		  AND  A.LINE_NO 	    = D.LINE_NO(+)
		  AND  A.SALES_ORD_NO   = C.SALES_ORD_NO
		  AND  C.SALES_ORD_NO   = B.SALES_ORD_NO
		  AND  C.WORK_ROUTE_SEQ = B.WORK_ROUTE_SEQ
		  AND  A.LINE_NO	    = B.LINE_NO
		  AND  C.DEL_YN 	    = 'N'
		  AND  A.SALES_ORD_NO   = ${salesOrdNo}
		  AND  C.WORK_ROUTE_SEQ = ${workRouteSeq}
	</statement>


<!-- 수입 입고실행오더전송용 아이템 정보 컨테이너 조회 -->
	<statement name="retrieveTransferImpPortGrEoItemContainerList">
		SELECT ${eoNo} as WRHS_EO_NO
		  	 , ${trmsSeq} as trms_seq
		  	 , ${workPlCd} as work_pl_cd 
			 , A.CUST_ORD_LINE_NO
			 , A.CUST_CD
			 , to_char(rownum * 10) LINE_NO
			 , a.basis_item_cd as ITEM_CD
			 , A.BAT_NO
		     , case when a.ORD_QTY >= 1 then
		    	         1
		            else 
		      	         a.ORD_QTY
		       end as std_ord_qty
		     , case when a.ORD_QTY >= 1 then
		    	         1
		            else 
		                 a.ORD_QTY
		       end as ORD_QTY
		     , A.QTY_UNIT_CD
		     , B.ORD_WGT
		     , A.WGT_UNIT_CD
		     , A.ORD_REASON_CD
		     , A.PLANT_CD
		     , b.cntr_no
		     , A.LINE_NO AS SALES_ORD_LINE_NO
			 , DECODE(A.ORD_QTY, 0, 0, (A.ORD_WGT/A.ORD_QTY)) BL_UNIT_WGT
			 , DECODE(A.ORD_QTY, 0, 0, (A.ADMT/A.ORD_QTY)) BL_UNIT_ADMT
             , case when a.cust_cd = 'P1100' then
	         		     case when trim(a.pcul_cd) is null and trim(a.mn_cd) is null then
	         				       ''
	         			      else 
	         				       trim(a.pcul_cd) || '-' || trim(a.mn_cd)
	         		     end
				    else 
					     ''
			   end as pcul_mn_cd 
		     , d.col01
		     , d.col02
		     , d.col03
		     , d.col04
		     , d.col05
		     , d.col06
		     , d.col07
		     , d.col08
		     , d.col09
		     , d.col10
		     , d.col11
		     , d.col12
		     , d.col13
		     , d.col14
		     , d.col15
		     , d.col16
		     , d.col17
		     , d.col18
		     , d.col19
		     , d.col20
		     , d.col21
		     , d.col22
		     , d.col23
		     , d.col24
		     , d.col25
		     , d.col26
		     , d.col27
		     , d.col28
		     , d.col29
		     , d.col30
		     , ${regrId} as regr_id
		     , ${mdfrId} as mdfr_id    
		 FROM  TB_OM02002 A
			 , TB_OM02021 B
			 , TB_OM02005 D
		WHERE  A.SALES_ORD_NO = D.SALES_ORD_NO(+)
		  AND  A.LINE_NO 	  = D.LINE_NO(+)
		  AND  A.SALES_ORD_NO = B.SALES_ORD_NO
		  AND  A.CUST_CD	  = B.CUST_CD
		  AND  A.ITEM_CD	  = B.ITEM_CD
		  AND  A.SALES_ORD_NO = ${salesOrdNo}
	</statement>	
	
	<statement name="retrieveTransferCase">
		SELECT EXP_IMP_DOM_SCTN_CD
			 , (SELECT WORK_PL_SCTN_CD FROM TB_MA01005 WHERE WORK_PL_CD = A.DPT_AR_CD) WORK_PL_SCTN_CD
			 , (SELECT LOGIS_SVC_SCTN_CD FROM TB_MA01006 WHERE ORD_TYPE_CD = A.ORD_TYPE_CD) LOGIS_SVC_SCTN_CD
		  FROM TB_OM02001 A
		 WHERE SALES_ORD_NO = ${salesOrdNo}
	</statement>
	
<!-- 운송실행오더전송용기본정보 조회 -->
  <statement name="retrieveTransferTranEo">
	  SELECT ${tranEoNo} as tran_eo_no
		   , ${trmsSctnCd} as trms_sctn_cd	 
	       , (SELECT nvl(MAX(trms_seq), 0) + 1 FROM tb_om03007i WHERE TRAN_EO_NO = ${eoNo}) AS trms_seq
		   , a.corp_cd
	       , a.ord_mngt_exce_dept_cd 
	       , nvl(a.ord_mngt_exce_ofcr_id, '20060050') as ord_mngt_exce_ofcr_id
	       , (SELECT ofcr_tel_no 
	            FROM tb_ma01011 
	           WHERE user_id = a.ord_mngt_exce_ofcr_id) AS ord_mngt_exce_ofcr_tel_no
	       , a.sales_ord_no
	       , a.cust_ord_no 
	       , a.ord_type_cd 
	       , (select ord_type_nm from tb_ma01006 where ord_type_cd = a.ord_type_cd) as ord_type_nm
	       , f.LOGIS_AR_CD
	       , f.LOGIS_DOMN_CD
	       , f.ORD_KIND_CD
	       , f.LOGIS_SVC_SCTN_CD
           , a.add_svc_type_cd 
	       , a.ctrt_cust_cd
           , (select otm_domain_cd from tb_ma01002 where ptn_cd = a.ctrt_cust_cd and rownum = 1) as RPT_CUST_CD
           , A.BILG_CUST_CD
           , a.cust_ofcr_nm 
           , a.cust_ofcr_tel_no 
	       , a.cust_of_cust_cd 
	       , (select cust_nm from tb_ma02020 where ptn_cd = a.ctrt_cust_cd and cust_ptn_cd = a.cust_of_cust_cd) cust_nm
	       , a.cust_expr_yn 
	       , a.cls_expr_yn 
	       , a.lead_time_expr_yn 
	       , a.ltrm_ord_yn 
           , a.aft_ord_yn
		   , b.dpt_ar_cd
		   , b.dpt_ar_type_cd
		   , b.dpt_ar_zip_cd
		   , b.dpt_ar_zip_addr
		   , b.dpt_ar_dtl_addr
		   , a.dpt_ar_ofcr_nm 
		   , a.dpt_ar_ofcr_tel_no 
	       , b.arv_ar_cd
	       , b.arv_ar_type_cd
	       , b.arv_ar_zip_cd
	       , b.arv_ar_zip_addr 
	       , b.arv_ar_dtl_addr 
	       , a.arv_ar_ofcr_nm 
	       , a.arv_ar_ofcr_tel_no 
           , b.strt_req_ymd
           , b.strt_req_hm
	       , b.aptd_req_ymd 
	       , b.aptd_req_hm 
	       , replace(replace(replace(idusr.omcomm_makermk_fn(a.sales_ord_no), chr(10), ''), chr(13), ''), chr(32), '') as rmk
	       , idusr.omcomm_makermk_fn(a.sales_ord_no) as rmk_org
		   , a.sales_ord_creat_ymd 
		   , a.sales_ord_creat_hms 
	       , a.exp_imp_dom_sctn_cd 
		   , c.ocean_air_sctn_cd
		   , a.cargo_form_cd
		   , c.fcl_lcl_sctn_cd
		   , c.hbl_no
		   , decode(nvl(b.bl_no,''), '', c.mbl_no, b.bl_no) mbl_no
		   --, decode(nvl(b.booking_no,''), '', c.pol_cd, e.pol_cd) pol_cd
		   , decode(nvl(b.booking_no,''), '', decode(nvl(c.pol_cd,''),'',b.SELL_DCSN_SCTN_CD,c.pol_cd), e.pol_cd) pol_cd
		   , decode(nvl(b.booking_no,''), '', c.pod_cd, e.pod_cd) pod_cd
		   , e.ship_co_booking_no as booking_no
		   , e.ship_co_cd 
		   , e.ship_nm 
		   , e.port_cnt 
		   , e.dpt_port_prar_ymd 
		   , e.arv_port_prar_ymd 
		   , e.cy_cls_ymd 
		   , e.cy_cls_hms 
		   , a.cust_ord_type_cd 
		   , a.cust_move_type_cd 		 
		   , a.move_type_cd
		   , a.load_dly_yn
		   , (SELECT COMN_CD_NM FROM TB_MA01015 WHERE CLAS_CD = 'MOVE_TYPE_CD' AND COMN_CD = A.MOVE_TYPE_CD) MOVE_TYPE_NM
		   , nvl((select y.comn_cd_nm 
			 	    from tb_ma01002 x
			 		   , tb_ma01015 y
			 	   where x.ptn_cd = a.ctrt_cust_cd
			 	     and y.clas_cd = 'OTM_RELEASE_STRTG_CD'
			 	     and x.OTM_RELEASE_STRTG_CD = y.comn_cd), 'ONE_BY_ONE') as ORD_CREAT_MTHD_CD
		   , A.SELF_TRAN_YN
		   , B.DRCT_LOAD_YN
		   , c.exp_type_cd
		   , b.plan_vanning_yn
		   , b.bl_cust_ord_no
	       , '' col01
	       , '' col02
	       , '' col03
	       , '' col04
	       , '' col05
	       , '' col06
	       , '' col07
	       , '' col08
	       , '' col09
	       , decode( a.ctrt_cust_cd,'P1200',d.col10,'') col10
	       , '' col11
	       , '' col12
	       , '' col13
	       , '' col14
	       , '' col15
	       , '' col16
	       , '' col17
	       , '' col18
	       , '' col19
	       , '' col20
	       , '' col21
	       , '' col22
	       , '' col23
	       , '' col24
	       , '' col25
	       , '' col26
	       , '' col27
	       , '' col28
	       , '' col29
	       , '' col30
	       , 'N' as if_yn
	       , a.TRAN_PLAN_CNTR_CD
	       , ${regrId} as regr_id
	       , ${mdfrId} as mdfr_id
	   FROM  tb_om02001 a
	       , tb_om03001 b
	       , tb_om02003 c
		   , tb_om02019 e
	       , tb_om02004 d
	       , tb_ma01006 f
	  WHERE  a.sales_ord_no   = b.sales_ord_no(+)
	    AND  a.sales_ord_no   = c.sales_ord_no(+)
	    AND  a.sales_ord_no   = d.sales_ord_no(+)
	    AND  b.sales_ord_no   = e.sales_ord_no(+)    
	    AND  b.booking_no     = e.booking_no(+)
	    AND  a.ord_type_cd	  = f.ord_type_cd
	    AND  a.sales_ord_no   = ${salesOrdNo}
	    AND  b.work_route_seq = ${workRouteSeq}
  </statement>
  
  <statement name="retrieveCntrSize">
	  select FLTR_CONTS2 || 'FT' cntr_size_cd
	    from tb_om02020 A
	       , TB_MA01015 B
           , TB_OM02001 C
	   WHERE B.CLAS_CD = 'CNTR_SIZ_TYP_SCTN'
	     AND B.COMN_CD = A.CNTR_KIND_CD
         AND A.SALES_ORD_NO = C.SALES_ORD_NO
         AND C.CUST_ORD_NO = ${blCustOrdNo}
         AND C.SALES_ORD_CNCL_YN = 'N'
	     AND ROWNUM = 1
  </statement>

<!-- 운송실행오더전송용 아이템정보 조회 -->
  <statement name="retrieveTransferTranEoItemList">
	  SELECT ${eoNo} tran_eo_no
	       , ${trmsSeq} trms_seq
	       , b.line_no
	       , a.item_cd
	       , (select item_lvl2_cd from tb_ma02010 where ptn_cd = a.cust_cd and item_cd = a.item_cd) item_lvl2_cd
	       , a.cust_cd
	       , a.bat_no
	       , B.ORD_QTY
	       , decode(c.qty_unit_cd, null, a.qty_unit_cd, c.qty_unit_cd) as qty_unit_cd
	       , b.ord_wgt
	       , decode(c.wgt_unit_cd, null, a.wgt_unit_cd, c.wgt_unit_cd) AS wgt_unit_cd
	       , b.ord_cbm
	       , b.admt
	       , b.pallet_qty
	       , b.pallet_unit_cbm
	       , a.CNTR_SIZE_CD
	       , a.plant_cd 
	       , a.lot_no
	       , a.prdt_req_no 
	       , a.prdt_prar_ymd 
	       , a.fe_sctn_cd
	       , a.cntr_no
	       , a.danger_sctn_cd
	       , a.seal_no1
	       , a.seal_no2
	       , a.pckg_unit_cd
	       , a.pckg_qty
	       , a.max_tmpt
	       , a.min_tmpt
	       , a.Ord_Reason_Cd
	       , a.cust_ord_line_no
		   , ( SELECT ORD_WGT / ORD_QTY
			     FROM TB_OM02002
			    WHERE SALES_ORD_NO = (SELECT SALES_ORD_NO
								        FROM TB_OM02001
								       WHERE CUST_ORD_NO = ${blCustOrdNo}
								         AND SALES_ORD_CNCL_YN = 'N'
								         AND RPT_CUST_CD = A.CUST_CD) 
			      AND ITEM_CD = A.ITEM_CD
			      AND DEL_YN = 'N' ) BL_UNIT_WGT
		   , ( SELECT ADMT / ORD_QTY
			     FROM TB_OM02002
			    WHERE SALES_ORD_NO = (SELECT SALES_ORD_NO
								        FROM TB_OM02001
								       WHERE CUST_ORD_NO = ${blCustOrdNo}
								         AND SALES_ORD_CNCL_YN = 'N'
								         AND RPT_CUST_CD = A.CUST_CD) 
			      AND ITEM_CD = A.ITEM_CD 
			      AND DEL_YN = 'N') BL_UNIT_ADMT
	       , decode(a.cust_cd, 'P1100',a.pcul_cd,'C1039',a.cust_ref_no,'') col01
	       , decode(a.cust_cd, 'P1100',a.mn_cd  ,'') col02
	       , '' col03
	       , '' col04
	       , '' col05
	       , '' col06
	       , '' col07
	       , '' col08
	       , '' col09
	       , '' col10
	       , '' col11
	       , '' col12
	       , '' col13
	       , '' col14
	       , '' col15
	       , '' col16
	       , '' col17
	       , '' col18
	       , '' col19
	       , '' col20
	       , '' col21
	       , '' col22
	       , '' col23
	       , '' col24
	       , '' col25
	       , '' col26
	       , '' col27
	       , '' col28
	       , '' col29
	       , '' col30
	       , ${regrId} as regr_id
	       , ${mdfrId} as mdfr_id
	       , (select round(cbm,3) from tb_ma02010 where ptn_cd = a.cust_cd and item_cd=a.item_cd) eve_cbm
	   FROM  tb_om02002 a
	       , tb_om03002 b
	       , tb_om02005 d
	       , (SELECT item_cd
                    ,qty_unit_cd
                    ,wgt_unit_cd
                FROM tb_om03001 ca
                    ,tb_om02001 cb
                    ,tb_om02002 cc
               WHERE ca.bl_cust_ord_no = cb.cust_ord_no
                 AND cb.sales_ord_no = cc.sales_ord_no
                 AND cb.sales_ord_cncl_yn = 'N'
                 AND ca.sales_ord_no = ${salesOrdNo}
                 AND ca.work_route_seq = ${workRouteSeq}
                 AND cc.del_yn='N') c
	   WHERE  a.sales_ord_no = b.sales_ord_no
	     AND  a.sales_ord_no = d.sales_ord_no(+)
	     AND  a.line_no      = b.line_no
	     AND  a.line_no      = d.line_no(+)
	     AND  a.item_cd      = c.item_cd (+)
	     AND  a.sales_ord_no 	= ${salesOrdNo}
	     AND  b.work_route_seq = ${workRouteSeq}
 		{#1}
    <append condition="${trmsSctnCd}.NOTEMPTY&amp;${trmsSctnCd}.EQ.Z" id="#1">
         AND  A.LINE_NO  = ${lineNo}
    </append>
  </statement>
  
<!-- 판매오더 수정여부 체크 판매오더헤더 특이사항 조회 -->
  <statement name="retrieveSalesOrdPrcl">
  	  SELECT *
  	    FROM TB_OM02004
  	   WHERE 1 = 1
  	    {#1}
    <append condition="${salesOrdNo}.NOTEMPTY" id="#1">
         AND SALES_ORD_NO  = ${salesOrdNo}
    </append>
  </statement>
<!-- 판매오더 수정여부 체크 판매오더아이템 특이사항 조회 -->
  <statement name="retrieveSalesOrdItemPrcl">
  	  SELECT *
  	    FROM TB_OM02005
  	   WHERE 1 = 1
  	    {#1}
    <append condition="${salesOrdNo}.NOTEMPTY" id="#1">
         AND SALES_ORD_NO  = ${salesOrdNo}
    </append>
  </statement>
<!-- 판매오더 수정여부 체크 국제물류내역  조회 -->
  <statement name="retrieveSalesOrdFisMngtAttr">
  	  SELECT *
  	    FROM TB_OM02003
  	   WHERE 1 = 1
  	    {#1}
    <append condition="${salesOrdNo}.NOTEMPTY" id="#1">
         AND SALES_ORD_NO  = ${salesOrdNo}
    </append>
  </statement>
<!-- 판매오더 수정여부 체크 Booking정보  조회 -->
  <statement name="retrieveBookingList">
  	  SELECT *
  	    FROM TB_OM02019
  	   WHERE 1 = 1
  	    {#1}
    <append condition="${salesOrdNo}.NOTEMPTY" id="#1">
         AND SALES_ORD_NO  = ${salesOrdNo}
    </append>
  </statement>
<!-- 판매오더 수정여부 체크 실행오더분배  조회 -->
  <statement name="retrieveEoCreatYn">
	  SELECT NVL(MAX(DECODE(B.WORK_STEP_CD, '00001', 'Y', '')),'N') AS INPUT_YN,
             NVL(MAX(DECODE(B.WORK_STEP_CD, '00002', 'Y', '')),'N') AS OUTPUT_YN,    
             NVL(MAX(DECODE(B.WORK_STEP_CD, '00003', 'Y', '')),'N') AS TRANS_YN, 
             NVL(MAX(DECODE(A.CMPD_TRAN_YN, 'Y'    , 'Y', '')),'N') AS FIS_YN         
        FROM TB_MA01006 A
          , TB_OM05002 B
       WHERE 1 = 1
        {#1}
         AND A.STD_WORK_ROUTE_NO = B.STD_WORK_ROUTE_NO(+)
    <append condition="${ordTypeCd}.NOTEMPTY" id="#1">
         AND A.ORD_TYPE_CD = ${ordTypeCd}
    </append>
  </statement>
  
<!-- 판매오더 아이템 실적 조회 -->
  <statement name="retrieveSalesOrdItemRslt">
	  SELECT A.SALES_ORD_NO
		    ,A.LINE_NO
	        ,A.ITEM_CD
	        ,(SELECT X.ITEM_NM
	            FROM TB_MA02010 X
	           WHERE X.PTN_CD  = A.CUST_CD
	             AND X.ITEM_CD = A.ITEM_CD) ITEM_NM
	         ,A.ORD_QTY
	         ,A.ORD_WGT
	         ,A.ORD_CBM
	         ,B.WORK_ROUTE_SEQ
             ,DENSE_RANK() OVER (PARTITION BY B.LINE_NO ORDER BY B.WORK_ROUTE_SEQ ) DIV_DGR_CNT
	         ,C.WORK_STEP_SEQ    
	         ,(SELECT X.WORK_STEP_NM
	             FROM TB_OM05003 X
	            WHERE X.WORK_STEP_CD = C.WORK_STEP_CD) WORK_STEP_NM     
	         ,(SELECT SUM(X.RSLT_QTY)
	             FROM TB_OM04003 X
	            WHERE X.SALES_ORD_NO   = E.SALES_ORD_NO
	              AND X.WORK_ROUTE_SEQ = E.WORK_ROUTE_SEQ
	              AND X.WORK_STEP_SEQ  = E.WORK_STEP_SEQ
	              AND X.RSLT_DGR_CNT   = E.RSLT_DGR_CNT
	              AND X.LINE_NO        = B.LINE_NO) RSLT_QTY 
	         ,(SELECT SUM(X.RSLT_WGT)
	             FROM TB_OM04003 X
	            WHERE X.SALES_ORD_NO   = E.SALES_ORD_NO
	              AND X.WORK_ROUTE_SEQ = E.WORK_ROUTE_SEQ
	              AND X.WORK_STEP_SEQ  = E.WORK_STEP_SEQ
	              AND X.RSLT_DGR_CNT   = E.RSLT_DGR_CNT
	              AND X.LINE_NO        = B.LINE_NO) RSLT_WGT 
	         ,(SELECT SUM(X.RSLT_CBM)
	             FROM TB_OM04003 X
	            WHERE X.SALES_ORD_NO   = E.SALES_ORD_NO
	              AND X.WORK_ROUTE_SEQ = E.WORK_ROUTE_SEQ
	              AND X.WORK_STEP_SEQ  = E.WORK_STEP_SEQ
	              AND X.RSLT_DGR_CNT   = E.RSLT_DGR_CNT
	              AND X.LINE_NO        = B.LINE_NO) RSLT_CBM 
	         ,(SELECT X.COMN_CD_NM
	             FROM TB_MA01015 X
	            WHERE X.CLAS_CD = 'RSLT_SCTN_CD'
	              AND X.COMN_CD = E.RSLT_SCTN_CD) RSLT_SCTN_NM
	         ,E.SHIPMENT_NO    
	     FROM TB_OM02002 A
	         ,TB_OM03002 B
	         ,TB_OM03003 C
	         ,TB_OM03015 D
	         ,TB_OM04001 E
	    WHERE 1 = 1
	     {#1}
	      AND A.SALES_ORD_NO   = B.SALES_ORD_NO
	      AND A.LINE_NO        = B.LINE_NO
	      AND B.SALES_ORD_NO   = C.SALES_ORD_NO
	      AND B.WORK_ROUTE_SEQ = C.WORK_ROUTE_SEQ
	      AND C.SALES_ORD_NO   = D.SALES_ORD_NO(+)
	      AND C.WORK_ROUTE_SEQ = D.WORK_ROUTE_SEQ(+)
	      AND C.WORK_STEP_SEQ  = D.WORK_STEP_SEQ(+)  
	      AND D.SALES_ORD_NO   = E.SALES_ORD_NO(+)
	      AND D.WORK_ROUTE_SEQ = E.WORK_ROUTE_SEQ(+)
	      AND D.WORK_STEP_SEQ  = E.WORK_STEP_SEQ(+)
	    ORDER BY to_number(A.LINE_NO), B.WORK_ROUTE_SEQ, C.WORK_STEP_SEQ
    <append condition="${salesOrdNo}.NOTEMPTY" id="#1">
          AND A.SALES_ORD_NO   = ${salesOrdNo}
    </append>
  </statement>
  
  <statement name="retrieveExpOrdSalesOrdNo">
  	  SELECT SALES_ORD_NO
  	    FROM TB_OM02002
  	   WHERE EXP_ORD_NO = ${expOrdNo}
  	     AND CUST_ORD_LINE_NO = ${custOrdLineNo}
  	     AND DEL_YN = 'N'
  </statement>
  
	<statement name="retrieveMstrOrdSalesOrdNo">
		SELECT sales_ord_no
		  FROM tb_om02001
		 WHERE 1 = 1
		{#1}
	    <append condition="${masterOrdNo}.NOTEMPTY" id="#1">
		   AND cust_ord_no = ${masterOrdNo}
	    </append>
	    <append condition="${custOrdNo}.NOTEMPTY" id="#1">
		   AND cust_ord_no = ${custOrdNo}
	    </append>	    
	    <append condition="${mstrOrdNo}.NOTEMPTY" id="#1">
		   AND cust_ord_no = ${mstrOrdNo}
	    </append>
	    
	</statement>
	
	<statement name="retrieveSalesOrdSearchListBasic">
		SELECT	/* retrieveSalesOrdSearchListBasic 2007.10.22 */
			   a.sales_ord_stat_cd
			 , (SELECT comn_cd_nm FROM tb_ma01015 WHERE clas_cd = 'ORD_STAT_CD' AND comn_cd = a.sales_ord_stat_cd) as sales_ord_stat_nm
			 , a.sales_ord_no
			 , (SELECT ord_type_nm FROM tb_ma01006 WHERE ord_type_cd = a.ord_type_cd) as ord_type_nm
			 , (SELECT comn_cd_nm  FROM tb_ma01015 WHERE clas_cd = 'MOVE_TYPE_CD' AND comn_cd = a.move_type_cd) as move_type_nm
			 , a.sales_ord_creat_ymd || a.sales_ord_creat_hms AS sales_ord_creat_date
			 , a.aptd_req_ymd || a.aptd_req_hm AS aptd_req_date
			 , case when a.dpt_ar_type_cd = '02' then
			             ( select name 
			                 from vw_ma01_01 
			                where code         = a.dpt_ar_cd 
			                  AND PTN_CD       = a.RPT_CUST_CD
			                  and work_sctn_cd = a.dpt_ar_type_cd) 
			        when a.dpt_ar_type_cd = '99' then
			             d.col01
			        else 	    	
			             ( select name 
			                 from vw_ma01_01 
			                where code         = a.dpt_ar_cd 
			                  and work_sctn_cd = a.dpt_ar_type_cd
			                  and rownum       = 1) 
			   end  as dpt_ar_nm
			 , case when a.arv_ar_type_cd = '02' then
			             ( select name 
			                 from vw_ma01_01 
			                where code         = a.arv_ar_cd 
			                  AND PTN_CD       = a.RPT_CUST_CD
			                  and work_sctn_cd = a.arv_ar_type_cd) 
			        when a.arv_ar_type_cd = '99' then
			             d.col01
			        else 	    	
			             ( select name 
			                 from vw_ma01_01 
			                where code         = a.arv_ar_cd 
			                  and work_sctn_cd = a.arv_ar_type_cd
			                  and rownum       = 1) 
			    end  as arv_ar_nm
			 , a.work_pl_cd
			 , (SELECT work_pl_nm FROM tb_ma01005 WHERE work_pl_cd = a.work_pl_cd) as work_pl_nm
			 , (SELECT comn_cd_nm  FROM tb_ma01015 WHERE clas_cd = 'EXP_TYPE_CD' AND comn_cd = c.exp_type_cd) as exp_type_nm
			 , (SELECT ptn_nm FROM tb_ma01002 WHERE ptn_cd = a.ctrt_cust_cd) as entp_nm
		     , a.cust_ord_no
			 , a.cust_ord_type_cd
			 , case when a.rpt_cust_cd = 'R1209' OR a.rpt_cust_cd = 'R1728' then
			  	         MACOMM_GETCD_FN( 'EVE_CUST_ORD_TYPE_CD', a.cust_ord_type_cd) 
			  	    when a.rpt_cust_cd = 'R1400' then
			  	         MACOMM_GETCD_FN( 'NSC_CUST_ORD_TYPE_CD', a.cust_ord_type_cd)			
			   else
			  	    MACOMM_GETCD_FN( 'CUST_ORD_TYPE_CD', a.cust_ord_type_cd) 
               end cust_ord_type_nm     --고객오더유형명
			 , a.cust_move_type_cd 			                                                       --고객이동유형코드
			 , decode(a.rpt_cust_cd, 'P1000', (select comn_cd_nm from tb_ma01015 where clas_cd = 'HPP_MOVE_TYPE_CD' and comn_cd = a.cust_move_type_cd)
								   , 'P1591', (select comn_cd_nm from tb_ma01015 where clas_cd = 'HPP_MOVE_TYPE_CD' and comn_cd = a.cust_move_type_cd)
								   , 'P1200', (select comn_cd_nm from tb_ma01015 where clas_cd = 'HHP_MOVE_TYPE_CD' and comn_cd = a.cust_move_type_cd) 
								   , '') as cust_move_type_nm
			 , a.rmk
			 , a.cust_expr_yn
			 , a.back_ord_yn
			 , decode(nvl(a.sales_ord_cncl_yn, 'N'), 'Y', '취소'
			                                       , 'N', (SELECT comn_cd_nm 
			                                                 FROM tb_ma01015 
			                                                WHERE clas_cd = 'SALES_ORD_CMPT_SCTN_CD' 
			                                                  AND comn_cd = a.sales_ord_cmpt_sctn_cd)
			         ) AS sales_ord_cmpt_sctn_nm
			 , decode(nvl(a.sales_ord_cncl_yn, 'N'), 'Y', to_char(a.sales_ord_cncl_date, 'yyyymmddhh24mi')
			                                       , 'N', to_char(a.sales_ord_cmpt_date, 'yyyymmddhh24mi') ) AS sales_ord_cmpt_date
			 , IDUSR.OMCOMM_GETCUSTREASONNM_FN(a.rpt_cust_cd, a.ord_reason_cd) as ord_reason_nm
			 , a.corp_cd
			 , (SELECT dept_nm FROM tb_ma01009 WHERE corp_cd = a.corp_cd and dept_cd = a.ord_mngt_exce_dept_cd) as dept_nm
			 , (SELECT user_nm FROM tb_ma01011 WHERE user_id = a.ord_mngt_exce_ofcr_id) as user_nm
			 , (SELECT user_nm FROM tb_ma01011 WHERE user_id = a.ord_mngt_fwd_ofcr_id) as fwd_nm
			 , a.exp_imp_dom_sctn_cd
			 , a.SALES_ORD_CNCL_YN
			 , a.cust_ref_no
		 FROM  tb_om02001 a
			 , tb_om02003 c
			 , tb_om02004 d
    	WHERE  1=1
    	  and  a.sales_ord_no = d.sales_ord_no(+)
    	  and  a.sales_ord_no = c.sales_ord_no(+)
    	 {#1}
    	 {#2}
		<append condition="${salesOrdNo}.NOTEMPTY" id="#1"> 
		  AND  a.sales_ord_no = ${salesOrdNo}
 		</append>
		<append condition="${custOrdNo}.NOTEMPTY" id="#1"> 
		  AND  a.cust_ord_no  = ${custOrdNo}
 		</append>
		<append condition="${custRefNo}.NOTEMPTY" id="#1"> 
		  AND  a.cust_ref_no  = ${custRefNo}
 		</append> 		
		<append condition="${ordTypeCd}.NOTEMPTY" id="#1"> 
		  AND  a.ord_type_cd = ${ordTypeCd}
		</append>
		<append condition="${dcnctOrdYn}.NOTEMPTY" id="#1"> 
		  AND  a.dcnct_ord_yn = ${dcnctOrdYn}
		ORDER BY a.sales_ord_no,a.cust_ord_no desc
		</append>
		
		<append condition="${custCd}.NOTEMPTY" id="#2"> 
		  AND  a.ctrt_cust_cd = ${ctrtCustCd}
 		</append>
		
	</statement>
	
  <statement name="retrieveSalesOrdSearchList">
	  SELECT /* retrieveSalesOrdSearchList 2007.10.22 */
			  a.sales_ord_stat_cd
			, (SELECT comn_cd_nm FROM tb_ma01015 WHERE clas_cd = 'ORD_STAT_CD' AND comn_cd = a.sales_ord_stat_cd) as sales_ord_stat_nm
			, a.sales_ord_no
			, (SELECT ord_type_nm FROM tb_ma01006 WHERE ord_type_cd = a.ord_type_cd) as ord_type_nm
			, (SELECT comn_cd_nm  FROM tb_ma01015 WHERE clas_cd = 'MOVE_TYPE_CD' AND comn_cd = a.move_type_cd) as move_type_nm
			, a.sales_ord_creat_ymd || a.sales_ord_creat_hms AS sales_ord_creat_date
			, a.aptd_req_ymd || a.aptd_req_hm AS aptd_req_date
			, case when a.dpt_ar_type_cd = '02' then
			          ( select name 
			              from vw_ma01_01 
			             where code         = a.dpt_ar_cd 
			               AND PTN_CD       = a.RPT_CUST_CD
			               and work_sctn_cd = a.dpt_ar_type_cd) 
			       when a.dpt_ar_type_cd = '99' then    
			            d.col01  
			       else 	    	
			          ( select name 
			              from vw_ma01_01 
			             where code         = a.dpt_ar_cd 
			               and work_sctn_cd = a.dpt_ar_type_cd
			               and rownum       = 1) 
			  end  as dpt_ar_nm
			, case when a.arv_ar_type_cd = '02' then
			          ( select name 
			              from vw_ma01_01 
			             where code         = a.arv_ar_cd 
			               AND PTN_CD       = a.RPT_CUST_CD
			               and work_sctn_cd = a.arv_ar_type_cd) 
			       when a.arv_ar_type_cd = '99' then    
			            d.col01  		            
			       else 	    	
			          ( select name 
			              from vw_ma01_01 
			             where code         = a.arv_ar_cd 
			               and work_sctn_cd = a.arv_ar_type_cd
			               and rownum       = 1) 
			  end  as arv_ar_nm
			, a.work_pl_cd
			, (SELECT work_pl_nm FROM tb_ma01005 WHERE work_pl_cd = a.work_pl_cd) as work_pl_nm
			, (SELECT comn_cd_nm  FROM tb_ma01015 WHERE clas_cd = 'EXP_TYPE_CD' AND comn_cd = c.exp_type_cd) as exp_type_nm
			, (SELECT ptn_nm FROM tb_ma01002 WHERE ptn_cd = a.ctrt_cust_cd) as entp_nm
			, a.cust_ord_no
			, a.cust_ord_type_cd
			, case when a.rpt_cust_cd='R1209' OR a.rpt_cust_cd='R1728' then
			  	        MACOMM_GETCD_FN( 'EVE_CUST_ORD_TYPE_CD', a.cust_ord_type_cd) 
			  	   when a.rpt_cust_cd='R1400' then
			  	        MACOMM_GETCD_FN( 'NSC_CUST_ORD_TYPE_CD', a.cust_ord_type_cd)			
			       else
			  	        MACOMM_GETCD_FN( 'CUST_ORD_TYPE_CD', a.cust_ord_type_cd) 
              end cust_ord_type_nm     --고객오더유형명
			, a.cust_move_type_cd 			                                                       --고객이동유형코드
			, decode(a.rpt_cust_cd, 'P1000', (select comn_cd_nm from tb_ma01015 where clas_cd = 'HPP_MOVE_TYPE_CD' and comn_cd = a.cust_move_type_cd)
								  , 'P1591', (select comn_cd_nm from tb_ma01015 where clas_cd = 'HPP_MOVE_TYPE_CD' and comn_cd = a.cust_move_type_cd)
								  , 'P1200', (select comn_cd_nm from tb_ma01015 where clas_cd = 'HHP_MOVE_TYPE_CD' and comn_cd = a.cust_move_type_cd) 
								  , '') as cust_move_type_nm
			, a.rmk
			, a.cust_expr_yn
			, a.back_ord_yn
			, decode(nvl(a.sales_ord_cncl_yn, 'N'), 'Y', '취소'
			                                      , 'N', (SELECT comn_cd_nm 
			                                                FROM tb_ma01015 
			                                               WHERE clas_cd = 'SALES_ORD_CMPT_SCTN_CD' 
			                                                 AND comn_cd = a.sales_ord_cmpt_sctn_cd)
			        ) AS sales_ord_cmpt_sctn_nm
			, decode(nvl(a.sales_ord_cncl_yn, 'N'), 'Y', to_char(a.sales_ord_cncl_date, 'yyyymmddhh24mi')
			                                      , 'N', to_char(a.sales_ord_cmpt_date, 'yyyymmddhh24mi') ) AS sales_ord_cmpt_date
			, IDUSR.OMCOMM_GETCUSTREASONNM_FN(a.rpt_cust_cd, a.ord_reason_cd) as ord_reason_nm
			, a.corp_cd
			, (SELECT dept_nm FROM tb_ma01009 WHERE corp_cd = a.corp_cd and dept_cd = a.ord_mngt_exce_dept_cd) as dept_nm
			, (SELECT user_nm FROM tb_ma01011 WHERE user_id = a.ord_mngt_exce_ofcr_id) as user_nm
			, (SELECT user_nm FROM tb_ma01011 WHERE user_id = a.ord_mngt_fwd_ofcr_id) as fwd_nm
	  		, MACOMM_GETCD_FN('OCEAN_AIR_SCTN_CD', c.ocean_air_sctn_cd)  as ocean_air_sctn_nm
			, a.exp_imp_dom_sctn_cd
			, a.SALES_ORD_CNCL_YN
		FROM  tb_om02001 a,
			  tb_ma01006 b,
			  tb_om02003 c,
			  tb_om02004 d	
    	WHERE a.ord_type_cd = b.ord_type_cd
    	  and a.sales_ord_no = d.sales_ord_no(+)
    	  AND a.sales_ord_no=c.sales_ord_no(+)
    	
    	  {#1}
        ORDER BY a.sales_ord_no desc
   	  	<append condition="${dcnctOrdYn}.NOTEMPTY" id="#1"> 
		  AND a.dcnct_ord_yn = ${dcnctOrdYn}
		</append>
 		<append condition="${salesOrdCreatYmd}.NOTEMPTY" id="#1">
		  AND a.sales_ord_creat_ymd between ${startDate} and ${endDate}
		</append>
		<append condition="${aptdReqYmd}.NOTEMPTY" id="#1">
		  AND a.aptd_req_ymd between ${startDate} and ${endDate}
		</append>
   		<append condition="${ordMngtExceDeptCd}.NOTEMPTY" id="#1"> 
		  AND a.ord_mngt_exce_dept_cd = lpad(${ordMngtExceDeptCd}, 10, '0') 	
  		</append>		  		
  		
   		<append condition="${ordMngtFwdDeptCd}.NOTEMPTY" id="#1"> 
   		  AND LTrim(a.ord_mngt_fwd_dept_cd,'0') LIKE ${ordMngtFwdDeptCd} || '%'
  		</append>
   		<append condition="${ctrtCustCd}.NOTEMPTY" id="#1"> 
		  AND a.rpt_cust_cd = ${ctrtCustCd}
	   </append>
   		<append condition="${salesOrdNo}.NOTEMPTY" id="#1"> 
		  AND a.sales_ord_no = ${salesOrdNo}
	   </append>
   		<append condition="${salesOrdStatCd}.NOTEMPTY" id="#1"> 
		  AND a.sales_ord_stat_cd = ${salesOrdStatCd}
	   </append>
   		<append condition="${ordMngtExceOfcrId}.NOTEMPTY" id="#1"> 
		  AND a.ord_mngt_exce_ofcr_id = ${ordMngtExceOfcrId}
	   </append>
   		<append condition="${dptArCd}.NOTEMPTY" id="#1"> 
		  AND a.dpt_ar_cd = ${dptArCd}
	   </append>
   		<append condition="${arvArCd}.NOTEMPTY" id="#1"> 
		  AND a.arv_ar_cd||'' = ${arvArCd}
	   </append>
   		<append condition="${workPlCd}.NOTEMPTY" id="#1"> 
		  AND a.work_pl_cd = ${workPlCd}
	   </append>
   		<append condition="${logisArCd}.NOTEMPTY" id="#1"> 
		  AND b.logis_ar_cd = ${logisArCd}
   		</append>
   		<append condition="${logisDomnCd}.NOTEMPTY" id="#1"> 
		  AND b.logis_domn_cd = ${logisDomnCd}
   		</append>
   		<append condition="${ordKindCd}.NOTEMPTY" id="#1"> 
		  AND b.ord_kind_cd = ${ordKindCd}
	   </append>
   		<append condition="${logisSvcSctnCd}.NOTEMPTY" id="#1"> 
		  AND b.logis_svc_sctn_cd = ${logisSvcSctnCd}
	   </append>
   		<append condition="${ordTypeCd}.NOTEMPTY" id="#1"> 
		  AND a.ord_type_cd = ${ordTypeCd}
	   </append>
   		<append condition="${oceanAirSctnCd}.NOTEMPTY" id="#1"> 
		  AND c.ocean_air_sctn_cd = ${oceanAirSctnCd}
	   </append>
   		<append condition="${moveTypeCd}.NOTEMPTY" id="#1"> 
		  AND a.move_type_cd = ${moveTypeCd}
	   </append>
   	   <append condition="${rmk}.NOTEMPTY" id="#1"> 
	      AND exists (SELECT 1
	                    FROM tb_om02002 z
	                   WHERE z.sales_ord_no   = a.sales_ord_no
	                     AND z.rmk Like '%'||${rmk}||'%')
	   </append>
   		<append condition="${exceptOrdYn}.NOTEMPTY" id="#1"> 
		  AND b.except_ord_yn = ${exceptOrdYn}
	   </append>
	   <append condition="${ordMngtFwdOfcrId}.NOTEMPTY" id="#1"> 
		  AND a.ord_mngt_fwd_ofcr_id = ${ordMngtFwdOfcrId}
	   </append>
	   
  	   <append condition="${cnclGubun}.EQ.Y&amp;${cnclGubun}.NOTEMPTY" id="#1">
    	  AND a.SALES_ORD_CNCL_YN = 'Y'
       </append>

       <append condition="${cnclGubun}.EQ.N&amp;${cnclGubun}.NOTEMPTY" id="#1">
    	  AND a.SALES_ORD_CNCL_YN = 'N'
       </append>	   
       
   	   <append condition="${cutYn}.EQ.Y&amp;${cutYn}.NOTEMPTY" id="#1">
		  AND exists (SELECT 1
			            FROM tb_om02005 z
			           WHERE z.sales_ord_no   = a.sales_ord_no
			             AND z.col14 Like '%'||${cutYn}||'%')
	   </append>	   
	   
     </statement>

  <statement name="retrieveSalesOrdSearchList_back">
	  SELECT /* retrieveSalesOrdSearchList 2007.10.22 */
			  a.sales_ord_stat_cd
			, (SELECT comn_cd_nm FROM tb_ma01015 WHERE clas_cd = 'ORD_STAT_CD' AND comn_cd = a.sales_ord_stat_cd) as sales_ord_stat_nm
			, a.sales_ord_no
			, (SELECT ord_type_nm FROM tb_ma01006 WHERE ord_type_cd = a.ord_type_cd) as ord_type_nm
			, (SELECT comn_cd_nm  FROM tb_ma01015 WHERE clas_cd = 'MOVE_TYPE_CD' AND comn_cd = a.move_type_cd) as move_type_nm
			, a.sales_ord_creat_ymd || a.sales_ord_creat_hms AS sales_ord_creat_date
			, a.aptd_req_ymd || a.aptd_req_hm AS aptd_req_date
			, case when a.dpt_ar_type_cd = '02' then
			          ( select name 
			              from vw_ma01_01 
			             where code         = a.dpt_ar_cd 
			               AND PTN_CD       = a.RPT_CUST_CD
			               and work_sctn_cd = a.dpt_ar_type_cd) 
			      else 	    	
			          ( select name 
			              from vw_ma01_01 
			             where code         = a.dpt_ar_cd 
			               and work_sctn_cd = a.dpt_ar_type_cd
			               and rownum       = 1) 
			  end  as dpt_ar_nm
			, case when a.arv_ar_type_cd = '02' then
			          ( select name 
			              from vw_ma01_01 
			             where code         = a.arv_ar_cd 
			               AND PTN_CD       = a.RPT_CUST_CD
			               and work_sctn_cd = a.arv_ar_type_cd) 
			      else 	    	
			          ( select name 
			              from vw_ma01_01 
			             where code         = a.arv_ar_cd 
			               and work_sctn_cd = a.arv_ar_type_cd
			               and rownum       = 1) 
			  end  as arv_ar_nm
			, a.work_pl_cd
			, (SELECT work_pl_nm FROM tb_ma01005 WHERE work_pl_cd = a.work_pl_cd) as work_pl_nm
			, (SELECT comn_cd_nm  FROM tb_ma01015 WHERE clas_cd = 'EXP_TYPE_CD' AND comn_cd = c.exp_type_cd) as exp_type_nm
			, (SELECT ptn_nm FROM tb_ma01002 WHERE ptn_cd = a.ctrt_cust_cd) as entp_nm
			, a.cust_ord_no
			, a.cust_ord_type_cd
			, case when a.rpt_cust_cd='R1209' OR a.rpt_cust_cd='R1728' then
			  	        MACOMM_GETCD_FN( 'EVE_CUST_ORD_TYPE_CD', a.cust_ord_type_cd) 			
			       else
			  	        MACOMM_GETCD_FN( 'CUST_ORD_TYPE_CD', a.cust_ord_type_cd) 
              end cust_ord_type_nm     --고객오더유형명
			, a.cust_move_type_cd 			                                                       --고객이동유형코드
			, decode(a.rpt_cust_cd, 'P1000', (select comn_cd_nm from tb_ma01015 where clas_cd = 'HPP_MOVE_TYPE_CD' and comn_cd = a.cust_move_type_cd)
								  , 'P1591', (select comn_cd_nm from tb_ma01015 where clas_cd = 'HPP_MOVE_TYPE_CD' and comn_cd = a.cust_move_type_cd)
								  , 'P1200', (select comn_cd_nm from tb_ma01015 where clas_cd = 'HHP_MOVE_TYPE_CD' and comn_cd = a.cust_move_type_cd) 
								  , '') as cust_move_type_nm
			, a.rmk
			, a.cust_expr_yn
			, a.back_ord_yn
			, decode(nvl(a.sales_ord_cncl_yn, 'N'), 'Y', '취소'
			                                      , 'N', (SELECT comn_cd_nm 
			                                              FROM   tb_ma01015 
			                                              WHERE  clas_cd = 'SALES_ORD_CMPT_SCTN_CD' 
			                                              AND    comn_cd = a.sales_ord_cmpt_sctn_cd)
			        ) AS sales_ord_cmpt_sctn_nm
			, decode(nvl(a.sales_ord_cncl_yn, 'N'), 'Y', to_char(a.sales_ord_cncl_date, 'yyyymmddhh24mi')
			                                      , 'N', to_char(a.sales_ord_cmpt_date, 'yyyymmddhh24mi') ) AS sales_ord_cmpt_date
			, IDUSR.OMCOMM_GETCUSTREASONNM_FN(a.rpt_cust_cd, a.ord_reason_cd) as ord_reason_nm
			, a.corp_cd
			, (SELECT dept_nm FROM tb_ma01009 WHERE corp_cd = a.corp_cd and dept_cd = a.ord_mngt_exce_dept_cd) as dept_nm
			, (SELECT user_nm FROM tb_ma01011 WHERE user_id = a.ord_mngt_exce_ofcr_id) as user_nm
			, (SELECT user_nm FROM tb_ma01011 WHERE user_id = a.ord_mngt_fwd_ofcr_id) as fwd_nm
	  		, MACOMM_GETCD_FN('OCEAN_AIR_SCTN_CD', c.ocean_air_sctn_cd)  as ocean_air_sctn_nm
			, a.exp_imp_dom_sctn_cd
			, a.SALES_ORD_CNCL_YN
		FROM  tb_om02001 a,
			  tb_ma01006 b,
			  tb_om02003 c	
    	WHERE a.ord_type_cd = b.ord_type_cd
    	  AND a.sales_ord_no=c.sales_ord_no(+)
    	{#1}
    	ORDER BY a.sales_ord_no desc
   	  	<append condition="${dcnctOrdYn}.NOTEMPTY" id="#1"> 
		  AND a.dcnct_ord_yn = ${dcnctOrdYn}
		</append>
 		<append condition="${salesOrdCreatYmd}.NOTEMPTY" id="#1">
		  AND a.sales_ord_creat_ymd between ${startDate} and ${endDate}
		</append>
		<append condition="${aptdReqYmd}.NOTEMPTY" id="#1">
		  AND a.aptd_req_ymd between ${startDate} and ${endDate}
		</append>
   		<append condition="${ordMngtExceDeptCd}.NOTEMPTY" id="#1"> 
		  AND (a.ord_mngt_exce_dept_cd = lpad(${ordMngtExceDeptCd}, 10, '0') OR 
		       a.arv_ar_cd IN (SELECT x.work_pl_cd
                                 FROM tb_ma01005 x
                                WHERE x.ord_chrg_dept_cd = lpad(${ordMngtExceDeptCd}, 10, '0')))		
  		</append>		

 
   		<append condition="${ordMngtFwdDeptCd}.NOTEMPTY" id="#1"> 
		  AND LTrim(a.ord_mngt_fwd_dept_cd,'0') LIKE ${ordMngtFwdDeptCd} || '%'
  		</append>
   		<append condition="${ctrtCustCd}.NOTEMPTY" id="#1"> 
		  AND a.ctrt_cust_cd = ${ctrtCustCd}
	   </append>
   		<append condition="${salesOrdNo}.NOTEMPTY" id="#1"> 
		  AND a.sales_ord_no = ${salesOrdNo}
	   </append>
   		<append condition="${salesOrdStatCd}.NOTEMPTY" id="#1"> 
		  AND a.sales_ord_stat_cd = ${salesOrdStatCd}
	   </append>
   		<append condition="${ordMngtExceOfcrId}.NOTEMPTY" id="#1"> 
		  AND a.ord_mngt_exce_ofcr_id = ${ordMngtExceOfcrId}
	   </append>
   		<append condition="${dptArCd}.NOTEMPTY" id="#1"> 
		  AND a.dpt_ar_cd = ${dptArCd}
	   </append>
   		<append condition="${arvArCd}.NOTEMPTY" id="#1"> 
		  AND a.arv_ar_cd = ${arvArCd}
	   </append>
   		<append condition="${workPlCd}.NOTEMPTY" id="#1"> 
		  AND a.work_pl_cd = ${workPlCd}
	   </append>
   		<append condition="${logisArCd}.NOTEMPTY" id="#1"> 
		  AND b.logis_ar_cd = ${logisArCd}
   		</append>
   		<append condition="${logisDomnCd}.NOTEMPTY" id="#1"> 
		  AND b.logis_domn_cd = ${logisDomnCd}
   		</append>
   		<append condition="${ordKindCd}.NOTEMPTY" id="#1"> 
		  AND b.ord_kind_cd = ${ordKindCd}
	   </append>
   		<append condition="${logisSvcSctnCd}.NOTEMPTY" id="#1"> 
		  AND b.logis_svc_sctn_cd = ${logisSvcSctnCd}
	   </append>
   		<append condition="${ordTypeCd}.NOTEMPTY" id="#1"> 
		  AND a.ord_type_cd = ${ordTypeCd}
	   </append>
   		<append condition="${oceanAirSctnCd}.NOTEMPTY" id="#1"> 
		  AND c.ocean_air_sctn_cd = ${oceanAirSctnCd}
	   </append>
   		<append condition="${moveTypeCd}.NOTEMPTY" id="#1"> 
		  AND a.move_type_cd = ${moveTypeCd}
	   </append>
   		<append condition="${rmk}.NOTEMPTY" id="#1"> 
	      AND exists (SELECT 1
	                    FROM tb_om02002 z
	                   WHERE z.sales_ord_no   = a.sales_ord_no
	                     AND z.rmk Like '%'||${rmk}||'%')
	   </append>
   		<append condition="${exceptOrdYn}.NOTEMPTY" id="#1"> 
		  AND b.except_ord_yn = ${exceptOrdYn}
	   </append>
	   <append condition="${ordMngtFwdOfcrId}.NOTEMPTY" id="#1"> 
		  AND a.ord_mngt_fwd_ofcr_id = ${ordMngtFwdOfcrId}
	   </append>
	   
  	   <append condition="${cnclGubun}.EQ.Y&amp;${cnclGubun}.NOTEMPTY" id="#1">
    	  AND a.SALES_ORD_CNCL_YN = 'Y'
       </append>

       <append condition="${cnclGubun}.EQ.N&amp;${cnclGubun}.NOTEMPTY" id="#1">
    	  AND a.SALES_ORD_CNCL_YN = 'N'
       </append>	   
    </statement>

	<statement name="retrieveSalesOrdManualCmptBasic">
	    SELECT chk
			, sales_ord_stat_cd
			, sales_ord_stat_nm
			, sales_ord_no
			, ord_type_nm
			, move_type_nm
			, sales_ord_creat_date
			, aptd_req_date
			, dpt_ar_nm
			, arv_ar_nm
			, work_pl_cd
			, work_pl_nm
			, exp_type_nm
			, entp_nm
			, cust_ord_no
			, cust_ord_type_nm
			, cust_move_type_cd
			, cust_move_type_nm
			, rmk
			, cust_expr_yn
			, back_ord_yn
			, sales_ord_cmpt_sctn_nm
			, sales_ord_cmpt_date
			, ord_reason_nm
			, corp_cd
			, dept_nm
			, user_nm
			, fwd_nm
			, exp_imp_dom_sctn_cd
			, line_no
			, item_cd
			, item_nm
			, qty_unit_cd 
			, ord_qty 
			, rslt_qty
			, remain_qty
			, wgt_unit_cd 
			, ord_wgt 
			, rslt_wgt
			, remain_wgt
			, admt
			, ord_cbm 
			, rslt_cbm
			, remain_cbm	
       FROM (
			SELECT	/* retrieveSalesOrdManualCmptBasic */
				  'F' chk
				, a.sales_ord_stat_cd
				, (SELECT comn_cd_nm FROM tb_ma01015 WHERE clas_cd = 'ORD_STAT_CD' AND comn_cd = a.sales_ord_stat_cd) as sales_ord_stat_nm
				, a.sales_ord_no
				, (SELECT ord_type_nm FROM tb_ma01006 WHERE ord_type_cd = a.ord_type_cd) as ord_type_nm
				, (SELECT comn_cd_nm  FROM tb_ma01015 WHERE clas_cd = 'MOVE_TYPE_CD' AND comn_cd = a.move_type_cd) as move_type_nm
				, a.sales_ord_creat_ymd || a.sales_ord_creat_hms AS sales_ord_creat_date
				, a.aptd_req_ymd || a.aptd_req_hm AS aptd_req_date
				, case when a.dpt_ar_type_cd = '02' then
						  ( select name 
							from   vw_ma01_01 
							where  code         = a.dpt_ar_cd 
							AND	   PTN_CD       = a.RPT_CUST_CD
							and    work_sctn_cd = a.dpt_ar_type_cd) 
					  else 	    	
						  ( select name 
							from   vw_ma01_01 
							where  code         = a.dpt_ar_cd 
							and    work_sctn_cd = a.dpt_ar_type_cd
							and    rownum       = 1) 
				  end  as dpt_ar_nm
				, case when a.arv_ar_type_cd = '02' then
						  ( select name 
							from   vw_ma01_01 
							where  code         = a.arv_ar_cd 
							AND	   PTN_CD       = a.RPT_CUST_CD
							and    work_sctn_cd = a.arv_ar_type_cd) 
					  else 	    	
						  ( select name 
							from   vw_ma01_01 
							where  code         = a.arv_ar_cd 
							and    work_sctn_cd = a.arv_ar_type_cd
							and    rownum       = 1) 
				  end  as arv_ar_nm
				, a.work_pl_cd
				, (SELECT work_pl_nm FROM tb_ma01005 WHERE work_pl_cd = a.work_pl_cd) as work_pl_nm
				, (SELECT comn_cd_nm  FROM tb_ma01015 WHERE clas_cd = 'EXP_TYPE_CD' AND comn_cd = c.exp_type_cd) as exp_type_nm
				, (SELECT ptn_nm FROM tb_ma01002 WHERE ptn_cd = a.ctrt_cust_cd) as entp_nm
				, a.cust_ord_no
				, a.cust_ord_type_cd
				, case when a.rpt_cust_cd = 'R1209' OR a.rpt_cust_cd = 'R1728' then
				    MACOMM_GETCD_FN( 'EVE_CUST_ORD_TYPE_CD', a.cust_ord_type_cd) 				
				  else
				    MACOMM_GETCD_FN( 'CUST_ORD_TYPE_CD', a.cust_ord_type_cd) 
                  end cust_ord_type_nm     --고객오더유형명
				, a.cust_move_type_cd 			                                                       --고객이동유형코드
				, decode(a.rpt_cust_cd, 'P1000', (select comn_cd_nm from tb_ma01015 where clas_cd = 'HPP_MOVE_TYPE_CD' and comn_cd = a.cust_move_type_cd)
									, 'P1591', (select comn_cd_nm from tb_ma01015 where clas_cd = 'HPP_MOVE_TYPE_CD' and comn_cd = a.cust_move_type_cd)
									, 'P1200', (select comn_cd_nm from tb_ma01015 where clas_cd = 'HHP_MOVE_TYPE_CD' and comn_cd = a.cust_move_type_cd) 
									, '') as cust_move_type_nm
				, a.rmk
				, a.cust_expr_yn
				, a.back_ord_yn
				, decode(nvl(a.sales_ord_cncl_yn, 'N'), 'Y', '취소'
													  , 'N', (SELECT comn_cd_nm 
															  FROM   tb_ma01015 
															  WHERE  clas_cd = 'SALES_ORD_CMPT_SCTN_CD' 
															  AND    comn_cd = a.sales_ord_cmpt_sctn_cd)
						) AS sales_ord_cmpt_sctn_nm
				, decode(nvl(a.sales_ord_cncl_yn, 'N'), 'Y', to_char(a.sales_ord_cncl_date, 'yyyymmddhh24mi')
													  , 'N', to_char(a.sales_ord_cmpt_date, 'yyyymmddhh24mi') ) AS sales_ord_cmpt_date
				, IDUSR.OMCOMM_GETCUSTREASONNM_FN(a.rpt_cust_cd, a.ord_reason_cd) as ord_reason_nm
				, a.corp_cd
				, (SELECT dept_nm FROM tb_ma01009 WHERE corp_cd = a.corp_cd and dept_cd = a.ord_mngt_exce_dept_cd) as dept_nm
				, (SELECT user_nm FROM tb_ma01011 WHERE user_id = a.ord_mngt_exce_ofcr_id) as user_nm
				, (SELECT user_nm FROM tb_ma01011 WHERE user_id = a.ord_mngt_fwd_ofcr_id) as fwd_nm
				, a.exp_imp_dom_sctn_cd
				, b.line_no
				, b.item_cd
				, (SELECT item_nm FROM tb_ma02010 WHERE ptn_cd = b.cust_cd AND item_cd = b.item_cd) item_nm
				, b.qty_unit_cd 
				, b.ord_qty 
				, NVL((SELECT sum(x.rslt_qty) 
					   FROM tb_om03002 x
						   ,tb_om03001 y
					   WHERE x.sales_ord_no   = b.sales_ord_no
					   AND   x.line_no        = b.line_no
					   AND   x.sales_ord_no   = y.sales_ord_no
					   AND   x.work_route_seq = y.work_route_seq
					   AND   y.del_yn         = 'N'), 0) rslt_qty
				, b.ord_qty - NVL((SELECT sum(x.rslt_qty) 
								   FROM tb_om03002 x
									   ,tb_om03001 y
								   WHERE x.sales_ord_no   = b.sales_ord_no
								   AND   x.line_no        = b.line_no
								   AND   x.sales_ord_no   = y.sales_ord_no
								   AND   x.work_route_seq = y.work_route_seq
								   AND   y.del_yn         = 'N'), 0) remain_qty
				, b.wgt_unit_cd 
				, b.ord_wgt 
				, NVL((SELECT sum(x.rslt_wgt) 
					   FROM tb_om03002 x
						   ,tb_om03001 y
					   WHERE x.sales_ord_no   = b.sales_ord_no
					   AND   x.line_no        = b.line_no
					   AND   x.sales_ord_no   = y.sales_ord_no
					   AND   x.work_route_seq = y.work_route_seq
					   AND   y.del_yn         = 'N'), 0) rslt_wgt
				, b.ord_wgt - NVL((SELECT sum(x.rslt_wgt) 
								   FROM tb_om03002 x
									   ,tb_om03001 y
								   WHERE x.sales_ord_no   = b.sales_ord_no
								   AND   x.line_no        = b.line_no
								   AND   x.sales_ord_no   = y.sales_ord_no
								   AND   x.work_route_seq = y.work_route_seq
								   AND   y.del_yn         = 'N'), 0) remain_wgt
				, b.admt
				, b.ord_cbm 
				, NVL((SELECT sum(x.rslt_cbm) 
					   FROM tb_om03002 x
						   ,tb_om03001 y
					   WHERE x.sales_ord_no   = b.sales_ord_no
					   AND   x.line_no        = b.line_no
					   AND   x.sales_ord_no   = y.sales_ord_no
					   AND   x.work_route_seq = y.work_route_seq
					   AND   y.del_yn         = 'N'), 0) rslt_cbm
				, b.ord_cbm - NVL((SELECT sum(x.rslt_cbm) 
								   FROM tb_om03002 x
									   ,tb_om03001 y
								   WHERE x.sales_ord_no   = b.sales_ord_no
								   AND   x.line_no        = b.line_no
								   AND   x.sales_ord_no   = y.sales_ord_no
								   AND   x.work_route_seq = y.work_route_seq
								   AND   y.del_yn         = 'N'), 0) remain_cbm	
			FROM	tb_om02001 a
				  , tb_om02002 b		
				  , tb_om02003 c
			WHERE	1=1
			AND     a.sales_ord_stat_cd = '05'
			AND		a.sales_ord_no = c.sales_ord_no(+)
			AND     a.sales_ord_cmpt_sctn_cd is null
			AND     a.sales_ord_cncl_yn = 'N'
			AND     a.sales_ord_no = b.sales_ord_no
			AND     b.del_yn       = 'N'    	
			{#1}
		)
		WHERE   1=1
		<append condition="${salesOrdNo}.NOTEMPTY" id="#1"> 
		AND		a.sales_ord_no = ${salesOrdNo}
		</append>
		<append condition="${custOrdNo}.NOTEMPTY"  id="#1"> 
		AND		a.cust_ord_no  = ${custOrdNo}
		</append>
		<append condition="${ordTypeCd}.NOTEMPTY"  id="#1"> 
		AND		a.ord_type_cd  = ${ordTypeCd}
		</append>
		<append condition="${dcnctOrdYn}.NOTEMPTY" id="#1"> 
		AND		a.dcnct_ord_yn = ${dcnctOrdYn}
		ORDER BY a.sales_ord_no, a.cust_ord_no desc
		</append>
	</statement>
		
    <statement name="retrieveSalesOrdManualCmpt">
	    SELECT chk
			, sales_ord_stat_cd
			, sales_ord_stat_nm
			, sales_ord_no
			, ord_type_nm
			, move_type_nm
			, sales_ord_creat_date
			, aptd_req_date
			, dpt_ar_nm
			, arv_ar_nm
			, work_pl_cd
			, work_pl_nm
			, exp_type_nm
			, entp_nm
			, cust_ord_no
			, cust_ord_type_nm
			, cust_move_type_cd
			, cust_move_type_nm
			, rmk
			, cust_expr_yn
			, back_ord_yn
			, sales_ord_cmpt_sctn_nm
			, sales_ord_cmpt_date
			, ord_reason_nm
			, corp_cd
			, dept_nm
			, user_nm
			, fwd_nm
			, exp_imp_dom_sctn_cd
			, line_no
			, item_cd
			, item_nm
			, qty_unit_cd 
			, ord_qty 
			, rslt_qty
			, remain_qty
			, wgt_unit_cd 
			, ord_wgt 
			, rslt_wgt
			, remain_wgt
			, admt
			, ord_cbm 
			, rslt_cbm
			, remain_cbm	
        FROM (
		SELECT	/* retrieveSalesOrdManualCmpt */
			  'F' chk
			, a.sales_ord_stat_cd
			, (SELECT comn_cd_nm FROM tb_ma01015 WHERE clas_cd = 'ORD_STAT_CD' AND comn_cd = a.sales_ord_stat_cd) as sales_ord_stat_nm
			, a.sales_ord_no
			, (SELECT ord_type_nm FROM tb_ma01006 WHERE ord_type_cd = a.ord_type_cd) as ord_type_nm
			, (SELECT comn_cd_nm  FROM tb_ma01015 WHERE clas_cd = 'MOVE_TYPE_CD' AND comn_cd = a.move_type_cd) as move_type_nm
			, a.sales_ord_creat_ymd || a.sales_ord_creat_hms AS sales_ord_creat_date
			, a.aptd_req_ymd || a.aptd_req_hm AS aptd_req_date
			, case when a.dpt_ar_type_cd = '02' then
					  ( select name 
						from   vw_ma01_01 
						where  code         = a.dpt_ar_cd 
						AND	   PTN_CD       = a.RPT_CUST_CD
						and    work_sctn_cd = a.dpt_ar_type_cd) 
				  else 	    	
					  ( select name 
						from   vw_ma01_01 
						where  code         = a.dpt_ar_cd 
						and    work_sctn_cd = a.dpt_ar_type_cd
						and    rownum       = 1) 
			  end  as dpt_ar_nm
			, case when a.arv_ar_type_cd = '02' then
					  ( select name 
						from   vw_ma01_01 
						where  code         = a.arv_ar_cd 
						AND	   PTN_CD       = a.RPT_CUST_CD
						and    work_sctn_cd = a.arv_ar_type_cd) 
				  else 	    	
					  ( select name 
						from   vw_ma01_01 
						where  code         = a.arv_ar_cd 
						and    work_sctn_cd = a.arv_ar_type_cd
						and    rownum       = 1) 
			  end  as arv_ar_nm
			, a.work_pl_cd
			, (SELECT work_pl_nm FROM tb_ma01005 WHERE work_pl_cd = a.work_pl_cd) as work_pl_nm
			, (SELECT comn_cd_nm  FROM tb_ma01015 WHERE clas_cd = 'EXP_TYPE_CD' AND comn_cd = c.exp_type_cd) as exp_type_nm
			, (SELECT ptn_nm FROM tb_ma01002 WHERE ptn_cd = a.ctrt_cust_cd) as entp_nm
			, a.cust_ord_no
			, case when a.rpt_cust_cd = 'R1209' OR a.rpt_cust_cd = 'R1728' then
			    MACOMM_GETCD_FN( 'EVE_CUST_ORD_TYPE_CD', a.cust_ord_type_cd) 			
			  else
			    MACOMM_GETCD_FN( 'CUST_ORD_TYPE_CD', a.cust_ord_type_cd) 
              end cust_ord_type_nm     --고객오더유형명
			, a.cust_move_type_cd 			                                                       --고객이동유형코드
			, decode(a.rpt_cust_cd, 'P1000', (select comn_cd_nm from tb_ma01015 where clas_cd = 'HPP_MOVE_TYPE_CD' and comn_cd = a.cust_move_type_cd)
								  , 'P1591', (select comn_cd_nm from tb_ma01015 where clas_cd = 'HPP_MOVE_TYPE_CD' and comn_cd = a.cust_move_type_cd)
								  , 'P1200', (select comn_cd_nm from tb_ma01015 where clas_cd = 'HHP_MOVE_TYPE_CD' and comn_cd = a.cust_move_type_cd) 
								  , '') as cust_move_type_nm
			, a.rmk
			, a.cust_expr_yn
			, a.back_ord_yn
			, decode(nvl(a.sales_ord_cncl_yn, 'N'), 'Y', '취소'
												  , 'N', (SELECT comn_cd_nm 
														  FROM   tb_ma01015 
														  WHERE  clas_cd = 'SALES_ORD_CMPT_SCTN_CD' 
														  AND    comn_cd = a.sales_ord_cmpt_sctn_cd)
					) AS sales_ord_cmpt_sctn_nm
			, decode(nvl(a.sales_ord_cncl_yn, 'N'), 'Y', to_char(a.sales_ord_cncl_date, 'yyyymmddhh24mi')
												  , 'N', to_char(a.sales_ord_cmpt_date, 'yyyymmddhh24mi') ) AS sales_ord_cmpt_date
			, IDUSR.OMCOMM_GETCUSTREASONNM_FN(a.rpt_cust_cd, a.ord_reason_cd) as ord_reason_nm
			, a.corp_cd
			, (SELECT dept_nm FROM tb_ma01009 WHERE corp_cd = a.corp_cd and dept_cd = a.ord_mngt_exce_dept_cd) as dept_nm
			, (SELECT user_nm FROM tb_ma01011 WHERE user_id = a.ord_mngt_exce_ofcr_id) as user_nm
			, (SELECT user_nm FROM tb_ma01011 WHERE user_id = a.ord_mngt_fwd_ofcr_id) as fwd_nm
			, MACOMM_GETCD_FN('OCEAN_AIR_SCTN_CD', c.ocean_air_sctn_cd)  as ocean_air_sctn_nm
			, a.exp_imp_dom_sctn_cd
			, d.line_no
			, d.item_cd
			, (SELECT item_nm FROM tb_ma02010 WHERE ptn_cd = d.cust_cd AND item_cd = d.item_cd) item_nm
			, d.qty_unit_cd 
			, d.ord_qty 
			, NVL((SELECT sum(x.rslt_qty) 
				   FROM tb_om03002 x
					   ,tb_om03001 y
				   WHERE x.sales_ord_no   = d.sales_ord_no
				   AND   x.line_no        = d.line_no
				   AND   x.sales_ord_no   = y.sales_ord_no
				   AND   x.work_route_seq = y.work_route_seq
				   AND   y.del_yn         = 'N'), 0) rslt_qty
			, d.ord_qty - NVL((SELECT sum(x.rslt_qty) 
							   FROM tb_om03002 x
								   ,tb_om03001 y
							   WHERE x.sales_ord_no   = d.sales_ord_no
							   AND   x.line_no        = d.line_no
							   AND   x.sales_ord_no   = y.sales_ord_no
							   AND   x.work_route_seq = y.work_route_seq
							   AND   y.del_yn         = 'N'), 0) remain_qty
			, d.wgt_unit_cd 
			, d.ord_wgt 
			, NVL((SELECT sum(x.rslt_wgt) 
				   FROM tb_om03002 x
					   ,tb_om03001 y
				   WHERE x.sales_ord_no   = d.sales_ord_no
				   AND   x.line_no        = d.line_no
				   AND   x.sales_ord_no   = y.sales_ord_no
				   AND   x.work_route_seq = y.work_route_seq
				   AND   y.del_yn         = 'N'), 0) rslt_wgt
			, d.ord_wgt - NVL((SELECT sum(x.rslt_wgt) 
							   FROM tb_om03002 x
								   ,tb_om03001 y
							   WHERE x.sales_ord_no   = d.sales_ord_no
							   AND   x.line_no        = d.line_no
							   AND   x.sales_ord_no   = y.sales_ord_no
							   AND   x.work_route_seq = y.work_route_seq
							   AND   y.del_yn         = 'N'), 0) remain_wgt
			, d.admt
			, d.ord_cbm 
			, NVL((SELECT sum(x.rslt_cbm) 
				   FROM tb_om03002 x
					   ,tb_om03001 y
				   WHERE x.sales_ord_no   = d.sales_ord_no
				   AND   x.line_no        = d.line_no
				   AND   x.sales_ord_no   = y.sales_ord_no
				   AND   x.work_route_seq = y.work_route_seq
				   AND   y.del_yn         = 'N'), 0) rslt_cbm
			, d.ord_cbm - NVL((SELECT sum(x.rslt_cbm) 
							   FROM tb_om03002 x
								   ,tb_om03001 y
							   WHERE x.sales_ord_no   = d.sales_ord_no
							   AND   x.line_no        = d.line_no
							   AND   x.sales_ord_no   = y.sales_ord_no
							   AND   x.work_route_seq = y.work_route_seq
							   AND   y.del_yn         = 'N'), 0) remain_cbm					
		FROM	tb_om02001 a,
				tb_ma01006 b,
				tb_om02003 c,
				tb_om02002 d
		WHERE	1=1
		AND     a.ord_type_cd  = b.ord_type_cd
		AND		a.sales_ord_no = c.sales_ord_no(+)
		AND     a.sales_ord_stat_cd = '05'
		AND     a.sales_ord_cmpt_sctn_cd is null
		AND     a.sales_ord_cncl_yn = 'N'    	
		AND     a.sales_ord_no = d.sales_ord_no
		AND   	d.del_yn       = 'N'    	
		{#1}
		)
		WHERE 1=1
		ORDER BY sales_ord_no desc, to_number(line_no) asc 
		<append condition="${dcnctOrdYn}.NOTEMPTY" id="#1"> 
		AND		a.dcnct_ord_yn = ${dcnctOrdYn}
		</append>
		<append condition="${salesOrdCreatYmd}.NOTEMPTY" id="#1">
		AND		a.sales_ord_creat_ymd between ${startDate} and ${endDate}
		</append>
		<append condition="${aptdReqYmd}.NOTEMPTY" id="#1">
		AND		a.aptd_req_ymd between ${startDate} and ${endDate}
		</append>
		<append condition="${ordMngtExceDeptCd}.NOTEMPTY" id="#1"> 
		AND		a.ord_mngt_exce_dept_cd = lpad(${ordMngtExceDeptCd}, 10, '0')
		</append>
		<append condition="${ordMngtFwdDeptCd}.NOTEMPTY" id="#1"> 
		AND	LTrim(a.ord_mngt_fwd_dept_cd,'0') LIKE ${ordMngtFwdDeptCd} || '%'
		</append>
		<append condition="${ctrtCustCd}.NOTEMPTY" id="#1"> 
		AND		a.ctrt_cust_cd = ${ctrtCustCd}
	   </append>
		<append condition="${salesOrdNo}.NOTEMPTY" id="#1"> 
		AND		a.sales_ord_no = ${salesOrdNo}
	   </append>
		<append condition="${expImpDomSctnCd}.NOTEMPTY" id="#1"> 
		AND		a.exp_imp_dom_sctn_cd = ${expImpDomSctnCd}
	   </append>
		<append condition="${ordMngtExceOfcrId}.NOTEMPTY" id="#1"> 
		AND		a.ord_mngt_exce_ofcr_id = ${ordMngtExceOfcrId}
	   </append>
		<append condition="${dptArCd}.NOTEMPTY" id="#1"> 
		AND		a.dpt_ar_cd = ${dptArCd}
	   </append>
		<append condition="${arvArCd}.NOTEMPTY" id="#1"> 
		AND		a.arv_ar_cd = ${arvArCd}
	   </append>
		<append condition="${workPlCd}.NOTEMPTY" id="#1"> 
		AND		a.work_pl_cd = ${workPlCd}
	   </append>
		<append condition="${logisArCd}.NOTEMPTY" id="#1"> 
		AND		b.logis_ar_cd = ${logisArCd}
		</append>
		<append condition="${logisDomnCd}.NOTEMPTY" id="#1"> 
		AND		b.logis_domn_cd = ${logisDomnCd}
		</append>
		<append condition="${ordKindCd}.NOTEMPTY" id="#1"> 
		AND		b.ord_kind_cd = ${ordKindCd}
	   </append>
		<append condition="${logisSvcSctnCd}.NOTEMPTY" id="#1"> 
		AND		b.logis_svc_sctn_cd = ${logisSvcSctnCd}
	   </append>
		<append condition="${ordTypeCd}.NOTEMPTY" id="#1"> 
		AND		a.ord_type_cd = ${ordTypeCd}
	   </append>
		<append condition="${oceanAirSctnCd}.NOTEMPTY" id="#1"> 
		AND		c.ocean_air_sctn_cd = ${oceanAirSctnCd}
	   </append>
		<append condition="${moveTypeCd}.NOTEMPTY" id="#1"> 
		AND		a.move_type_cd = ${moveTypeCd}
	   </append>
		<append condition="${rmk}.NOTEMPTY" id="#1"> 
		 AND    exists (SELECT 1
						FROM tb_om02002 z
						WHERE z.sales_ord_no   = a.sales_ord_no
						AND   z.rmk Like '%'||${rmk}||'%')
	   </append>
		<append condition="${exceptOrdYn}.NOTEMPTY" id="#1"> 
		AND		b.except_ord_yn = ${exceptOrdYn}
	   </append>
     </statement>
     		
	<statement name="retrieveSalesOrdPartCmptListBasic">
	SELECT	/* retrieveSalesOrdPartCmptList.jsp 2007.10.22 */
	    (SELECT comn_cd_nm FROM tb_ma01015 WHERE clas_cd = 'ORD_STAT_CD' AND comn_cd = a.sales_ord_stat_cd) as sales_ord_stat_nm,
		a.sales_ord_no, a.cust_ord_no, a.aptd_req_ymd,
		(SELECT ptn_nm FROM tb_ma01002 
		WHERE ptn_cd = a.ctrt_cust_cd) as entp_nm,
		(SELECT dept_nm FROM tb_ma01009 
		WHERE corp_cd = a.corp_cd 
		and dept_cd = a.ord_mngt_exce_dept_cd) as dept_nm,
		(SELECT ord_type_nm FROM tb_ma01006 
		WHERE ord_type_cd = a.ord_type_cd) as ord_type_nm,
		a.sales_ord_creat_ymd, 
	     case when a.dpt_ar_type_cd = '02' then
	    	(select name 
	    	from vw_ma01_01 
	    	where code = a.dpt_ar_cd 
	    	AND	  PTN_CD = a.RPT_CUST_CD
	    	and work_sctn_cd = a.dpt_ar_type_cd) 
		  else 	    	
	    	(select name 
	    	from vw_ma01_01 
	    	where code = a.dpt_ar_cd 
	    	and work_sctn_cd = a.dpt_ar_type_cd
	    	and rownum = 1) 
	      end  as dpt_ar_nm, 

	     case when a.arv_ar_type_cd = '02' then
	    	(select name 
	    	from vw_ma01_01 
	    	where code = a.arv_ar_cd 
	    	AND	  PTN_CD = a.RPT_CUST_CD
	    	and work_sctn_cd = a.arv_ar_type_cd) 
		  else 	    	
	    	(select name 
	    	from vw_ma01_01 
	    	where code = a.arv_ar_cd 
	    	and work_sctn_cd = a.arv_ar_type_cd
	    	and rownum = 1) 
	      end  as arv_ar_nm,
			(select WORK_PL_NM 
			from TB_MA01005 
			where WORK_PL_CD = a.work_pl_cd ) as work_pl_nm,
		(SELECT user_nm FROM tb_ma01011 
		WHERE user_id = a.ord_mngt_fwd_ofcr_id) as fwd_nm,
		(SELECT user_nm FROM tb_ma01011 
		WHERE user_id = a.ord_mngt_exce_ofcr_id) as user_nm,
		sales_ord_cmpt_sctn_cd,
		(SELECT comn_cd_nm FROM tb_ma01015
		 WHERE clas_cd = 'SALES_ORD_CMPT_SCTN_CD' AND comn_cd = sales_ord_cmpt_sctn_cd) as sales_ord_cmpt_sctn_nm
	FROM	tb_om02001 a
   	WHERE	1=1
	AND  ( a.sales_ord_cmpt_sctn_cd = '02' or (a.sales_ord_cmpt_sctn_cd = '01' and a.rpt_cust_cd = 'P1100') OR a.sales_ord_cmpt_sctn_cd is null) 
	AND	   a.sales_ord_cncl_yn != 'Y'  
	AND  ((a.rpt_cust_cd != 'P1000' AND a.rpt_cust_cd != 'P1100') OR 
	      (a.rpt_cust_cd  = 'P1000' AND a.exp_imp_dom_sctn_cd != '01') OR
	      (a.rpt_cust_cd  = 'P1100' AND (a.exp_imp_dom_sctn_cd != '01' OR a.dpt_ar_cd != '1000'))	      
	     ) 
	AND  (a.sales_ord_stat_cd = '02' 
	      OR (a.sales_ord_cmpt_sctn_cd = '01' and a.rpt_cust_cd = 'P1100')
	      OR IDUSR.OMCOMM_CHECKPARTCMPT_FN(a.sales_ord_no) = 'Y')
   	{#1}   	                
	<append condition="${salesOrdNo}.NOTEMPTY" id="#1"> 
	AND		a.sales_ord_no  = ${salesOrdNo}
   	ORDER BY a.sales_ord_no desc
	</append>
	<append condition="${custOrdNo}.NOTEMPTY" id="#1"> 
	AND		a.cust_ord_no = ${custOrdNo}
   	ORDER BY a.cust_ord_no desc
	</append>
	</statement>	
	
	<statement name="retrieveSalesOrdPartCmptList">
	SELECT	/* retrieveSalesOrdPartCmptList.jsp 2007.10.22 */
	    (SELECT comn_cd_nm FROM tb_ma01015 WHERE clas_cd = 'ORD_STAT_CD' AND comn_cd = a.sales_ord_stat_cd) as sales_ord_stat_nm,	
		a.sales_ord_no, a.cust_ord_no, a.aptd_req_ymd,
		(SELECT ptn_nm FROM tb_ma01002 
		WHERE ptn_cd = a.ctrt_cust_cd) as entp_nm,
		(SELECT dept_nm FROM tb_ma01009 
		WHERE corp_cd = a.corp_cd 
		and dept_cd = a.ord_mngt_exce_dept_cd) as dept_nm,
		(SELECT ord_type_nm FROM tb_ma01006 
		WHERE ord_type_cd = a.ord_type_cd) as ord_type_nm,
		a.sales_ord_creat_ymd,
		     case when a.dpt_ar_type_cd = '02' then
		    	(select name 
		    	from vw_ma01_01 
		    	where code = a.dpt_ar_cd 
		    	AND	  PTN_CD = a.RPT_CUST_CD
		    	and work_sctn_cd = a.dpt_ar_type_cd) 
			  else 	    	
		    	(select name 
		    	from vw_ma01_01 
		    	where code = a.dpt_ar_cd 
		    	and work_sctn_cd = a.dpt_ar_type_cd
		    	and rownum = 1) 
		      end  as dpt_ar_nm,

		     case when a.arv_ar_type_cd = '02' then
		    	(select name 
		    	from vw_ma01_01 
		    	where code = a.arv_ar_cd 
		    	AND	  PTN_CD = a.RPT_CUST_CD
		    	and work_sctn_cd = a.arv_ar_type_cd) 
			  else 	    	
		    	(select name 
		    	from vw_ma01_01 
		    	where code = a.arv_ar_cd 
		    	and work_sctn_cd = a.arv_ar_type_cd
		    	and rownum = 1) 
		      end  as arv_ar_nm,
			(select WORK_PL_NM 
			from TB_MA01005 
			where WORK_PL_CD = a.work_pl_cd ) as work_pl_nm,
		(SELECT user_nm FROM tb_ma01011 
		WHERE user_id = a.ord_mngt_fwd_ofcr_id) as fwd_nm,
		(SELECT user_nm FROM tb_ma01011 
		WHERE user_id = a.ord_mngt_exce_ofcr_id) as user_nm,
		sales_ord_cmpt_sctn_cd,
		(SELECT comn_cd_nm FROM tb_ma01015
		 WHERE clas_cd = 'SALES_ORD_CMPT_SCTN_CD' AND comn_cd = sales_ord_cmpt_sctn_cd) as sales_ord_cmpt_sctn_nm
	FROM	tb_om02001 a,
			tb_ma01006 b
   	WHERE	a.ord_type_cd = b.ord_type_cd
   	AND	    a.sales_ord_cncl_yn != 'Y'
   	AND     a.sales_ord_no like 'S%'
	AND  ((a.rpt_cust_cd != 'P1000' AND a.rpt_cust_cd != 'P1100') OR 
	      (a.rpt_cust_cd  = 'P1000' AND a.exp_imp_dom_sctn_cd != '01') OR
	      (a.rpt_cust_cd  = 'P1100' AND (a.exp_imp_dom_sctn_cd != '01' OR a.dpt_ar_cd != '1000'))	      
	     )    	
	AND  (a.sales_ord_stat_cd = '02' OR IDUSR.OMCOMM_CHECKPARTCMPT_FN(a.sales_ord_no) = 'Y')
   	{#1}
   	ORDER BY a.sales_ord_no desc
	<append condition="${salesOrdCreatYmd}.NOTEMPTY" id="#1">
		AND		a.sales_ord_creat_ymd between ${startDate} and ${endDate}
	</append>
	<append condition="${aptdReqYmd}.NOTEMPTY" id="#1">
		AND		a.aptd_req_ymd between ${startDate} and ${endDate}
	</append>
   <append condition="${ordMngtExceDeptCd}.NOTEMPTY" id="#1"> 
		AND		a.ord_mngt_exce_dept_cd = LPad(${ordMngtExceDeptCd}, 10, '0')
   </append>
   <append condition="${ctrtCustCd}.NOTEMPTY" id="#1"> 
		AND		a.ctrt_cust_cd = ${ctrtCustCd}
   </append>
   <append condition="${salesOrdNo}.NOTEMPTY" id="#1"> 
		AND		a.sales_ord_no = ${salesOrdNo}
   </append>
   <append condition="${salesOrdCmptSctnCd}.EMPTY" id="#1"> 
		AND ( a.sales_ord_cmpt_sctn_cd = '02' OR 
		      a.sales_ord_cmpt_sctn_cd is null)
   </append>
   <append condition="${salesOrdCmptSctnCd}.EQ.02" id="#1"> 
		AND   a.sales_ord_cmpt_sctn_cd = '02'
   </append>
   <append condition="${salesOrdCmptSctnCd}.EQ.01" id="#1"> 
		AND   a.sales_ord_cmpt_sctn_cd is null
   </append>
   <append condition="${ordMngtExceOfcrId}.NOTEMPTY" id="#1"> 
		AND		a.ord_mngt_exce_ofcr_id = ${ordMngtExceOfcrId}
   </append>
   <append condition="${dptArCd}.NOTEMPTY" id="#1"> 
		AND		a.dpt_ar_cd = ${dptArCd}
   </append>
   <append condition="${arvArCd}.NOTEMPTY" id="#1"> 
		AND		a.arv_ar_cd = ${arvArCd}
   </append>
   <append condition="${workPlCd}.NOTEMPTY" id="#1"> 
		AND		a.work_pl_cd = ${workPlCd}
   </append>
   <append condition="${logisArCd}.NOTEMPTY" id="#1"> 
		AND		b.logis_ar_cd = ${logisArCd}
   </append>
   <append condition="${logisDomnCd}.NOTEMPTY" id="#1"> 
		AND		b.logis_domn_cd = ${logisDomnCd}
   </append>
   <append condition="${ordKindCd}.NOTEMPTY" id="#1"> 
		AND		b.ord_kind_cd = ${ordKindCd}
   </append>
   <append condition="${logisSvcSctnCd}.NOTEMPTY" id="#1"> 
		AND		b.logis_svc_sctn_cd = ${logisSvcSctnCd}
   </append>
   <append condition="${ordTypeCd}.NOTEMPTY" id="#1"> 
		AND		a.ord_type_cd = ${ordTypeCd}
   </append>
	</statement>
	
	<statement name="retrieveMdfDlySalesOrdListBasic">
	SELECT	/* retrieveMdfDlySalesOrdList.jsp 2007.10.22 */
		a.sales_ord_no, a.cust_ord_no, a.aptd_req_ymd,
		(SELECT ptn_nm FROM tb_ma01002 
		WHERE ptn_cd = a.ctrt_cust_cd) as entp_nm,
		(SELECT dept_nm FROM tb_ma01009 
		WHERE corp_cd = a.corp_cd 
		and dept_cd = a.ord_mngt_exce_dept_cd) as dept_nm,
		(SELECT ord_type_nm FROM tb_ma01006 
		WHERE ord_type_cd = a.ord_type_cd) as ord_type_nm,
		a.sales_ord_creat_ymd, 
		     case when a.dpt_ar_type_cd = '02' then
		    	(select name 
		    	from vw_ma01_01 
		    	where code = a.dpt_ar_cd 
		    	AND	  PTN_CD = a.RPT_CUST_CD
		    	and work_sctn_cd = a.dpt_ar_type_cd) 
			  else 	    	
		    	(select name 
		    	from vw_ma01_01 
		    	where code = a.dpt_ar_cd 
		    	and work_sctn_cd = a.dpt_ar_type_cd
		    	and rownum = 1) 
		      end  as dpt_ar_nm, 

		     case when a.arv_ar_type_cd = '02' then
		    	(select name 
		    	from vw_ma01_01 
		    	where code = a.arv_ar_cd 
		    	AND	  PTN_CD = a.RPT_CUST_CD
		    	and work_sctn_cd = a.arv_ar_type_cd) 
			  else 	    	
		    	(select name 
		    	from vw_ma01_01 
		    	where code = a.arv_ar_cd 
		    	and work_sctn_cd = a.arv_ar_type_cd
		    	and rownum = 1) 
		      end  as arv_ar_nm,
			(select WORK_PL_NM
			from TB_MA01005
			where WORK_PL_CD = a.work_pl_cd
			) as work_pl_nm,
		(SELECT user_nm FROM tb_ma01011 
		WHERE user_id = a.ord_mngt_fwd_ofcr_id) as fwd_nm,
		(SELECT user_nm FROM tb_ma01011 
		WHERE user_id = a.ord_mngt_exce_ofcr_id) as user_nm
		, mdf_dly_sctn_cd
		, (SELECT comn_cd_nm FROM tb_ma01015 
		   WHERE clas_cd = 'MDF_DLY_SCTN_CD' 
		   AND comn_cd = a.mdf_dly_sctn_cd) as mdf_dly_sctn_nm    		
	FROM	tb_om02011h a
   	WHERE	1=1
   	AND		a.mdf_dly_sctn_cd is not null
    AND     a.sales_ord_chg_seq = (select max(x.sales_ord_chg_seq)
	                               from tb_om02011h x
	                               where x.sales_ord_no = a.sales_ord_no)   	
   	{#1}
	<append condition="${salesOrdNo}.NOTEMPTY" id="#1"> 
	AND		a.sales_ord_no = ${salesOrdNo}
   	ORDER BY a.sales_ord_no desc
	</append>
	<append condition="${custOrdNo}.NOTEMPTY" id="#1"> 
	AND		a.cust_ord_no = ${custOrdNo}
   	ORDER BY a.cust_ord_no desc
	</append>
	</statement>	
	
	<statement name="retrieveMdfDlySalesOrdList">
	SELECT	/* retrieveMdfDlySalesOrdList.jsp 2007.10.22 */
		a.sales_ord_no, a.cust_ord_no, a.aptd_req_ymd,
		(SELECT ptn_nm FROM tb_ma01002 
		WHERE ptn_cd = a.ctrt_cust_cd) as entp_nm,
		(SELECT dept_nm FROM tb_ma01009 
		WHERE corp_cd = a.corp_cd 
		and dept_cd = a.ord_mngt_exce_dept_cd) as dept_nm,
		(SELECT ord_type_nm FROM tb_ma01006 
		WHERE ord_type_cd = a.ord_type_cd) as ord_type_nm,
		a.sales_ord_creat_ymd, a.sales_ord_stat_cd,
		(SELECT comn_cd_nm FROM tb_ma01015 
		WHERE clas_cd = 'ORD_STAT_CD' 
		AND comn_cd = a.sales_ord_stat_cd) as sales_ord_stat_nm,
		     case when a.dpt_ar_type_cd = '02' then
		    	(select name 
		    	from vw_ma01_01 
		    	where code = a.dpt_ar_cd 
		    	AND	  PTN_CD = a.RPT_CUST_CD
		    	and work_sctn_cd = a.dpt_ar_type_cd) 
			  else 	    	
		    	(select name 
		    	from vw_ma01_01 
		    	where code = a.dpt_ar_cd 
		    	and work_sctn_cd = a.dpt_ar_type_cd
		    	and rownum = 1) 
		      end  as dpt_ar_nm, 

		     case when a.arv_ar_type_cd = '02' then
		    	(select name 
		    	from vw_ma01_01 
		    	where code = a.arv_ar_cd 
		    	AND	  PTN_CD = a.RPT_CUST_CD
		    	and work_sctn_cd = a.arv_ar_type_cd) 
			  else 	    	
		    	(select name 
		    	from vw_ma01_01 
		    	where code = a.arv_ar_cd 
		    	and work_sctn_cd = a.arv_ar_type_cd
		    	and rownum = 1) 
		      end  as arv_ar_nm,
			(select WORK_PL_NM from TB_MA01005 
			where WORK_PL_CD = a.work_pl_cd) as work_pl_nm,
		(SELECT user_nm FROM tb_ma01011 
		WHERE user_id = a.ord_mngt_fwd_ofcr_id) as fwd_nm,
		(SELECT user_nm FROM tb_ma01011 
		WHERE user_id = a.ord_mngt_exce_ofcr_id) as user_nm
		, mdf_dly_sctn_cd
		, (SELECT comn_cd_nm FROM tb_ma01015 
		   WHERE clas_cd = 'MDF_DLY_SCTN_CD' 
		   AND comn_cd = a.mdf_dly_sctn_cd) as mdf_dly_sctn_nm  		
	FROM	tb_om02011h a,
			tb_ma01006  b
   	WHERE	a.ord_type_cd = b.ord_type_cd
    AND     a.sales_ord_chg_seq = (select max(x.sales_ord_chg_seq)
	                               from tb_om02011h x
	                               where x.sales_ord_no = a.sales_ord_no)   	
   	{#1}
   	ORDER BY a.sales_ord_no desc
	<append condition="${salesOrdCreatYmd}.NOTEMPTY" id="#1">
		AND		a.sales_ord_creat_ymd between ${startDate} and ${endDate}
	</append>
	<append condition="${aptdReqYmd}.NOTEMPTY" id="#1">
		AND		a.aptd_req_ymd between ${startDate} and ${endDate}
	</append>
	<append condition="${ordMngtExceDeptCd}.NOTEMPTY" id="#1"> 
		AND		a.ord_mngt_exce_dept_cd = lpad(${ordMngtExceDeptCd}, 10, '0')
	</append>
	<append condition="${ctrtCustCd}.NOTEMPTY" id="#1"> 
		AND		a.ctrt_cust_cd = ${ctrtCustCd}
	</append>
	<append condition="${salesOrdNo}.NOTEMPTY" id="#1"> 
		AND		a.sales_ord_no = ${salesOrdNo}
	</append>
	<append condition="${mdfDlySctnCd}.EMPTY" id="#1"> 
		AND		a.mdf_dly_sctn_cd is not null        
	</append>
	<append condition="${mdfDlySctnCd}.NOTEMPTY" id="#1"> 
		AND		a.mdf_dly_sctn_cd = ${mdfDlySctnCd}
	</append>
	<append condition="${ordMngtExceOfcrId}.NOTEMPTY" id="#1"> 
		AND		a.ord_mngt_exce_ofcr_id = ${ordMngtExceOfcrId}
	</append>
	<append condition="${dptArCd}.NOTEMPTY" id="#1"> 
		AND		a.dpt_ar_cd = ${dptArCd}
	</append>
	<append condition="${arvArCd}.NOTEMPTY" id="#1"> 
		AND		a.arv_ar_cd = ${arvArCd}
	</append>
	<append condition="${workPlCd}.NOTEMPTY" id="#1"> 
		AND		a.work_pl_cd = ${workPlCd}
	</append>
	<append condition="${logisArCd}.NOTEMPTY" id="#1"> 
		AND		b.logis_ar_cd = ${logisArCd}
	</append>
	<append condition="${logisDomnCd}.NOTEMPTY" id="#1"> 
		AND		b.logis_domn_cd = ${logisDomnCd}
	</append>
	<append condition="${ordKindCd}.NOTEMPTY" id="#1"> 
		AND		b.ord_kind_cd = ${ordKindCd}
	</append>
	<append condition="${logisSvcSctnCd}.NOTEMPTY" id="#1"> 
		AND		b.logis_svc_sctn_cd = ${logisSvcSctnCd}
	</append>
	<append condition="${ordTypeCd}.NOTEMPTY" id="#1"> 
		AND		a.ord_type_cd = ${ordTypeCd}
	</append>
	</statement>
	
  <statement name="retrieveExceptSalesOrdBasisInfo">
SELECT	/* manageExceptSalesOrd.jsp 2007.10.25 */
	a.sales_ord_no,a.corp_cd,
	a.sales_ord_stat_cd,
	macomm_getcd_fn('ORD_STAT_CD', a.sales_ord_stat_cd ) AS sales_ord_stat_nm,
	a.sales_ord_creat_ymd, a.sales_ord_creat_hms, 
	a.add_svc_type_cd,
	( select comn_cd_nm from tb_ma01015
	where clas_cd = 'ADD_SVC_TYPE_CD'
	and upper_clas_cd='LOGIS_SVC_SCTN_CD'
	and comn_cd = a.add_svc_type_cd ) as add_svc_type_nm,
	a.ctrt_no,
	a.ctrt_no ||' '|| ( select d.ctrt_nm
		from tb_sm04110 a, tb_sm07110 d
		where a.corp_cd = d.corp_cd
		and a.prmt_biz_no = d.prmt_biz_no
		and sell_ctrt_no = a.ctrt_no
	) as ctrt_nm,
	a.ctrt_cust_cd,
	( SELECT ptn_nm FROM TB_MA01002
	WHERE ptn_cd = a.ctrt_cust_cd ) AS ctrt_cust_nm,
   	a.ord_req_cust_cd,
	( SELECT ptn_nm FROM TB_MA01002
	WHERE ptn_cd = a.ord_req_cust_cd ) AS ord_req_cust_nm,
	a.cargo_form_cd,
	macomm_getcd_fn( 'CARGO_FORM_CD', cargo_form_cd) cargo_form_nm,
	a.sell_dcsn_sctn_cd,
--	( select comn_cd_nm from tb_ma01015
--	where clas_cd = 'SELL_DCSN_SCTN'
--	and comn_cd = sell_dcsn_sctn_cd ) as sell_dcsn_sctn_nm,
( select case when t.cnt > 0 then 'Y' else 'N' end 
    from (
           select count(sell_attr_cd) cnt 
           from tb_is01001 f 
           where f.sales_ord_no = ${salesOrdNo}
           AND   f.dcsn_sctn_cd > '1'
      ) t
  ) sell_dcsn_sctn_nm,

	a.ord_type_cd,
	( SELECT ord_type_nm FROM TB_MA01006
	WHERE ord_type_cd = a.ord_type_cd) as ord_type_nm,
	a.bilg_cust_cd,
	( SELECT ptn_nm FROM TB_MA01002
	WHERE ptn_cd = a.bilg_cust_cd ) AS bilg_cust_nm,
   	LTrim(a.sell_dept_cd, '0') as sell_dept_cd,
   	MACOMM_GETDEPTNM_FN( a.corp_cd, a.sell_dept_cd ) AS sell_dept_nm,
    a.sales_ofcr_id,
	MACOMM_GETUSERNM_FN( a.sales_ofcr_id ) AS sales_ofcr_nm,
	LTrim(a.ord_mngt_exce_dept_cd, '0') as ord_mngt_exce_dept_cd,
	MACOMM_GETDEPTNM_FN( a.corp_cd, a.ord_mngt_exce_dept_cd) AS ord_mngt_exce_dept_nm,
	a.ord_mngt_exce_ofcr_id,
	MACOMM_GETUSERNM_FN( a.ord_mngt_exce_ofcr_id ) AS ord_mngt_exce_ofcr_nm,
	a.work_pl_cd,
	( SELECT work_pl_nm FROM tb_ma01005
	where work_pl_cd = a.work_pl_cd ) as work_pl_nm,
	a.dpt_ar_cd,
	( SELECT work_pl_nm FROM tb_ma01005
	where work_pl_cd = a.dpt_ar_cd ) as dpt_ar_nm,
   	a.arv_ar_cd,
   	( SELECT work_pl_nm FROM tb_ma01005
   	where work_pl_cd = a.arv_ar_cd ) as arv_ar_nm,
   	a.sales_ord_cmpt_sctn_cd,
   	( select comn_cd_nm from tb_ma01015
	where clas_cd = 'SALES_ORD_CMPT_SCTN_CD'
	and comn_cd = a.sales_ord_cmpt_sctn_cd ) as sales_ord_cmpt_sctn_nm,
   	a.rmk, a.tran_eo_no, a.sales_ord_cncl_yn, a.regr_id, a.mdfr_id,
	to_char(a.sales_ord_cncl_date, 'yyyy/mm/dd hh24:mi:ss') as sales_ord_cncl_date,
	to_char(a.sales_ord_cmpt_date, 'yyyy/mm/dd hh24:mi:ss') as sales_ord_cmpt_date,
	to_char(a.reg_date, 'yyyy/mm/dd hh24:mi:ss') as reg_date,
	to_char(a.mdf_date, 'yyyy/mm/dd hh24:mi:ss') as mdf_date,
	'' temp, a.exp_imp_dom_sctn_cd,
	a.rpt_cust_cd,
	a.cust_cd, 
	a.ord_reason_cd ,
	a.ltrm_ord_yn ,
	a.line_sctn_cd 
FROM	tb_om02001 a
,		tb_ma01006 b
WHERE	1 = 1
and		a.ord_type_cd = b.ord_type_cd
and		b.except_ord_yn = 'Y' 
AND		a.sales_ord_no = ${salesOrdNo}
  </statement>		
  
  <statement name="retrieveExceptSalesOrdItemList">
SELECT	/* manageExceptSalesOrd.jsp 2007.11.13 */
	a.sales_ord_no, a.line_no, a.item_cd, a.cust_cd,
	MACOMM_GETCD_FN('CNTR_SIZ_TYP_SCTN', a.item_cd ) as item_nm,
	ord_qty,qty_unit_cd, a.ord_wgt,wgt_unit_cd, a.regr_id, a.mdfr_id
FROM	tb_om02002 a
WHERE	1 = 1
{#1}
   <append condition="${salesOrdNo}.NOTEMPTY" id="#1">
AND		a.sales_ord_no = ${salesOrdNo}
   </append>
  </statement>
  
 <statement name="ordTest">
	select	ord_type_cd as code, ord_type_nm as val,
				except_ord_yn, '23' logis_svc_sctn_cd
	from tb_ma01006
	order by ord_type_cd asc
  </statement>
  
  <statement name="ctrtTest">
	select	corp_cd as ctrt_no, sell_ctrt_no as ctrt_nm,
				prmt_biz_no as sell_dept_cd, ctrt_sctn_cd as bilg_nm,
				hansol_indgrp_cd as sales_ofcr_id
	from tb_sm04110
	where 1=1
	<![CDATA[ and rownum < 11 ]]>
  </statement>
	
	<statement name="retrieveTranEoNoCnt">
		select count(tran_eo_no) + 1 as trms_seq
		from tb_om03007i
		where tran_eo_no = ${tranEoNo}
	</statement>
	
	<statement name="retrieveOm03007iCnt">
		select count(tran_eo_no) + 1 as tran_eo_no_cnt
		from tb_om03007i
		where sales_ord_no = ${salesOrdNo}
	</statement>
	
	<statement name="retrieveSalesOrdHistoryCnt">
		SELECT nvl(max(sales_ord_chg_seq),0) + 1 as cnt
		FROM TB_OM02011H
		where sales_ord_no = ${salesOrdNo}
	</statement>
	
	<statement name="retrieveTbOm04001">
		select rslt_sctn_cd
		from tb_om04001
		where sales_ord_no = ${salesOrdNo}
	</statement>
	
	<statement name="retrieveTbOm04002">
		select max(rslt_sctn_cd) rslt_sctn_cd
		from tb_om04002
		where sales_ord_no = ${salesOrdNo}
	</statement>
	
	<statement name="retrieveTbOm03015">
		select count(a.sales_ord_no) as cnt
		from   tb_om03015 a
		     , tb_om03001 b
		where  a.sales_ord_no = ${salesOrdNo}
		AND    a.sales_ord_no = b.sales_ord_no
		AND    a.work_route_seq = b.work_route_seq
		AND    b.del_yn = 'N'
	</statement>

	<statement name="retrieveTbOm03016">
		select count(a.sales_ord_no) as cnt
		from   tb_om03016 a
		     , tb_om03001 b
		where  a.sales_ord_no = ${salesOrdNo}
		AND    a.sales_ord_no = b.sales_ord_no
		AND    a.work_route_seq = b.work_route_seq
		AND    b.del_yn = 'N'
	</statement>
	
	<statement name="retrieveTbOm02001">
		select tran_eo_no
		from tb_om02001
		where sales_ord_no = ${salesOrdNo}
	</statement>
	
	<statement name="retrieveTbOm02003">
		select FWD_EO_NO
		from tb_om02003
		where sales_ord_no = ${salesOrdNo}
	</statement>
	
	<statement name="retrieveTbOm02019">
		select FWD_EO_NO
		from tb_om02019
		where sales_ord_no = ${salesOrdNo}
	</statement>
	
	<statement name="retrieveCustCdMpngOrdTypeCd">
		SELECT ORD_TYPE_CD
		FROM (
		      SELECT ORD_TYPE_CD
		            ,DECODE(SELF_TRAN_YN  , '', 1, 'N', 2, 3) SELF_TRAN_LVL		      
		            ,DECODE(DPT_AR_CD     , '', 2, 1) DPT_LVL
		            ,DECODE(ARV_AR_CD     , '', 2, 1) ARV_LVL
		            ,DECODE(EXP_SCTN_CD   , '', 2, 1) EXP_LVL		            
		            ,DECODE(SELF_GDS_CD   , '', 2, 1) GDS_LVL		            		            
		            ,DECODE(CARGO_FORM_CD , '', 2, 1) CARGO_LVL		            		            		            
		      FROM TB_OM02102
		      WHERE 1=1
		      AND   CUST_CD = ${custCd}
			  {#1}
		      ORDER BY 2, 3, 4, 5, 6, 7
		     )
		WHERE ROWNUM = 1  
		<append condition="${custOrdTypeCd}.NOTEMPTY" id="#1">
		AND   CUST_ORD_TYPE_CD  = ${custOrdTypeCd}
		</append>
		<append condition="${custMoveTypeCd}.NOTEMPTY" id="#1">
		AND   CUST_MOVE_TYPE_CD = ${custMoveTypeCd}
		</append>
	    <append condition="${dptArCd}.NOTEMPTY" id="#1">			  
	    AND   (DPT_AR_CD IS NULL OR DPT_AR_CD = ${dptArCd})
	    </append>		      
		<append condition="${arvArCd}.NOTEMPTY" id="#1">
	    AND   (ARV_AR_CD IS NULL OR ARV_AR_CD = ${arvArCd})
		</append>
		<append condition="${selfTranYn}.NOTEMPTY" id="#1">
		AND   (SELF_TRAN_YN IS NULL OR SELF_TRAN_YN = ${selfTranYn})
		</append>			
		<append condition="${expSctnCd}.NOTEMPTY" id="#1">
		AND   (EXP_SCTN_CD IS NULL OR EXP_SCTN_CD = ${expSctnCd})
		</append>		
		<append condition="${selfGdsCd}.NOTEMPTY" id="#1">
		AND   (SELF_GDS_CD IS NULL OR SELF_GDS_CD = ${selfGdsCd})
		</append>							         
		<append condition="${cargoFormCd}.NOTEMPTY" id="#1">
		AND   (CARGO_FORM_CD IS NULL OR CARGO_FORM_CD = ${cargoFormCd})
		</append>							         
	</statement>

	<statement name="retrieveDptArvUseYn">
        select CUST_CD,CUST_ORD_TYPE_CD,CUST_MOVE_TYPE_CD
              ,max(dpt_ar_cd) dpt_ar_cd_yn
              ,max(arv_ar_cd) arv_ar_cd_yn
          from tb_om02102
         where cust_cd= ${custCd}
			  {#1}{#2}
         group by CUST_CD,CUST_ORD_TYPE_CD,CUST_MOVE_TYPE_CD
         order by CUST_ORD_TYPE_CD,CUST_MOVE_TYPE_CD
		<append condition="${custOrdTypeCd}.NOTEMPTY" id="#1">
		   AND CUST_ORD_TYPE_CD  = ${custOrdTypeCd}
		</append>
		<append condition="${custMoveTypeCd}.NOTEMPTY" id="#2">
		   AND CUST_MOVE_TYPE_CD = ${custMoveTypeCd}
		</append>

	</statement>

	<statement name="retrieveMoveDptArvUseYn">
        select CUST_CD,CUST_ORD_TYPE_CD,CUST_MOVE_TYPE_CD
              ,max(col04) dpt_ar_cd_yn
              ,max(col05) arv_ar_cd_yn
          from tb_om02104
         where cust_cd= ${custCd}
			  {#1}{#2}
         group by CUST_CD,CUST_ORD_TYPE_CD,CUST_MOVE_TYPE_CD
         order by CUST_ORD_TYPE_CD,CUST_MOVE_TYPE_CD
		<append condition="${custOrdTypeCd}.NOTEMPTY" id="#1">
		   AND CUST_ORD_TYPE_CD  = ${custOrdTypeCd}
		</append>
		<append condition="${custMoveTypeCd}.NOTEMPTY" id="#2">
		   AND CUST_MOVE_TYPE_CD = ${custMoveTypeCd}
		</append>

	</statement>


	<statement name="getGiGrTypeCd">
        select  PTN_CD,CUST_PTN_CD,COL05,COL06 
                {#2}
          from tb_ma02020
         where ptn_cd= ${custCd}
			  {#1}
        <append condition="${dptArCd}.NOTEMPTY" id="#1">
		   AND cust_ptn_cd  = ${dptArCd}
		</append>
		<append condition="${arvArCd}.NOTEMPTY" id="#1">
		   AND cust_ptn_cd = ${arvArCd}
		</append>

        <append condition="${dptArCd}.NOTEMPTY" id="#2">
		   ,col05 col
		</append>
		<append condition="${arvArCd}.NOTEMPTY" id="#2">
		   ,col06 col
		</append>

	</statement>

	<statement name="getGrTypeCd">
        select  PTN_CD,CUST_PTN_CD,COL05
          from tb_ma02020
         where ptn_cd= ${custCd}
			  {#1}
        <append condition="${dptArCd}.NOTEMPTY" id="#1">
		   AND cust_ptn_cd  = ${dptArCd}
		</append>
	</statement>

	<statement name="getGiTypeCd">
        select  PTN_CD,CUST_PTN_CD,COL06
          from tb_ma02020
         where ptn_cd= ${custCd}
			  {#1}
        <append condition="${arvArCd}.NOTEMPTY" id="#1">
		   AND cust_ptn_cd  = ${arvArCd}
		</append>
	</statement>

	<statement name="getEveOrdTypeCd">
       select CUST_ORD_TYPE_CD,CUST_MOVE_TYPE_CD,COL,ORD_TYPE_CD,COL01,COL02 
         from (
                select CUST_CD,CUST_ORD_TYPE_CD,CUST_MOVE_TYPE_CD
                      ,decode(DPT_AR_CD,'N',decode(ARV_AR_CD,'N','','Y',col02)
                                       ,'Y',decode(ARV_AR_CD,'N',col01,'Y','')) col
                      ,dpt_ar_cd
                      ,ARV_AR_CD,ORD_TYPE_CD,COL01,COL02 
                  from tb_om02102 
                 where cust_cd= ${custCd}
               )
          where 1=1
             {#1}{#2}{#3}
        <append condition="${custOrdTypeCd}.NOTEMPTY" id="#1">
		    AND cust_ord_type_cd  = ${custOrdTypeCd}
		</append>
		<append condition="${custMoveTypeCd}.NOTEMPTY" id="#2">
		    AND cust_move_type_cd = ${custMoveTypeCd}
		</append>
        <append condition="${col}.NOTEMPTY" id="#3">
		    and col = ${col}
		</append>
       <append condition="${col05Value}.NOTEMPTY" id="#3">
		    and col01 = ${col05Value}
		</append>		
       <append condition="${col06Value}.NOTEMPTY" id="#3">
		    and col02 = ${col06Value}
		</append>
	</statement>

	<statement name="getEveMoveTypeCd">
      select CUST_ORD_TYPE_CD,CUST_MOVE_TYPE_CD,COL,MOVE_TYPE_CD
            ,COL01,COL02,COL03,COL04,COL05,trans_yn 
         from (
                select CUST_CD,CUST_ORD_TYPE_CD,CUST_MOVE_TYPE_CD
                      ,case when col04 = 'Y' then col01
                            when col05 = 'Y' then col02
                            else ''
                       end  col
                      ,col04
                      ,col05,MOVE_TYPE_CD,COL01,COL02,COL03 
                      ,decode(col03,'','N','Y') trans_yn
                  from tb_om02104 
                 where cust_cd= ${custCd}
               )
          where 1=1
          {#1}{#2}{#3}{#4}{#5}
        <append condition="${custOrdTypeCd}.NOTEMPTY" id="#1">
		    AND cust_ord_type_cd  = ${custOrdTypeCd}
		</append>
		<append condition="${custMoveTypeCd}.NOTEMPTY" id="#2">
		    AND cust_move_type_cd = ${custMoveTypeCd}
		</append>
        <append condition="${col}.NOTEMPTY" id="#3">
		    and col = ${col}
		</append>
       <append condition="${col05Value}.NOTEMPTY" id="#3">
		    and col01 = ${col05Value}
		</append>		
       <append condition="${col06Value}.NOTEMPTY" id="#3">
		    and col02 = ${col06Value}
		</append>		
       <append condition="${transValue}.NOTEMPTY" id="#4">
		    and col03 = ${transValue}
		</append>
		<append condition="${moveType}.NOTEMPTY" id="#5">
			AND  MOVE_TYPE_CD LIKE ${moveType} || '%'
		</append>	

	</statement>

	<statement name="getEveTransYn">
		select cust_ord_type_cd, cust_move_type_cd , max(trans_yn) trans_yn
  		from (
         		select cust_ord_type_cd, cust_move_type_cd
               		  ,decode(col03,'','N','Y') trans_yn
           		  from tb_om02104 
          		  where cust_cd= ${custCd}
         		  {#1}{#2}
          		  group by cust_ord_type_cd, cust_move_type_cd,col03
        	 )
 		group by cust_ord_type_cd, cust_move_type_cd
 		order by cust_ord_type_cd, cust_move_type_cd

        <append condition="${custOrdTypeCd}.NOTEMPTY" id="#1">
		    AND cust_ord_type_cd  = ${custOrdTypeCd}
		</append>
		<append condition="${custMoveTypeCd}.NOTEMPTY" id="#2">
		    AND cust_move_type_cd = ${custMoveTypeCd}
		</append>
 
	</statement>

	
	<statement name="retrieveSalesOrdMdfHistList">	
  	SELECT /* retrieveSalesOrdMdfHist.jsp 2007.12.12 */
		a.sales_ord_no 	
		, a.sales_ord_chg_seq
		, a.cust_ord_no 	
		, a.ord_type_cd 	
		, b.ord_type_nm	
		, a.ctrt_cust_cd  
		, MACOMM_GETPTNNM_FN(a.ctrt_cust_cd ) AS ctrt_cust_nm	
		, a.ctrt_no 			
	    , ( SELECT y.ctrt_nm
			FROM   tb_sm04110 x, tb_sm07110 y
			WHERE  x.corp_cd 	 = y.corp_cd
			AND	   x.prmt_biz_no = y.prmt_biz_no
			AND    x.cust_cd 	 = a.ctrt_cust_cd
			AND    x.sell_ctrt_no = a.ctrt_no) as ctrt_nm
		, a.cust_move_type_cd 			                                                       --고객이동유형코드
		, a.sales_ord_stat_cd 
		, MACOMM_GETCD_FN('ORD_STAT_CD', a.sales_ord_stat_cd ) AS sales_ord_stat_nm 
		, LTrim(a.ord_mngt_exce_dept_cd, '0') as ord_mngt_exce_dept_cd 				
		, MACOMM_GETDEPTNM_FN(a.corp_cd, a.ord_mngt_exce_dept_cd) AS ord_mngt_exce_dept_nm 
		, a.ord_mngt_exce_ofcr_id 
		, MACOMM_GETUSERNM_FN( a.ord_mngt_exce_ofcr_id ) AS ord_mngt_exce_ofcr_nm 
		, a.back_ord_yn 				
		, a.cust_expr_yn 				
		, a.cls_expr_yn 				
		, a.lead_time_expr_yn 		
		, a.LTRM_ORD_YN			
		, a.dpt_ar_cd 				
	    , (select name 
	    	from vw_ma01_01 
	    	where code         = a.dpt_ar_cd 
	    	and	  (ptn_cd is null or ptn_cd       = (SELECT RPT_CUST_CD 
                                  FROM TB_OM02001 
                                  WHERE SALES_ORD_NO = A.SALES_ORD_NO))
	    	and   work_sctn_cd = a.dpt_ar_type_cd)  DPT_AR_NM
		, a.dpt_ar_zip_cd 			
		, a.dpt_ar_zip_addr||' '||a.dpt_ar_dtl_addr as dpt_ar_addr 			
		, a.dpt_ar_ofcr_nm 			
		, a.dpt_ar_ofcr_tel_no 		
		, a.arv_ar_cd 				
	    , (select name 
	    	from vw_ma01_01 
	    	where code         = a.arv_ar_cd 
	    	and	  (ptn_cd is null or ptn_cd       = (SELECT RPT_CUST_CD 
                                  FROM TB_OM02001 
                                  WHERE SALES_ORD_NO = A.SALES_ORD_NO))
	    	and   work_sctn_cd = a.arv_ar_type_cd)  ARV_AR_NM
		, a.arv_ar_zip_cd 			
		, a.arv_ar_zip_addr||' '||a.arv_ar_dtl_addr as arv_ar_addr 			
		, a.arv_ar_ofcr_nm 			
		, a.arv_ar_ofcr_tel_no 		
		, a.strt_req_ymd||a.strt_req_hm as strt_req_ymd_hm				
		, a.aptd_req_ymd||a.aptd_req_hm as aptd_req_ymd_hm 				
		, LTrim(a.sell_dept_cd, '0') as sell_dept_cd 							
		, MACOMM_GETDEPTNM_FN( a.corp_cd, a.sell_dept_cd ) AS sell_dept_nm 	
		, a.sales_ofcr_id 			
		, MACOMM_GETUSERNM_FN( a.sales_ofcr_id ) AS sales_ofcr_nm 			
		, a.bilg_cust_cd 				
		, MACOMM_GETPTNNM_FN( a.bilg_cust_cd ) AS bilg_cust_nm 				
		, a.sell_dcsn_sctn_cd 		
		, ( select comn_cd_nm from tb_ma01015
			where clas_cd = 'SELL_DCSN_SCTN'
			and comn_cd = a.sell_dcsn_sctn_cd ) as sell_dcsn_sctn_nm	
		, a.cust_ord_type_cd 			
		, MACOMM_GETCD_FN( 'CUST_ORD_TYPE_CD', a.cust_ord_type_cd) as cust_ord_type_nm 
		, a.cust_ord_recp_date 		
		, a.cust_ord_recp_chn_cd 	
		, MACOMM_GETCD_FN( 'CUST_ORD_RECP_CHN_CD', a.cust_ord_recp_chn_cd) as cust_ord_recp_chn_nm	
		, a.ord_req_cust_cd 			
		, MACOMM_GETPTNNM_FN( a.ord_req_cust_cd) as ord_req_cust_nm			
		, a.cust_ofcr_nm 				
		, a.cust_ofcr_tel_no 			
		, a.rmk 						
		, a.cust_ref_no 				
		, a.cust_of_cust_cd 			
		, ( SELECT cust_nm 
			from   tb_ma02020 
			where  ptn_cd = a.rpt_cust_cd 
			and    cust_ptn_cd =	a.cust_of_cust_cd ) as cust_of_cust_nm		
		, a.sup_pl_cd 				
		, ( SELECT cust_nm 
			from   tb_ma02020 
			where  ptn_cd = a.rpt_cust_cd 
			and    cust_ptn_cd = a.sup_pl_cd ) as sup_pl_nm		
		, a.sales_ord_creat_ymd||a.sales_ord_creat_hms as sales_ord_creat_ymd_hms		
		, to_char(a.sales_ord_cncl_date, 'yyyymmdd')||to_char(a.sales_ord_cncl_date, 'hh24mi') as sales_ord_cncl_ymd_hm	
		, to_char(a.sales_ord_cmpt_date, 'yyyymmdd')||to_char(a.sales_ord_cmpt_date, 'hh24mi') as sales_ord_cmpt_ymd_hm	
		, a.sales_ord_cmpt_sctn_cd 	
		, MACOMM_GETCD_FN( 'SALES_ORD_CMPT_SCTN_CD', a.sales_ord_cmpt_sctn_cd) as sales_ord_cmpt_sctn_nm
		, a.SALES_ORD_CNCL_REASON		
		, a.ORD_REASON_CD				
		, IDUSR.OMCOMM_GETCUSTREASONNM_FN(a.rpt_cust_cd, a.ord_reason_cd) ORD_REASON_NM
		, a.RLTD_GI_ORD_NO			
		, a.aft_ord_yn				
		, b.logis_svc_sctn_cd		
		, (SELECT upper_comn_cd
	 	   FROM   Tb_Ma01015
	 	   WHERE  clas_cd = 'LOGIS_AR_CD'
	 	   AND    comn_cd = b.logis_ar_cd)	AS exp_imp_dom_sctn_cd  				
		, a.work_info_mngt_type_cd 	
		, a.load_dly_yn
		, a.load_dly_rltd_sales_ord_no
		, A.MOVE_TYPE_CD	
		, (select comn_cd_nm from tb_ma01015 where clas_cd = 'MOVE_TYPE_CD' and comn_cd = a.move_type_cd) move_type_nm
		, MACOMM_GETCD_FN('APTD_DLY_CD', a.aptd_dly_cd) APTD_DLY_NM	
		, a.sales_ord_mdf_reason	
  	FROM	TB_OM02011H A
  		  , TB_MA01006 B
  	WHERE	A.ord_type_cd = B.ord_type_cd
  	{#1}
  	ORDER BY A.SALES_ORD_CHG_SEQ DESC
    <append condition="${salesOrdNo}.NOTEMPTY" id="#1">
    AND SALES_ORD_NO  = ${salesOrdNo}
    </append>
	</statement>
	
	<statement name="retrieveSalesOrdItemHistLIst">
  	SELECT /* retrieveSalesOrdMdfHist.jsp 2007.12.12 */
	      a.sales_ord_no
		, a.sales_ord_chg_seq
	    , a.line_no 
	    , a.item_cd 
	    , b.item_nm
	    , decode(a.item_grade_cd, '', d.grade_cd, a.item_grade_cd) item_grade_cd 
	    , a.bat_no 
	    , a.ord_qty 
	    , a.ord_qty as org_ord_qty
	    , 0 as read_only_qty
	    , a.qty_unit_cd 
	    , a.ord_wgt 
	    , a.ord_wgt as org_ord_wgt
	    , 0 as read_only_wgt
	    , a.wgt_unit_cd 
	    , a.ord_cbm 
	    , a.ord_cbm as org_ord_cbm
	    , 0 as read_only_cbm
	    , a.ord_reason_cd
		, IDUSR.OMCOMM_GETCUSTREASONNM_FN(c.rpt_cust_cd, a.ord_reason_cd) AS ord_reason_nm
	    , a.dpt_ar_cd 
	    , (select name 
	    	from vw_ma01_01 
	    	where code         = a.dpt_ar_cd 
	    	and	  (ptn_cd is null or ptn_cd       = (SELECT RPT_CUST_CD 
					                                  FROM TB_OM02001 
					                                  WHERE SALES_ORD_NO = A.SALES_ORD_NO))
	    	and   work_sctn_cd = a.dpt_ar_type_cd)  DPT_AR_NM

	    , a.dpt_ar_zip_cd 
	    , a.dpt_ar_zip_addr 
	    , a.dpt_ar_dtl_addr 
	    , a.dpt_ar_ofcr_nm 
	    , a.dpt_ar_ofcr_tel_no 
	    , a.arv_ar_cd 
	    , (select name 
	    	from vw_ma01_01 
	    	where code         = a.arv_ar_cd 
	    	and	  (ptn_cd is null or ptn_cd       = (SELECT RPT_CUST_CD 
					                                  FROM TB_OM02001 
					                                  WHERE SALES_ORD_NO = A.SALES_ORD_NO))
	    	and   work_sctn_cd = a.arv_ar_type_cd)  ARV_AR_NM
	    , a.arv_ar_zip_cd 
	    , a.arv_ar_zip_addr 
	    , a.arv_ar_dtl_addr 
	    , a.arv_ar_ofcr_nm 
	    , a.arv_ar_ofcr_tel_no 
	    , a.strt_req_ymd 
	    , a.strt_req_hm 
	    , a.aptd_req_ymd 
	    , a.aptd_req_hm 
	    , a.mnf_no 
	    , a.lot_no 
	    , a.prdt_req_no 
	    , a.prdt_prar_ymd 
	    , a.sales_uprice 
	    , a.cust_ref_no  
	    , decode(a.pcul_cd, '', d.pcul_cd, a.pcul_cd) pcul_cd 
	    , decode(a.mn_cd  , '', d.mn_cd  , a.mn_cd  ) mn_cd 	    		
		, a.plant_cd
		, (select comn_cd_nm
		   from tb_ma01015
		   where clas_cd = 'PLANT_CD'
		   and   comn_cd = a.plant_cd) plant_nm		
		, a.pallet_qty
		, a.rmk
		, a.del_yn
	FROM  TB_OM02012H A
	    , TB_MA02010  B
	    , TB_OM02011H C
	    , TB_MA02011  D
	WHERE A.cust_cd = B.Ptn_Cd
	AND   A.item_cd = B.Item_Cd
	AND   A.Sales_Ord_No = C.Sales_Ord_No
	AND   A.SALES_ORD_CHG_SEQ = C.SALES_ORD_CHG_SEQ
	AND   A.CUST_CD = D.PTN_CD(+)
	AND   A.ITEM_CD = D.ITEM_CD(+)
	AND   A.BAT_NO  = D.CUST_BAT_NO(+)
  	{#1}
  	ORDER BY to_number(A.LINE_NO), A.SALES_ORD_CHG_SEQ DESC
    <append condition="${salesOrdNo}.NOTEMPTY" id="#1">
    AND   A.SALES_ORD_NO  = ${salesOrdNo}
    </append>
	</statement>
	
	<statement name="retrieveSalesOrdMdfHistComboList">	
	SELECT sales_ord_no
	      ,code
	      ,val
	FROM (
	      SELECT sales_ord_no
	            ,code
	            ,val
	            ,case when mdf_dly_sctn_cd is not null and
	                       code > max_chg_seq then 'N'
	                  else 'Y' end chk
	      FROM (
	          SELECT                                              
	            a.sales_ord_no 	                            
	          , a.sales_ord_chg_seq as code                       
	          , a.sales_ord_chg_seq as val                        
	          , (select mdf_dly_sctn_cd
	             from tb_om02011h
	             where sales_ord_no      = ${salesOrdNo}
	             and   sales_ord_chg_seq = (select max(x.sales_ord_chg_seq)
	                                        from tb_om02011h x
	                                        where x.sales_ord_no = ${salesOrdNo})) mdf_dly_sctn_cd
	          , (select max(x.sales_ord_chg_seq)
	             from tb_om02011h x
	             where x.sales_ord_no = ${salesOrdNo}
	             and   x.mdf_dly_sctn_cd is null) max_chg_seq
	          FROM	TB_OM02011H A                               
	          WHERE	1 = 1                                       
	          AND SALES_ORD_NO  = ${salesOrdNo}                    
	      )
	)
	WHERE CHK = 'Y'
	ORDER BY CODE DESC                   
	</statement>

  <statement name="retrieveDomSalesOrdExceHist">
  <![CDATA[
  	SELECT 
			  a.sales_ord_no 	                          --판매오더번호
			, a.corp_cd
			, a.rpt_cust_cd
			, a.ord_type_cd 	                          --오더유형코드
			, b.ord_type_nm	                            --오더유형명
			, a.add_svc_type_cd
			, b.logis_svc_sctn_cd			                  --물류서비스구분코드
			, ( SELECT upper_comn_cd
			    FROM   Tb_Ma01015
			    WHERE  clas_cd = 'LOGIS_AR_CD'
			    AND    comn_cd = b.logis_ar_cd)	AS exp_imp_dom_sctn_cd  				               --수출입내수구분코드
			, a.cargo_form_cd
			, LTrim(a.ord_mngt_exce_dept_cd, '0') as ord_mngt_exce_dept_cd 				             --오더관리실행부서코드
			, MACOMM_GETDEPTNM_FN(a.corp_cd, a.ord_mngt_exce_dept_cd) AS ord_mngt_exce_dept_nm --오더관리실행부서명
			, a.ord_mngt_fwd_dept_cd
			, a.ord_mngt_exce_ofcr_id                                                          --오더관리실행담당자아이디
			, MACOMM_GETUSERNM_FN( a.ord_mngt_exce_ofcr_id ) AS ord_mngt_exce_ofcr_nm          --오더관리실행담당자명
			, a.ord_mngt_fwd_ofcr_id
			, a.tran_plan_cntr_cd
			, a.sales_ord_stat_cd                                                              --판매오더상태코드
			, MACOMM_GETCD_FN('ORD_STAT_CD', a.sales_ord_stat_cd ) AS sales_ord_stat_nm        --판매오더상태명
			, a.cust_ord_no 	                                                                 --고객오더번호
			, a.cust_cd
			, a.cust_ord_type_cd 			                                                         --고객오더유형코드
			, case when a.rpt_cust_cd='R1209' OR a.rpt_cust_cd='R1728' then
			    MACOMM_GETCD_FN( 'EVE_CUST_ORD_TYPE_CD', a.cust_ord_type_cd) 			
			  else 
			    MACOMM_GETCD_FN( 'CUST_ORD_TYPE_CD', a.cust_ord_type_cd) 
              end cust_ord_type_nm     --고객오더유형명
			, a.cust_move_type_cd 			                                                       --고객이동유형코드
			, to_char(a.cust_ord_recp_date, 'YYYYMMDD') as cust_ord_recp_ymd		               --고객오더접수일시
			, to_char(a.cust_ord_recp_date, 'HH24MI') as cust_ord_recp_hm		                 --고객오더접수일시
			, a.cust_ord_recp_chn_cd 	                                                         --고객오더접수채널코드
			, MACOMM_GETCD_FN( 'CUST_ORD_RECP_CHN_CD', a.cust_ord_recp_chn_cd) as cust_ord_recp_chn_nm	--고객오더접수채널명
			, a.ctrt_cust_cd                                                                            --계약고객코드
			, MACOMM_GETPTNNM_FN(a.ctrt_cust_cd ) AS ctrt_cust_nm	                                      --계약고객명
			, a.ctrt_no 			                                                                          --계약번호
			, ( SELECT y.ctrt_nm
			    FROM   tb_sm04110 x
			         , tb_sm07110 y
			    WHERE  x.corp_cd 	    = y.corp_cd
			    AND	   x.prmt_biz_no  = y.prmt_biz_no
			    AND    x.cust_cd 	    = a.ctrt_cust_cd
			    AND    x.sell_ctrt_no = a.ctrt_no) as ctrt_nm
			, a.ord_req_cust_cd 			                                                                  --오더요청고객코드
			, MACOMM_GETPTNNM_FN( a.ord_req_cust_cd) as ord_req_cust_nm			                            --오더요청고객명
			, a.bilg_cust_cd 				                                                                    --청구고객코드
			, MACOMM_GETPTNNM_FN( a.bilg_cust_cd ) AS bilg_cust_nm 				                              --청구고객명
			, a.cust_ofcr_nm 				                                                                    --고객담당자명
			, a.cust_ofcr_tel_no 			                                                                  --고객담당자전화번호
			, a.cust_of_cust_cd 			                                                                  --고객거래선코드
			, ( SELECT cust_nm 
			    from   tb_ma02020 
			    where  ptn_cd = ( select upper_ptn_cd 
			                      from   tb_ma01002 
			                      where  ptn_cd      = a.ctrt_cust_cd) 
			    and    cust_ptn_cd =	a.cust_of_cust_cd ) as cust_of_cust_nm		                        --고객거래선명
			, a.sup_pl_cd 				                                                                      --공급지코드
			, ( SELECT cust_nm 
			    from   tb_ma02020 
			    where  ptn_cd = ( select upper_ptn_cd 
			                      from   tb_ma01002 
			                      where  ptn_cd = a.ctrt_cust_cd) 
			    and    cust_ptn_cd = a.sup_pl_cd ) as sup_pl_nm		                                      --공급지명
			, a.plant_cd
			, a.cust_ref_no 				                                                                    --고객참조번호
			, a.dpt_ar_cd 				                                                                      --출발지코드
			, a.dpt_ar_type_cd 				                                                                  --출발지코드
			, case when a.dpt_ar_type_cd = '02' then
			          ( select name 
			            from   vw_ma01_01 
			            where  code         = a.dpt_ar_cd 
			            AND	   PTN_CD       = A.RPT_CUST_CD
			            and    work_sctn_cd = a.dpt_ar_type_cd) 
			       else 
			          ( select name 
			            from   vw_ma01_01 
			            where  code         = a.dpt_ar_cd 
			            and    work_sctn_cd = a.dpt_ar_type_cd
			            and    rownum       = 1) 
			  end as dpt_AR_NM   
			, a.dpt_ar_zip_cd 			                                                                    --출발지우편번호
			, a.dpt_ar_zip_addr 			                                                                  --출발지우편주소
			, a.dpt_ar_dtl_addr 			                                                                  --출발지상세주소
			, a.dpt_ar_ofcr_nm 			                                                                    --출발지 담당자명
			, a.dpt_ar_ofcr_tel_no 		                                                                  --출발지 전화번호
			, a.arv_ar_cd 				                                                                      --도착지 코드
			, a.arv_ar_type_cd 				                                                                  --도착지 코드
			, CASE WHEN a.arv_ar_type_cd = '02' THEN
			          ( select name 
			            from   vw_ma01_01 
			            where  code         = a.arv_ar_cd 
			            AND	   PTN_CD       = A.RPT_CUST_CD
			            and    work_sctn_cd = a.arv_ar_type_cd) 
			      ELSE 
			          ( select name 
			            from   vw_ma01_01 
			            where  code         = a.arv_ar_cd 
			            and    work_sctn_cd = a.arv_ar_type_cd
			            and    rownum       = 1) 
			  END as ARV_AR_NM   
			, a.arv_ar_zip_cd 			                                                                    --도착지우편번호
			, a.arv_ar_zip_addr 			                                                                  --도착지우편주소
			, a.arv_ar_dtl_addr 			                                                                  --도착지상세주소
			, a.arv_ar_ofcr_nm 			                                                                    --도착지담당자명
			, a.arv_ar_ofcr_tel_no 		                                                                  --도착지전화번호
			, a.work_pl_cd
			, a.strt_req_ymd 				                                                                    --시작요청일자
			, a.strt_req_hm 				                                                                    --시작요청시간
			, a.aptd_req_ymd 				                                                                    --납기요청일자
			, a.aptd_req_hm 				                                                                    --납기요청시간
			, LTrim(a.sell_dept_cd, '0') as sell_dept_cd 							                                  --매출부서코드
			, MACOMM_GETDEPTNM_FN( a.corp_cd, a.sell_dept_cd ) AS sell_dept_nm 	                        --매출부서명
			, a.sales_ofcr_id 			                                                                    --영업사원아이디
			, MACOMM_GETUSERNM_FN( a.sales_ofcr_id ) AS sales_ofcr_nm 			                            --영업사원명
			, a.sell_dcsn_sctn_cd 		                                                                        --매출확정구분코드
			, DECODE( (SELECT COUNT(sales_ord_no) 
			           FROM   tb_om03001 
			           WHERE  SALES_ORD_NO = A.SALES_ORD_NO), 0, '1'
			                  , decode((SELECT  COUNT(*)
			                            FROM	  TB_OM03001
			                            WHERE   SALES_ORD_NO = A.SALES_ORD_NO
			                            AND	    to_number(NVL(sell_dcsn_sctn_cd, 0)) < 2), 0, '2', '1') ) as sell_dcsn_sctn_nm	--매출확정구분명
			, a.cust_expr_yn 				                                                                    --고객긴급여부
			, a.cls_expr_yn 				                                                                    --마감긴급여부
			, a.lead_time_expr_yn 		                                                                  --리드타임긴급여부
			, a.dtod_yn      
			, a.rmk 						                                                                        --비고
			, a.load_dly_yn
			, a.load_dly_rltd_sales_ord_no
			, a.back_ord_yn 				                                                                    --대기오더여부
			, a.aft_ord_yn				                                                                      --사후오더여부
			, a.chg_aptd_ymd
			, a.chg_aptd_hm
			, a.sales_ord_creat_ymd 		                                                                --판매오더생성일자
			, a.sales_ord_creat_hms 		                                                                --판매오더생성시간
			, a.sales_ord_cncl_yn
			, to_char(a.sales_ord_cncl_date, 'yyyymmdd') as sales_ord_cncl_ymd		                      --판매오더취소일시
			, to_char(a.sales_ord_cncl_date, 'hh24miss') as sales_ord_cncl_Hms		                      --판매오더취소일시
			, a.SALES_ORD_CNCL_REASON		                                                                --판매오더취소사유
			, a.sales_ord_cmpt_sctn_cd 	                                                                --판매오더완료구분코드
			, MACOMM_GETCD_FN( 'SALES_ORD_CMPT_SCTN_CD', a.sales_ord_cmpt_sctn_cd) as sales_ord_cmpt_sctn_nm	--판매오더완료구분명
			, to_char(a.sales_ord_cmpt_date, 'yyyymmdd') as sales_ord_cmpt_ymd		                            --판매오더완료일시
			, to_char(a.sales_ord_cmpt_date, 'hh24miss') as sales_ord_cmpt_Hms		                            --판매오더완료일시
			, a.ORD_REASON_CD				                                                                          --오더사유
			, MACOMM_GETCD_FN('ORD_REASON_CD', a.ORD_REASON_CD) as ORD_REASON_CD      
			, a.RLTD_GI_ORD_NO			                                                                          --관련출고오더번호
			, a.work_info_mngt_type_cd 	                                                                      --작업정보관리유형코드
			, a.if_id
			, a.tran_eo_no
			, a.LTRM_ORD_YN				                                                                            --장기오더여부
			, a.rltd_gi_eo_no
			, DECODE( ( SELECT COUNT(*) 
			            FROM   TB_OM02002 
			            WHERE  SALES_ORD_NO = A.SALES_ORD_NO 
			            AND   (NVL(DPT_AR_CD, 'X') != A.DPT_AR_CD
			                  OR NVL(DPT_AR_ZIP_CD, 'X') != A.DPT_AR_ZIP_CD 
			                  OR NVL(DPT_AR_ZIP_CD, 'X') != A.DPT_AR_ZIP_CD
			                  OR NVL(DPT_AR_ZIP_ADDR, 'X') != A.DPT_AR_ZIP_ADDR
			                  OR NVL(DPT_AR_DTL_ADDR, 'X') != A.DPT_AR_DTL_ADDR
			                  OR NVL(ARV_AR_CD, 'X') != A.ARV_AR_CD
			                  OR NVL(ARV_AR_ZIP_CD, 'X') != A.ARV_AR_ZIP_CD
			                  OR NVL(ARV_AR_ZIP_ADDR, 'X') != A.ARV_AR_ZIP_ADDR
			                  OR NVL(ARV_AR_DTL_ADDR, 'X') != A.ARV_AR_DTL_ADDR
			                  OR NVL(STRT_REQ_YMD, 'X') || NVL(STRT_REQ_HM, 'X') != A.STRT_REQ_YMD || A.STRT_REQ_HM
			                  OR NVL(APTD_REQ_YMD, 'X') || NVL(APTD_REQ_HM, 'X') != A.APTD_REQ_YMD || A.APTD_REQ_HM )  ), 0, 'N', 'Y') ITEM_DIFF_YN
			, A.LINE_SCTN_CD
			, A.DCNCT_ORD_YN
			, A.PAY_COND_CD	
			, A.MOVE_TYPE_CD	
			, (select comn_cd_nm from tb_ma01015 where clas_cd = 'MOVE_TYPE_CD' and comn_cd = a.move_type_cd) move_type_nm
			, A.TRAN_COND_CD		
			, A.GI_CNCL_REASON_CD
			, A.ORD_VERIFY_YN
			, A.APTD_DLY_CD
			, A.SELF_TRAN_YN
			, A.SALES_ORD_CHG_SEQ
	      , C.col01
	      , C.col02
	      , C.col03
	      , C.col04
	      , C.col05
	      , C.col06
	      , C.col07
	      , C.col08
	      , C.col09
	      , C.col10
	      , C.col11
	      , C.col12
	      , C.col13
	      , C.col14
	      , C.col15
	      , C.col16
	      , C.col17
	      , C.col18
	      , C.col19
	      , C.col20
	      , C.col21
	      , C.col22
	      , C.col23
	      , C.col24
	      , C.col25
	      , C.col26
	      , C.col27
	      , C.col28
	      , C.col29
	      , C.col30
		    , '' as UPD_FLAG
		    , a.MDF_DLY_SCTN_CD
		    , (select comn_cd_nm from tb_ma01015 where clas_cd = 'MDF_DLY_SCTN_CD' and comn_cd = a.MDF_DLY_SCTN_CD) MDF_DLY_SCTN_NM
  	FROM	TB_OM02011H A
  		  , TB_OM02004 C
  		  , TB_MA01006 B
  	WHERE	A.ord_type_cd = B.ord_type_cd
  	AND	    A.SALES_ORD_NO = C.SALES_ORD_NO(+)
  	{#1}
  	AND		A.SALES_ORD_CHG_SEQ = (SELECT MAX(nvl(SALES_ORD_CHG_SEQ, '')) FROM TB_OM02011H WHERE SALES_ORD_NO = a.sales_ord_no )
  	]]>
    <append condition="${salesOrdNo}.NOTEMPTY" id="#1">
    AND   A.SALES_ORD_NO  = ${salesOrdNo}
    </append>
  </statement>	

  <statement name="retrieveDomSalesOrdExceItemHist">
	SELECT 
			  a.sales_ord_no 
			, a.line_no 
			, a.cust_cd
			, a.item_cd 
			, b.item_nm
			, a.basis_item_cd
			, a.cust_ord_line_no
            , DECODE(NVL(a.item_grade_cd, ''), '', idusr.OMCOMM_GET_ITEM_INFO_FN(A.CUST_CD, A.ITEM_CD, 'ITEM_GRADE_CD', A.BAT_NO, A.ITEM_GRADE_CD)
                                                                             , A.ITEM_GRADE_CD) AS ITEM_GRADE_CD_MST
            , a.item_grade_cd  
			, a.ord_qty 
			, a.ord_qty as org_ord_qty
			, a.qty_unit_cd 
			, NVL(f.rslt_qty, 0) rslt_qty 
			, a.ord_qty - NVL(f.rslt_qty, 0) remain_qty
			, a.ord_wgt 
			, a.ord_wgt as org_ord_wgt
			, a.wgt_unit_cd 
			, NVL(f.rslt_wgt, 0) rslt_wgt 
			, a.ord_wgt - NVL(f.rslt_wgt, 0) remain_wgt
			, a.admt
			, a.ord_cbm 
			, a.ord_cbm as org_ord_cbm
			, NVL(f.rslt_cbm , 0) rslt_cbm
			, a.ord_cbm - NVL(f.rslt_cbm, 0) remain_cbm
			, a.basis_unit_cd
			, (select x.fltr_conts1 from tb_ma01015 x where x.clas_cd = 'BASIC_UNIT_CD' and x.comn_cd = a.basis_unit_cd) unit_cd
			, a.bat_no 
			, a.cust_bat_no
			, a.mnf_no
			, a.lot_no 
			, a.prdt_req_no 
			, a.prdt_prar_ymd 
			, a.plant_cd 
			, MACOMM_GETCD_FN('PLANT_CD', a.plant_cd) AS plant_nm 
			, a.sales_uprice 
			, a.cust_ref_no  
			, a.fe_sctn_cd
			, a.cntr_size_cd
			, a.cntr_no
			, a.danger_sctn_cd
			, a.seal_no1
			, a.seal_no2
			, a.pckg_unit_cd
			, a.pckg_qty
			, a.max_tmpt
			, a.min_tmpt
			, a.dpt_ar_cd 
			, a.dpt_ar_type_cd 
			, CASE WHEN a.dpt_ar_type_cd = '02' THEN
			          ( SELECT name 
			            FROM   vw_ma01_01 
			            WHERE  code         = a.dpt_ar_cd 
			            AND	   PTN_CD       = C.RPT_CUST_CD
			            AND    work_sctn_cd = a.dpt_ar_type_cd) 
			       ELSE
			          ( SELECT name 
			            FROM   vw_ma01_01 
			            WHERE  code         = a.dpt_ar_cd 
			            AND    work_sctn_cd = a.dpt_ar_type_cd
			            AND    ROWNUM       = 1) 
			  END  as dpt_ar_nm
			, a.dpt_ar_zip_cd 
			, a.dpt_ar_zip_addr 
			, a.dpt_ar_dtl_addr 
			, a.dpt_ar_ofcr_nm 
			, a.dpt_ar_ofcr_tel_no 
			, a.arv_ar_cd 
			, a.arv_ar_type_cd 
			, CASE WHEN a.arv_ar_type_cd = '02' THEN
			          ( SELECT name 
			            FROM   vw_ma01_01 
			            WHERE  code         = a.arv_ar_cd 
			            AND	   PTN_CD       = C.RPT_CUST_CD
			            AND    work_sctn_cd = a.arv_ar_type_cd) 
			       ELSE
			          ( SELECT name 
			            FROM   vw_ma01_01 
			            WHERE  code         = a.arv_ar_cd 
			            AND    work_sctn_cd = a.arv_ar_type_cd
			            AND    ROWNUM       = 1) 
			  END  as arv_ar_nm
			, a.arv_ar_zip_cd 
			, a.arv_ar_zip_addr 
			, a.arv_ar_dtl_addr 
			, a.arv_ar_ofcr_nm 
			, a.arv_ar_ofcr_tel_no 
			, a.strt_req_ymd 
			, a.strt_req_hm 
			, a.strt_req_ymd || a.strt_req_hm strt_req_date
			, a.aptd_req_ymd 
			, a.aptd_req_hm 
			, a.aptd_req_ymd || a.aptd_req_hm aptd_req_date	    
			, a.ord_reason_cd
			, IDUSR.OMCOMM_GETCUSTREASONNM_FN(c.rpt_cust_cd, a.ord_reason_cd) AS ord_reason_nm
			, a.booking_no
			, a.prog_stat_cd
			, MACOMM_GETCD_FN('EXP_PROG_STAT_CD', a.prog_stat_cd) AS prog_stat_nm						
			, a.vanning_grp_id
			, a.prdt_ymd
			, a.pol_cd
			, a.schd_no
			, a.sctn_cd
			, a.rpt_item_nm
			, a.cls_expr_yn
			, a.lead_time_expr_yn
			, a.ltrm_ord_yn
			, a.rmk
			, a.exp_ord_no
			, a.dpt_port_prar_ymd
			, a.gi_req_ymd
			, a.std_wgt
			, a.pallet_qty
			, a.more_pmsr
			, a.less_pmsr
			, a.cntr_dcsn_ofcr_id
			, to_char(a.cntr_dcsn_date, 'yyyymmddhh24miss') cntr_dcsn_date
            , DECODE(NVL(a.pcul_cd, ''), '', idusr.OMCOMM_GET_ITEM_INFO_FN(A.CUST_CD, A.ITEM_CD, 'PCUL_CD', A.BAT_NO, A.pcul_cd)
                                                                       , A.PCUL_CD) PCUL_CD_MST
            , DECODE(NVL(a.mn_cd, ''), '', idusr.OMCOMM_GET_ITEM_INFO_FN(A.CUST_CD, A.ITEM_CD, 'MN_CD', A.BAT_NO, A.mn_cd)
                                                                       , A.mn_cd) mn_cd_MST
            , a.pcul_cd
            , a.mn_cd
			, a.cmpt_ymd
			, a.dcsn_yn
			, a.del_yn
			, nvl(a.ord_verify_yn, 'Y') ord_verify_yn
			, c.cust_ord_no
	      , d.col01
	      , d.col02
	      , d.col03
	      , d.col04
	      , d.col05
	      , d.col06
	      , d.col07
	      , d.col08
	      , d.col09
	      , d.col10
	      , d.col11
	      , d.col12
	      , d.col13
	      , d.col14
	      , d.col15
	      , d.col16
	      , d.col17
	      , d.col18
	      , d.col19
	      , d.col20
	      , d.col21
	      , d.col22
	      , d.col23
	      , d.col24
	      , d.col25
	      , d.col26
	      , d.col27
	      , d.col28
	      , d.col29
	      , d.col30
	    , '' as UPD_FLAG
	    , a.sales_ord_chg_seq
	FROM  TB_OM02012H A
	    , TB_MA02010  B
	    , TB_OM02011H C
	    , TB_OM02005  D
 		, (SELECT e.line_no, SUM(e.rslt_qty) rslt_qty, SUM(e.rslt_wgt) rslt_wgt, SUM(e.rslt_cbm) rslt_cbm
		  	 FROM tb_om03002 e
 		   WHERE e.SALES_ORD_NO = ${salesOrdNo}
		   GROUP BY e.line_no) F
	    , (SELECT X.SALES_ORD_NO
                 ,X.LINE_NO
	       FROM TB_OM02012H X
	       WHERE X.SALES_ORD_NO      = ${salesOrdNo}
	       AND   X.SALES_ORD_CHG_SEQ = (SELECT MAX(SALES_ORD_CHG_SEQ) 
	                                    FROM TB_OM02011H  
	                                    WHERE SALES_ORD_NO    = X.SALES_ORD_NO
	                                    AND   (MDF_DLY_SCTN_CD IS NULL OR MDF_DLY_SCTN_CD = '02'))
	       AND   X.DEL_YN = 'N'
	       UNION ALL
	       SELECT X.SALES_ORD_NO
	             ,X.LINE_NO
	       FROM TB_OM02012H X
	       WHERE X.SALES_ORD_NO      = ${salesOrdNo}
	       AND   X.SALES_ORD_CHG_SEQ = (SELECT MAX(SALES_ORD_CHG_SEQ) FROM TB_OM02011H WHERE SALES_ORD_NO = X.SALES_ORD_NO )
	       AND   NOT EXISTS (SELECT 1
	                         FROM TB_OM02012H Y
	                         WHERE Y.SALES_ORD_NO = X.SALES_ORD_NO
	                         AND   Y.LINE_NO      = X.LINE_NO
	                         AND   Y.SALES_ORD_CHG_SEQ = (SELECT MAX(Z.SALES_ORD_CHG_SEQ) 
	                                                      FROM TB_OM02011H Z 
	                                                      WHERE Z.SALES_ORD_NO    = Y.SALES_ORD_NO
	                                                      AND   (Z.MDF_DLY_SCTN_CD IS NULL OR Z.MDF_DLY_SCTN_CD = '02')))
           ) G		   
	WHERE A.cust_cd      = B.Ptn_Cd
	AND   A.item_cd      = B.Item_Cd
	AND   A.Sales_Ord_No = C.Sales_Ord_No
	AND	  A.SALES_ORD_NO = D.SALES_ORD_NO(+)
	AND	  A.LINE_NO		 = D.LINE_NO(+)
	AND	  A.LINE_NO		 = F.LINE_NO(+)
	AND   a.sales_ord_chg_seq = c.sales_ord_chg_seq
  	AND	  C.SALES_ORD_CHG_SEQ = (SELECT MAX(SALES_ORD_CHG_SEQ) FROM TB_OM02011H WHERE SALES_ORD_NO = A.SALES_ORD_NO )
	AND   A.SALES_ORD_NO  = G.SALES_ORD_NO
	AND   A.LINE_NO       = G.LINE_NO  	
  	{#1}
  	{#2}
	ORDER BY TO_NUMBER(A.LINE_NO)  	
    <append condition="${salesOrdNo}.NOTEMPTY" id="#1">
    AND   A.SALES_ORD_NO  = ${salesOrdNo}
    </append>
    <append condition="${lineNo}.NOTEMPTY" id="#2">
    AND   A.LINE_NO  = ${lineNo}
    </append>
  </statement>
  
	<statement name="retrieveSellDept">
		SELECT ctrt_no,						-- 계약번호
		       sell_dept_cd,				-- 매출부서코드
		       sell_dept_cd  bilg_dept_cd, 	-- 청구부서코드
		       bilg_cust_cd,				-- 청구고객코드
		       rltd_gi_ord_no				-- 관련출고 오더번호  
		  FROM tb_om02001
		 WHERE sales_ord_no = ${salesOrdNo}
		   AND corp_cd = ${corpCd}
	</statement>
	    
	
	<statement name="retrieveConsolTgtSalesOrdItem">
		SELECT A.SALES_ORD_NO
			 , B.LINE_NO
			 , B.BASIS_UNIT_CD
			 , B.PROG_STAT_CD
		FROM	TB_OM02001 A
			  , TB_OM02002 B
		WHERE	A.SALES_ORD_NO 		= B.SALES_ORD_NO
		AND		B.EXP_ORD_NO 		= ${custOrdNo}
		AND		B.CUST_ORD_LINE_NO 	= ${custOrdLineNo}
		AND		B.DEL_YN = 'N'
	</statement>
	<statement name="retrieveExistSalesOrdItem">
		SELECT COUNT(*) cnt
		FROM	TB_OM02002
		WHERE	SALES_ORD_NO = (select  sales_ord_no 
								from	tb_om02001 
								where 	cust_ord_no = ${custOrdNo} )
		AND		DEL_YN = 'N'
	</statement>	
	
	<!-- 계열수출오더포워딩관리 -->
	<statement name="retrieveBranchOceanExpSalesOrdFwdOrdList">
		SELECT a.sales_ord_no
			 , a.corp_cd
			 , a.ctrt_cust_cd
		     , nvl(a.cust_ord_no, '') as cust_ord_no
		     , a.ord_type_cd
		     , c.exp_type_cd
		     , MACOMM_GETCD_FN('EXP_TYPE_CD', c.exp_type_cd) exp_type_nm
		     , a.ctrt_no
		     , a.cargo_form_cd
		     , nvl(c.pod_cd, '') as pod_cd
		     , nvl(c.pod_nm, '') as pod_nm
		     , nvl(a.sales_ofcr_id, '') as sales_ofcr_id
		     , nvl(a.cust_ofcr_nm, '')  AS cust_ofcr_nm
		     , nvl(a.dpt_ar_cd, '') as dpt_ar_cd
		     , nvl(a.dpt_ar_type_cd, '') as dpt_ar_type_cd
		     , nvl(MACOMM_GETWORKPLNM_FN( a.dpt_ar_cd, a.corp_cd), '') AS dpt_ar_nm
		     , nvl(c.CNEE_NM, '') as CNEE_NM
		     , nvl(c.DLV_PL_CD, '') as arv_ar_cd
		     , nvl(a.arv_ar_type_cd, '') as arv_ar_type_cd
		     , nvl(c.DLV_PL_NM, '') as arv_ar_nm
		     , nvl((SELECT max(cntr_size_cd) FROM tb_om02016 WHERE sales_ord_no = a.sales_ord_no ), '') as  cntr_type
		     , nvl((SELECT COUNT(*) FROM tb_om02016 WHERE sales_ord_no = a.sales_ord_no), 0) as  cntr_qty
		     , b.line_no
		     , b.EXP_ORD_NO
		     , b.cust_ord_line_no
		     , b.schd_no	
		     , b.pol_cd
		     , b.dpt_port_prar_ymd
		     , b.arv_port_prar_ymd
		     , b.ord_qty
		     , b.ord_wgt
		     , a.rmk
		     , a.rpt_cust_cd
		     , a.cust_exca_ofcr_nm
		     , a.SALES_ORD_STAT_CD
	  	     , MACOMM_GETCD_FN('ORD_STAT_CD', a.sales_ord_stat_cd ) AS sales_ord_stat_nm
			  , (SELECT MAX(RSLT_SCTN_CD) 
  			   	 FROM 	 TB_OM04002 
  			   	 WHERE   SALES_ORD_NO = a.SALES_ORD_NO ) FWD_STAT_CD
			  , (SELECT COMN_CD_NM 
			  	 FROM TB_MA01015 X
			  	 WHERE	X.CLAS_CD 		= 'FWD_RSLT_SCTN_CD'
			  	 AND	X.COMN_CD 		= (SELECT MAX(RSLT_SCTN_CD) 
     			  	 					   FROM 	 TB_OM04002 
    			  	 					   WHERE   SALES_ORD_NO = a.SALES_ORD_NO) ) FWD_STAT_nm
		FROM   tb_om02001 a
		     , tb_om02002 b
		     , tb_om02003 c
		WHERE  a.sales_ord_no = b.sales_ord_no
		AND    a.sales_ord_no = c.sales_ord_no
		AND	   (A.RPT_CUST_CD = 'P1000' OR A.RPT_CUST_CD = 'P1100' OR A.RPT_CUST_CD = 'P1591')
		AND		A.EXP_IMP_DOM_SCTN_CD = '01'
		AND		C.OCEAN_AIR_SCTN_CD = 'S'
		AND		A.SALES_ORD_CNCL_YN = 'N'
		AND		B.DEL_YN = 'N'
		{#1}
		{#2}
		{#3}
		{#4}
		{#5}
		{#6}
		{#7}
		{#8}
		order by a.sales_ord_no desc, to_number(b.line_no) 
	    <append condition="${custOrdNo}.NOTEMPTY" id="#1">
		AND   a.cust_ord_no IN (SELECT x.cust_ord_no 
	                            FROM   tb_om02001 x
	                                 , tb_om02002 y 
	                            WHERE  x.sales_ord_no = y.sales_ord_no 
	                            AND    y.exp_ord_no = ${custOrdNo}
	                            AND    y.del_yn = 'N'
	                            AND    x.sales_ord_cncl_yn = 'N')
		</append>
	    <append condition="${custCd}.NOTEMPTY" id="#2">
			AND    a.ctrt_Cust_cd      = ${custCd}
		</append>
	    <append condition="${dptPortPrarYmdFrom}.NOTEMPTY&amp;${dptPortPrarYmdTo}.NOTEMPTY&amp;${dateType}.EQ.E" id="#3">
			AND    b.dpt_port_prar_ymd between ${dptPortPrarYmdFrom} and ${dptPortPrarYmdTo}
		</append>
	    <append condition="${dptPortPrarYmdFrom}.NOTEMPTY&amp;${dptPortPrarYmdTo}.NOTEMPTY&amp;${dateType}.EQ.D" id="#4">
			AND    b.GI_REQ_YMD between ${dptPortPrarYmdFrom} and ${dptPortPrarYmdTo}
		</append>
	    <append condition="${dptArCd}.NOTEMPTY" id="#5">
			AND    a.dpt_ar_cd         = ${dptArCd}
		</append>
	    <append condition="${ctryCd}.NOTEMPTY" id="#6">
			AND    c.ctry_cd        = ${ctryCd}
		</append>
	    <append condition="${custOfcrNm}.NOTEMPTY" id="#7">
			AND    a.CUST_OFCR_NM      = ${custOfcrNm}
		</append>
	    <append condition="${expTypeCd}.NOTEMPTY" id="#8">
			AND    c.EXP_TYPE_CD      = ${expTypeCd}
		</append>

	</statement>
	
	<!-- 계열수출오더포워딩관리 -->
	<statement name="retrieveBranchOceanExpSalesOrdBookingList">
		SELECT sales_ord_no
		     , booking_no
		     , ship_co_booking_no
		     , booking_ymd
		     , schd_no
		     , '' schd_type
		     , schd_ofcr_nm
		     , ship_co_cd
		     , ship_co_nm
		     , ship_co_ofcr_nm
		     , ship_co_tel_no
		     , ship_co_fax_no
		     , ship_nm
		     , port_cnt
		     , pol_cd
		     , pol_nm
		     , pod_cd
		     , pod_nm
		     , dpt_port_prar_ymd
		     , arv_port_prar_ymd
		     , cy_cls_ymd
		     , cy_cls_hms
		     , sr_cls_ymd
		     , sr_cls_hms
		     , cntr_kind_cd1
		     , cntr_qty1
		     , cntr_kind_cd2
		     , cntr_qty2
		     , cntr_kind_cd3
		     , cntr_qty3
		     , cntr_kind_cd4
		     , cntr_qty4
		     , cntr_kind_cd5
		     , cntr_qty5
		     , booking_wgt
		     , wgt_unit_cd
		     , cy_dtl_conts
		     , FWD_EO_NO
		     , VANNING_CMPT_YN
		     , '' inland_Port_Cd
		     , '' inland_Port_Nm
		     , '' as upd_flag
		     , (select a.dpt_ar_ofcr_nm 
		          from tb_om02001 a
		         where a.sales_ord_no = ${salesOrdNo}) as dpt_ar_ofcr_nm
		FROM   tb_om02019
		WHERE  sales_ord_no = ${salesOrdNo}
		{#1}
	    <append condition="${vanningCmptYn}.NOTEMPTY" id="#1">
			AND    VANNING_CMPT_YN      = ${vanningCmptYn}
		</append>
	</statement>	
	
	<statement name="retrieveBookingNo">
		SELECT A.BOOKING_NO
		FROM   TB_OM02019 A
		     , TB_OM02001 B
		     , TB_OM02003 C
		WHERE  A.SALES_ORD_NO        = B.SALES_ORD_NO
		AND    A.SALES_ORD_NO        = C.SALES_ORD_NO
		AND    B.EXP_IMP_DOM_SCTN_CD = '01'
		AND    C.OCEAN_AIR_SCTN_CD   = 'S'
		AND    A.SALES_ORD_NO        = ${salesOrdNo}
		AND    A.FWD_EO_NO           = ${fwdEoNo}
	</statement>
	
	<statement name="retrieveShipCoBookingNo">
		SELECT A.SHIP_CO_BOOKING_NO
		FROM   TB_OM02019 A
		     , TB_OM02001 B
		WHERE  A.SALES_ORD_NO        = B.SALES_ORD_NO
		AND    A.SALES_ORD_NO        = ${salesOrdNo}
		AND	   A.BOOKING_NO			 = ${bookingNo}
	</statement>
		
<!-- 항공수입판매오더포워딩 정보 -->
  <statement name="retrieveAirImpSalesOrd">
		SELECT /* 항공수입판매오더포워딩 정보 */
		       a.sales_ord_no       														--판매오더번호
			  , a.sales_ord_stat_cd 														--판매오더상태코드
			  , MACOMM_GETCD_FN('ORD_STAT_CD', a.sales_ord_stat_cd ) AS sales_ord_stat_nm 	--판매오더상태명
		      , a.sales_ord_creat_ymd 														--판매오더생성일자
		      , a.sales_ord_creat_hms 														--판매오더생성시간
		      , a.ctrt_cust_cd        														--계약고객코드
		      , MACOMM_GETPTNNM_FN(a.ctrt_cust_cd ) AS ctrt_cust_nm 						--계약고객명
			  , a.ord_req_cust_cd 															--오더요청고객코드
			  , MACOMM_GETPTNNM_FN( a.ord_req_cust_cd) as ord_req_cust_nm					--오더요청고객명
		      , a.ord_type_cd  																--오더형태
	 	      , ( SELECT ord_type_nm
		    	  FROM	 TB_MA01006
		    	  WHERE	 ord_type_cd = a.ord_type_cd) as ord_type_nm						--오더명
		      , a.ctrt_no      																--계약번호
		      , ( SELECT y.ctrt_nm
				  FROM   tb_sm04110 x, tb_sm07110 y
				  WHERE  x.corp_cd 	 	= y.corp_cd
				  AND	 x.prmt_biz_no 	= y.prmt_biz_no
				  AND    x.cust_cd 	 	= a.ctrt_cust_cd
				  AND    x.sell_ctrt_no = a.ctrt_no) as ctrt_nm 							--계약명
		  	  , a.bilg_cust_cd 																--청구고객코드
			  , MACOMM_GETPTNNM_FN( a.bilg_cust_cd ) AS bilg_cust_nm 						--청구고객명
			  , LTrim(a.sell_dept_cd, '0') as sell_dept_cd 									--매출부서코드
			  , MACOMM_GETDEPTNM_FN( a.corp_cd, a.sell_dept_cd ) AS sell_dept_nm 			--매출부서명
			  , a.sales_ofcr_id 															--영업사원아이디
			  , MACOMM_GETUSERNM_FN( a.sales_ofcr_id ) AS sales_ofcr_nm 					--영업사원명
		      , LTrim(a.ord_mngt_exce_dept_cd, '0') as ord_mngt_exce_dept_cd
		      , MACOMM_GETDEPTNM_FN( a.corp_cd, a.ord_mngt_exce_dept_cd ) AS ord_mngt_exce_dept_nm
		      , LTrim(a.ord_mngt_fwd_dept_cd, '0') as ord_mngt_fwd_dept_cd 					--오더관리포워딩부서코드
			  , MACOMM_GETDEPTNM_FN( a.corp_cd, a.ord_mngt_fwd_dept_cd ) AS ord_mngt_fwd_dept_nm 	--오더관리포워딩부서명
			  , a.ord_mngt_fwd_ofcr_id 														--오더관리포워딩담당자아이디
			  , MACOMM_GETUSERNM_FN( a.ord_mngt_fwd_ofcr_id ) AS ord_mngt_fwd_ofcr_nm 		--오더관리포워딩담당자명
		      , b.fwd_eo_no          						--포워딩오더번호
		      , a.sales_ord_cncl_yn  						--취소여부
		      , b.hbl_no									--House BL
		      , b.bl_kind_cd         						--B/L Type
		      , b.ci_no              						--C/I No (Invoice No)
		      , b.mbl_no									--Master BL
		      , a.cargo_form_cd      						--Cargo Type
			  , macomm_getcd_fn( 'CARGO_FORM_CD', a.cargo_form_cd) cargo_form_nm
		      , b.fcl_lcl_sctn_cd    						--FCL/LCL
		      , b.dpt_svc_term_cd    						--출발ServiceTerm
		      , b.arv_svc_term_cd    						--도착ServiceTerm
		      , b.incoterms_cd       						--INCOTERMS
		      , b.TRAN_COST_PAY_COND_CD		-- Freight 운임지급조건코드
		      , b.EXTR_EXPN_PAY_COND_CD		-- Other 부대비용지급조건코드
		      , b.PTN_CD
		      , b.PTN_NM									-- Partner
		      , b.PTN_OFCR_NM							-- Partner PIC
		      , b.airline_cd         						
			  , macomm_getcd_fn( 'IATA_CD', b.airline_cd) as airline__nm			
		      , b.ship_nm           						--Vessel
		      , b.port_cnt          						--Voyage
		      , b.pol_cd             						--POL코드
		      , b.pol_nm             						--POL명
		      , b.pod_cd             						--POD코드
		      , b.pod_nm             						--POD명
		      , b.dpt_port_prar_ymd  						--ETD
		      , b.arv_port_prar_ymd  						--ETA
		      , b.arv_port_prar_hm  						--ETA
		      , b.pckg_qty           						--Total Package수량
		      , b.pckg_unit_cd       						--Total Package코드
		      , MACOMM_GETCD_FN('PCKG_UNIT_CD', b.pckg_unit_cd ) AS pckg_unit_nm
		      , b.tot_wgt            						--Gross Wgt
		      , b.tot_cbm            						--CBM
		      , b.RPT_ITEM_NM						-- Main Item
		      , a.cust_ref_no        						--Ref No
		      , b.lc_no              						--L/C No
		      , decode(b.BOND_TRAN_YN,'Y','1','0') bond_tran_yn					-- Bonded Trans
		      , decode(b.MNFEST_DCLR_TGT_YN,'Y','1','0') MNFEST_DCLR_TGT_YN		-- Target on Declation
		      , a.rmk                						--비고
		      , b.SHIPPER_CD							--Shipper
		      , b.SHIPPER_NM
		      , b.SHIPPER_ADDR1
		      , b.SHIPPER_ADDR2
		      , b.SHIPPER_ADDR3
		      , b.SHIPPER_ADDR4
		      , b.cnee_cd            						--Consignee코드
		      , b.cnee_nm            						--Consignee명
		      , b.cnee_addr1
		      , b.cnee_addr2
		      , b.cnee_addr3
		      , b.cnee_addr4
		      , b.NTFY_CD								-- NOTiFY
		      , b.NTFY_NM
		      , b.NTFY_ADDR1
		      , b.NTFY_ADDR2
		      , b.NTFY_ADDR3
		      , b.NTFY_ADDR4
		      , b.cntr_kind_cd1     
		      , b.cntr_qty1 
		      , b.cntr_kind_cd2 
		      , b.cntr_qty2 
		      , b.cntr_kind_cd3 
		      , b.cntr_qty3 
		      , b.cntr_kind_cd4 
		      , b.cntr_qty4 
		      , b.cntr_kind_cd5 
		      , b.cntr_qty5
		      , a.dpt_ar_cd         						--Door코드
		      , a.dpt_ar_type_cd         						--Door코드
		    , case when a.dpt_ar_type_cd = '02' then
		    	(select name 
		    	from vw_ma01_01 
		    	where code = a.dpt_ar_cd 
		    	AND	  PTN_CD = a.RPT_CUST_CD
		    	and work_sctn_cd = a.dpt_ar_type_cd) 
			  else 	    	
		    	(select name 
		    	from vw_ma01_01 
		    	where code = a.dpt_ar_cd 
		    	and work_sctn_cd = a.dpt_ar_type_cd
		    	and rownum = 1) 
		      end  as dpt_ar_nm
		      , a.dpt_ar_zip_cd     						--Door 우편번호
		      , a.dpt_ar_zip_addr   						--Door 우편주소
		      , a.dpt_ar_dtl_addr   						--Door 상세주소
		      , a.dpt_ar_ofcr_nm    						--Door PIC
		      , a.dpt_ar_ofcr_tel_no 						--Door Tel
		      , a.strt_req_ymd       						--Door Date
		      , a.strt_req_hm        						--Door Time
		      , b.TRAN_COST_PAY_COND_CD
		      , b.EXTR_EXPN_PAY_COND_CD
		      , a.cust_ofcr_nm									--고객담당자명
		      , a.cust_ofcr_tel_no							--고객담당자연락번호
		      , b.tran_cost_wgt
		      , b.co_load_entp_cd
		      , (SELECT c.ptn_nm FROM tb_ma01002 c WHERE c.ptn_cd = b.co_load_entp_cd ) co_load_entp_nm	
		      , (SELECT COMN_CD_NM 
			  	 FROM TB_MA01015 X
			  	 	, TB_OM04002 Y
			  	 WHERE	X.CLAS_CD 		= 'FWD_RSLT_SCTN_CD'
			  	 AND	X.COMN_CD 		= Y.RSLT_SCTN_CD
			  	 AND	Y.SALES_ORD_NO  = A.SALES_ORD_NO
			  	 AND	Y.RSLT_SCTN_CD  = (SELECT MAX(RSLT_SCTN_CD) 
			  	 						   FROM 	 TB_OM04002 
			  	 						   WHERE   SALES_ORD_NO = Y.SALES_ORD_NO) ) FWD_STAT_NM	  
			  , c.rslt_sctn_cd	 
			  , a.rpt_cust_cd						       
		FROM   tb_om02001 a
		     , tb_om02003 b
		     , tb_om04002 c
		WHERE  a.sales_ord_no = b.sales_ord_no(+)
		AND    b.ocean_air_sctn_cd(+) = 'A' --항공
		AND    a.exp_imp_dom_sctn_cd = '02' --수입
		AND    a.sales_ord_no = c.sales_ord_no(+)
		{#1}
    <append condition="${salesOrdNo}.NOTEMPTY" id="#1">
    AND   a.sales_ord_no  = ${salesOrdNo}
    </append>
  </statement>	
  
<!-- 항공수출판매오더포워딩 정보 -->
  <statement name="retrieveAirExpSalesOrd">
		SELECT /* 항공수출판매오더포워딩 정보 */
		       a.sales_ord_no       														
			  , a.sales_ord_stat_cd 														
			  , MACOMM_GETCD_FN('ORD_STAT_CD', a.sales_ord_stat_cd ) AS sales_ord_stat_nm 	
		      , a.sales_ord_creat_ymd 														
		      , a.sales_ord_creat_hms 														
		      , a.ctrt_cust_cd        														
		      , MACOMM_GETPTNNM_FN(a.ctrt_cust_cd ) AS ctrt_cust_nm 						
			  , a.ord_req_cust_cd 															
			  , MACOMM_GETPTNNM_FN( a.ord_req_cust_cd) as ord_req_cust_nm					
		      , a.ord_type_cd  																
	 	      , ( SELECT ord_type_nm
		    	  FROM	 TB_MA01006
		    	  WHERE	 ord_type_cd = a.ord_type_cd) as ord_type_nm						
		      , a.ctrt_no      																
		      , ( SELECT y.ctrt_nm
				  FROM   tb_sm04110 x, tb_sm07110 y
				  WHERE  x.corp_cd 	 	= y.corp_cd
				  AND	 x.prmt_biz_no 	= y.prmt_biz_no
				  AND    x.cust_cd 	 	= a.ctrt_cust_cd
				  AND    x.sell_ctrt_no = a.ctrt_no) as ctrt_nm 							--계약명
		  	  , a.bilg_cust_cd 																--청구고객코드
			  , MACOMM_GETPTNNM_FN( a.bilg_cust_cd ) AS bilg_cust_nm 						--청구고객명
			  , LTrim(a.sell_dept_cd, '0') as sell_dept_cd 									--매출부서코드
			  , MACOMM_GETDEPTNM_FN( a.corp_cd, a.sell_dept_cd ) AS sell_dept_nm 			--매출부서명
			  , a.sales_ofcr_id 															--영업사원아이디
			  , MACOMM_GETUSERNM_FN( a.sales_ofcr_id ) AS sales_ofcr_nm 					--영업사원명
		      , LTrim(a.ord_mngt_exce_dept_cd, '0') as ord_mngt_exce_dept_cd
		      , MACOMM_GETDEPTNM_FN( a.corp_cd, a.ord_mngt_exce_dept_cd ) AS ord_mngt_exce_dept_nm
		      , LTrim(a.ord_mngt_fwd_dept_cd, '0') as ord_mngt_fwd_dept_cd 					--오더관리포워딩부서코드
			  , MACOMM_GETDEPTNM_FN( a.corp_cd, a.ord_mngt_fwd_dept_cd ) AS ord_mngt_fwd_dept_nm 	--오더관리포워딩부서명
			  , a.ord_mngt_fwd_ofcr_id 														--오더관리포워딩담당자아이디
			  , MACOMM_GETUSERNM_FN( a.ord_mngt_fwd_ofcr_id ) AS ord_mngt_fwd_ofcr_nm 		--오더관리포워딩담당자명
		      , b.fwd_eo_no          						--포워딩오더번호
		      , a.sales_ord_cncl_yn  						--취소여부
		      , b.hbl_no									--House BL
		      , b.bl_kind_cd         						--B/L Type
		      , b.ci_no              						--C/I No (Invoice No)
		      , b.mbl_no									--Master BL
		      , a.cargo_form_cd      						--Cargo Type
			  , macomm_getcd_fn( 'CARGO_FORM_CD', a.cargo_form_cd) cargo_form_nm
		      , b.fcl_lcl_sctn_cd    						--FCL/LCL
		      , b.dpt_svc_term_cd    						--출발ServiceTerm
		      , b.arv_svc_term_cd    						--도착ServiceTerm
		      , b.incoterms_cd       						--INCOTERMS
		      , b.TRAN_COST_PAY_COND_CD		-- Freight 운임지급조건코드
		      , b.EXTR_EXPN_PAY_COND_CD		-- Other 부대비용지급조건코드
		      , b.PTN_CD
		      , b.PTN_NM									-- Partner
		      , b.PTN_OFCR_NM							-- Partner PIC
		      , b.airline_cd         						
			  , macomm_getcd_fn( 'IATA_CD', b.airline_cd) as airline__nm	
		      , b.ship_nm           						--Vessel
		      , b.port_cnt          						--Voyage
		      , b.pol_cd             						--POL코드
		      , b.pol_nm             						--POL명
		      , b.pod_cd             						--POD코드
		      , b.pod_nm             						--POD명
		      , b.dpt_port_prar_ymd  						--ETD
		      , b.dpt_port_prar_hm  						--ETD
		      , b.arv_port_prar_ymd  						--ETA
		      , b.arv_port_prar_hm  						--ETA
		      , b.pckg_qty           						--Total Package수량
		      , b.pckg_unit_cd       						--Total Package코드
		      , b.tot_wgt            						--Gross Wgt
		      , b.tot_cbm            						--CBM
		      , b.RPT_ITEM_NM						-- Main Item
		      , a.cust_ref_no        						--Ref No
		      , b.lc_no              						--L/C No
		      , decode(b.BOND_TRAN_YN,'Y','1','0') bond_tran_yn					-- Bonded Trans
		      , decode(b.MNFEST_DCLR_TGT_YN,'Y','1','0') MNFEST_DCLR_TGT_YN		-- Target on Declation
		      , a.rmk                						--비고
		      , b.SHIPPER_CD							--Shipper
		      , b.SHIPPER_NM
		      , b.SHIPPER_ADDR1
		      , b.SHIPPER_ADDR2
		      , b.SHIPPER_ADDR3
		      , b.SHIPPER_ADDR4
		      , b.cnee_cd            						--Consignee코드
		      , b.cnee_nm            						--Consignee명
		      , b.cnee_addr1
		      , b.cnee_addr2
		      , b.cnee_addr3
		      , b.cnee_addr4
		      , b.NTFY_CD								-- NOTiFY
		      , b.NTFY_NM
		      , b.NTFY_ADDR1
		      , b.NTFY_ADDR2
		      , b.NTFY_ADDR3
		      , b.NTFY_ADDR4
		      , b.cntr_kind_cd1     
		      , b.cntr_qty1 
		      , b.cntr_kind_cd2 
		      , b.cntr_qty2 
		      , b.cntr_kind_cd3 
		      , b.cntr_qty3 
		      , b.cntr_kind_cd4 
		      , b.cntr_qty4 
		      , b.cntr_kind_cd5 
		      , b.cntr_qty5
		      , a.dpt_ar_cd         						--Door코드
		      , a.dpt_ar_type_cd         						--Door코드
		    , case when a.dpt_ar_type_cd = '02' then
		    	(select name 
		    	from vw_ma01_01 
		    	where code = a.dpt_ar_cd 
		    	AND	  PTN_CD = a.RPT_CUST_CD
		    	and work_sctn_cd = a.dpt_ar_type_cd) 
			  else 	    	
		    	(select name 
		    	from vw_ma01_01 
		    	where code = a.dpt_ar_cd 
		    	and work_sctn_cd = a.dpt_ar_type_cd
		    	and rownum = 1) 
		      end  as dpt_ar_nm
		      , a.dpt_ar_zip_cd     						--Door 우편번호
		      , a.dpt_ar_zip_addr   						--Door 우편주소
		      , a.dpt_ar_dtl_addr   						--Door 상세주소
		      , a.dpt_ar_ofcr_nm    						--Door PIC
		      , a.dpt_ar_ofcr_tel_no 						--Door Tel
		      , a.strt_req_ymd       						--Door Date
		      , a.strt_req_hm        						--Door Time
		      , b.TRAN_COST_PAY_COND_CD
		      , b.EXTR_EXPN_PAY_COND_CD
		      , a.cust_ofcr_nm									--고객담당자명
		      , a.cust_ofcr_tel_no							--고객담당자연락번호
		      , b.tran_cost_wgt
		      , b.carr_cd1, b.carr_cd2, b.carr_cd3
		      , b.ts_cd1, b.ts_cd2, b.ts_cd3
		      , b.co_load_entp_cd
		      , (SELECT c.ptn_nm FROM tb_ma01002 c WHERE c.ptn_cd = b.co_load_entp_cd ) co_load_entp_nm
		      , (SELECT COMN_CD_NM 
			  	 FROM TB_MA01015 X
			  	 	, TB_OM04002 Y
			  	 WHERE	X.CLAS_CD 		= 'FWD_RSLT_SCTN_CD'
			  	 AND	X.COMN_CD 		= Y.RSLT_SCTN_CD
			  	 AND	Y.SALES_ORD_NO  = A.SALES_ORD_NO
			  	 AND	Y.RSLT_SCTN_CD  = (SELECT MAX(RSLT_SCTN_CD) 
			  	 						   FROM 	 TB_OM04002 
			  	 						   WHERE   SALES_ORD_NO = Y.SALES_ORD_NO) ) FWD_STAT_NM
			  , c.rslt_sctn_cd	 		
			  , a.rpt_cust_cd				   
		FROM   tb_om02001 a
		     , tb_om02003 b
		     , tb_om04002 c
		WHERE  a.sales_ord_no = b.sales_ord_no(+)
		AND    b.ocean_air_sctn_cd(+) = 'A' --항공
		AND    a.exp_imp_dom_sctn_cd = '01' --수출		
		AND    a.sales_ord_no = c.sales_ord_no(+)
		{#1}
    <append condition="${salesOrdNo}.NOTEMPTY" id="#1">
    AND   a.sales_ord_no  = ${salesOrdNo}
    </append>
  </statement>  

<!-- 수출입판매 오더 실행관리 헤더조회 -->
  <statement name="retrieveExpImpSalesOrdExceMngtHead">
  <![CDATA[
	SELECT 
			 a.sales_ord_no 	                          --판매오더번호
			, a.corp_cd
			, a.rpt_cust_cd
			, a.ord_type_cd 	                          --오더유형코드
			, b.ord_type_nm	                            --오더유형명
			, a.add_svc_type_cd
			, b.logis_svc_sctn_cd			                  --물류서비스구분코드
			, nvl(b.CMPD_TRAN_YN, 'N') as CMPD_TRAN_YN
			, ( SELECT upper_comn_cd
			    FROM   Tb_Ma01015
			    WHERE  clas_cd = 'LOGIS_AR_CD'
			    AND    comn_cd = b.logis_ar_cd)	AS exp_imp_dom_sctn_cd  				               --수출입내수구분코드
			, (SELECT b.comn_cd_nm
		 	   FROM   Tb_Ma01015 a, tb_ma01015 b
		 	   WHERE  a.clas_cd = 'LOGIS_AR_CD'
		       AND    b.clas_cd = 'EXP_IMP_DOM_SCTN'
         	   AND    a.upper_comn_cd = b.comn_cd
		 	   AND    A.comn_cd = b.logis_ar_cd)	AS exp_imp_dom_sctn_NM  				--수출입내수구분명
			, a.cargo_form_cd
			, LTrim(a.ord_mngt_exce_dept_cd, '0') as ord_mngt_exce_dept_cd 				             --오더관리실행부서코드
			, MACOMM_GETDEPTNM_FN(a.corp_cd, a.ord_mngt_exce_dept_cd) AS ord_mngt_exce_dept_nm --오더관리실행부서명
			, a.ord_mngt_fwd_dept_cd
			, a.ord_mngt_exce_ofcr_id                                                          --오더관리실행담당자아이디
			, MACOMM_GETUSERNM_FN( a.ord_mngt_exce_ofcr_id ) AS ord_mngt_exce_ofcr_nm          --오더관리실행담당자명
			, a.ord_mngt_fwd_ofcr_id
			, a.tran_plan_cntr_cd
			, a.sales_ord_stat_cd                                                              --판매오더상태코드
			, MACOMM_GETCD_FN('ORD_STAT_CD', a.sales_ord_stat_cd ) AS sales_ord_stat_nm        --판매오더상태명
			, a.cust_ord_no 	                                                                 --고객오더번호
			, a.cust_cd
			, a.cust_ord_type_cd 			                                                         --고객오더유형코드
			, case when a.rpt_cust_cd = 'R1209' OR a.rpt_cust_cd = 'R1728' then
			    MACOMM_GETCD_FN( 'EVE_CUST_ORD_TYPE_CD', a.cust_ord_type_cd) 			
			  else
			    MACOMM_GETCD_FN( 'CUST_ORD_TYPE_CD', a.cust_ord_type_cd) 
              end cust_ord_type_nm     --고객오더유형명
			, a.cust_move_type_cd 			                                                       --고객이동유형코드
			, decode(rpt_cust_cd, 'P1000', (select comn_cd_nm from tb_ma01015 where clas_cd = 'HPP_MOVE_TYPE_CD' and comn_cd = a.cust_move_type_cd)
								, 'P1591', (select comn_cd_nm from tb_ma01015 where clas_cd = 'HPP_MOVE_TYPE_CD' and comn_cd = a.cust_move_type_cd)
								, 'P1200', (select comn_cd_nm from tb_ma01015 where clas_cd = 'HHP_MOVE_TYPE_CD' and comn_cd = a.cust_move_type_cd) 
								, '') as cust_move_type_nm
			, to_char(a.cust_ord_recp_date, 'YYYYMMDD') as cust_ord_recp_ymd		               --고객오더접수일시
			, to_char(a.cust_ord_recp_date, 'HH24MI') as cust_ord_recp_hm		                 --고객오더접수일시
			, a.cust_ord_recp_chn_cd 	                                                         --고객오더접수채널코드
			, MACOMM_GETCD_FN( 'CUST_ORD_RECP_CHN_CD', a.cust_ord_recp_chn_cd) as cust_ord_recp_chn_nm	--고객오더접수채널명
			, a.ctrt_cust_cd                                                                            --계약고객코드
			, MACOMM_GETPTNNM_FN(a.ctrt_cust_cd ) AS ctrt_cust_nm	                                      --계약고객명
			, a.ctrt_no 			                                                                          --계약번호
			, ( SELECT y.ctrt_nm
			    FROM   tb_sm04110 x
			         , tb_sm07110 y
			    WHERE  x.corp_cd 	    = y.corp_cd
			    AND	   x.prmt_biz_no  = y.prmt_biz_no
			    AND    x.cust_cd 	    = a.ctrt_cust_cd
			    AND    x.sell_ctrt_no = a.ctrt_no) as ctrt_nm
			, a.ord_req_cust_cd 			                                                                  --오더요청고객코드
			, MACOMM_GETPTNNM_FN( a.ord_req_cust_cd) as ord_req_cust_nm			                            --오더요청고객명
			, a.bilg_cust_cd 				                                                                    --청구고객코드
			, MACOMM_GETPTNNM_FN( a.bilg_cust_cd ) AS bilg_cust_nm 				                              --청구고객명
			, a.cust_ofcr_nm 				                                                                    --고객담당자명
			, a.cust_ofcr_tel_no 			                                                                  --고객담당자전화번호
			, a.cust_of_cust_cd 			                                                                  --고객거래선코드
			, ( SELECT cust_nm 
			    from   tb_ma02020 
			    where  ptn_cd = ( select upper_ptn_cd 
			                      from   tb_ma01002 
			                      where  ptn_cd      = a.ctrt_cust_cd) 
			    and    cust_ptn_cd =	a.cust_of_cust_cd ) as cust_of_cust_nm		                        --고객거래선명
			, a.sup_pl_cd 				                                                                      --공급지코드
			, ( SELECT cust_nm 
			    from   tb_ma02020 
			    where  ptn_cd = ( select upper_ptn_cd 
			                      from   tb_ma01002 
			                      where  ptn_cd = a.ctrt_cust_cd) 
			    and    cust_ptn_cd = a.sup_pl_cd ) as sup_pl_nm		                                      --공급지명
			, a.plant_cd
			, a.cust_ref_no 				                                                                    --고객참조번호
			, a.dpt_ar_cd 				                                                                      --출발지코드
			, a.dpt_ar_type_cd 				                                                                  --출발지코드
			, case when a.dpt_ar_type_cd = '02' then
			          ( select name 
			            from   vw_ma01_01 
			            where  code         = a.dpt_ar_cd 
			            AND	   PTN_CD       = A.RPT_CUST_CD
			            and    work_sctn_cd = a.dpt_ar_type_cd) 
			       else 
			          ( select name 
			            from   vw_ma01_01 
			            where  code         = a.dpt_ar_cd 
			            and    work_sctn_cd = a.dpt_ar_type_cd
			            and    rownum       = 1) 
			  end as dpt_AR_NM   
			, a.dpt_ar_zip_cd 			                                                                    --출발지우편번호
			, a.dpt_ar_zip_addr 			                                                                  --출발지우편주소
			, a.dpt_ar_dtl_addr 			                                                                  --출발지상세주소
			, a.dpt_ar_ofcr_nm 			                                                                    --출발지 담당자명
			, a.dpt_ar_ofcr_tel_no 		                                                                  --출발지 전화번호
			, a.arv_ar_cd 				                                                                      --도착지 코드
			, a.arv_ar_type_cd 				                                                                  --도착지 코드
			, CASE WHEN a.arv_ar_type_cd = '02' THEN
			          ( select name 
			            from   vw_ma01_01 
			            where  code         = a.arv_ar_cd 
			            AND	   PTN_CD       = A.RPT_CUST_CD
			            and    work_sctn_cd = a.arv_ar_type_cd) 
			      ELSE 
			          ( select name 
			            from   vw_ma01_01 
			            where  code         = a.arv_ar_cd 
			            and    work_sctn_cd = a.arv_ar_type_cd
			            and    rownum       = 1) 
			  END as ARV_AR_NM   
			, a.arv_ar_zip_cd 			                                                                    --도착지우편번호
			, a.arv_ar_zip_addr 			                                                                  --도착지우편주소
			, a.arv_ar_dtl_addr 			                                                                  --도착지상세주소
			, a.arv_ar_ofcr_nm 			                                                                    --도착지담당자명
			, a.arv_ar_ofcr_tel_no 		                                                                  --도착지전화번호
			, a.work_pl_cd
			, a.strt_req_ymd 				                                                                    --시작요청일자
			, a.strt_req_hm 				                                                                    --시작요청시간
			, a.aptd_req_ymd 				                                                                    --납기요청일자
			, a.aptd_req_hm 				                                                                    --납기요청시간
			, LTrim(a.sell_dept_cd, '0') as sell_dept_cd 							                                  --매출부서코드
			, MACOMM_GETDEPTNM_FN( a.corp_cd, a.sell_dept_cd ) AS sell_dept_nm 	                        --매출부서명
			, a.sales_ofcr_id 			                                                                    --영업사원아이디
			, MACOMM_GETUSERNM_FN( a.sales_ofcr_id ) AS sales_ofcr_nm 			                            --영업사원명
			, a.sell_dcsn_sctn_cd 		                                                                        --매출확정구분코드
			, CASE WHEN (select NVL(MAX(d.dcsn_sctn_cd),'0') 
	             	  	 from tb_is01001 d 
	             	  	 where d.sales_ord_no = A.SALES_ORD_NO) < 2 THEN
	             	  	 '1'
	               ELSE '2' 
	          END  sell_dcsn_sctn_nm																				--매출확정구분명
			, a.cust_expr_yn 				                                                                    --고객긴급여부
			, a.cls_expr_yn 				                                                                    --마감긴급여부
			, a.lead_time_expr_yn 		                                                                  --리드타임긴급여부
			, a.dtod_yn      
			, a.rmk 						                                                                        --비고
			, a.load_dly_yn
			, a.load_dly_rltd_sales_ord_no
			, a.back_ord_yn 				                                                                    --대기오더여부
			, a.aft_ord_yn				                                                                      --사후오더여부
			, a.chg_aptd_ymd
			, a.chg_aptd_hm
			, a.sales_ord_creat_ymd 		                                                                --판매오더생성일자
			, a.sales_ord_creat_hms 		                                                                --판매오더생성시간
			, a.sales_ord_cncl_yn
			, to_char(a.sales_ord_cncl_date, 'yyyymmdd') as sales_ord_cncl_ymd		                      --판매오더취소일시
			, to_char(a.sales_ord_cncl_date, 'hh24miss') as sales_ord_cncl_Hms		                      --판매오더취소일시
			, a.SALES_ORD_CNCL_REASON		                                                                --판매오더취소사유
			, a.sales_ord_cmpt_sctn_cd 	                                                                --판매오더완료구분코드
			, MACOMM_GETCD_FN( 'SALES_ORD_CMPT_SCTN_CD', a.sales_ord_cmpt_sctn_cd) as sales_ord_cmpt_sctn_nm	--판매오더완료구분명
			, to_char(a.sales_ord_cmpt_date, 'yyyymmdd') as sales_ord_cmpt_ymd		                            --판매오더완료일시
			, to_char(a.sales_ord_cmpt_date, 'hh24miss') as sales_ord_cmpt_Hms		                            --판매오더완료일시
			, a.ORD_REASON_CD				                                                                          --오더사유
			, MACOMM_GETCD_FN('ORD_REASON_CD', a.ORD_REASON_CD) as ORD_REASON_CD      
			, a.RLTD_GI_ORD_NO			                                                                          --관련출고오더번호
			, a.work_info_mngt_type_cd 	                                                                      --작업정보관리유형코드
			, a.if_id
			, a.tran_eo_no
			, a.LTRM_ORD_YN				                                                                            --장기오더여부
			, a.rltd_gi_eo_no
			, DECODE( ( SELECT COUNT(*) 
			            FROM   TB_OM02002 
			            WHERE  SALES_ORD_NO = A.SALES_ORD_NO 
			             AND   (NVL(DPT_AR_CD, 'X') != nvl(A.DPT_AR_CD, 'X')
		                         OR NVL(DPT_AR_ZIP_CD, 'X') != nvl(A.DPT_AR_ZIP_CD, 'X') 
		                         OR NVL(DPT_AR_ZIP_CD, 'X') != nvl(A.DPT_AR_ZIP_CD, 'X')
		                         OR NVL(DPT_AR_ZIP_ADDR, 'X') != nvl(A.DPT_AR_ZIP_ADDR, 'X')
		                         OR NVL(DPT_AR_DTL_ADDR, 'X') != nvl(A.DPT_AR_DTL_ADDR, 'X')
		                         OR NVL(ARV_AR_CD, 'X') != nvl(A.ARV_AR_CD, 'X')
		                         OR NVL(ARV_AR_ZIP_CD, 'X') != nvl(A.ARV_AR_ZIP_CD, 'X')
		                         OR NVL(ARV_AR_ZIP_ADDR, 'X') != nvl(A.ARV_AR_ZIP_ADDR, 'X')
		                         OR NVL(ARV_AR_DTL_ADDR, 'X') != nvl(A.ARV_AR_DTL_ADDR, 'X')
		                         OR NVL(STRT_REQ_YMD, 'X') || NVL(STRT_REQ_HM, 'X') != nvl(A.STRT_REQ_YMD, 'X') || nvl(A.STRT_REQ_HM, 'X')
		                         OR NVL(APTD_REQ_YMD, 'X') || NVL(APTD_REQ_HM, 'X') != nvl(A.APTD_REQ_YMD, 'X') || nvl(A.APTD_REQ_HM, 'X') )  ), 0, 'N', 'Y') ITEM_DIFF_YN
			, A.LINE_SCTN_CD
			, A.DCNCT_ORD_YN
			, A.PAY_COND_CD	
			, A.MOVE_TYPE_CD	
			, (select comn_cd_nm from tb_ma01015 where clas_cd = 'MOVE_TYPE_CD' and comn_cd = a.move_type_cd) move_type_nm
			, A.TRAN_COND_CD		
			, A.GI_CNCL_REASON_CD
			, a.APTD_DLY_CD
			, a.SELF_TRAN_YN
			, a.CHG_APTD_YMD
			, a.CHG_APTD_HM
			  , (SELECT MAX(RSLT_SCTN_CD) 
			  	 FROM 	 TB_OM04002 
			  	 WHERE   SALES_ORD_NO = A.SALES_ORD_NO ) FWD_STAT_CD
			  , (SELECT COMN_CD_NM 
			  	 FROM TB_MA01015
			  	 WHERE	CLAS_CD 		= 'FWD_RSLT_SCTN_CD'
			  	 AND	COMN_CD 		= (SELECT MAX(RSLT_SCTN_CD) 
			  	 						   FROM 	 TB_OM04002 
			  	 						   WHERE   SALES_ORD_NO = A.SALES_ORD_NO) ) FWD_STAT_NM
			, C.col01
			, C.col02
			, C.col03
			, C.col04
			, decode(C.col04,'X','Y','N') inspect_yn
			, C.col05
			, C.col06
			, C.col07
			, C.col08
			, C.col09
			, C.col10
			, C.col11
			, C.col12
			, C.col13
			, C.col14
			, C.col15
			, C.col16
			, C.col17
			, C.col18
			, C.col19
			, C.col20
			, C.col21
			, C.col22
			, C.col23
			, C.col24
			, C.col25
			, C.col26
			, C.col27
			, C.col28
			, C.col29
			, C.col30
		    , '' as UPD_FLAG
		    , a.ord_verify_yn
		    , d.exp_type_cd
  	FROM	TB_OM02001 A
  		  , TB_OM02004 C
  		  , TB_MA01006 B
  		  , TB_OM02003 D
  	WHERE	A.ord_type_cd = B.ord_type_cd
  	AND	    A.SALES_ORD_NO = C.SALES_ORD_NO(+)
  	AND	    A.SALES_ORD_NO = D.SALES_ORD_NO(+)
  	{#1}
  	]]>
    <append condition="${salesOrdNo}.NOTEMPTY" id="#1">
    AND    A.SALES_ORD_NO  = ${salesOrdNo}
    </append>
  </statement>
  <statement name="retrieveExpImpSalesOrdExceMngtItem">
  <![CDATA[
  	SELECT   
			  a.sales_ord_no 
			, a.line_no 
			, a.cust_cd
			, a.item_cd 
			, b.item_nm
			, a.basis_item_cd
			, a.cust_ord_line_no
			, DECODE(NVL(a.item_grade_cd, ''), '', idusr.OMCOMM_GET_ITEM_INFO_FN(A.CUST_CD, A.ITEM_CD, 'ITEM_GRADE_CD', A.BAT_NO, A.ITEM_GRADE_CD)
											 , A.ITEM_GRADE_CD) AS ITEM_GRADE_CD_MST
			, a.item_grade_cd
			, a.ord_qty 
			, a.ord_qty as org_ord_qty
			, NVL(f.rslt_qty, 0) rslt_qty 
			, a.ord_qty - NVL(f.rslt_qty, 0) remain_qty
			, a.qty_unit_cd 
			, a.ord_wgt 
			, a.ord_wgt as org_ord_wgt
			, NVL(f.rslt_wgt, 0) rslt_wgt 
			, a.ord_wgt - NVL(f.rslt_wgt, 0) remain_wgt
			, a.wgt_unit_cd 
			, a.admt
			, a.admt as org_ord_admt
			, a.ord_cbm 
			, a.ord_cbm as org_ord_cbm
			, NVL(f.rslt_cbm , 0) rslt_cbm
			, a.ord_cbm - NVL(f.rslt_cbm, 0) remain_cbm
			, a.basis_unit_cd
			, a.bat_no 
			, a.cust_bat_no
			, a.mnf_no
			, a.lot_no 
			, a.prdt_req_no 
			, a.prdt_prar_ymd 
			, a.plant_cd 
			, MACOMM_GETWORKPLNM_FN( a.plant_cd, c.corp_cd) AS plant_nm 
			, a.sales_uprice 
			, a.cust_ref_no  
			, a.FE_SCTN_CD
			, a.CNTR_SIZE_CD
			, a.cntr_no
			, a.danger_sctn_cd
			, a.seal_no1
			, a.seal_no2
			, a.pckg_unit_cd
			, a.pckg_qty
			, a.max_tmpt
			, a.min_tmpt
			, a.dpt_ar_cd 
			, a.dpt_ar_type_cd 
			, CASE WHEN a.dpt_ar_type_cd = '02' THEN
			          ( SELECT name 
			            FROM   vw_ma01_01 
			            WHERE  code         = a.dpt_ar_cd 
			            AND	   PTN_CD       = C.RPT_CUST_CD
			            AND    work_sctn_cd = a.dpt_ar_type_cd) 
			       ELSE
			          ( SELECT name 
			            FROM   vw_ma01_01 
			            WHERE  code         = a.dpt_ar_cd 
			            AND    work_sctn_cd = a.dpt_ar_type_cd
			            AND    ROWNUM       = 1) 
			  END  as dpt_ar_nm
			, a.dpt_ar_zip_cd 
			, a.dpt_ar_zip_addr 
			, a.dpt_ar_dtl_addr 
			, a.dpt_ar_ofcr_nm 
			, a.dpt_ar_ofcr_tel_no 
			, a.arv_ar_cd 
			, a.arv_ar_type_cd 
			, CASE WHEN a.arv_ar_type_cd = '02' THEN
			          ( SELECT name 
			            FROM   vw_ma01_01 
			            WHERE  code         = a.arv_ar_cd 
			            AND	   PTN_CD       = C.RPT_CUST_CD
			            AND    work_sctn_cd = a.arv_ar_type_cd) 
			       ELSE
			          ( SELECT name 
			            FROM   vw_ma01_01 
			            WHERE  code         = a.arv_ar_cd 
			            AND    work_sctn_cd = a.arv_ar_type_cd
			            AND    ROWNUM       = 1) 
			  END  as arv_ar_nm
			, a.arv_ar_zip_cd 
			, a.arv_ar_zip_addr 
			, a.arv_ar_dtl_addr 
			, a.arv_ar_ofcr_nm 
			, a.arv_ar_ofcr_tel_no 
			, a.strt_req_ymd 
			, a.strt_req_hm 
			, a.strt_req_ymd || a.strt_req_hm strt_req_date
			, a.aptd_req_ymd 
			, a.aptd_req_hm 
			, a.aptd_req_ymd || a.aptd_req_hm aptd_req_date	    
			, a.ord_reason_cd
			, IDUSR.OMCOMM_GETCUSTREASONNM_FN(c.rpt_cust_cd, a.ord_reason_cd) AS ord_reason_nm
			, a.booking_no
			, a.prog_stat_cd
			, a.vanning_grp_id
			, a.prdt_ymd
			, a.pol_cd
			, a.schd_no
			, a.sctn_cd
			, a.rpt_item_nm
			, a.cls_expr_yn
			, a.lead_time_expr_yn
			, a.ltrm_ord_yn
			, a.rmk
			, a.exp_ord_no
			, a.dpt_port_prar_ymd
			, a.gi_req_ymd
			, a.std_wgt
			, a.pallet_qty
			, a.more_pmsr
			, a.less_pmsr
			, a.cntr_dcsn_ofcr_id
			, to_char(a.cntr_dcsn_date, 'yyyymmddhh24miss') cntr_dcsn_date
			, DECODE(NVL(a.pcul_cd, ''), '', idusr.OMCOMM_GET_ITEM_INFO_FN(A.CUST_CD, A.ITEM_CD, 'PCUL_CD', A.BAT_NO, A.pcul_cd)
										   , A.PCUL_CD) PCUL_CD_MST
			, DECODE(NVL(a.mn_cd, ''), '', idusr.OMCOMM_GET_ITEM_INFO_FN(A.CUST_CD, A.ITEM_CD, 'MN_CD', A.BAT_NO, A.mn_cd)
										   , A.mn_cd) mn_cd_MST
			, a.pcul_cd
			, a.mn_cd
			, a.pcul_cd
			, a.mn_cd
			, a.dcsn_yn
			, a.del_yn
			, c.cust_ord_no
			, a.CMPT_YMD
			, d.col01
			, d.col02
			, d.col03
			, d.col04
			, d.col05
			, d.col06
			, d.col07
			, d.col08
			, d.col09
			, d.col10
			, d.col11
			, d.col12
			, d.col13
			, d.col14
			, d.col15
			, d.col16
			, d.col17
			, d.col18
			, d.col19
			, d.col20
			, d.col21
			, d.col22
			, d.col23
			, d.col24
			, d.col25
			, d.col26
			, d.col27
			, d.col28
			, d.col29
			, decode(a.ord_verify_yn, 'N', d.col30, '') col30
			, '' as UPD_FLAG
			, a.ord_verify_yn
  	FROM TB_OM02002 A
  		, tb_ma02010 b
  		, tb_om02001 c
  		, tb_om02005 d
 		, (SELECT ee.line_no, SUM(ee.rslt_qty) rslt_qty, SUM(ee.rslt_wgt) rslt_wgt, SUM(ee.rslt_cbm) rslt_cbm
		  	 FROM tb_om03001 e, tb_om03002 ee
 		   WHERE e.SALES_ORD_NO = ${salesOrdNo}
 		   AND	 e.SALES_ORD_NO = ee.SALES_ORD_NO
 		   AND	 e.WORK_ROUTE_SEQ = ee.WORK_ROUTE_SEQ
 		   AND	 e.del_yn = 'N'
		   GROUP BY ee.line_no) F
  	WHERE  a.sales_ord_no = c.sales_ord_no
  	and	   a.cust_cd = b.ptn_cd
  	and	   a.item_cd = b.item_cd
	AND	   A.DEL_YN  != 'Y'
  	and	   a.sales_ord_no = d.sales_ord_no(+)
  	and	   a.line_no 	 = d.line_no(+)
  	AND	   A.LINE_NO	= F.LINE_NO(+)
  	{#1}
  	order by a.sales_ord_no
				, to_number(a.line_no)
  	]]>
    <append condition="${salesOrdNo}.NOTEMPTY" id="#1">
    AND    A.SALES_ORD_NO  = ${salesOrdNo}
    </append>
  	
  </statement>
  
  <statement name="retrieveExpImpSalesOrdExceFis">
  	SELECT
			  sales_ord_no
			, ocean_air_sctn_cd
			, MACOMM_GETCD_FN('OCEAN_AIR_SCTN_CD', A.ocean_air_sctn_cd) AS ocean_air_sctn_NM
			, fcl_lcl_sctn_cd
			, MACOMM_GETCD_FN('FCL_LCL_SCTN_CD', A.fcl_lcl_sctn_cd) AS fcl_lcl_sctn_NM
			, bl_kind_cd
			, MACOMM_GETCD_FN('BL_KIND_CD', A.BL_KIND_CD) AS BL_KIND_NM
			, hbl_no
			, mbl_no
			, ctry_cd
			, MACOMM_GETCD_FN('CTRY_CD', A.CTRY_CD) AS CTRY_NM
			, pol_cd
			, pol_nm
			, pod_cd
			, pod_nm
			, dlv_pl_cd
			, dlv_pl_nm
			, fdest_cd
			, fdest_nm
			, ship_co_cd
			, ship_co_nm			--Liner명
			, ship_co_agnt_cd
			, AIRLINE_CD
			, ship_nm
			, port_cnt
			, incoterms_cd
			, dpt_svc_term_cd
			, arv_svc_term_cd
			, mark_conts
			, desc_conts
			, dpt_port_prar_ymd
			, dpt_port_prar_hm
			, arv_port_prar_ymd
			, arv_port_prar_hm
			, shipper_cd
			, shipper_nm
			, shipper_addr1
			, shipper_addr2
			, shipper_addr3
			, shipper_addr4
			, cnee_cd
			, cnee_nm
			, cnee_addr1
			, cnee_addr2
			, cnee_addr3
			, cnee_addr4
			, ntfy_cd
			, ntfy_nm
			, ntfy_addr1
			, ntfy_addr2
			, ntfy_addr3
			, ntfy_addr4
			, ptn_cd
			, ptn_nm
			, ptn_ofcr_nm
			, lc_no
			, ci_no
			, cntr_kind_cd1
			, cntr_qty1
			, cntr_kind_cd2
			, cntr_qty2
			, cntr_kind_cd3
			, cntr_qty3
			, cntr_kind_cd4
			, cntr_qty4
			, cntr_kind_cd5
			, cntr_qty5
			, pckg_unit_cd
			, pckg_qty
			, tot_qty
			, qty_unit_cd
			, tot_wgt
			, wgt_unit_cd
			, tot_admt
			, tran_cost_wgt
			, tot_cbm
			, rpt_item_nm
			, danger_sctn_cd
			, bond_tran_yn
			, tran_cost_pay_cond_cd
			, extr_expn_pay_cond_cd
			, mnfest_dclr_tgt_yn
			, ts_cd1
			, ts_cd2
			, ts_cd3
			, carr_cd1
			, carr_cd2
			, carr_cd3
			, co_load_entp_cd
			, arv_port_ymd
			, cgwrk_ymd
			, det_frtime_days
			, dem_frtime_days
			, tot_frtime_days
			, frtime_expi_ymd
			, lc_expi_ymd
			, exp_cust_ord_sctn_cd
			, exp_type_cd
			, MACOMM_GETCD_FN('EXP_TYPE_CD', exp_type_cd) AS exp_type_nm
			, booking_no
			, fwd_eo_no
			, '' upd_flag
  	FROM	TB_OM02003 A
  	WHERE	1 = 1
  	{#1}
    <append condition="${salesOrdNo}.NOTEMPTY" id="#1">
    AND    A.SALES_ORD_NO  = ${salesOrdNo}
    </append>

  </statement>
  
  <statement name="retrieveImpCntrList">
        SELECT a.sales_ord_no
             , a.cntr_no
             , a.cntr_kind_cd
             , a.pckg_qty
             , a.pckg_unit_cd
             , b.item_cd
             , (SELECT item_nm FROM tb_ma02010 WHERE item_cd = b.item_cd and ptn_cd = b.cust_cd) as item_nm
             , b.ORD_QTY
			 , b.ORD_WGT
			 , b.QTY_UNIT_CD
			 , b.WGT_UNIT_CD
        FROM   tb_om02020 a
             , tb_om02021 b
        WHERE  a.sales_ord_no = b.sales_ord_no
        AND    a.cntr_no = b.cntr_no
  	{#1}
    <append condition="${salesOrdNo}.NOTEMPTY" id="#1">
    AND    A.SALES_ORD_NO  = ${salesOrdNo}
    </append>
  </statement>

  <statement name="retrieveSalesOrdPrclCount">
  	SELECT COUNT(*) cnt
  	FROM	TB_OM02004
  	WHERE	SALES_ORD_NO = ${salesOrdNo}
  </statement>

  <statement name="retrieveSalesOrdItemPrclCount">
  	SELECT COUNT(*) cnt
  	FROM	TB_OM02005
  	WHERE	SALES_ORD_NO = ${salesOrdNo}
  	AND		LINE_NO 	 = ${lineNo}
  </statement>


  <statement name="retrieveHblNo">
	   SELECT 'HSLC1'||LPAD(IDUSR.SQ_HOUSEBLNO.NEXTVAL,6,'0') hbl_no
       FROM   DUAL
  </statement>  

  <statement name="retrieveHblNo_max">
	   SELECT 'HSLC1'||lpad(nvl(max(substr(hbl_no,6,6)),0)+1,6,0) hbl_no
       FROM   tb_om02003
       WHERE  hbl_no LIKE 'HSLC1%'
       AND	  OCEAN_AIR_SCTN_CD = 'A'
  </statement>  
  
  <statement name="retrieveSalesOrdType">
        SELECT a.ord_type_cd, b.CMPD_TRAN_YN, a.rpt_cust_cd, b.logis_svc_sctn_cd, a.exp_imp_dom_sctn_cd
				,	(SELECT decode(nvl(SUM(decode(u.work_step_cd,'00001',1,'00002',1,0)),0),0,'N','Y')
					FROM   tb_ma01006 t
					      ,tb_om05002 u
					WHERE  t.std_work_route_no = u.std_work_route_no
					AND    t.ord_type_cd = A.ORD_TYPE_CD) AS IN_OUT_YN
       FROM   tb_om02001 a
       		, tb_ma01006 b
	   where 1 = 1
	   {#1}
	   AND	 A.ORD_TYPE_CD = B.ORD_TYPE_CD
		<append condition="${salesOrdNo}.NOTEMPTY" id="#1">
		AND    A.SALES_ORD_NO  = ${salesOrdNo}
		</append>
	   
  </statement>  

  <statement name="retrieveWorkStep">
		select  max(decode(work_step_cd,'00001','Y','N')) IN_WMS_YN
               ,max(decode(work_step_cd,'00002','Y','N')) OUT_WMS_YN
               ,max(decode(work_step_cd,'00003','Y','N')) TMS_YN
               ,count(*) cnt
  	  	  from tb_om03003 
	 	 where 1 = 1
	      {#1}
	   <append condition="${salesOrdNo}.NOTEMPTY" id="#1">
		   AND    SALES_ORD_NO  = ${salesOrdNo}
	   </append>
	   
  </statement>  
  
  <statement name="retrieveItemRsltCmptYn">
  <![CDATA[
	SELECT SALES_ORD_NO
	     , LINE_NO
	     , 
	     CASE WHEN ORD_REASON_CD IS NULL AND del_yn = 'N' THEN
		     	CASE WHEN	(LESS_PMSR IS NOT NULL AND ORD - (ORD * (LESS_PMSR/100) ) <= RSLT) THEN 'Y'
		     		 WHEN	(LESS_PMSR IS NULL AND ORD <= RSLT) THEN 'Y'
		     		 ELSE   'N'
		     	END
		      ELSE 'Y' 
		 END  CASE_YN
	FROM (
	      SELECT A.SALES_ORD_NO
	           , A.LINE_NO
	           , DECODE(FLTR_CONTS1, 'QTY_UNIT_CD', A.ORD_QTY, 'WGT_UNIT_CD', A.ORD_WGT, 'CBM', A.ORD_CBM) AS ORD
	           , DECODE(FLTR_CONTS1, 'QTY_UNIT_CD', B.RSLT_QTY, 'WGT_UNIT_CD', B.RSLT_WGT, 'CBM', B.RSLT_CBM) AS RSLT
	           , A.MORE_PMSR
	           , A.LESS_PMSR
	           , A.ORD_REASON_CD
	           , A.DEL_YN
	      FROM  (SELECT SALES_ORD_NO, LINE_NO, ORD_QTY, ORD_WGT, ORD_CBM, FLTR_CONTS1, MORE_PMSR, LESS_PMSR, ORD_REASON_CD, DEL_YN
	             FROM   TB_OM02002 A
	                  , TB_MA01015 B
	             WHERE  A.SALES_ORD_NO = ${salesOrdNo}
	             AND    B.CLAS_CD = 'BASIC_UNIT_CD'
	             AND    A.BASIS_UNIT_CD = B.COMN_CD
	             ) A
	           , (SELECT SALES_ORD_NO, LINE_NO, SUM(RSLT_QTY) RSLT_QTY, SUM(RSLT_WGT) RSLT_WGT, SUM(RSLT_CBM) RSLT_CBM
	              FROM   TB_OM03002
	              WHERE  SALES_ORD_NO = ${salesOrdNo}
	              GROUP BY SALES_ORD_NO, LINE_NO) B     
	      WHERE   A.SALES_ORD_NO = B.SALES_ORD_NO(+)
	      AND     A.LINE_NO = B.LINE_NO(+)       
	)      
	]]> 
  </statement>
  
	<statement name="retrieveExistSalesOrdBooking">
		SELECT  SALES_ORD_NO, BOOKING_NO
		FROM	TB_OM02019
		WHERE	SALES_ORD_NO = ${salesOrdNo}
	</statement>
  
  	<statement name="retrieveSalesOrdCmptYn">
  		SELECT COUNT(*) CNT
  		FROM	TB_OM02001
  		WHERE	SALES_ORD_NO = ${salesOrdNo}
  		AND		SALES_ORD_STAT_CD = ${salesOrdStatCd}
  	</statement>
  	<statement name="retrieveSalesOrdAutoCmptYn">
  		SELECT COUNT(*) CNT
  		FROM	TB_OM02001
  		WHERE	SALES_ORD_NO = ${salesOrdNo}
  		AND		SALES_ORD_STAT_CD = ${salesOrdStatCd}
  		AND		SALES_ORD_CMPT_SCTN_CD != '01'
  	</statement>

  	<statement name="retrieveSalesOrdItemCmptYn">
  		SELECT CASE WHEN COUNT(*) = SUM(DECODE(ORD_REASON_CD, '', 0, 1)) THEN 'Y'
                  ELSE 'N' END CMPT_YN
  		FROM	TB_OM02002
  		WHERE	SALES_ORD_NO = ${salesOrdNo}
  		AND		DEL_YN = 'N'
  	</statement>
  	
  	<statement name="retrieveExceptSalesOrdList">
  		SELECT SALES_ORD_NO
		FROM   TB_OM02001
		WHERE  (SALES_ORD_STAT_CD != ${salesOrdStatCd} AND SALES_ORD_CNCL_YN != 'Y')
		AND    ORD_TYPE_CD IN (SELECT ORD_TYPE_CD 
		                       FROM   TB_MA01006 
		                       WHERE  EXCEPT_ORD_YN = 'Y')
  	</statement>
  	
  	<statement name="retrieveImpBlSalesOrdNo">
		SELECT sales_ord_no
		FROM   tb_om02001
		WHERE  ctrt_cust_cd = ${custCd}
		AND    cust_ord_no = ${custOrdNo}
		AND	   SALES_ORD_CNCL_YN != 'Y'
  	</statement>
  	
  	<statement name="retrieveImpBlSalesOrd">
		SELECT  A.CTRT_CUST_CD
		      , MACOMM_GETPTNNM_FN(A.CTRT_CUST_CD) AS CTRT_CUST_NM
		      , a.rpt_cust_cd
		      , A.CUST_ORD_NO
		      , B.MBL_NO
		      , A.CARGO_FORM_CD
		      , B.ARV_PORT_PRAR_YMD
		      , A.ARV_AR_CD
			  , MACOMM_GETWORKPLNM_FN(  a.arv_ar_cd, a.corp_cd) AS arv_ar_nm
		      , B.ARV_PORT_YMD
		      , A.APTD_REQ_YMD
		      , B.CGWRK_YMD
		      , A.TRAN_COND_CD
		      , B.DET_FRTIME_DAYS
		      , B.DEM_FRTIME_DAYS
		      , B.TOT_FRTIME_DAYS
		      , B.FRTIME_EXPI_YMD
		      , TO_CHAR(A.CUST_ORD_RECP_DATE, 'YYYYMMDD') CUST_ORD_RECP_YMD
		      , TO_CHAR(A.CUST_ORD_RECP_DATE, 'HH24MISS') CUST_ORD_RECP_HMS
		      , B.SHIP_NM
		      , B.SHIP_CO_AGNT_CD
		      , MACOMM_GETPTNNM_FN(B.SHIP_CO_AGNT_CD)SHIP_CO_AGNT_NM
		      , B.POL_CD
			  , MACOMM_GETWORKPLNM_FN(  B.POL_CD, a.corp_cd) AS POL_NM
		      , B.CTRY_CD
		      , B.tot_qty as ORD_QTY
		      , B.QTY_UNIT_CD
		      , B.tot_admt as ADMT
		      , B.tot_wgt as ORD_WGT
		      , B.WGT_UNIT_CD
		      , A.RMK
		      , A.SALES_ORD_NO
		      , A.SALES_ORD_CREAT_YMD
		      , A.SALES_ORD_CREAT_HMS
		      , A.SALES_ORD_STAT_CD
			  , MACOMM_GETCD_FN('ORD_STAT_CD', a.sales_ord_stat_cd ) AS sales_ord_stat_nm
		      , A.CTRT_NO
			  , ( SELECT y.ctrt_nm
		    	  FROM   tb_sm04110 x, tb_sm07110 y
		    	  WHERE  x.corp_cd 	   = y.corp_cd
		    	  AND	 x.prmt_biz_no = y.prmt_biz_no
		    	  AND    x.cust_cd 	   = a.ctrt_cust_cd
		    	  AND    x.sell_ctrt_no = a.ctrt_no) as ctrt_nm
		      , A.ORD_TYPE_CD
			  , ( SELECT ord_type_nm
		  	      FROM	 TB_MA01006
		  	      WHERE	 ord_type_cd = a.ord_type_cd) as ord_type_nm
		      , a.ORD_MNGT_EXCE_DEPT_CD
		      , a.ORD_MNGT_EXCE_OFCR_ID
		      , a.EXP_IMP_DOM_SCTN_CD
		      , a.WORK_INFO_MNGT_TYPE_CD
		      , a.LINE_SCTN_CD
		      , A.BILG_CUST_CD
			  , LTrim(sell_dept_cd, '0') as sell_dept_cd
		      , A.SALES_OFCR_ID
		      , a.cust_cd
		      , a.ord_req_cust_cd
		      , b.ship_co_cd
		      , b.ship_co_nm
		      , a.if_id
		      , a.STRT_REQ_YMD  as dem_Arv_Port_Apply_Ymd
		      , a.CHG_APTD_YMD  as det_Arv_Port_Apply_Ymd
		      , b.CNTR_KIND_CD1
		      , nvl(b.CNTR_QTY1,0) as CNTR_QTY1
		FROM  TB_OM02001 A, TB_OM02003 B
		WHERE A.SALES_ORD_NO = B.SALES_ORD_NO
		AND	  A.SALES_ORD_NO = ${salesOrdNo}
  	</statement>

	<statement name="retrieveSalesOrdNo">
		SELECT sales_ord_no
		FROM   tb_om02001
		WHERE  cust_ord_no = ${salesOrdNo}
		AND		SALES_ORD_CNCL_YN != 'Y'
	</statement>

	<statement name="retrieveSalesOrdNoNew">
		SELECT sales_ord_no
		  FROM tb_om02001
		 WHERE cust_ord_no = ${salesOrdNo}
		   AND rpt_cust_cd = ${custCd}
		   AND SALES_ORD_CNCL_YN != 'Y'
	</statement>
  	
  	<statement name="retrieveImpBlSalesOrdItem">
		SELECT a.cust_ord_line_no
			 , a.line_no
			 , A.CUST_CD
		     , a.item_cd
		     , b.item_nm
		     , a.basis_unit_cd
		     , a.ord_qty
		     , a.qty_unit_cd
		     , a.admt ord_admt
		     , a.ord_wgt
		     , a.wgt_unit_cd
		     , a.BASIS_ITEM_CD org_item_cd
		     , a.bat_no
		     , a.arv_ar_cd
		     , a.aptd_req_ymd
		     , a.basis_item_cd
		     , a.work_cntr_cd
		     , (select work_pl_nm from tb_ma01005 where work_pl_cd = a.work_cntr_cd) work_cntr_nm
		     , '' flag
		     , a.plant_cd
		FROM   tb_om02002 a
			 , tb_ma02010 b
			 , tb_ma01002 c
		WHERE  a.sales_ord_no 	= ${salesOrdNo}
		and	   a.cust_cd 		= c.ptn_cd
		and	   c.upper_ptn_cd 	= b.ptn_cd
		and	   a.item_cd 		= b.item_cd
  	</statement>
  	
  	<statement name="retrieveImpBlSalesOrdCntr">
		SELECT a.cntr_no
			 , b.cust_cd
			 , MACOMM_GETCD_FN('CNTR_SIZ_TYP_SCTN', a.cntr_kind_cd ) AS cntr_kind_cd
		     , b.item_cd
		     , (select item_nm from tb_ma02010 where ptn_cd = b.cust_cd and item_cd = b.item_cd) item_nm
		     , a.pckg_qty
		     , a.pckg_unit_cd
		     , b.ord_wgt
		     , b.wgt_unit_cd
		     , '' flag
		FROM   tb_om02020 a
		     , tb_om02021 b
		WHERE  a.sales_ord_no = b.sales_ord_no
		AND    a.cntr_no      = b.cntr_no
		AND    a.sales_ord_no = ${salesOrdNo}
  	</statement>
  	
  	<statement name="retrieveAvailStock">

		select a.tot_stock_qty avail_stock
		from   tb_iv02001 a
		where  a.work_cntr_cd = ${workPlCd}
		and    a.ctrt_cust_cd = ${custCd}
		and    a.item_cd = ${itemCd}
		{#1}
	<append condition="${batCd}.NOTEMPTY" id="#1">
		and    a.cust_bat_no = ${batCd}
  	</append>
  	</statement>
  	
  	<statement name="retrieveImpGiOrdList">
		SELECT a.sales_ord_no
		     , a.cust_ord_no
		     , a.ord_type_cd
		     , a.rpt_cust_cd
		     , a.load_dly_yn
		     , a.LOAD_DLY_RLTD_SALES_ORD_NO
		     , b.cust_ord_line_no
		     , b.line_no
		     , b.arv_ar_cd
		     , b.arv_ar_type_cd
			  , case when b.arv_ar_type_cd = '02' then
		    	(select name 
		    	from vw_ma01_01 
		    	where code = b.arv_ar_cd 
		    	AND	  PTN_CD = a.RPT_CUST_CD
		    	and work_sctn_cd = b.arv_ar_type_cd) 
			  else 	    	
		    	(select name 
		    	from vw_ma01_01 
		    	where code = b.arv_ar_cd 
		    	and work_sctn_cd = b.arv_ar_type_cd
		    	and rownum = 1) 
		      end  as arv_ar_nm
		     , b.arv_ar_zip_cd
		     , b.arv_ar_zip_addr
		     , b.arv_ar_dtl_addr
		     , b.item_cd
		     , c.item_nm
		     , b.admt ord_admt
		     , b.wgt_unit_cd
			 , a.CUST_OFCR_NM
		     , a.ctrt_cust_cd
		     , b.dpt_ar_cd
		     , b.dpt_ar_type_cd
		     , b.dpt_ar_zip_cd
		     , b.dpt_ar_zip_addr
		     , b.dpt_ar_dtl_addr
		     , b.strt_req_ymd
		     , b.strt_req_hm
		     , b.aptd_req_ymd
		     , b.aptd_req_hm
	         , (SELECT wm_work_pl_cd FROM tb_ma01005 WHERE work_pl_cd = b.dpt_ar_cd AND wm_yn = 'Y') work_pl_cd
	         , a.ord_verify_yn
		FROM   tb_om02001 a
		     , tb_om02002 b
		     , TB_MA02010 c
		     , tb_om02003 d
		     , tb_ma01006 e
		WHERE  a.sales_ord_no = b.sales_ord_no     
		AND	   A.SALES_ORD_NO = D.SALES_ORD_NO
		AND    b.item_cd      = c.item_cd
		and	   b.cust_cd	  = c.ptn_cd
		AND	   A.EXP_IMP_DOM_SCTN_CD = '02'
		AND	   D.OCEAN_AIR_SCTN_CD = 'S'
		and	   e.ord_type_cd = a.ord_type_cd
		and	   e.LOGIS_AR_CD = '3'
		{#1}
		{#2}
		{#3}
		{#4}
		ORDER BY a.sales_ord_no
		     , a.cust_ord_no
		     , b.line_no
	<append condition="${ctrtCustCd}.NOTEMPTY" id="#1">
		AND    a.ctrt_cust_cd = ${ctrtCustCd}
	</append>
	<append condition="${dptArCd}.NOTEMPTY" id="#2">
		AND    a.dpt_ar_cd    = ${dptArCd}
	</append>
	<append condition="${aptdReqYmdFrom}.NOTEMPTY" id="#3">
		AND    b.aptd_req_ymd BETWEEN ${aptdReqYmdFrom}
	</append>
	<append condition="${aptdReqYmdTo}.NOTEMPTY" id="#4">
		AND    ${aptdReqYmdTo}
	</append>
  	</statement>
  	
  	<statement name="retrieveImpGiItemWorkRouteList">
		SELECT a.sales_ord_no
		     , a.work_route_seq
		     , a.ord_div_dgr_cnt
		     , b.line_no
		     , c.item_cd
		     , c.cust_cd
		     , d.ord_type_cd
		     , a.bl_no
		     , a.bl_cust_ord_no
		     , 0 AS avail_qty
		     , 0 AS avail_wgt
		     , 0 AS avail_admt
		     , b.ord_qty 
		     , b.ord_wgt
		     , b.admt ord_admt
		     , 0 AS bl_qty
		     , 0 AS bl_wgt
		     , 0 AS bl_admt
		     , decode((SELECT COUNT(*) 
		                FROM   tb_om04001
		                WHERE  sales_ord_no = a.sales_ord_no
		                AND    work_route_seq = a.work_route_seq
		                AND    work_step_seq = (SELECT work_step_seq
		                                        FROM   tb_om03003
		                                        WHERE  sales_ord_no = a.sales_ord_no
		                                        AND    work_route_seq = a.work_route_seq
		                                        AND    work_step_cd = '00002') ), 0, 'N', 'Y') output_yn
		      , c.dpt_ar_cd
		      , c.arv_ar_cd      
		      , c.arv_ar_type_cd
		     , c.dpt_ar_cd
		     , c.dpt_ar_type_cd
		     , c.dpt_ar_zip_cd
		     , c.dpt_ar_zip_addr
		     , c.dpt_ar_dtl_addr
		     , c.arv_ar_cd
		     , c.arv_ar_type_cd
		     , c.arv_ar_zip_cd
		     , c.arv_ar_zip_addr
		     , c.arv_ar_dtl_addr
		     , c.strt_req_ymd
		     , c.strt_req_hm
		     , c.aptd_req_ymd
		     , c.aptd_req_hm
		      , a.load_dly_yn
		      , a.load_dly_rltd_sales_ord_no
		      , a.DRCT_LOAD_YN
		      , d.tran_cond_cd
		FROM   tb_om03001 a
		     , tb_om03002 b
		     , tb_om02002 c
		     , tb_om02001 d
		WHERE  a.sales_ord_no = b.sales_ord_no
		AND    a.work_route_seq = b.work_route_seq
		AND    b.sales_ord_no = c.sales_ord_no
		AND    b.line_no      =  c.line_no
		and	   c.sales_ord_no = d.sales_ord_no
		AND    a.sales_ord_no = ${salesOrdNo}
		AND    b.line_no = ${lineNo}
		AND    a.del_yn = 'N'
  	</statement>
  	
  	<statement name="retrieveWrhsAvailStock">
  	<![CDATA[  	
	 SELECT nvl(max(whseid), '~') 								as WHSEID,
	        to_number(nvl(sum(nvl(CNTR_STOCK_QTY	, 0)), 0) ) as CNTR_STOCK_QTY,
	        to_number(nvl(sum(nvl(ALLOC_STOCK_QTY	, 0)), 0) ) as ALLOC_STOCK_QTY,
	        to_number(nvl(sum(nvl(PICKING_STOCK_QTY	, 0)), 0) ) as PICKING_STOCK_QTY,
	        to_number(nvl(sum(nvl(DLY_STOCK_QTY	 	, 0)), 0) ) as DLY_STOCK_QTY,
	        to_number(nvl(max(nvl(GI_PRAR_STOCK_QTY	, 0)), 0) ) as GI_PRAR_STOCK_QTY,
	        to_number(nvl(max(nvl(ASN_QTY			, 0)), 0) ) as ASN_QTY,
	        nvl(max(nvl(UOM, 0)), '~') 							as UNIT_CD
	   FROM {#2}
	  WHERE WHSEID 		= ${wmWorkPlCd}
	    AND STORERKEY 	= ${custCd}
	    AND SKU 		= ${itemCd} || ${batNo}
	    {#1}
	]]>	    
	<append condition="${lottable01}.NOTEMPTY" id="#1">
		AND	LOTTABLE01 	= ${lottable01}
	</append>	    
	<append condition="${lottable02}.NOTEMPTY" id="#1">
		AND	LOTTABLE02 	= ${lottable02}
	</append>	    
	<append condition="${lottable03}.NOTEMPTY" id="#1">
		AND	LOTTABLE03 	= ${lottable03}
	</append>	
	<append condition="${custCd}.EQ.R1209" id="#1">
		AND	trim(LOTTABLE03) 	= '02'
	</append>
	<append condition="${custCd}.EQ.R1728" id="#1">
		AND	trim(LOTTABLE03) 	= '02'
	</append>		    
	<append condition="${lottable04}.NOTEMPTY" id="#1">
		AND	LOTTABLE04 	= ${lottable04}
	</append>	    
	<append condition="${lottable05}.NOTEMPTY" id="#1">
		AND	LOTTABLE05 	= ${lottable05}
	</append>	    
	<append condition="${lottable06}.NOTEMPTY" id="#1">
		AND	LOTTABLE06 	= ${lottable06}
	</append>	    
	<append condition="${lottable07}.NOTEMPTY" id="#1">
		AND	LOTTABLE07 	LIKE ${lottable07}
	</append>	    
	<append condition="${lottable08}.NOTEMPTY" id="#1">
		AND	LOTTABLE08 	= ${lottable08}
	</append>	    
	<append condition="${lottable09}.NOTEMPTY" id="#1">
		AND	LOTTABLE09 	= ${lottable09}
	</append>	    
	<append condition="${lottable10}.NOTEMPTY" id="#1">
		AND	LOTTABLE10 	= ${lottable10}
	</append>	 
	<append condition="${wmWorkPlCd}.NOTEMPTY&amp;${inhYn}.EQ.Y"   id="#2">
		IDWAS.V_ATC
	</append>		   
	<append condition="${wmWorkPlCd}.NOTEMPTY&amp;${inhYn}.NE.Y"   id="#2">
		${wmWorkPlCd:not}.V_ATC
	</append>

  	</statement>

  	<statement name="retrieveWrhsAvailStockLepsilon">
  	<![CDATA[  	
	 SELECT nvl(max(wcode), '~') 								as WHSEID,
	        to_number(nvl(sum(nvl(CNTR_STOCK_QTY	, 0)), 0) ) as CNTR_STOCK_QTY,
	        to_number(nvl(sum(nvl(ALLOC_STOCK_QTY	, 0)), 0) ) as ALLOC_STOCK_QTY,
	        to_number(nvl(sum(nvl(PICKING_STOCK_QTY	, 0)), 0) ) as PICKING_STOCK_QTY,
	        to_number(nvl(sum(nvl(DLY_STOCK_QTY	 	, 0)), 0) ) as DLY_STOCK_QTY,
	        to_number(nvl(max(nvl(GI_PRAR_STOCK_QTY	, 0)), 0) ) as GI_PRAR_STOCK_QTY,
	        to_number(nvl(max(nvl(ASN_QTY			, 0)), 0) ) as ASN_QTY,
	        nvl(max(nvl(UOM, 0)), '~') 							as UNIT_CD
	   FROM V_ATC
	  WHERE WCODE 		= ${wmWorkPlCd}
	    AND OWNER 	    = ${custCd}
	    AND STOCK 		= ${itemCd}
	    {#1} 
	    {#2}
	    {#3}
	]]>	    

	<append condition="${custCd}.EQ.R1206" id="#1">
		and LOTABLE6    = ${itemGradeCd} 
	</append>

	<append condition="${custCd}.EQ.R1206&amp;${col01}.NOTEMPTY" id="#2">
		and to_char(nvl(LOTABLE7,'99991231'),'yyyymmdd') >=  ${col01} 
	</append>

	<append condition="${custCd}.EQ.E8001&amp;${lotNo}.NOTEMPTY" id="#3">
		and LOTABLE1  =  ${lotNo} 
	</append>

	<append condition="${custCd}.EQ.R1312&amp;${lotable5}.NOTEMPTY" id="#3">
		and LOTABLE8  =  ${lotable5} 
	</append>
	
  	</statement>


  	  	
  	<statement name="retrieveBlAvailStock">
		SELECT cust_ord_no
		     , mbl_no
		     , cargo_form_cd
		     , bat_no
		     , avail_qty
		     , (avail_qty * (bl_wgt/bl_qty) ) as avail_wgt
		     , decode(avail_admt, 0, (avail_qty * (bl_admt/bl_qty) ), avail_admt) as avail_admt
		     , bl_qty
		     , bl_wgt
		     , bl_admt
		     , TRAN_COND_CD
		FROM (
				SELECT cust_ord_no
				     , mbl_no
				     , cargo_form_cd
				     , bat_no
				     , decode(asn_stock_inc_yn, 'Y', avail_qty + asn_qty, avail_qty) AS avail_qty
				     , 0 as avail_wgt
				     , 0 AS avail_admt
				     , bl_qty
				     , bl_wgt
				     , bl_admt
				     , TRAN_COND_CD
				FROM (
				      SELECT a.cust_ord_no
				           , b.mbl_no
				           , a.cargo_form_cd
				           , c.bat_no
				           , f.asn_stock_inc_yn
				           , c.ord_qty AS bl_qty
				           , c.ord_wgt AS bl_wgt
				           , c.admt    AS bl_admt
				           , A.TRAN_COND_CD
		               	   , a.sales_ord_no
		               	   , c.item_cd
				      FROM   tb_om02001 a
				           , tb_om02003 b
				           , tb_om02002 c     
				           , tb_ma01002 f
				      WHERE  a.sales_ord_no = b.sales_ord_no
				      AND    a.sales_ord_no = c.sales_ord_no
				      AND    a.ctrt_cust_cd = ${custCd}
				      AND    c.work_cntr_cd = ${arvArCd}
				      AND    c.item_cd      = ${itemCd}
				      AND    a.ctrt_cust_cd = f.ptn_cd
		          	  AND    a.sales_ord_cncl_yn != 'Y'  ) a
				       , (SELECT a.sales_ord_no
				               , a.item_cd
				               , d.blno
				               , sum(d.cntr_stock_qty) - sum(d.alloc_stock_qty) - sum(d.picking_stock_qty) - sum(d.dly_stock_qty) - sum(d.gi_prar_stock_qty) AS avail_qty
						       , sum(d.asn_qty) asn_qty
						       , d.uom
				               , e.fltr_conts1
				          FROM   
						       {#1}
						       , tb_ma01015 e
				               , tb_om02002 a
				          WHERE  d.storerkey     = ${custCd}
				          AND    d.itemcd        = a.basis_item_cd
				          AND    a.item_cd       = ${itemCd}
				          AND    a.basis_unit_cd = e.comn_cd
				          AND    e.clas_cd       = 'BASIC_UNIT_CD'
				         GROUP BY a.sales_ord_no, a.item_cd, d.blno, d.uom, e.fltr_conts1) b
				WHERE    a.sales_ord_no = b.sales_ord_no
				AND      a.item_cd      = b.item_cd 
				and	     (a.mbl_no || a.cust_ord_no) = b.blno
			)
		<append condition="${workPlCd}.NOTEMPTY" id="#1">
				${workPlCd:not}.V_ATCBYBL@DL_WMS_IF d
		</append>
  	</statement>
  	
	<statement name="retrieveOrdMngtExceOfcrId">
		SELECT user_id
		FROM   tb_om05006
		WHERE  ord_chrg_dept_cd = ${ordChrgDeptCd}  
		AND    cust_cd = ${custCd} 
		AND    exp_imp_dom_sctn_cd = ${expImpDomSctnCd}
		AND	   main_ofcr_yn = 'Y'
	</statement>  	

	<statement name="retrieveDivideFwdEoNoExist">
		SELECT 	FWD_EO_NO eo_no
		FROM	TB_OM02019
		WHERE	BOOKING_NO 	 = ${bookingNo}
		AND		SALES_ORD_NO = ${salesOrdNo}
	</statement>

	<statement name="retrieveDivideFwdEoNoNotExist">
		SELECT 	FWD_EO_NO eo_no
		FROM	TB_OM02003
		WHERE	SALES_ORD_NO = ${salesOrdNo}
	</statement>
	
	<statement name="retrieveTransferFwdEo">
		SELECT		
				  ${eoNo} FWD_EO_NO
		        , (SELECT nvl(MAX(trms_seq), 0) + 1 FROM tb_om03011i WHERE FWD_EO_NO = ${eoNo}) AS trms_seq
				, ${trmsSctnCd} TRMS_SCTN_CD
				, a.SALES_ORD_NO
				, a.CORP_CD
				, a.EXP_IMP_DOM_SCTN_CD
				, a.CARGO_FORM_CD
				, a.sell_dept_cd as ORD_MNGT_FWD_DEPT_CD
				, a.ORD_MNGT_FWD_OFCR_ID
				, decode(nvl(a.CUST_ORD_NO, ''), '', a.cust_ref_no, a.cust_ord_no) cust_ord_no
				, a.bilg_cust_cd as ctrt_cust_cd
				, b.OCEAN_AIR_SCTN_CD
				, b.FCL_LCL_SCTN_CD
				, b.BL_KIND_CD
				, b.HBL_NO
				, b.MBL_NO
				, decode(nvl(${bookingNo}, ''), '', b.booking_no, c.SHIP_CO_BOOKING_NO) booking_no
				, decode(nvl(${bookingNo}, ''), '', '', c.BOOKING_YMD) booking_ymd
				
				, decode(nvl(${bookingNo}, ''), '', decode(b.POL_CD,'KRPUN','KRPUS',b.POL_CD), decode(c.pol_cd,'KRPUN','KRPUS',c.POL_CD)) pol_cd
				, decode(nvl(${bookingNo}, ''), '', decode(b.POL_CD,'KRPUN','BUSAN, KOREA',b.POL_NM), decode(c.pol_cd,'KRPUN','BUSAN, KOREA',c.pol_nm))	pol_nm
				
				, decode(nvl(${bookingNo}, ''), '', b.POD_CD, c.pod_cd)	pod_cd
				, decode(nvl(${bookingNo}, ''), '', b.POD_NM, c.pod_nm)	pod_nm
				, b.DLV_PL_CD
				, b.DLV_PL_NM
				, b.FDEST_CD
				, b.FDEST_NM
				, decode(nvl(${bookingNo}, ''), '', b.SHIP_CO_CD, c.ship_co_cd) ship_co_cd
				, substr(decode(nvl(${bookingNo}, ''), '', b.ship_co_nm, c.ship_co_nm), 1, 50) ship_co_nm
				, decode(nvl(${bookingNo}, ''), '', '', c.SHIP_CO_OFCR_NM) SHIP_CO_OFCR_NM
				, decode(nvl(${bookingNo}, ''), '', '', c.ship_co_tel_no) ship_co_tel_no
				, decode(nvl(${bookingNo}, ''), '', '', c.ship_co_fax_no) ship_co_fax_no
				, substr(decode(nvl(${bookingNo}, ''), '', b.SHIP_NM, c.SHIP_NM), 1, 25) SHIP_NM
				, decode(nvl(${bookingNo}, ''), '', b.PORT_CNT, c.PORT_CNT) PORT_CNT
				, b.airline_cd
				, MACOMM_GETCD_FN('IATA_CD', B.AIRLINE_CD) AIRLINE_NM
				, b.INCOTERMS_CD
				, b.DPT_SVC_TERM_CD
				, b.ARV_SVC_TERM_CD
				, decode(nvl(${bookingNo}, ''), '', b.DPT_PORT_PRAR_YMD, c.DPT_PORT_PRAR_YMD) DPT_PORT_PRAR_YMD
				, decode(nvl(${bookingNo}, ''), '', b.DPT_PORT_PRAR_HM, '') DPT_PORT_PRAR_HM
				, decode(nvl(${bookingNo}, ''), '', b.ARV_PORT_PRAR_YMD, c.ARV_PORT_PRAR_YMD) ARV_PORT_PRAR_YMD
				, decode(nvl(${bookingNo}, ''), '', b.ARV_PORT_PRAR_HM, '') ARV_PORT_PRAR_HM
				, decode(nvl(${bookingNo}, ''), '', '', c.CY_CLS_YMD) CY_CLS_YMD
				, decode(nvl(${bookingNo}, ''), '', '', c.CY_CLS_HMS) CY_CLS_HMS
				, decode(nvl(${bookingNo}, ''), '', '', c.SR_CLS_YMD) SR_CLS_YMD
				, decode(nvl(${bookingNo}, ''), '', '', c.SR_CLS_HMS) SR_CLS_HMS
				, decode(nvl(${bookingNo}, ''), '', '', c.CY_DTL_CONTS) CY_DTL_CONTS
				, b.SHIPPER_CD
				, b.SHIPPER_NM
				, b.SHIPPER_ADDR1
				, b.SHIPPER_ADDR2
				, b.SHIPPER_ADDR3
				, b.SHIPPER_ADDR4
				, b.CNEE_CD
				, b.CNEE_NM
				, b.CNEE_ADDR1
				, b.CNEE_ADDR2
				, b.CNEE_ADDR3
				, b.CNEE_ADDR4
				, b.NTFY_CD
				, b.NTFY_NM
				, b.NTFY_ADDR1
				, b.NTFY_ADDR2
				, b.NTFY_ADDR3
				, b.NTFY_ADDR4
				, b.PTN_CD
				, b.PTN_NM
				, b.PTN_OFCR_NM
				, b.LC_NO
				, b.CI_NO
				, decode(nvl(${bookingNo}, ''), '', b.CNTR_KIND_CD1, c.CNTR_KIND_CD1) CNTR_KIND_CD1
				, decode(nvl(${bookingNo}, ''), '', b.CNTR_QTY1, c.CNTR_QTY1) CNTR_QTY1
				, decode(nvl(${bookingNo}, ''), '', b.CNTR_KIND_CD2, c.CNTR_KIND_CD2) CNTR_KIND_CD2
				, decode(nvl(${bookingNo}, ''), '', b.CNTR_QTY2, c.CNTR_QTY2) CNTR_QTY2
				, decode(nvl(${bookingNo}, ''), '', b.CNTR_KIND_CD3, c.CNTR_KIND_CD3) CNTR_KIND_CD3
				, decode(nvl(${bookingNo}, ''), '', b.CNTR_QTY3, c.CNTR_QTY3) CNTR_QTY3
				, decode(nvl(${bookingNo}, ''), '', b.CNTR_KIND_CD4, c.CNTR_KIND_CD4) CNTR_KIND_CD4
				, decode(nvl(${bookingNo}, ''), '', b.CNTR_QTY4, c.CNTR_QTY4) CNTR_QTY4
				, decode(nvl(${bookingNo}, ''), '', b.CNTR_KIND_CD5, c.CNTR_KIND_CD5) CNTR_KIND_CD5
				, decode(nvl(${bookingNo}, ''), '', b.CNTR_QTY5, c.CNTR_QTY5) CNTR_QTY5
				, b.PCKG_UNIT_CD
				, b.PCKG_QTY
				, b.TOT_WGT
				, b.TRAN_COST_WGT
				, b.TOT_CBM
				, b.RPT_ITEM_NM
				, b.DANGER_SCTN_CD
				, b.BOND_TRAN_YN
				, b.TRAN_COST_PAY_COND_CD
				, b.EXTR_EXPN_PAY_COND_CD
				, b.MNFEST_DCLR_TGT_YN
				, a.CUST_OFCR_NM
				, a.CUST_OFCR_TEL_NO
		    , case when a.dpt_ar_type_cd = '02' then
		    	(select name 
		    	from vw_ma01_01 
		    	where code = a.dpt_ar_cd 
		    	AND	  PTN_CD = a.RPT_CUST_CD
		    	and work_sctn_cd = a.dpt_ar_type_cd) 
			  else 	    	
		    	(select name 
		    	from vw_ma01_01 
		    	where code = a.dpt_ar_cd 
		    	and work_sctn_cd = a.dpt_ar_type_cd
		    	and rownum = 1) 
		      end  as dpt_ar_nm
				
				, a.DPT_AR_OFCR_NM
				, a.DPT_AR_OFCR_TEL_NO
				, a.STRT_REQ_YMD
				, a.STRT_REQ_HM
				, a.SALES_OFCR_ID
		    	, MACOMM_GETUSERNM_FN( a.sales_ofcr_id ) AS sales_ofcr_nm
				, idusr.omcomm_makermk_fn(a.sales_ord_no) as RMK
				, b.TS_CD1
				, b.TS_CD2
				, b.TS_CD3
				, b.CARR_CD1
				, b.CARR_CD2
				, b.CARR_CD3
				, b.CO_LOAD_ENTP_CD
				, b.MARK_CONTS
				, b.DESC_CONTS
				, b.LC_EXPI_YMD
				, (SELECT min(CUSTOMS_DOC_NO) FROM tb_om02204i where cust_ord_no = a.cust_ord_no)	CUSTOMS_DOC_NO
				, 'N' if_yn
				, ${regrId} regr_id
				, ${mdfrId} mdfr_id
		FROM  tb_om02001 a
		    , tb_om02003 b
		    , tb_om02019 c
		WHERE a.sales_ord_no = b.sales_ord_no(+)
		AND   a.sales_ord_no = c.sales_ord_no(+)
		AND   a.sales_ord_no = ${salesOrdNo}
		{#1}
		<append condition="${bookingNo}.NOTEMPTY" id="#1">
			AND   c.booking_no(+) = ${bookingNo}
		</append>
	
	</statement>

	<statement name="retrieveTransferFwdEo_back">
		SELECT		
				  ${eoNo} FWD_EO_NO
		        , (SELECT nvl(MAX(trms_seq), 0) + 1 FROM tb_om03011i WHERE FWD_EO_NO = ${eoNo}) AS trms_seq
				, ${trmsSctnCd} TRMS_SCTN_CD
				, a.SALES_ORD_NO
				, a.CORP_CD
				, a.EXP_IMP_DOM_SCTN_CD
				, a.CARGO_FORM_CD
				, a.sell_dept_cd as ORD_MNGT_FWD_DEPT_CD
				, a.ORD_MNGT_FWD_OFCR_ID
				, decode(nvl(a.CUST_ORD_NO, ''), '', a.cust_ref_no, a.cust_ord_no) cust_ord_no
				, a.bilg_cust_cd as ctrt_cust_cd
				, b.OCEAN_AIR_SCTN_CD
				, b.FCL_LCL_SCTN_CD
				, b.BL_KIND_CD
				, b.HBL_NO
				, b.MBL_NO
				, decode(nvl(${bookingNo}, ''), '', b.booking_no, c.SHIP_CO_BOOKING_NO) booking_no
				, decode(nvl(${bookingNo}, ''), '', '', c.BOOKING_YMD) booking_ymd
				, decode(nvl(${bookingNo}, ''), '', b.POL_CD, c.pol_cd) pol_cd
				, decode(nvl(${bookingNo}, ''), '', b.POL_NM, c.pol_nm)	pol_nm
			
				, decode(nvl(${bookingNo}, ''), '', b.POD_CD, c.pod_cd)	pod_cd
				, decode(nvl(${bookingNo}, ''), '', b.POD_NM, c.pod_nm)	pod_nm
				, b.DLV_PL_CD
				, b.DLV_PL_NM
				, b.FDEST_CD
				, b.FDEST_NM
				, decode(nvl(${bookingNo}, ''), '', b.SHIP_CO_CD, c.ship_co_cd) ship_co_cd
				, substr(decode(nvl(${bookingNo}, ''), '', b.ship_co_nm, c.ship_co_nm), 1, 50) ship_co_nm
				, decode(nvl(${bookingNo}, ''), '', '', c.SHIP_CO_OFCR_NM) SHIP_CO_OFCR_NM
				, decode(nvl(${bookingNo}, ''), '', '', c.ship_co_tel_no) ship_co_tel_no
				, decode(nvl(${bookingNo}, ''), '', '', c.ship_co_fax_no) ship_co_fax_no
				, substr(decode(nvl(${bookingNo}, ''), '', b.SHIP_NM, c.SHIP_NM), 1, 25) SHIP_NM
				, decode(nvl(${bookingNo}, ''), '', b.PORT_CNT, c.PORT_CNT) PORT_CNT
				, b.airline_cd
				, MACOMM_GETCD_FN('IATA_CD', B.AIRLINE_CD) AIRLINE_NM
				, b.INCOTERMS_CD
				, b.DPT_SVC_TERM_CD
				, b.ARV_SVC_TERM_CD
				, decode(nvl(${bookingNo}, ''), '', b.DPT_PORT_PRAR_YMD, c.DPT_PORT_PRAR_YMD) DPT_PORT_PRAR_YMD
				, decode(nvl(${bookingNo}, ''), '', b.DPT_PORT_PRAR_HM, '') DPT_PORT_PRAR_HM
				, decode(nvl(${bookingNo}, ''), '', b.ARV_PORT_PRAR_YMD, c.ARV_PORT_PRAR_YMD) ARV_PORT_PRAR_YMD
				, decode(nvl(${bookingNo}, ''), '', b.ARV_PORT_PRAR_HM, '') ARV_PORT_PRAR_HM
				, decode(nvl(${bookingNo}, ''), '', '', c.CY_CLS_YMD) CY_CLS_YMD
				, decode(nvl(${bookingNo}, ''), '', '', c.CY_CLS_HMS) CY_CLS_HMS
				, decode(nvl(${bookingNo}, ''), '', '', c.SR_CLS_YMD) SR_CLS_YMD
				, decode(nvl(${bookingNo}, ''), '', '', c.SR_CLS_HMS) SR_CLS_HMS
				, decode(nvl(${bookingNo}, ''), '', '', c.CY_DTL_CONTS) CY_DTL_CONTS
				, b.SHIPPER_CD
				, b.SHIPPER_NM
				, b.SHIPPER_ADDR1
				, b.SHIPPER_ADDR2
				, b.SHIPPER_ADDR3
				, b.SHIPPER_ADDR4
				, b.CNEE_CD
				, b.CNEE_NM
				, b.CNEE_ADDR1
				, b.CNEE_ADDR2
				, b.CNEE_ADDR3
				, b.CNEE_ADDR4
				, b.NTFY_CD
				, b.NTFY_NM
				, b.NTFY_ADDR1
				, b.NTFY_ADDR2
				, b.NTFY_ADDR3
				, b.NTFY_ADDR4
				, b.PTN_CD
				, b.PTN_NM
				, b.PTN_OFCR_NM
				, b.LC_NO
				, b.CI_NO
				, decode(nvl(${bookingNo}, ''), '', b.CNTR_KIND_CD1, c.CNTR_KIND_CD1) CNTR_KIND_CD1
				, decode(nvl(${bookingNo}, ''), '', b.CNTR_QTY1, c.CNTR_QTY1) CNTR_QTY1
				, decode(nvl(${bookingNo}, ''), '', b.CNTR_KIND_CD2, c.CNTR_KIND_CD2) CNTR_KIND_CD2
				, decode(nvl(${bookingNo}, ''), '', b.CNTR_QTY2, c.CNTR_QTY2) CNTR_QTY2
				, decode(nvl(${bookingNo}, ''), '', b.CNTR_KIND_CD3, c.CNTR_KIND_CD3) CNTR_KIND_CD3
				, decode(nvl(${bookingNo}, ''), '', b.CNTR_QTY3, c.CNTR_QTY3) CNTR_QTY3
				, decode(nvl(${bookingNo}, ''), '', b.CNTR_KIND_CD4, c.CNTR_KIND_CD4) CNTR_KIND_CD4
				, decode(nvl(${bookingNo}, ''), '', b.CNTR_QTY4, c.CNTR_QTY4) CNTR_QTY4
				, decode(nvl(${bookingNo}, ''), '', b.CNTR_KIND_CD5, c.CNTR_KIND_CD5) CNTR_KIND_CD5
				, decode(nvl(${bookingNo}, ''), '', b.CNTR_QTY5, c.CNTR_QTY5) CNTR_QTY5
				, b.PCKG_UNIT_CD
				, b.PCKG_QTY
				, b.TOT_WGT
				, b.TRAN_COST_WGT
				, b.TOT_CBM
				, b.RPT_ITEM_NM
				, b.DANGER_SCTN_CD
				, b.BOND_TRAN_YN
				, b.TRAN_COST_PAY_COND_CD
				, b.EXTR_EXPN_PAY_COND_CD
				, b.MNFEST_DCLR_TGT_YN
				, a.CUST_OFCR_NM
				, a.CUST_OFCR_TEL_NO
		    , case when a.dpt_ar_type_cd = '02' then
		    	(select name 
		    	from vw_ma01_01 
		    	where code = a.dpt_ar_cd 
		    	AND	  PTN_CD = a.RPT_CUST_CD
		    	and work_sctn_cd = a.dpt_ar_type_cd) 
			  else 	    	
		    	(select name 
		    	from vw_ma01_01 
		    	where code = a.dpt_ar_cd 
		    	and work_sctn_cd = a.dpt_ar_type_cd
		    	and rownum = 1) 
		      end  as dpt_ar_nm
				
				, a.DPT_AR_OFCR_NM
				, a.DPT_AR_OFCR_TEL_NO
				, a.STRT_REQ_YMD
				, a.STRT_REQ_HM
				, a.SALES_OFCR_ID
		    	, MACOMM_GETUSERNM_FN( a.sales_ofcr_id ) AS sales_ofcr_nm
				, idusr.omcomm_makermk_fn(a.sales_ord_no) as RMK
				, b.TS_CD1
				, b.TS_CD2
				, b.TS_CD3
				, b.CARR_CD1
				, b.CARR_CD2
				, b.CARR_CD3
				, b.CO_LOAD_ENTP_CD
				, b.MARK_CONTS
				, b.DESC_CONTS
				, b.LC_EXPI_YMD
				, (SELECT min(CUSTOMS_DOC_NO) FROM tb_om02204i where cust_ord_no = a.cust_ord_no)	CUSTOMS_DOC_NO
				, 'N' if_yn
				, ${regrId} regr_id
				, ${mdfrId} mdfr_id
		FROM  tb_om02001 a
		    , tb_om02003 b
		    , tb_om02019 c
		WHERE a.sales_ord_no = b.sales_ord_no(+)
		AND   a.sales_ord_no = c.sales_ord_no(+)
		AND   a.sales_ord_no = ${salesOrdNo}
		{#1}
		<append condition="${bookingNo}.NOTEMPTY" id="#1">
			AND   c.booking_no(+) = ${bookingNo}
		</append>
	
	</statement>

	
	<statement name="retrieveTransferFwdEoItemList">
		SELECT ${eoNo} fwd_eo_no
		     , ${trmsSeq} trms_seq
		     , a.exp_dclr_no
		     , nvl((SELECT 	MAX(exp_dclr_no_seq) + 1 
		     		FROM 	tb_om03019i 
		        	WHERE 	fwd_eo_no = ${eoNo}
		        	AND   	trms_seq = ${trmsSeq}
		        	AND   	exp_dclr_no = a.exp_dclr_no), 1) exp_dclr_no_seq
		     , a.customs_doc_no
		     , a.pckg_qty
		     , a.dclr_wgt
		     , a.ptil_shmt_yn
		     , ${regrId} regr_id
		     , ${mdfrId} mdfr_id
		FROM   tb_om02203i a
		     , tb_om02204i b
		WHERE  a.customs_doc_no = b.customs_doc_no
		AND    a.exp_dclr_no = b.exp_dclr_no
		AND    b.cust_ord_no = (SELECT cust_ord_no
		                        FROM   tb_om02001
		                        WHERE  sales_ord_no = ${salesOrdNo})
	</statement>	
	
	<statement name="retrieveSalesOrdFromCustOrdNo">
		SELECT SALES_ORD_NO
		     , CORP_CD
		     , ORD_MNGT_EXCE_DEPT_CD
		     , ORD_MNGT_FWD_DEPT_CD
		     , ORD_MNGT_EXCE_OFCR_ID
		     , ORD_MNGT_FWD_OFCR_ID
		     , CTRT_NO
		     , ORD_REQ_CUST_CD
		     , BILG_CUST_CD
		     , SELL_DEPT_CD
		     , SALES_OFCR_ID
			 , SALES_ORD_STAT_CD
			 , SALES_ORD_CMPT_SCTN_CD
		FROM   TB_OM02001
		WHERE  CUST_ORD_NO = ${custOrdNo}
		{#1}
		<append condition="${rptCustCd}.NOTEMPTY" id="#1">
		AND    RPT_CUST_CD = ${rptCustCd}
		</append>
	</statement>

	<statement name="retrieveSalesOrdItemExpOrdCmpt">
		SELECT  SALES_ORD_NO
			  , LINE_NO
		      , BASIS_UNIT_CD
		FROM	TB_OM02002
		WHERE	EXP_ORD_NO = ${expOrdNo}
		AND     CUST_ORD_LINE_NO = ${custOrdLineNo}
		AND     DEL_YN = 'N'
	</statement>

	<statement name="retrieveSalesOrdItemOrdCmpt">
		SELECT  SALES_ORD_NO
			  , LINE_NO
		      , BASIS_UNIT_CD
		FROM	TB_OM02002
		WHERE	sales_ord_no  = (select sales_ord_no from tb_om02001 where cust_ord_no = ${custOrdNo})
		AND     CUST_ORD_LINE_NO = ${custOrdLineNo}
		AND     DEL_YN = 'N'
	</statement>


	<statement name="retrieveSalesOrdItemFromSalesOrd">
		SELECT  LINE_NO
		      , BASIS_UNIT_CD
		FROM	TB_OM02002
		WHERE	SALES_ORD_NO = ${salesOrdNo}
		AND     CUST_ORD_LINE_NO = ${custOrdLineNo}
	</statement>
	
	<statement name="retrieveSalesOrdItemFromCustOrd">
		SELECT  SALES_ORD_NO
			  , LINE_NO
		      , BASIS_UNIT_CD
		FROM	TB_OM02002
		WHERE	EXP_ORD_NO = ${expOrdNo}
		AND     CUST_ORD_LINE_NO = ${custOrdLineNo}
		AND		DEL_YN != 'Y'
	</statement>
	<statement name="retrieveFwdCntrCustCd">
		SELECT RPT_CUST_CD
			 , ORD_TYPE_CD
		FROM	(SELECT A.RPT_CUST_CD
					  , A.ORD_TYPE_CD
				 FROM	TB_OM02001 A
				 	  , TB_OM02003 B
			    WHERE  A.SALES_ORD_NO 	= B.SALES_ORD_NO
			    AND	   A.SALES_ORD_CNCL_YN != 'Y'
			    AND    B.FWD_EO_NO 		= ${fwdEoNo}
			    UNION ALL
			    SELECT A.RPT_CUST_CD
			    	  , A.ORD_TYPE_CD
			    FROM	TB_OM02001 A
			    	  , TB_OM02019 B
                WHERE   B.fwd_eo_no = ${fwdEoNo}
                AND     A.sales_Ord_no = B.sales_ord_no
                AND		A.SALES_ORD_CNCL_YN != 'Y') a
			    	  
	</statement>
	<statement name="retrieveSalesOrdFwdCntrEtc">
		SELECT SALES_ORD_NO
		     , BOOKING_NO
		     , CTRT_CUST_CD AS CUST_CD
		     , LINE_SCTN_CD
	         , exp_imp_dom_sctn_cd
		FROM	
			 (  SELECT A.SALES_ORD_NO
			         , '' BOOKING_NO
			         , A.CTRT_CUST_CD
			         , A.LINE_SCTN_CD
			         , a.exp_imp_dom_sctn_cd
				 FROM	TB_OM02001 A
				 	  , TB_OM02003 B
			    WHERE  A.SALES_ORD_NO 	= B.SALES_ORD_NO
			    AND	   A.SALES_ORD_CNCL_YN != 'Y'
			    AND    B.FWD_EO_NO 		= ${fwdEoNo}
			    UNION ALL
			    SELECT A.SALES_ORD_NO
			         , B.BOOKING_NO
			         , A.CTRT_CUST_CD
			         , A.LINE_SCTN_CD
			         , A.exp_imp_dom_sctn_cd
			    FROM	TB_OM02001 A
			    	  , TB_OM02019 B
                WHERE   B.fwd_eo_no = ${fwdEoNo}
                AND     A.sales_Ord_no = B.sales_ord_no
                AND		A.SALES_ORD_CNCL_YN != 'Y') a
	</statement>

	<statement name="retrieveSalesOrdFwdCntrCii">
        SELECT A.SALES_ORD_NO
		     , '' BOOKING_NO
		     , A.CTRT_CUST_CD AS CUST_CD
		     , A.LINE_SCTN_CD
		     , a.exp_imp_dom_sctn_cd
		  FROM TB_OM02001 A
			  ,TB_OM02003 B
	     WHERE A.SALES_ORD_NO 	    = B.SALES_ORD_NO
		   AND A.SALES_ORD_CNCL_YN != 'Y'
		   AND B.FWD_EO_NO 		    = ${fwdEoNo}
	</statement>
		
	<statement name="retrieveSalesOrdFwdCntr">
		SELECT SALES_ORD_NO
		     , BOOKING_NO
		     , CTRT_CUST_CD AS CUST_CD
		     , LINE_SCTN_CD
	         , exp_imp_dom_sctn_cd
		FROM (
		    SELECT A.SALES_ORD_NO
		         , '' BOOKING_NO
		         , A.CTRT_CUST_CD
		         , A.LINE_SCTN_CD
		         , a.exp_imp_dom_sctn_cd
		    FROM   tb_OM02001 A
		         , TB_OM02003 B
		    WHERE  A.SALES_ORD_NO 	= B.SALES_ORD_NO
		    AND	   A.SALES_ORD_CNCL_YN != 'Y'
		    AND    B.FWD_EO_NO 		= ${fwdEoNo}
		    UNION ALL
		    SELECT c.SALES_ORD_NO
		         , B.BOOKING_NO
		         , c.CTRT_CUST_CD
		         , c.LINE_SCTN_CD
		         , c.exp_imp_dom_sctn_cd
	        FROM    tb_om02019 b
	              , tb_om02001 c
	               , (SELECT nvl(a.ship_co_booking_no, 'x') AS ship_co_booking_no
	                       , b.rpt_cust_cd
	                       , a.ship_co_cd
	                       , a.pol_cd
	                       , a.pod_cd
	                       , a.dpt_port_prar_ymd
	                FROM    tb_om02019 a
	                      , tb_om02001 b
	                WHERE   fwd_eo_no = ${fwdEoNo}
	                AND     a.sales_Ord_no = b.sales_ord_no
	                AND		B.SALES_ORD_CNCL_YN != 'Y') a
	        WHERE   a.ship_co_booking_no = nvl(b.ship_co_booking_no, 'x')
	        AND     b.sales_ord_no 		 = c.sales_Ord_no
	        AND     c.rpt_cust_cd 		 = a.rpt_cust_cd
	        AND     a.ship_co_cd 		 = b.ship_co_cd
	        AND     a.pol_cd 			 = b.pol_cd
	        AND     a.pod_cd 			 = b.pod_cd
	        AND     a.dpt_port_prar_ymd  = b.dpt_port_prar_ymd 
	        AND		C.SALES_ORD_CNCL_YN  != 'Y'
	     )		    
    </statement>

	<statement name="retrieveFwdCntrChungwon_temp">
		SELECT A.SALES_ORD_NO
		     , b.col04 as CNTR_NO
		     , b.col05 as SEAL_NO1
		     , '' as SEAL_NO2
		     , to_char((select sum(ord_wgt) from tb_om02002 where sales_ord_no = a.sales_ord_no)) as cntr_wgt
		     , ''    as cntr_mea
		     , case when c.cargo_form_cd = '40FT' then '42GP'
		     		when c.cargo_form_cd = '20FT' then '22GP'
		     		else ''
		     		end 	as cntr_typ
		     , '' as pckg_qty	
		     , '' as PCKG_UNIT_CD
		     , '' as net_wgt
		     , '' as csr_no
		     , '' as cd_no
		     , '' as RPT_ITEM_NM
		from 	tb_om02001 a
			  , tb_om02004 b
			  , tb_om01001 c
		where	a.cust_ref_no = ( select  cust_ord_no 
								from 	tb_om02001 
								where 	sales_ord_no = ${salesOrdNo} )
		and		a.sales_ord_no = b.sales_ord_no
		and		a.cust_cd 		= c.cust_cd
		and		a.cust_ord_no = c.cust_ord_no
	</statement>
	
	<statement name="retrieveFwdCntrChungwon_temp1">
	    SELECT A.SALES_ORD_NO    AS  SALES_ORD_NO,
	           B.COL04           AS  CNTR_NO,
	           B.COL05           AS  SEAL_NO1,
	           ''                AS  SEAL_NO2,
               A.CNTR_WGT        AS  CNTR_WGT,
               CASE C.CARGO_FORM_CD  WHEN '20FT' THEN '16'
                                     WHEN '40FT' THEN '20'   END AS CNTR_MEA,
	           CASE C.CARGO_FORM_CD  WHEN '20FT' THEN '22GP'
		                             WHEN '40FT' THEN '42GP' END AS CNTR_TYP,
	           A.PCKG_QTY        AS PCKG_QTY,	
	           'RL'              AS PCKG_UNIT_CD,
	           ''                AS NET_WGT,
	           ''                AS CSR_NO,
	           ''                AS CD_NO,
	           ''                AS RPT_ITEM_NM
	      FROM  TB_OM02004 B,
		        TB_OM01001 C,
                ( SELECT H.CUST_CD                AS CUST_CD,
                         H.CUST_ORD_NO            AS CUST_ORD_NO, 
                         D.SALES_ORD_NO           AS SALES_ORD_NO,
                         TO_CHAR(SUM(D.ORD_WGT))  AS CNTR_WGT, 
                         TO_CHAR(SUM(D.ORD_QTY))  AS PCKG_QTY
                    FROM TB_OM02001  H,
                         TB_OM02002  D
                   WHERE H.CUST_REF_NO  = ( SELECT CUST_ORD_NO 
				                              FROM TB_OM02001 
					                         WHERE SALES_ORD_NO = ${salesOrdNo} )
                     AND D.SALES_ORD_NO =  H.SALES_ORD_NO
                   GROUP BY H.CUST_CD, H.CUST_ORD_NO, D.SALES_ORD_NO) A
 	      WHERE  A.SALES_ORD_NO   =   B.SALES_ORD_NO
	        AND  A.CUST_CD 	      =   C.CUST_CD
	        AND  A.CUST_ORD_NO    =   C.CUST_ORD_NO
	        AND  C.DEL_YN         =  'N'
		ORDER  BY B.COL04, B.COL05	        
	</statement>	

	<statement name="retrieveFwdCntrChungwon_backup">
	    SELECT ${salesOrdNo}     AS sales_ORD_NO,
	           B.COL04           AS  CNTR_NO,
	           B.COL05           AS  SEAL_NO1,
	           ''                AS  SEAL_NO2,
               cast(sum(A.CNTR_WGT) as varchar2(10))        AS  CNTR_WGT,
               CASE C.CARGO_FORM_CD  WHEN '20FT' THEN '16'
                                     WHEN '40FT' THEN '20'   END AS CNTR_MEA,
	           CASE C.CARGO_FORM_CD  WHEN '20FT' THEN '22GP'
		                             WHEN '40FT' THEN '42GP' END AS CNTR_TYP,
	           cast(sum(A.PCKG_QTY) as varchar2(10))        AS PCKG_QTY,	
	           'RL'              AS PCKG_UNIT_CD,
	           ''                AS NET_WGT,
	           ''                AS CSR_NO,
	           ''                AS CD_NO,
	           ''                AS RPT_ITEM_NM
	      FROM  TB_OM02004 B,
		        TB_OM01001 C,
                ( SELECT H.CUST_CD                AS CUST_CD,
                         H.CUST_ORD_NO            AS CUST_ORD_NO, 
                         D.SALES_ORD_NO           AS SALES_ORD_NO,
                         TO_CHAR(SUM(D.ORD_WGT))  AS CNTR_WGT, 
                         TO_CHAR(SUM(D.ORD_QTY))  AS PCKG_QTY
                    FROM TB_OM02001  H,
                         TB_OM02002  D
                   WHERE H.CUST_REF_NO  = ( SELECT CUST_ORD_NO 
				                              FROM TB_OM02001 
					                         WHERE SALES_ORD_NO = ${salesOrdNo} )
                     AND D.SALES_ORD_NO =  H.SALES_ORD_NO
                   GROUP BY H.CUST_CD, H.CUST_ORD_NO, D.SALES_ORD_NO) A
 	      WHERE  A.SALES_ORD_NO   =   B.SALES_ORD_NO
	        AND  A.CUST_CD 	      =   C.CUST_CD
	        AND  A.CUST_ORD_NO    =   C.CUST_ORD_NO
	        AND  C.DEL_YN         =  'N'
	    group by B.COL04, B.COL05,C.CARGO_FORM_CD
		ORDER  BY B.COL04, B.COL05	        
	</statement>	

	<statement name="retrieveFwdCntrChungwon">
	    SELECT ${salesOrdNo}     AS sales_ORD_NO,
	           B.COL04           AS  CNTR_NO,
	           min(B.COL05)           AS  SEAL_NO1,
	           ''                AS  SEAL_NO2,
               cast(sum(A.CNTR_WGT) as varchar2(10))        AS  CNTR_WGT,
               CASE C.CARGO_FORM_CD  WHEN '20FT' THEN '16'
                                     WHEN '40FT' THEN '20'   END AS CNTR_MEA,
	           CASE C.CARGO_FORM_CD  WHEN '20FT' THEN '22GP'
		                             WHEN '40FT' THEN '42GP' END AS CNTR_TYP,
	           cast(sum(A.PCKG_QTY) as varchar2(10))        AS PCKG_QTY,	
	           'RL'              AS PCKG_UNIT_CD,
	           ''                AS NET_WGT,
	           ''                AS CSR_NO,
	           ''                AS CD_NO,
	           ''                AS RPT_ITEM_NM
	      FROM  TB_OM02004 B,
		        TB_OM01001 C,
                ( SELECT H.CUST_CD                AS CUST_CD,
                         H.CUST_ORD_NO            AS CUST_ORD_NO, 
                         D.SALES_ORD_NO           AS SALES_ORD_NO,
                         TO_CHAR(SUM(D.ORD_WGT))  AS CNTR_WGT, 
                         TO_CHAR(SUM(D.ORD_QTY))  AS PCKG_QTY
                    FROM TB_OM02001  H,
                         TB_OM02002  D
                   WHERE H.CUST_REF_NO  = ( SELECT CUST_ORD_NO 
				                              FROM TB_OM02001 
					                         WHERE SALES_ORD_NO = ${salesOrdNo} )
                     AND D.SALES_ORD_NO =  H.SALES_ORD_NO
                   GROUP BY H.CUST_CD, H.CUST_ORD_NO, D.SALES_ORD_NO) A
 	      WHERE  A.SALES_ORD_NO   =   B.SALES_ORD_NO
	        AND  A.CUST_CD 	      =   C.CUST_CD
	        AND  A.CUST_ORD_NO    =   C.CUST_ORD_NO
	        AND  C.DEL_YN         =  'N'
	    group by B.COL04,C.CARGO_FORM_CD
		ORDER  BY B.COL04	        
	</statement>	

	
	<statement name="retrieveFwdCntrStc">
		SELECT A.SALES_ORD_NO
		     , A.CNTR_NO
		     , A.SEAL_NO1
		     , A.SEAL_NO2
		     , to_char(A.TOT_WGT)	    as cntr_wgt
		     , to_char(A.TOT_CBM)	    as cntr_mea
		     , A.CNTR_KIND_CD	as cntr_typ
		     , to_char(A.PCKG_QTY) as pckg_qty	
		     , A.PCKG_UNIT_CD
		     , to_char(A.NET_WGT) as net_wgt
		     , B.CUST_ORD_NO    as csr_no
		     , A.CUSTOMS_DOC_NO as cd_no
		     , A.RPT_ITEM_NM
		FROM   TB_OM02020 A
		     , TB_OM02001 B
		     , TB_OM02001 C
		WHERE  A.SALES_ORD_NO = B.SALES_ORD_NO
		AND	   A.SALES_ORD_NO = C.SALES_ORD_NO
		AND	   C.SALES_ORD_CNCL_YN != 'Y'
		AND    A.SALES_ORD_NO = ${salesOrdNo}
	</statement>

	<statement name="retrieveImpFwdCntr">
		SELECT A.SALES_ORD_NO
		     , A.CNTR_NO
		     , A.SEAL_NO1
		     , A.SEAL_NO2
		     , to_char(A.ORD_WGT)	as cntr_wgt
		     , to_char(A.ORD_CBM)	as cntr_mea
		     , A.ITEM_CD	as cntr_typ
		     , to_char(A.PCKG_QTY) pckg_qty
		     , A.PCKG_UNIT_CD
		     , ''  as NET_WGT
		     , '' as csr_no
		     , '' as cd_no
		     , '' AS RPT_ITEM_NM
		FROM   TB_OM02002 A
			 , TB_OM02001 B
		WHERE  A.SALES_ORD_NO = B.SALES_ORD_NO
		AND	   B.SALES_ORD_CNCL_YN != 'Y'
		AND	   A.SALES_ORD_NO = ${salesOrdNo}
		AND    A.DEL_YN = 'N'
	</statement>

	<statement name="retrieveExpFwdCntr">
		SELECT A.SALES_ORD_NO
		     , C.CNTR_NO
		     , C.SEAL_NO1
		     , C.SEAL_NO2
		     , to_char(A.ORD_WGT)	as cntr_wgt
		     , to_char(A.ORD_CBM)	as cntr_mea
		     , A.ITEM_CD	as cntr_typ
		     , to_char(DECODE(NVL(C.PCKG_QTY, 0), 0, A.PCKG_QTY, C.PCKG_QTY) ) as PCKG_QTY
		     , DECODE(NVL(C.PCKG_UNIT_CD, ''), '', A.PCKG_UNIT_CD, C.PCKG_UNIT_CD) as PCKG_UNIT_CD
		     , ''  as NET_WGT
		     , '' as csr_no
		     , '' as cd_no
		     , '' AS RPT_ITEM_NM
		FROM   TB_OM02002 A
		     , TB_OM03002 B
		     , TB_OM03014 C
		     , TB_OM02001 D
		WHERE  A.SALES_ORD_NO   = B.SALES_ORD_NO
		AND    A.LINE_NO        = B.LINE_NO
		AND    A.SALES_ORD_NO   = C.SALES_ORD_NO
		AND    B.WORK_ROUTE_SEQ = C.WORK_ROUTE_SEQ
		AND	   A.SALES_ORD_NO   = D.SALES_ORD_NO
		AND	   D.SALES_ORD_CNCL_YN != 'Y'
		AND    A.SALES_ORD_NO   = ${salesOrdNo}
		AND    A.DEL_YN         = 'N'
	</statement>

	<statement name="retrieveFwdCntrBooking_temp">
		SELECT A.SALES_ORD_NO
		     , A.CNTR_NO
		     , A.SEAL_NO1
		     , A.SEAL_NO2
		     , to_char((select sum(rslt_wgt)
		     	          from tb_om04001 x
		     		         , tb_om04003 y
		     	         where x.sales_ord_no 	 = y.sales_ord_no
		     	           and x.work_route_seq  = y.work_route_seq
		     	           and x.work_step_seq   = y.work_step_seq
		     	           and x.rslt_dgr_cnt 	 = y.rslt_dgr_cnt
          		           AND x.rslt_sctn_cd 	 = '04'
		     	           and x.sales_ord_no 	 = a.sales_ord_no
		     	           and x.work_route_seq = a.work_route_seq
		     	           and x.shipment_no 	 = a.shipment_no) ) as cntr_wgt
		     , ''  as cntr_mea
		     , a.CNTR_KIND_CD as cntr_typ
		     , ''  as PCKG_QTY
		     , '' as PCKG_UNIT_CD
		     , ''  as NET_WGT
		     , '' as csr_no
		     , '' as cd_no
		     , '' AS RPT_ITEM_NM
		 FROM  TB_OM03014 A
		     , TB_OM03001 B
		     , TB_OM02001 C
		WHERE  A.SALES_ORD_NO   = B.SALES_ORD_NO
		  AND  A.WORK_ROUTE_SEQ = B.WORK_ROUTE_SEQ
		  AND  A.SALES_ORD_NO	= C.SALES_ORD_NO
		  AND  A.SHIPMENT_NO NOT LIKE 'O%'
		  AND  C.SALES_ORD_CNCL_YN != 'Y'
		  AND  A.SALES_ORD_NO   = ${salesOrdNo} 
		  AND  B.BOOKING_NO     = ${bookingNo}
	</statement>

	<statement name="retrieveFwdCntrBooking">
        SELECT A.SALES_ORD_NO  AS  SALES_ORD_NO,
               A.CNTR_NO       AS  CNTR_NO,
               A.SEAL_NO1      AS  SEAL_NO1,
               A.SEAL_NO2      AS  SEAL_NO2,
               K.CNTR_WGT      AS  CNTR_WGT,
               CASE SUBSTR(A.CNTR_KIND_CD,1,1)  WHEN '2' THEN '16' 
                                                WHEN '4' THEN '20' END AS CNTR_MEA,
               A.CNTR_KIND_CD  AS  CNTR_TYP,
               K.PCKG_QTY      AS  PCKG_QTY,
               K.PCKG_UNIT_CD  AS  PCKG_UNIT_CD,
               ''              AS  NET_WGT,
               ''              AS  CSR_NO,
               ''              AS  CD_NO,
               ''              AS  RPT_ITEM_NM
          FROM  TB_OM03014 A,
                TB_OM03001 B,
                TB_OM02001 C,
                (SELECT H.SALES_ORD_NO     AS SALES_ORD_NO, 
                        H.WORK_ROUTE_SEQ   AS WORK_ROUTE_SEQ,    
                        CASE M.ITEM_LVL2_CD  WHEN '160100'  THEN  'RL' 
                                             ELSE  'PL'      
                        END    AS PCKG_UNIT_CD,
                        TO_CHAR(SUM(H.RSLT_WGT)) AS CNTR_WGT, 
                        TO_CHAR(SUM(CASE nvl(M.PALLET_RM,0)  WHEN 0  THEN H.RSLT_QTY 
                                                      ELSE H.RSLT_QTY / M.PALLET_RM  END))  AS PCKG_QTY
                   FROM TB_OM03002  H, 
                        TB_OM02002  D, 
                        TB_MA02010  M
                  WHERE H.SALES_ORD_NO    =   ${salesOrdNo}    
                    AND D.SALES_ORD_NO    =   H.SALES_ORD_NO
                    AND D.LINE_NO         =   H.LINE_NO
                    AND M.PTN_CD          =   D.CUST_CD
                    AND M.ITEM_CD         =   D.ITEM_CD
                  GROUP BY H.SALES_ORD_NO, H.WORK_ROUTE_SEQ, PCKG_UNIT_CD, 
                           (CASE M.ITEM_LVL2_CD WHEN '160100'  THEN  'RL' ELSE 'PL' END) )  K
          WHERE  A.SALES_ORD_NO       =  B.SALES_ORD_NO
            AND  A.WORK_ROUTE_SEQ     =  B.WORK_ROUTE_SEQ
            AND	 A.SALES_ORD_NO	      =  C.SALES_ORD_NO
            AND  A.SALES_ORD_NO       =  K.SALES_ORD_NO
            AND  A.WORK_ROUTE_SEQ     =  K.WORK_ROUTE_SEQ
            AND	 A.SHIPMENT_NO      NOT LIKE 'O%'
            AND	 C.SALES_ORD_CNCL_YN !=  'Y'
            AND  B.DEL_YN             =  'N'
		    AND  A.SALES_ORD_NO       =  ${salesOrdNo} 
		    AND  B.BOOKING_NO         =  ${bookingNo}
	</statement>


	<statement name="retrieveRptMoveTypeCd">
		SELECT a.move_type_cd, a.arv_ar_cd, ${custOfCustCd} cust_of_cust_cd
		  FROM tb_om02104 a
		 WHERE a.cust_cd 			= ${rptCustCd}
		   AND a.cust_ord_type_cd 	= nvl(${custOrdTypeCd}, 'NONE')
		   AND ( a.cust_move_type_cd  = nvl(${custMoveTypeCd},'NONE')
		         or a.cust_move_type_cd  = nvl(${custMoveTypeCd},'%'))
           {#2}
		   {#3}
		<append condition="${moveType}.NOTEMPTY" id="#2">
		   AND  A.MOVE_TYPE_CD LIKE ${moveType} || '%'
		</append>		
		<append condition="${custOrdTypeCd}.EQ.DOOR" id="#3">
		   order by arv_ar_cd 
		</append>		
		
	</statement>
	<statement name="retrieveRptMoveTypeCdLaf">
		SELECT a.move_type_cd
		  FROM tb_om02104 a
		 WHERE a.cust_cd 			= ${rptCustCd}
		   AND a.cust_ord_type_cd 	= ${custOrdTypeCd}
		{#1}
		<append condition="${moveType}.NOTEMPTY" id="#1">
		   AND  A.MOVE_TYPE_CD LIKE ${moveType} || '%'
		</append>		
	</statement>

	<statement name="retrieveRptMoveTypeCdHPOut">
		SELECT CASE WHEN cust_mpng_cd IS NOT NULL THEN
		                 decode(${arvArTypeCd}, '02'
		                                      , decode((SELECT work_pl_cd
		                                                  FROM tb_ma02020
		                                                 WHERE ptn_cd = ${rptCustCd}
		                                                   AND cust_ptn_cd = ${arvArCd}), '2100', 'Y', '1600', 'Y', '2000', 'Y' ,'2010' ,'Y' ,'3100','Y', '2040','Y', '2050','Y', '2060','Y','3200','Y','2020','Y','2030','Y', '2800','Y','N')
		                                      , 'N')
		            WHEN cust_mpng_cd IS NULL THEN
		              ''
		            ELSE ''
		       END arv_ar_cd
		  FROM tb_ma02020 a
		 WHERE a.ptn_cd      = ${rptCustCd}
		   AND a.cust_ptn_cd = ${custOfCustCd}
	</statement>

	<statement name="retrieveMoveTypeCd_back_20090706">
		SELECT a.move_type_cd, a.arv_ar_cd, b.cust_of_cust_cd
		  FROM tb_om02104 a
		     , tb_om02001 b
		 WHERE a.cust_cd 			= b.rpt_cust_cd
		   AND a.cust_ord_type_cd 	= nvl(b.cust_ord_type_cd, 'NONE')
		   AND nvl(b.cust_move_type_cd, '%') LIKE a.cust_move_type_cd
		   AND b.sales_ord_no 		= ${salesOrdNo}
		  {#1}
		<append condition="${moveType}.NOTEMPTY" id="#1">
		   AND A.MOVE_TYPE_CD LIKE ${moveType} || '%'
		</append>		
	</statement>
	
	<statement name="retrieveMoveTypeCd">
		SELECT a.move_type_cd, a.arv_ar_cd, b.cust_of_cust_cd
		  FROM tb_om02104 a
		     , tb_om02001 b
		 WHERE a.cust_cd 			= b.rpt_cust_cd
		   AND a.cust_ord_type_cd 	= nvl(b.cust_ord_type_cd, 'NONE')
		   AND (a.cust_move_type_cd  = nvl(b.cust_move_type_cd,'NONE')
		        or a.cust_move_type_cd  = nvl(b.cust_move_type_cd,'%'))	
		   AND b.sales_ord_no 		= ${salesOrdNo}
		  {#1}
		<append condition="${moveType}.NOTEMPTY" id="#1">
		   AND  A.MOVE_TYPE_CD LIKE ${moveType} || '%'
		</append>		
	</statement>	

	<statement name="retrieveMoveTypeCd_back">
		SELECT a.move_type_cd, a.arv_ar_cd, b.cust_of_cust_cd
		  FROM tb_om02104 a
		     , tb_om02001 b
		 WHERE a.cust_cd 			= b.rpt_cust_cd
		   AND a.cust_ord_type_cd 	= nvl(b.cust_ord_type_cd, 'NONE')
		   AND a.cust_move_type_cd  LIKE nvl(b.cust_move_type_cd, '%')
		   AND b.sales_ord_no 		= ${salesOrdNo}
		  {#1}
		<append condition="${moveType}.NOTEMPTY" id="#1">
		   AND A.MOVE_TYPE_CD LIKE ${moveType} || '%'
		</append>		
	</statement>	

	
	<statement name="retrieveMoveTypeCdLaf">
		SELECT a.move_type_cd
		  FROM tb_om02104 a
			 , tb_om02001 b
		 WHERE a.cust_cd 			= b.rpt_cust_cd
		   AND a.cust_ord_type_cd 	= b.cust_ord_type_cd
		   and b.sales_ord_no		= ${salesOrdNo}
		  {#1}
		<append condition="${moveType}.NOTEMPTY" id="#1">
		   AND A.MOVE_TYPE_CD LIKE ${moveType} || '%'
		</append>		
	</statement>


	<statement name="retrieveMoveTypeCdEve_back">
        select b.move_type_cd 
          from (
                 select a.cust_cd,a.cust_ord_type_cd,a.cust_move_type_cd
                       ,a.col01,a.col02,a.col03,a.col04,a.col05
                       ,a.move_type_cd ,a.dpt_ar_cd,a.arv_ar_cd
                       ,a.cust_ptn_cd,a.sales_ord_no,a.cust_ord_no
                       ,decode(a.col04,'Y',b.col05,decode(a.col05,'Y',b.col06,'')) gr_gi_type_cd
                       ,decode(a.col04,'Y',b.col05,'') gr_type_cd
                       ,decode(a.col05,'Y',b.col06,'') gi_type_cd 
                       ,a.trans_value
                   from (		
                         select a.cust_cd,a.cust_ord_type_cd,a.cust_move_type_cd
                               ,a.col01,a.col02,a.col03,a.col04,a.col05
                               ,a.move_type_cd 
                               ,b.dpt_ar_cd,b.arv_ar_cd
                               ,b.sales_ord_no
                               ,b.cust_ord_no
                      --       ,decode(a.col04,'Y',b.dpt_ar_cd,decode(a.col05,'Y',b.arv_ar_cd,'')) cust_ptn_cd
                               ,case when a.col04 = 'Y' then b.dpt_ar_cd
                                     when a.col05 = 'Y' then b.arv_ar_cd
                                else '' end cust_ptn_cd                      
                               ,a.col03 trans_value
                           from tb_om02104 a
                               ,tb_om02001 b
                               ,tb_om02004 c
                          where a.cust_cd            = b.rpt_cust_cd
                            and a.cust_cd            = ${custCd}
                            and b.sales_ord_no       = ${salesOrdNo}
                            and b.sales_ord_no       = c.sales_ord_no
                            and a.cust_ord_type_cd   = b.cust_ord_type_cd
                            and a.cust_move_type_cd  = b.cust_move_type_cd
                            and nvl(a.col03,c.col01) = c.col01	
                         ) a
                        ,tb_ma02020 b
                   where a.cust_cd = b.ptn_cd(+)
                     and a.cust_ptn_cd = b.cust_ptn_cd(+)
 --                    and rownum = 1
                 ) a
                ,tb_om02104 b 
         where b.cust_cd = a.cust_cd
           and b.cust_ord_type_cd = a.cust_ord_type_cd
           and b.cust_move_type_cd = a.cust_move_type_cd
           and nvl(b.col01,'Y') = nvl(a.gr_type_cd,'Y')
           and nvl(b.col02,'Y') = nvl(a.gi_type_cd,'Y')
           and nvl(b.col03,'Y') = nvl(a.trans_value,'Y')
		   {#1}           
		<append condition="${moveType}.NOTEMPTY" id="#1">
		   AND b.MOVE_TYPE_CD LIKE ${moveType} || '%'
		</append>	
	</statement>


	<statement name="retrieveMoveTypeCdEve">
        select b.move_type_cd 
          from (
                 select a.cust_cd,a.cust_ord_type_cd,a.cust_move_type_cd
                       ,a.col01,a.col02,a.col03,a.col04,a.col05
                       ,a.move_type_cd ,a.dpt_ar_cd,a.arv_ar_cd
                       ,a.cust_ptn_cd,a.sales_ord_no,a.cust_ord_no
                       ,decode(a.col04,'Y',a.gr_tran_cd,decode(a.col05,'Y',a.gi_tran_cd,'')) gr_gi_type_cd
                       ,decode(a.col04,'Y',a.gr_tran_cd,'') gr_type_cd
                       ,decode(a.col05,'Y',a.gi_tran_cd,'') gi_type_cd 
                       ,a.trans_value
                   from (		
                         select a.cust_cd,a.cust_ord_type_cd,a.cust_move_type_cd
                               ,a.col01,a.col02,a.col03,a.col04,a.col05
                               ,a.move_type_cd 
                               ,b.dpt_ar_cd,b.arv_ar_cd
                               ,b.sales_ord_no
                               ,b.cust_ord_no
                      --         ,decode(a.col04,'Y',b.dpt_ar_cd,decode(a.col05,'Y',b.arv_ar_cd,'')) cust_ptn_cd
                               ,case when a.col04 = 'Y' then b.dpt_ar_cd
                                     when a.col05 = 'Y' then b.arv_ar_cd
                                else '' end cust_ptn_cd                      
                               ,a.col03 trans_value
                               ,c.col05 gr_tran_cd
                               ,c.col06 gi_tran_cd
                           from tb_om02104 a
                               ,tb_om02001 b
                               ,tb_om02004 c
                          where a.cust_cd            = b.rpt_cust_cd
                            and a.cust_cd            = ${custCd}
                            and b.sales_ord_no       = ${salesOrdNo}
                            and b.sales_ord_no       = c.sales_ord_no
                            and a.cust_ord_type_cd   = b.cust_ord_type_cd
                            and a.cust_move_type_cd  = b.cust_move_type_cd
                            and nvl(a.col03,c.col01) = c.col01	
                         ) a
                  ) a
                ,tb_om02104 b 
         where b.cust_cd = a.cust_cd
           and b.cust_ord_type_cd = a.cust_ord_type_cd
           and b.cust_move_type_cd = a.cust_move_type_cd
           and nvl(b.col01,'Y') = nvl(a.gr_type_cd,'Y')
           and nvl(b.col02,'Y') = nvl(a.gi_type_cd,'Y')
           and nvl(b.col03,'Y') = nvl(a.trans_value,'Y')
		   {#1}           
		<append condition="${moveType}.NOTEMPTY" id="#1">
		   AND b.MOVE_TYPE_CD LIKE ${moveType} || '%'
		</append>	
	</statement>



	<statement name="retrieveMoveTypeCdEve_temp">
        select b.move_type_cd 
          from (
                 select a.cust_cd,a.cust_ord_type_cd,a.cust_move_type_cd
                       ,a.col01,a.col02,a.col03,a.col04,a.col05
                       ,a.move_type_cd ,a.dpt_ar_cd,a.arv_ar_cd
                       ,a.cust_ptn_cd,a.sales_ord_no,a.cust_ord_no
                       ,decode(a.col04,'Y',b.col01,decode(a.col05,'Y',b.col02,'')) gr_gi_type_cd
                       ,decode(a.col04,'Y',b.col05,'') gr_type_cd
                       ,decode(a.col05,'Y',b.col06,'') gi_type_cd 
                       ,a.trans_value
                   from (		
                         select a.cust_cd,a.cust_ord_type_cd,a.cust_move_type_cd
                               ,a.col01,a.col02,a.col03,a.col04,a.col05
                               ,a.move_type_cd 
                               ,b.dpt_ar_cd,b.arv_ar_cd
                               ,b.sales_ord_no
                               ,b.cust_ord_no
                      --       ,decode(a.col04,'Y',b.dpt_ar_cd,decode(a.col05,'Y',b.arv_ar_cd,'')) cust_ptn_cd
                               ,case when ${moveType} = '1' and a.col04 = 'Y' then b.dpt_ar_cd
                                     when ${moveType} = '2' and a.col05 = 'Y' then b.arv_ar_cd
                                else '' end cust_ptn_cd                      
                               ,a.col03 trans_value
                           from tb_om02104 a
                               ,tb_om02001 b
                               ,tb_om02004 c
                          where a.cust_cd            = b.rpt_cust_cd
                            and a.cust_cd            = ${custCd}
                            and b.sales_ord_no       = ${salesOrdNo}
                            and b.sales_ord_no       = c.sales_ord_no
                            and a.cust_ord_type_cd   = b.cust_ord_type_cd
                            and a.cust_move_type_cd  = b.cust_move_type_cd
                            and nvl(a.col03,c.col01) = c.col01	
                         ) a
                        ,tb_ma02020 b
                   where a.cust_cd = b.ptn_cd(+)
                     and a.cust_ptn_cd = b.cust_ptn_cd(+)
 --                    and rownum = 1
                 ) a
                ,tb_om02104 b 
         where b.cust_cd = a.cust_cd
           and b.cust_ord_type_cd = a.cust_ord_type_cd
           and b.cust_move_type_cd = a.cust_move_type_cd
           and nvl(b.col01,'Y') = nvl(a.gr_type_cd,'Y')
           and nvl(b.col02,'Y') = nvl(a.gi_type_cd,'Y')
           and nvl(b.col03,'Y') = nvl(a.trans_value,'Y')
		   {#1}           
		<append condition="${moveType}.NOTEMPTY" id="#1">
		   AND b.MOVE_TYPE_CD LIKE ${moveType} || '%'
		</append>	
	</statement>

	<statement name="retrieveEveCustOrdMoveTypeInfo">
        select a.cust_ord_type_cd,a.cust_move_type_cd,a.rpt_cust_cd
              ,a.cust_ord_no,a.sales_ord_no,b.col01
          from tb_om02001 a, tb_om02004 b
         where a.sales_ord_no = b.sales_ord_no(+)
           and a.sales_ord_no = ${salesOrdNo}
	</statement>

	
	<statement name="retrieveMoveTypeCdHPOut">
		SELECT CASE WHEN cust_mpng_cd IS NOT NULL THEN
		       decode(b.arv_ar_type_cd, '02'
		                              , decode((SELECT work_pl_cd
		                                       FROM   tb_ma02020
		                                       WHERE  ptn_cd = b.rpt_cust_cd
		                                       AND    cust_ptn_cd = b.arv_ar_cd), '2100', 'Y', '1600', 'Y', '2000', 'Y' ,'2010' ,'Y' ,'3100','Y', '2040','Y', '2050','Y', '2060','Y','3200','Y','2020','Y', '2030','Y','2800','Y','N')
		                              , 'N')
		         WHEN cust_mpng_cd IS NULL THEN
		              ''
		         ELSE ''
		         END arv_ar_cd
		FROM   tb_ma02020 a
		     , tb_om02001 b
		WHERE  a.ptn_cd = b.rpt_cust_cd
		AND    b.sales_ord_no = ${salesOrdNo}
		AND    b.cust_of_cust_cd = a.cust_ptn_cd
	</statement>
	
	<statement name="retrieveRptMoveTypeCdNosInput">
        SELECT A.MOVE_TYPE_CD
          FROM TB_OM02104 A
         WHERE A.CUST_CD = ${rptCustCd}
           AND A.CUST_ORD_TYPE_CD = ${custOrdTypeCd}
           AND DECODE(${expImpDomSctnCd}, '01', ${expImpDomSctnCd}, '%') = A.EXP_IMP_DOM_SCTN_CD
		  {#1}
		<append condition="${moveType}.NOTEMPTY" id="#1">
		   AND A.MOVE_TYPE_CD LIKE ${moveType} || '%'
		</append>		
	</statement>

	<statement name="retrieveMoveTypeCdNosInput">
        SELECT A.MOVE_TYPE_CD
          FROM TB_OM02104 A
             , TB_OM02001 B
         WHERE A.CUST_CD = B.RPT_CUST_CD
           AND A.CUST_ORD_TYPE_CD = B.CUST_ORD_TYPE_CD
           AND A.EXP_IMP_DOM_SCTN_CD = DECODE(B.EXP_IMP_DOM_SCTN_CD, '01', B.EXP_IMP_DOM_SCTN_CD, '%')
           AND B.SALES_ORD_NO  = ${salesOrdNo}
		  {#1}
		<append condition="${moveType}.NOTEMPTY" id="#1">
		   AND A.MOVE_TYPE_CD LIKE ${moveType} || '%'
		</append>		
	</statement>

	<statement name="retrieveRptMoveTypeCdNosOutput">
        SELECT A.MOVE_TYPE_CD
          FROM TB_OM02104 A
         WHERE A.CUST_CD = ${rptCustCd}
           AND NVL(${custOrdTypeCd}, '%') = A.CUST_ORD_TYPE_CD
           AND ${selfGdsCd} LIKE DECODE(${custOrdTypeCd}, '1', A.SELF_GDS_CD, '%') 
           AND DECODE(${expImpDomSctnCd}, '01', ${expImpDomSctnCd}, '%') = A.EXP_IMP_DOM_SCTN_CD
		   {#1}
		<append condition="${moveType}.NOTEMPTY" id="#1">
		   AND A.MOVE_TYPE_CD LIKE ${moveType} || '%'
		</append>		
	</statement>
	
	<statement name="retrieveMoveTypeCdNosOutput">
        SELECT A.MOVE_TYPE_CD
          FROM TB_OM02104 A
             , TB_OM02001 B
         WHERE A.CUST_CD = B.RPT_CUST_CD
           AND NVL(B.CUST_ORD_TYPE_CD, '%') = A.CUST_ORD_TYPE_CD
           AND (SELECT COL04 FROM TB_OM02005 WHERE SALES_ORD_NO = B.SALES_ORD_NO AND ROWNUM = 1)
                LIKE  DECODE(B.CUST_ORD_TYPE_CD, '1', A.SELF_GDS_CD, '%') 
           AND DECODE(B.EXP_IMP_DOM_SCTN_CD, '01', B.EXP_IMP_DOM_SCTN_CD, '%') = A.EXP_IMP_DOM_SCTN_CD
           AND B.SALES_ORD_NO  = ${salesOrdNo}
		  {#1}
		<append condition="${moveType}.NOTEMPTY" id="#1">
		   AND A.MOVE_TYPE_CD LIKE ${moveType} || '%'
		</append>		
	</statement>
	
	<statement name="retrieveRptMoveTypeCdCommonInput">
        SELECT a.move_type_cd
          FROM TB_OM02105 a
         WHERE a.ord_kind_cd = (SELECT ord_kind_cd FROM tb_ma01006 WHERE ord_type_cd = ${ordTypeCd})
           AND a.exp_imp_dom_sctn_cd = ${expImpDomSctnCd}
           AND decode((SELECT COUNT(*) 
                         FROM tb_om02105 
                        WHERE ord_kind_cd = a.ord_kind_cd 
                          AND exp_imp_dom_sctn_cd = a.exp_imp_dom_sctn_cd 
                          AND dpt_ar_type_cd = ${dptArTypeCd}
                          AND arv_ar_type_cd = a.arv_ar_type_cd), 0, '%', ${dptArTypeCd}) = a.dpt_ar_type_cd
           AND decode(nvl(${arvArTypeCd}, '0000'), '0000', '%', decode(substr(${arvArTypeCd},1,2),'03', '%', ${arvArTypeCd})) = a.arv_ar_type_cd
           AND A.MOVE_TYPE_CD LIKE ${moveTypeCd}||'%'
	</statement>

	<statement name="retrieveMoveTypeCdCommonInput">
        SELECT /* retrieveMoveTypeCdCommonInput 2013.04.30 */
               --a.move_type_cd
               case when B.RPT_CUST_CD = 'P1000' AND B.CUST_MOVE_TYPE_CD IN ('Z25', 'Z27', 'Z31') THEN
                   '1601'
                   when B.RPT_CUST_CD = 'P1591' AND B.CUST_MOVE_TYPE_CD IN ('Z25', 'Z27', 'Z31') THEN
                   '1601'
		       ELSE 
		           a.move_type_cd
		       END as move_type_cd
          FROM TB_OM02105 a
              ,tb_om02001 b
         WHERE a.ord_kind_cd = (SELECT ord_kind_cd FROM tb_ma01006 WHERE ord_type_cd = b.ord_type_cd)
           AND a.exp_imp_dom_sctn_cd = b.exp_imp_dom_sctn_cd
           AND decode((SELECT COUNT(*) 
                         FROM tb_om02105 
                        WHERE ord_kind_cd = a.ord_kind_cd 
                          AND exp_imp_dom_sctn_cd = a.exp_imp_dom_sctn_cd 
                          AND dpt_ar_type_cd = ${dptArTypeCd}
                          AND arv_ar_type_cd = a.arv_ar_type_cd), 0, '%', ${dptArTypeCd}) = a.dpt_ar_type_cd
           AND decode(nvl(${arvArTypeCd}, '0000'), '0000', '%', decode(substr(${arvArTypeCd},1,2),'03', '%', ${arvArTypeCd})) = a.arv_ar_type_cd
           AND b.sales_ord_no = ${salesOrdNo}
           AND A.MOVE_TYPE_CD LIKE ${moveTypeCd}||'%'
	</statement>

	<statement name="retrieveRptMoveTypeCdCommonOutput">
        SELECT a.move_type_cd
          FROM TB_OM02105 a
         WHERE a.ord_kind_cd = (SELECT ord_kind_cd FROM tb_ma01006 WHERE ord_type_cd = ${ordTypeCd})
           AND a.exp_imp_dom_sctn_cd = ${expImpDomSctnCd}
           AND decode(nvl(${dptArTypeCd}, '0000'), '0000', '%', decode(substr(${dptArTypeCd},1,2),'03', '%', ${dptArTypeCd})) = a.dpt_ar_type_cd
           AND decode((SELECT COUNT(*) 
                         FROM tb_om02105 
                        WHERE ord_kind_cd = a.ord_kind_cd 
                          AND exp_imp_dom_sctn_cd = a.exp_imp_dom_sctn_cd 
                          AND arv_ar_type_cd = ${arvArTypeCd}
                          AND dpt_ar_type_cd = a.dpt_ar_type_cd), 0, '%', ${arvArTypeCd}) = a.arv_ar_type_cd
           AND A.MOVE_TYPE_CD LIKE ${moveTypeCd}||'%'
	</statement>

	<statement name="retrieveMoveTypeCdCommonOutput">
        SELECT /* retrieveMoveTypeCdCommonOutput 2013.04.30 */
               a.move_type_cd
          FROM TB_OM02105 a
             , tb_om02001 b
         WHERE a.ord_kind_cd = (SELECT ord_kind_cd FROM tb_ma01006 WHERE ord_type_cd = b.ord_type_cd)
           AND a.exp_imp_dom_sctn_cd = b.exp_imp_dom_sctn_cd
           AND decode(nvl(${dptArTypeCd}, '0000'), '0000', '%', decode(substr(${dptArTypeCd},1,2),'03', '%', ${dptArTypeCd})) = a.dpt_ar_type_cd
           AND decode((SELECT COUNT(*) 
                         FROM tb_om02105 
                        WHERE ord_kind_cd = a.ord_kind_cd 
                          AND exp_imp_dom_sctn_cd = a.exp_imp_dom_sctn_cd 
                          AND arv_ar_type_cd = ${arvArTypeCd}
                          AND dpt_ar_type_cd = a.dpt_ar_type_cd), 0, '%', ${arvArTypeCd}) = a.arv_ar_type_cd
           AND b.sales_ord_no = ${salesOrdNo}
           AND A.MOVE_TYPE_CD LIKE ${moveTypeCd}||'%'
	</statement>
	
	<statement name="retrieveSalesOrdFISOrdInfo">
	    SELECT SALES_ORD_NO
			  ,OCEAN_AIR_SCTN_CD
			  ,FCL_LCL_SCTN_CD
			  ,BL_KIND_CD
			  ,HBL_NO
			  ,MBL_NO
			  ,CTRY_CD
			  ,POL_CD
			  ,POL_NM
			  ,POD_CD
			  ,POD_NM
			  ,DLV_PL_CD
			  ,DLV_PL_NM
			  ,FDEST_CD
			  ,FDEST_NM
			  ,SHIP_CO_CD
			  ,SHIP_CO_NM
			  ,SHIP_CO_AGNT_CD
			  ,AIRLINE_CD
			  ,SHIP_NM
			  ,PORT_CNT
			  ,INCOTERMS_CD
			  ,DPT_SVC_TERM_CD
			  ,ARV_SVC_TERM_CD
			  ,MARK_CONTS
			  ,DESC_CONTS
			  ,DPT_PORT_PRAR_YMD
			  ,DPT_PORT_PRAR_HM
			  ,ARV_PORT_PRAR_YMD
			  ,ARV_PORT_PRAR_HM
			  ,SHIPPER_CD
			  ,SHIPPER_NM
			  ,SHIPPER_ADDR1
			  ,SHIPPER_ADDR2
			  ,SHIPPER_ADDR3
			  ,SHIPPER_ADDR4
			  ,CNEE_CD
			  ,CNEE_NM
			  ,CNEE_ADDR1
			  ,CNEE_ADDR2
			  ,CNEE_ADDR3
			  ,CNEE_ADDR4
			  ,NTFY_CD
			  ,NTFY_NM
			  ,NTFY_ADDR1
			  ,NTFY_ADDR2
			  ,NTFY_ADDR3
			  ,NTFY_ADDR4
			  ,PTN_CD
			  ,PTN_NM
			  ,PTN_OFCR_NM
			  ,LC_NO
			  ,CI_NO
			  ,CNTR_KIND_CD1
			  ,CNTR_QTY1
			  ,CNTR_KIND_CD2
			  ,CNTR_QTY2
			  ,CNTR_KIND_CD3
			  ,CNTR_QTY3
			  ,CNTR_KIND_CD4
			  ,CNTR_QTY4
			  ,CNTR_KIND_CD5
			  ,CNTR_QTY5
			  ,PCKG_UNIT_CD
			  ,PCKG_QTY
			  ,TOT_QTY
			  ,QTY_UNIT_CD
			  ,TOT_WGT
			  ,WGT_UNIT_CD
			  ,TOT_ADMT
			  ,TRAN_COST_WGT
			  ,TOT_CBM
			  ,RPT_ITEM_NM
			  ,DANGER_SCTN_CD
			  ,BOND_TRAN_YN
			  ,TRAN_COST_PAY_COND_CD
			  ,EXTR_EXPN_PAY_COND_CD
			  ,MNFEST_DCLR_TGT_YN
			  ,TS_CD1
			  ,TS_CD2
			  ,TS_CD3
			  ,CARR_CD1
			  ,CARR_CD2
			  ,CARR_CD3
			  ,CO_LOAD_ENTP_CD
			  ,ARV_PORT_YMD
			  ,CGWRK_YMD
			  ,DET_FRTIME_DAYS
			  ,DEM_FRTIME_DAYS
			  ,TOT_FRTIME_DAYS
			  ,FRTIME_EXPI_YMD
			  ,LC_EXPI_YMD
			  ,EXP_CUST_ORD_SCTN_CD
			  ,EXP_TYPE_CD
			  ,BOOKING_NO
			  ,FWD_EO_NO
	      FROM TB_OM02003
         WHERE SALES_ORD_NO = ${salesOrdNo}
	</statement>

	<statement name="retrieveDomSalesOrdGIOrdInfo_back">
	    SELECT SALES_ORD_NO
	          ,CORP_CD
	          ,DPT_AR_CD
	          ,ORD_MNGT_EXCE_OFCR_ID
	          ,SALES_ORD_NO
	          ,CUST_ORD_NO
	          ,ORD_TYPE_CD
	          ,RPT_CUST_CD
	          ,CTRT_CUST_CD
	          ,CUST_ORD_TYPE_CD
	          ,ORD_REQ_CUST_CD
	          ,CUST_OF_CUST_CD
	          ,SUP_PL_CD
	          ,ARV_AR_CD
	          ,ARV_AR_ZIP_CD
	          ,ARV_AR_ZIP_ADDR
	          ,ARV_AR_DTL_ADDR
	          ,ARV_AR_OFCR_NM
	          ,ARV_AR_OFCR_TEL_NO
	          ,APTD_REQ_YMD
	          ,APTD_REQ_HM
	          ,RMK
	          ,CUST_EXPR_YN
	          ,CLS_EXPR_YN
	          ,LEAD_TIME_EXPR_YN
	          ,LTRM_ORD_YN
	          ,LOAD_DLY_YN
	          ,MOVE_TYPE_CD
	          ,IF_ID
	          ,EXP_IMP_DOM_SCTN_CD
	          ,CUST_MOVE_TYPE_CD
	      FROM TB_OM02001 
         WHERE SALES_ORD_NO = ${salesOrdNo}
	</statement>	

	<statement name="retrieveDomSalesOrdGIOrdInfo">
	    SELECT a.SALES_ORD_NO
	          ,a.CORP_CD
	          ,a.DPT_AR_CD
	          ,a.ORD_MNGT_EXCE_OFCR_ID
	          ,a.SALES_ORD_NO
	          ,a.CUST_ORD_NO
	          ,a.ORD_TYPE_CD
	          ,a.RPT_CUST_CD
	          ,a.CTRT_CUST_CD
	          ,a.CUST_ORD_TYPE_CD
	          ,a.ORD_REQ_CUST_CD
	          ,a.CUST_OF_CUST_CD
	          ,a.SUP_PL_CD
	          ,a.ARV_AR_CD
	          ,a.ARV_AR_ZIP_CD
	          ,a.ARV_AR_ZIP_ADDR
	          ,a.ARV_AR_DTL_ADDR
	          ,a.ARV_AR_OFCR_NM
	          ,a.ARV_AR_OFCR_TEL_NO
	          ,a.APTD_REQ_YMD
	          ,a.APTD_REQ_HM
	          ,a.RMK
	          ,a.CUST_EXPR_YN
	          ,a.CLS_EXPR_YN
	          ,a.LEAD_TIME_EXPR_YN
	          ,a.LTRM_ORD_YN
	          ,a.LOAD_DLY_YN
	          ,a.MOVE_TYPE_CD
	          ,a.IF_ID
	          ,a.EXP_IMP_DOM_SCTN_CD
	          ,a.CUST_MOVE_TYPE_CD
	      FROM TB_OM02001 a
         WHERE a.SALES_ORD_NO = ${salesOrdNo}
	</statement>

	<statement name="retrieveDomSalesOrdList">
	    SELECT a.SALES_ORD_NO
	          ,a.CORP_CD
	          ,a.DPT_AR_CD
	          ,a.ORD_MNGT_EXCE_OFCR_ID
	          ,a.SALES_ORD_NO
	          ,a.CUST_ORD_NO
	          ,a.ORD_TYPE_CD
	          ,a.RPT_CUST_CD
	          ,a.CTRT_CUST_CD
	          ,a.CUST_ORD_TYPE_CD
	          ,a.ORD_REQ_CUST_CD
	          ,a.CUST_OF_CUST_CD
	          ,a.SUP_PL_CD
	          ,a.ARV_AR_CD
	          ,a.ARV_AR_ZIP_CD
	          ,a.ARV_AR_ZIP_ADDR
	          ,a.ARV_AR_DTL_ADDR
	          ,a.ARV_AR_OFCR_NM
	          ,a.ARV_AR_OFCR_TEL_NO
	          ,a.APTD_REQ_YMD
	          ,a.APTD_REQ_HM
	          ,a.RMK
	          ,a.CUST_EXPR_YN
	          ,a.CLS_EXPR_YN
	          ,a.LEAD_TIME_EXPR_YN
	          ,a.LTRM_ORD_YN
	          ,a.LOAD_DLY_YN
	          ,a.MOVE_TYPE_CD
	          ,a.IF_ID
	          ,a.EXP_IMP_DOM_SCTN_CD
	          ,a.CUST_MOVE_TYPE_CD
	          ,b.col01
	          ,b.col02
	          ,b.col03
	          ,b.col04
	          ,b.col05
	          ,b.col06
	          ,b.col07
	          ,b.col08
	          ,b.col09
	          ,b.col10
	          ,b.col11
	      FROM TB_OM02001 a, tb_om02004 b
         WHERE a.SALES_ORD_NO = ${salesOrdNo}
           AND a.sales_ord_no = b.sales_ord_no(+)
	</statement>
	
	<statement name="retrieveDomSalesOrdGIOrdItemInfo">	
	    SELECT SALES_ORD_NO
	          ,LINE_NO
	          ,DPT_AR_CD
	          ,CUST_CD
	          ,ITEM_CD
	          ,BAT_NO
	          ,ITEM_GRADE_CD
	          ,ORD_QTY
	          ,QTY_UNIT_CD
	          ,ORD_WGT
	          ,WGT_UNIT_CD
	          ,LOT_NO
	          ,PRDT_REQ_NO
	          ,PLANT_CD
	          ,ORD_REASON_CD
	          ,CUST_ORD_LINE_NO
	      FROM TB_OM02002
         WHERE SALES_ORD_NO = ${salesOrdNo}
           AND LINE_NO = ${lineNo}
	</statement>
		
	<statement name="retrieveDomSalesOrdItemInfo">	
	    SELECT A.SALES_ORD_NO
	          ,A.LINE_NO
	          ,A.ITEM_CD
	          ,A.BAT_NO
	          ,A.PLANT_CD
	          ,A.PCUL_CD
	          ,A.MN_CD
	          ,A.ORD_QTY
	          ,A.ORD_WGT
	          ,A.ORD_CBM
	          ,A.QTY_UNIT_CD
	          ,A.WGT_UNIT_CD
	          ,A.ORD_REASON_CD
	          ,A.DPT_AR_CD
	          ,A.DPT_AR_TYPE_CD
	          ,A.ARV_AR_CD
	          ,A.ARV_AR_TYPE_CD
	          ,A.ORD_VERIFY_YN
              ,A.ITEM_GRADE_CD
              ,A.ADMT
              ,A.PRDT_REQ_NO
              ,A.PRDT_PRAR_YMD
              ,A.LOT_NO
              ,A.APTD_REQ_YMD
              ,A.APTD_REQ_HM
              ,A.DCSN_YN	   
              ,A.PALLET_QTY   
              ,A.DEL_YN
              ,A.RMK
              ,(SELECT CASE WHEN COUNT(*) > 0 THEN 'Y'
                       ELSE 'N' END 
                  FROM TB_OM03002 X
                      ,TB_OM03001 Y
                 WHERE X.SALES_ORD_NO   = A.SALES_ORD_NO
                   AND X.LINE_NO        = A.LINE_NO
                   AND X.SALES_ORD_NO   = Y.SALES_ORD_NO
                   AND X.WORK_ROUTE_SEQ = Y.WORK_ROUTE_SEQ
                   AND Y.DEL_YN         = 'N') DIV_YN   
              ,b.col01 
              ,a.cust_cd 
	      FROM TB_OM02002 A, TB_OM02005 B
         WHERE A.SALES_ORD_NO = ${salesOrdNo}
           AND A.LINE_NO      = ${lineNo}
           and a.sales_ord_no = b.sales_ord_no(+)
           and a.line_no      = b.line_no(+)
	</statement>
			
	<statement name="retrieveDomSalesOrdTranOrdInfo">	
	    SELECT A.SALES_ORD_NO
	          ,A.CORP_CD
	          ,A.TRAN_PLAN_CNTR_CD
	          ,LTrim(A.ORD_MNGT_EXCE_DEPT_CD, '0') ord_mngt_exce_dept_cd
	          ,A.ORD_MNGT_EXCE_OFCR_ID
	          ,A.CUST_ORD_NO
	          ,A.ORD_TYPE_CD
	          ,A.ADD_SVC_TYPE_CD
	          ,A.CTRT_CUST_CD
	          ,A.RPT_CUST_CD
	          ,A.CUST_OFCR_NM
	          ,A.CUST_OFCR_TEL_NO
	          ,A.CUST_OF_CUST_CD
	          ,A.CUST_EXPR_YN
	          ,A.CLS_EXPR_YN
	          ,A.LEAD_TIME_EXPR_YN
	          ,A.AFT_ORD_YN
	          ,A.DPT_AR_CD
	          ,A.DPT_AR_TYPE_CD
	          ,A.DPT_AR_ZIP_CD
	          ,A.DPT_AR_ZIP_ADDR
	          ,A.DPT_AR_DTL_ADDR
	          ,A.DPT_AR_OFCR_NM
	          ,A.DPT_AR_OFCR_TEL_NO
	          ,A.ARV_AR_CD
	          ,A.ARV_AR_TYPE_CD
	          ,A.ARV_AR_ZIP_CD
	          ,A.ARV_AR_ZIP_ADDR
	          ,A.ARV_AR_DTL_ADDR
	          ,A.ARV_AR_OFCR_NM
	          ,A.ARV_AR_OFCR_TEL_NO
	          ,A.STRT_REQ_YMD
	          ,A.STRT_REQ_HM
	          ,A.APTD_REQ_YMD
	          ,A.APTD_REQ_HM
	          ,A.RMK
	          ,A.SALES_ORD_CREAT_YMD
	          ,A.SALES_ORD_CREAT_HMS
	          ,A.EXP_IMP_DOM_SCTN_CD
	          ,B.OCEAN_AIR_SCTN_CD
	          ,A.CARGO_FORM_CD
	          ,B.FCL_LCL_SCTN_CD
	          ,B.HBL_NO
	          ,B.MBL_NO
	          ,B.POL_CD
	          ,B.POD_CD
	          ,B.BOOKING_NO
	          ,B.SHIP_CO_CD
	          ,B.SHIP_NM
	          ,B.PORT_CNT
	          ,B.DPT_PORT_PRAR_YMD
	          ,B.ARV_PORT_PRAR_YMD
	          ,A.CUST_ORD_TYPE_CD
	          ,A.LOAD_DLY_YN
	      FROM TB_OM02001 A
              ,TB_OM02003 B
         WHERE A.SALES_ORD_NO = B.SALES_ORD_NO(+)
           AND A.SALES_ORD_NO = ${salesOrdNo}
	</statement>	
	
	<statement name="retrieveDomSalesOrdTranOrdItemInfo">	
	    SELECT SALES_ORD_NO
	          ,LINE_NO
	          ,CUST_CD
	          ,ITEM_CD
	          ,BAT_NO
	          ,ORD_QTY
	          ,QTY_UNIT_CD
	          ,ORD_WGT
	          ,WGT_UNIT_CD
	          ,ORD_CBM
	          ,PLANT_CD
	          ,LOT_NO
	          ,PRDT_REQ_NO
	          ,PRDT_PRAR_YMD
	          ,FE_SCTN_CD
	          ,CNTR_NO
	          ,DANGER_SCTN_CD
	          ,SEAL_NO1
	          ,SEAL_NO2
	          ,PCKG_UNIT_CD
	          ,PCKG_QTY
	          ,MAX_TMPT
	          ,MIN_TMPT
	          ,ORD_REASON_CD
	          ,CUST_ORD_LINE_NO
	      FROM TB_OM02002
         WHERE SALES_ORD_NO = ${salesOrdNo}
           AND LINE_NO = ${lineNo}
	</statement>
		
	<statement name="retrieveDomSalesOrdGROrdInfo">		
	    SELECT SALES_ORD_NO
	          ,CORP_CD
	          ,ARV_AR_CD
	          ,ORD_MNGT_EXCE_OFCR_ID
	          ,CUST_ORD_NO
	          ,ORD_TYPE_CD
	          ,RPT_CUST_CD
	          ,CTRT_CUST_CD
	          ,CUST_ORD_TYPE_CD
	          ,DPT_AR_CD
	          ,DPT_AR_ZIP_CD
	          ,DPT_AR_ZIP_ADDR
	          ,DPT_AR_DTL_ADDR
	          ,DPT_AR_OFCR_NM
	          ,DPT_AR_OFCR_TEL_NO
	          ,APTD_REQ_YMD
	          ,APTD_REQ_HM
	          ,RMK
	          ,RLTD_GI_EO_NO
	          ,ORD_REASON_CD
		      ,MOVE_TYPE_CD	
	      FROM TB_OM02001 	
         WHERE SALES_ORD_NO = ${salesOrdNo}
	</statement>		
	
	<statement name="retrieveDomSalesOrdGROrdItemInfo">	
	    SELECT SALES_ORD_NO
	          ,LINE_NO
	          ,ARV_AR_CD
	          ,CUST_CD
	          ,ITEM_CD
	          ,BAT_NO
	          ,ITEM_GRADE_CD
	          ,ORD_QTY
	          ,QTY_UNIT_CD
	          ,ORD_WGT
	          ,WGT_UNIT_CD
	          ,LOT_NO
	          ,ORD_REASON_CD
	          ,PLANT_CD
	          ,PRDT_REQ_NO
	          ,PRDT_YMD
	          ,CNTR_NO
	          ,CUST_ORD_LINE_NO
	          ,DCSN_YN
	      FROM TB_OM02002
         WHERE SALES_ORD_NO = ${salesOrdNo}
           AND LINE_NO = ${lineNo}
	</statement>		

	<statement name="retrieveSalesOrdFisMdfPossYn">	
	    SELECT CASE WHEN COUNT(*) > 0 THEN 'Y'
				    ELSE 'N' END FIS_YN
	      FROM TB_OM04002 A
	     WHERE A.SALES_ORD_NO =  ${salesOrdNo}
	</statement>		

	<statement name="retrieveHblNoDouble">	
	    SELECT HBL_NO
	      FROM TB_OM02003 a
		     , tb_om02001 b
         WHERE a.HBL_NO=${hblNo}
           and a.sales_ord_no = b.sales_ord_no
           and a.ocean_air_sctn_cd = ${oceanAirSctnCd}
           and b.sales_ord_cncl_yn != 'Y'
	</statement>		
	
	<statement name="retrieveSalesOrd">
		SELECT  sales_ord_no
			  , corp_cd
			  , rpt_cust_cd
			  , '1043' ord_type_cd
			  , null add_svc_type_cd
			  , '03' exp_imp_dom_sctn_cd
			  , cargo_form_cd
			  , ord_mngt_exce_dept_cd
			  , ord_mngt_fwd_dept_cd
			  , ord_mngt_exce_ofcr_id
			  , ord_mngt_fwd_ofcr_id
			  , tran_plan_cntr_cd
			  , '02' sales_ord_stat_cd
			  , null cust_ord_no
			  , null cust_cd
			  , null cust_ord_type_cd
			  , null cust_move_type_cd
			  , null cust_ord_recp_date
			  , null cust_ord_recp_chn_cd
			  , ctrt_cust_cd
			  , ctrt_no
			  , ord_req_cust_cd
			  , bilg_cust_cd
			  , cust_ofcr_nm
			  , cust_ofcr_tel_no
			  , null cust_of_cust_cd
			  , null sup_pl_cd
			  , null plant_cd
			  , null cust_ref_no
			  , (SELECT arv_ar_cd FROM TB_OM03009I WHERE WRHS_EO_NO = ${eoNo} and trms_seq = (select max(trms_seq) from tb_om03009i where wrhs_eo_no = ${eoNo}) ) as dpt_ar_cd
			  , (SELECT b.arv_ar_type_cd  
				  FROM   TB_OM03009I A
				       , TB_OM03001 B
				       , tb_om03015 c
				  WHERE  A.WRHS_EO_NO = ${eoNo}
				  and 	 a.trms_seq = (select max(trms_seq) from tb_om03009i where wrhs_eo_no = ${eoNo})
				  AND    A.SALES_ORD_NO = B.SALES_ORD_NO
				  AND    a.wrhs_eo_no = c.eo_no
				  AND    b.sales_ord_no = c.sales_ord_no
				  AND    b.work_route_seq = c.work_route_seq
				  AND    A.ARV_AR_CD = B.ARV_AR_CD) as dpt_ar_type_cd
			  , (SELECT arv_ar_zip_cd FROM TB_OM03009I WHERE WRHS_EO_NO = ${eoNo} and trms_seq = (select max(trms_seq) from tb_om03009i where wrhs_eo_no = ${eoNo})) as dpt_ar_zip_cd
			  , (SELECT arv_ar_zip_addr FROM TB_OM03009I WHERE WRHS_EO_NO = ${eoNo} and trms_seq = (select max(trms_seq) from tb_om03009i where wrhs_eo_no = ${eoNo})) as dpt_ar_zip_addr
			  , (SELECT arv_ar_dtl_addr FROM TB_OM03009I WHERE WRHS_EO_NO = ${eoNo} and trms_seq = (select max(trms_seq) from tb_om03009i where wrhs_eo_no = ${eoNo})) as dpt_ar_dtl_addr
			  , (SELECT arv_ar_ofcr_nm FROM TB_OM03009I WHERE WRHS_EO_NO = ${eoNo} and trms_seq = (select max(trms_seq) from tb_om03009i where wrhs_eo_no = ${eoNo})) as dpt_ar_ofcr_nm
			  , (SELECT arv_ar_ofcr_tel_no FROM TB_OM03009I WHERE WRHS_EO_NO = ${eoNo} and trms_seq = (select max(trms_seq) from tb_om03009i where wrhs_eo_no = ${eoNo})) as dpt_ar_ofcr_tel_no
			  , (SELECT work_pl_cd FROM TB_OM03009I WHERE WRHS_EO_NO = ${eoNo} and trms_seq = (select max(trms_seq) from tb_om03009i where wrhs_eo_no = ${eoNo})) arv_ar_cd
			  , '01' arv_ar_type_cd
			  , (select zip_cd 
		    	 from vw_ma01_01 
          		 WHERE   CODE = (SELECT work_pl_cd FROM TB_OM03009I WHERE WRHS_EO_NO = ${eoNo} and trms_seq = (select max(trms_seq) from tb_om03009i where wrhs_eo_no = ${eoNo}))
          		 AND     WORK_SCTN_CD = '01') AS arv_ar_zip_cd
			  , (select zip_ADDR 
		    	 from vw_ma01_01 
          		 WHERE   CODE = (SELECT work_pl_cd FROM TB_OM03009I WHERE WRHS_EO_NO = ${eoNo} and trms_seq = (select max(trms_seq) from tb_om03009i where wrhs_eo_no = ${eoNo}))
          		 AND     WORK_SCTN_CD = '01') AS arv_ar_zip_ADDR
			  , (select DTL_ADDR
		    	 from vw_ma01_01 
          		 WHERE   CODE = (SELECT work_pl_cd FROM TB_OM03009I WHERE WRHS_EO_NO = ${eoNo} and trms_seq = (select max(trms_seq) from tb_om03009i where wrhs_eo_no = ${eoNo}))
          		 AND     WORK_SCTN_CD = '01') AS arv_ar_dtl_addr
			  , '' arv_ar_ofcr_nm
			  , '' arv_ar_ofcr_tel_no
			  , null work_pl_cd
			  , null strt_req_ymd
			  , null strt_req_hm
			  , aptd_req_ymd
			  , aptd_req_hm
			  , sell_dept_cd
			  , sales_ofcr_id
			  , null sell_dcsn_sctn_cd
			  , 'N' cust_expr_yn
			  , 'N' cls_expr_yn
			  , 'N' lead_time_expr_yn
			  , 'N' dtod_yn
			  , null rmk
			  , 'N' load_dly_yn
			  , null load_dly_rltd_sales_ord_no
			  , 'N' back_ord_yn
			  , 'N' aft_ord_yn
			  , null chg_aptd_ymd
			  , null chg_aptd_hm
			  , TO_CHAR(sysdate,'YYYYMMDD') sales_ord_creat_ymd
			  , TO_CHAR(sysdate,'HH24MISS') sales_ord_creat_hms
			  , 'N' sales_ord_cncl_yn
			  , null sales_ord_cncl_date
			  , null sales_ord_cncl_reason
			  , null sales_ord_cmpt_sctn_cd
			  , null sales_ord_cmpt_date
			  , '' ord_reason_cd
			  , sales_ord_no rltd_gi_ord_no
			  , '01' work_info_mngt_type_cd
			  , null if_id
			  , null tran_eo_no
			  , 'N' ltrm_ord_yn
			  , '' rltd_gi_eo_no
			  , line_sctn_cd
			  , 'N' dcnct_ord_yn
			  , null pay_cond_cd
			  , null move_type_cd
			  , null tran_cond_cd
			  , regr_id, reg_date, mdfr_id, mdf_date 
		FROM	TB_OM02001
		WHERE	sales_ord_no = ${salesOrdNo}
	</statement>
	
	<statement name="retrieveSalesOrdItem">
		SELECT sales_ord_no, line_no, cust_cd, item_cd, basis_item_cd, cust_ord_line_no, 
				item_grade_cd, ord_qty, qty_unit_cd, ord_wgt, wgt_unit_cd, 0 admt, ord_cbm, basis_unit_cd, 
				bat_no, cust_bat_no, null mnf_no, null lot_no, prdt_req_no, prdt_prar_ymd, plant_cd, sales_uprice, 
				cust_ref_no, fe_sctn_cd, cntr_no, danger_sctn_cd, seal_no1, seal_no2, pckg_unit_cd, 
				pckg_qty, max_tmpt, min_tmpt
			  , (SELECT arv_ar_cd FROM TB_OM03009I WHERE WRHS_EO_NO = ${eoNo} and trms_seq = (select max(trms_seq) from tb_om03009i where wrhs_eo_no = ${eoNo})) as dpt_ar_cd
			  , (SELECT b.arv_ar_type_cd  
				  FROM   TB_OM03009I A
				       , TB_OM03001 B
				       , tb_om03015 c
				  WHERE  A.WRHS_EO_NO = ${eoNo}
				  and 	 a.trms_seq = (select max(trms_seq) from tb_om03009i where wrhs_eo_no = ${eoNo})
				  AND    A.SALES_ORD_NO = B.SALES_ORD_NO
				  AND    a.wrhs_eo_no = c.eo_no
				  AND    b.sales_ord_no = c.sales_ord_no
				  AND    b.work_route_seq = c.work_route_seq
				  AND    A.ARV_AR_CD = B.ARV_AR_CD) as dpt_ar_type_cd
			  , (SELECT arv_ar_zip_cd FROM TB_OM03009I WHERE WRHS_EO_NO = ${eoNo} and trms_seq = (select max(trms_seq) from tb_om03009i where wrhs_eo_no = ${eoNo})) as dpt_ar_zip_cd
			  , (SELECT arv_ar_zip_addr FROM TB_OM03009I WHERE WRHS_EO_NO = ${eoNo} and trms_seq = (select max(trms_seq) from tb_om03009i where wrhs_eo_no = ${eoNo})) as dpt_ar_zip_addr
			  , (SELECT arv_ar_dtl_addr FROM TB_OM03009I WHERE WRHS_EO_NO = ${eoNo} and trms_seq = (select max(trms_seq) from tb_om03009i where wrhs_eo_no = ${eoNo})) as dpt_ar_dtl_addr
			  , (SELECT arv_ar_ofcr_nm FROM TB_OM03009I WHERE WRHS_EO_NO = ${eoNo} and trms_seq = (select max(trms_seq) from tb_om03009i where wrhs_eo_no = ${eoNo})) as dpt_ar_ofcr_nm
			  , (SELECT arv_ar_ofcr_tel_no FROM TB_OM03009I WHERE WRHS_EO_NO = ${eoNo} and trms_seq = (select max(trms_seq) from tb_om03009i where wrhs_eo_no = ${eoNo})) as dpt_ar_ofcr_tel_no
			  , (SELECT work_pl_cd FROM TB_OM03009I WHERE WRHS_EO_NO = ${eoNo} and trms_seq = (select max(trms_seq) from tb_om03009i where wrhs_eo_no = ${eoNo})) arv_ar_cd
			  , '01' arv_ar_type_cd
			  , (select zip_cd 
		    	 from vw_ma01_01 
          		 WHERE   CODE = (SELECT work_pl_cd FROM TB_OM03009I WHERE WRHS_EO_NO = ${eoNo} and trms_seq = (select max(trms_seq) from tb_om03009i where wrhs_eo_no = ${eoNo}))
          		 AND     WORK_SCTN_CD = '01') AS arv_ar_zip_cd
			  , (select zip_ADDR 
		    	 from vw_ma01_01 
          		 WHERE   CODE = (SELECT work_pl_cd FROM TB_OM03009I WHERE WRHS_EO_NO = ${eoNo} and trms_seq = (select max(trms_seq) from tb_om03009i where wrhs_eo_no = ${eoNo}))
          		 AND     WORK_SCTN_CD = '01') AS arv_ar_zip_ADDR
			  , (select DTL_ADDR
		    	 from vw_ma01_01 
          		 WHERE   CODE = (SELECT work_pl_cd FROM TB_OM03009I WHERE WRHS_EO_NO = ${eoNo} and trms_seq = (select max(trms_seq) from tb_om03009i where wrhs_eo_no = ${eoNo}))
          		 AND     WORK_SCTN_CD = '01') AS arv_ar_dtl_addr
			  , '' arv_ar_ofcr_nm
			  , '' arv_ar_ofcr_tel_no
			  ,	null strt_req_ymd, null strt_req_hm, aptd_req_ymd, aptd_req_hm, null ord_reason_cd, null booking_no, 
				null prog_stat_cd, null vanning_grp_id, null prdt_ymd, null pol_cd, null schd_no, null sctn_cd, null rpt_item_nm, 
				'N' cls_expr_yn, 'N' lead_time_expr_yn, 'N' ltrm_ord_yn, null rmk, null exp_ord_no, null dpt_port_prar_ymd, 
				null gi_req_ymd, null std_wgt, null pallet_qty, null more_pmsr, null less_pmsr, null cntr_dcsn_ofcr_id, 
				null cntr_dcsn_date, pcul_cd, mn_cd, 'N' dcsn_yn, 'N' del_yn, regr_id, reg_date, mdfr_id, mdf_date
		FROM	TB_OM02002
		WHERE	sales_ord_no = ${salesOrdNo}
		AND     line_no = ${lineNo}
	</statement>	
		
	<statement name="retrieveMdfDlySalesOrdHistory">		
	SELECT  a.sales_ord_no
			, a.sales_ord_chg_seq
			, a.corp_cd
			, a.ord_type_cd
			, a.add_svc_type_cd
			, a.exp_imp_dom_sctn_cd
			, a.cargo_form_cd
			, a.ord_mngt_exce_dept_cd
			, a.ord_mngt_fwd_dept_cd
			, a.ord_mngt_exce_ofcr_id
			, a.ord_mngt_fwd_ofcr_id
			, a.tran_plan_cntr_cd
			, a.sales_ord_stat_cd
			, a.cust_ord_no
			, a.cust_cd
			, a.cust_ord_type_cd
			, a.cust_move_type_cd		
			, to_char(a.cust_ord_recp_date, 'YYYYMMDDHH24MISS') cust_ord_recp_date
			, a.cust_ord_recp_chn_cd
			, a.ctrt_cust_cd
			, a.ctrt_no
			, a.ord_req_cust_cd
			, a.bilg_cust_cd
			, a.cust_ofcr_nm
			, a.cust_ofcr_tel_no
			, a.cust_of_cust_cd
			, a.sup_pl_cd
			, a.plant_cd
			, a.cust_ref_no
			, a.dpt_ar_cd
			, a.dpt_ar_type_cd
			, a.dpt_ar_zip_cd
			, a.dpt_ar_zip_addr
			, a.dpt_ar_dtl_addr
			, a.dpt_ar_ofcr_nm
			, a.dpt_ar_ofcr_tel_no
			, a.arv_ar_cd
			, a.arv_ar_type_cd
			, a.arv_ar_zip_cd
			, a.arv_ar_zip_addr
			, a.arv_ar_dtl_addr
			, a.arv_ar_ofcr_nm
			, a.arv_ar_ofcr_tel_no
			, a.work_pl_cd
			, a.strt_req_ymd
			, a.strt_req_hm
			, a.aptd_req_ymd
			, a.aptd_req_hm
			, a.sell_dept_cd
			, a.sales_ofcr_id
			, a.sell_dcsn_sctn_cd
			, a.cust_expr_yn
			, a.cls_expr_yn
			, a.lead_time_expr_yn
			, a.dtod_yn
			, a.rmk
			, a.load_dly_yn
			, a.load_dly_rltd_sales_ord_no			
			, a.back_ord_yn
			, a.aft_ord_yn
			, a.chg_aptd_ymd
			, a.chg_aptd_hm
			, a.sales_ord_creat_ymd
			, a.sales_ord_creat_hms
			, a.sales_ord_cncl_yn
			, a.sales_ord_cncl_date
			, a.sales_ord_cncl_reason
			, a.sales_ord_cmpt_sctn_cd
			, a.sales_ord_cmpt_date
			, a.ord_reason_cd
			, a.rltd_gi_ord_no
			, a.work_info_mngt_type_cd
			, a.mdf_dly_sctn_cd
			, a.if_id
			, a.tran_eo_no
			, a.ltrm_ord_yn
			, a.rltd_gi_eo_no
			, a.ord_div_dgr_cnt
			, a.line_sctn_cd
			, a.dcnct_ord_yn
			, a.pay_cond_cd
			, a.move_type_cd
			, a.tran_cond_cd
			, a.gi_cncl_reason_cd
			, a.aptd_dly_cd
			, a.self_tran_yn
			, a.ord_verify_yn
			, b.ocean_air_sctn_cd
			, b.fcl_lcl_sctn_cd
			, b.bl_kind_cd
			, b.hbl_no
			, b.mbl_no
			, b.ctry_cd
			, b.pol_cd
			, b.pol_nm
			, b.pod_cd
			, b.pod_nm
			, b.dlv_pl_cd
			, b.dlv_pl_nm
			, b.fdest_cd
			, b.fdest_nm
			, b.ship_co_cd
			, b.ship_co_nm
			, b.ship_co_agnt_cd
			, b.airline_cd
			, b.ship_nm
			, b.port_cnt
			, b.incoterms_cd
			, b.dpt_svc_term_cd
			, b.arv_svc_term_cd
			, b.mark_conts
			, b.desc_conts
			, b.dpt_port_prar_ymd
			, b.dpt_port_prar_hm
			, b.arv_port_prar_ymd
			, b.arv_port_prar_hm
			, b.shipper_cd
			, b.shipper_nm
			, b.shipper_addr1
			, b.shipper_addr2
			, b.shipper_addr3
			, b.shipper_addr4
			, b.cnee_cd
			, b.cnee_nm
			, b.cnee_addr1
			, b.cnee_addr2
			, b.cnee_addr3
			, b.cnee_addr4
			, b.ntfy_cd
			, b.ntfy_nm
			, b.ntfy_addr1
			, b.ntfy_addr2
			, b.ntfy_addr3
			, b.ntfy_addr4
			, b.ptn_cd
			, b.ptn_nm
			, b.ptn_ofcr_nm
			, b.lc_no
			, b.ci_no
			, b.cntr_kind_cd1
			, b.cntr_qty1
			, b.cntr_kind_cd2
			, b.cntr_qty2
			, b.cntr_kind_cd3
			, b.cntr_qty3
			, b.cntr_kind_cd4
			, b.cntr_qty4
			, b.cntr_kind_cd5
			, b.cntr_qty5
			, b.pckg_unit_cd
			, b.pckg_qty
			, b.tot_qty
			, b.qty_unit_cd
			, b.tot_wgt
			, b.wgt_unit_cd
			, b.tot_admt
			, b.tran_cost_wgt
			, b.tot_cbm
			, b.rpt_item_nm
			, b.danger_sctn_cd
			, b.bond_tran_yn
			, b.tran_cost_pay_cond_cd
			, b.extr_expn_pay_cond_cd
			, b.mnfest_dclr_tgt_yn
			, b.ts_cd1
			, b.ts_cd2
			, b.ts_cd3
			, b.carr_cd1
			, b.carr_cd2
			, b.carr_cd3
			, b.co_load_entp_cd
			, b.arv_port_ymd
			, b.cgwrk_ymd
			, b.det_frtime_days
			, b.dem_frtime_days
			, b.tot_frtime_days
			, b.frtime_expi_ymd
			, b.lc_expi_ymd
			, b.exp_cust_ord_sctn_cd
			, b.exp_type_cd
			, b.booking_no
			, b.fwd_eo_no
	  FROM tb_om02011h a
        ,tb_om02013h b
	  WHERE a.sales_ord_no 	  = ${salesOrdNo}
	  AND   a.sales_ord_chg_seq = (select max(sales_ord_chg_seq)
	                             from tb_om02011h
	                             where sales_ord_no 	= ${salesOrdNo}
	  							             and   mdf_dly_sctn_cd	= '01')
	  AND   a.sales_ord_no      = b.sales_ord_no(+)
	  AND   a.sales_ord_chg_seq = b.sales_ord_chg_seq(+)                           
	</statement>		
		
	<statement name="retrieveSalesOrdItemHistory">			
	 SELECT	  SALES_ORD_NO
			, SALES_ORD_CHG_SEQ
			, LINE_NO
			, CUST_CD
			, ITEM_CD
			, BASIS_ITEM_CD
			, CUST_ORD_LINE_NO
			, ITEM_GRADE_CD
			, ORD_QTY
			, QTY_UNIT_CD
			, ORD_WGT
			, WGT_UNIT_CD
			, ADMT
			, ORD_CBM
			, BASIS_UNIT_CD
			, BAT_NO
			, CUST_BAT_NO
			, MNF_NO
			, LOT_NO
			, PRDT_REQ_NO
			, PRDT_PRAR_YMD
			, PLANT_CD
			, SALES_UPRICE
			, CUST_REF_NO
			, FE_SCTN_CD
			, CNTR_SIZE_CD
			, CNTR_NO
			, DANGER_SCTN_CD
			, SEAL_NO1
			, SEAL_NO2
			, PCKG_UNIT_CD
			, PCKG_QTY
			, MAX_TMPT
			, MIN_TMPT
			, DPT_AR_CD
			, DPT_AR_TYPE_CD
			, DPT_AR_ZIP_CD
			, DPT_AR_ZIP_ADDR
			, DPT_AR_DTL_ADDR
			, DPT_AR_OFCR_NM
			, DPT_AR_OFCR_TEL_NO
			, ARV_AR_CD
			, ARV_AR_TYPE_CD
			, ARV_AR_ZIP_CD
			, ARV_AR_ZIP_ADDR
			, ARV_AR_DTL_ADDR
			, ARV_AR_OFCR_NM
			, ARV_AR_OFCR_TEL_NO
			, STRT_REQ_YMD
			, STRT_REQ_HM
			, APTD_REQ_YMD
			, APTD_REQ_HM
			, ORD_REASON_CD
			, BOOKING_NO
			, PROG_STAT_CD
			, VANNING_GRP_ID
			, PRDT_YMD
			, POL_CD
			, SCHD_NO
			, SCTN_CD
			, RPT_ITEM_NM
			, CLS_EXPR_YN
			, LEAD_TIME_EXPR_YN
			, LTRM_ORD_YN
			, RMK
			, EXP_ORD_NO
			, DPT_PORT_PRAR_YMD
			, ARV_PORT_PRAR_YMD
			, GI_REQ_YMD
			, STD_WGT
			, PALLET_QTY
			, MORE_PMSR
			, LESS_PMSR
			, CNTR_DCSN_OFCR_ID
			, CNTR_DCSN_DATE
			, PCUL_CD
			, MN_CD
			, DCSN_YN
			, DELIV_DLY_YN
			, CMPT_YMD
			, ORD_VERIFY_YN
			, DEL_YN
			, CASE WHEN (SELECT COUNT(*)
			             FROM TB_OM02002 X
			             WHERE X.SALES_ORD_NO = A.SALES_ORD_NO
			             AND   X.LINE_NO	  = A.LINE_NO) > 0 THEN 'N'
			       ELSE 'Y' END ADD_YN
	FROM TB_OM02012H A
	WHERE SALES_ORD_NO 		= ${salesOrdNo}
	AND   SALES_ORD_CHG_SEQ	= ${salesOrdChgSeq}		
	</statement>	
	
	<statement name="retrieveSalesOrdPrclHistory">			
	 SELECT	  SALES_ORD_NO
			, SALES_ORD_CHG_SEQ
			, COL01
			, COL02
			, COL03
			, COL04
			, COL05
			, COL06
			, COL07
			, COL08
			, COL09
			, COL10
			, COL11
			, COL12
			, COL13
			, COL14
			, COL15
			, COL16
			, COL17
			, COL18
			, COL19
			, COL20
			, COL21
			, COL22
			, COL23
			, COL24
			, COL25
			, COL26
			, COL27
			, COL28
			, COL29
			, COL30
	FROM TB_OM02014H
	WHERE SALES_ORD_NO 		= ${salesOrdNo}
	AND   SALES_ORD_CHG_SEQ	= ${salesOrdChgSeq}		
	</statement>								
	
	<statement name="retrieveSalesOrdItemPrclHistory">			
	 SELECT	  SALES_ORD_NO
			, SALES_ORD_CHG_SEQ
			, LINE_NO
			, COL01
			, COL02
			, COL03
			, COL04
			, COL05
			, COL06
			, COL07
			, COL08
			, COL09
			, COL10
			, COL11
			, COL12
			, COL13
			, COL14
			, COL15
			, COL16
			, COL17
			, COL18
			, COL19
			, COL20
			, COL21
			, COL22
			, COL23
			, COL24
			, COL25
			, COL26
			, COL27
			, COL28
			, COL29
			, COL30
	FROM TB_OM02015H
	WHERE SALES_ORD_NO 		= ${salesOrdNo}
	AND   SALES_ORD_CHG_SEQ	= ${salesOrdChgSeq}			
	</statement>		
			
	<statement name="retrieveSalesOrdBookingRsltYn">
        SELECT COUNT(*) cnt
        FROM   tb_om04002
        WHERE  1 = 1
		{#1}
		{#2}
		{#3}
	<append condition="${salesOrdNo}.NOTEMPTY" id="#1">
        AND    sales_ord_no = ${salesOrdNo}
	</append>
	<append condition="${bookingNo}.NOTEMPTY" id="#2">
        AND    booking_no = ${bookingNo}
	</append>
	<append condition="${rsltSctnCd}.NOTEMPTY" id="#3">
        AND    rslt_sctn_cd = ${rsltSctnCd}
	</append>
	</statement>
	
  <statement name="retrieveSelfGdsCd">
  	SELECT   SALES_ORD_NO
			, LINE_NO
			, COL01
			, COL02
			, COL03
			, COL04
			, COL05
			, COL06
			, COL07
			, COL08
			, COL09
			, COL10
			, COL11
			, COL12
			, COL13
			, COL14
			, COL15
			, COL16
			, COL17
			, COL18
			, COL19
			, COL20
			, COL21
			, COL22
			, COL23
			, COL24
			, COL25
			, COL26
			, COL27
			, COL28
			, COL29
			, COL30
  	FROM	TB_OM02005
  	WHERE	SALES_ORD_NO = ${salesOrdNo}
  	AND     rownum = 1
  </statement>	
	
  <statement name="retrieveCustOfCustOrderInfo">
  	SELECT SALES_ORD_NO
  	FROM	TB_OM02001
  	WHERE	RLTD_GI_EO_NO = ${eoNo}
  	AND		ORD_DIV_DGR_CNT = ${rsltDgrCnt}
  	AND     ORD_TYPE_CD = '1023'
  </statement>
  
  <statement name="retrieveFwdOrdList">
		SELECT DECODE(NVL(A.FWD_EO_NO, ''), '' , B.FWD_EO_NO, A.FWD_EO_NO) FWD_EO_NO, BOOKING_NO
		FROM
		     (SELECT FWD_EO_NO, SALES_ORD_NO
		      FROM   TB_OM02003 A
		      WHERE  A.SALES_ORD_NO = ${salesOrdNo}) A
		   , (SELECT FWD_EO_NO, SALES_ORD_NO, BOOKING_NO
		      FROM   TB_OM02019 A
		      WHERE  A.SALES_ORD_NO = ${salesOrdNo}) B
		WHERE A.SALES_ORD_NO = B.SALES_ORD_NO(+)     
  </statement>
  
  <statement name="retrieveOrdReason">
      SELECT CASE WHEN COUNT(*) = SUM(DECODE(ORD_REASON_CD, '',0,1)) THEN 'Y'
                  ELSE 'N' END CHK_YN
	    FROM TB_OM02002 A
	   WHERE A.SALES_ORD_NO = ${salesOrdNo}
  </statement>
    
  <statement name="retrieveMdfDlyCheck">
	  SELECT (SELECT NVL(MAX(SALES_ORD_CHG_SEQ),0)
	            FROM TB_OM02011H X
	           WHERE X.SALES_ORD_NO = ${salesOrdNo}) MAX_CHG_SEQ
	        ,(SELECT NVL(MAX(SALES_ORD_CHG_SEQ),0)
	            FROM TB_OM02011H X
	           WHERE X.SALES_ORD_NO = ${salesOrdNo}
	             AND X.MDF_DLY_SCTN_CD IS NOT NULL) DLY_CHG_SEQ        
	        ,(SELECT COUNT(*)
	            FROM TB_OM02011H X
	           WHERE X.SALES_ORD_NO = ${salesOrdNo}
	             AND X.MDF_DLY_SCTN_CD IS NOT NULL) DLY_CHG_CNT   
	        ,(SELECT NVL(MAX(SALES_ORD_CHG_SEQ),0)
	            FROM TB_OM02011H X
	           WHERE X.SALES_ORD_NO = ${salesOrdNo}
	             AND X.MDF_DLY_SCTN_CD = '01') MDF_CHG_SEQ  	             
	    FROM DUAL
  </statement>  

  <statement name="retrievePartCmptItemInfo">
	  SELECT IDUSR.OM_HPL_ORD_GUBUN_FN( B.RPT_CUST_CD, B.CUST_ORD_NO) ORD_GUBUN
            ,B.RPT_CUST_CD
	        ,B.CUST_ORD_NO
	        ,B.CUST_ORD_TYPE_CD
	        ,A.CUST_ORD_LINE_NO LINE_NO
	        ,A.ORD_REASON_CD
	        ,CASE WHEN B.RPT_CUST_CD IN ('P1010', 'P1028') THEN
	          (select COMN_CD_NM  
	            from tb_ma01015 
	           where clas_cd = 'HPL_ORD_REASON_CD' 
	             and COMN_CD = a.ord_reason_cd
	             and rownum =1)	        
	         ELSE
	          (select COMN_CD_NM  
	            from tb_ma01015 
	           where clas_cd = 'ORD_REASON_CD' 
	             and COMN_CD = a.ord_reason_cd
	             and rownum =1)
             END as ord_reason_nm	       
	        ,NVL((SELECT 'N'
	                FROM TB_IV02007 X
	               WHERE X.CORP_CD           = B.CORP_CD
	                 AND X.SALES_ORD_NO      = A.SALES_ORD_NO
	                 AND X.SALES_ORD_LINE_NO = A.LINE_NO
	                 AND X.SAP_TRMS_STAT_CD != 'Y'
	                 AND ROWNUM = 1),'Y') GI_TRMS_YN
	        ,NVL((SELECT 'N'
	                FROM TB_IV02006 X
	               WHERE X.CORP_CD           = B.CORP_CD
	                 AND X.SALES_ORD_NO      = A.SALES_ORD_NO
	                 AND X.SALES_ORD_LINE_NO = A.LINE_NO
	                 AND X.SAP_TRMS_STAT_CD != 'Y'
	                 AND ROWNUM = 1),'Y') GR_TRMS_YN	             
	     FROM TB_OM02002 A
	         ,TB_OM02001 B
	    WHERE A.SALES_ORD_NO = ${salesOrdNo}
	      AND A.LINE_NO      = ${lineNo}
	      AND A.SALES_ORD_NO = B.SALES_ORD_NO    
  </statement>
  
  <statement name="retrieveOrderConfirmYn">
	  SELECT CASE WHEN COUNT(*) > 0 THEN 'Y'
		          ELSE 'N' END CONFIRM_YN
		    ,CASE WHEN SUM(DECODE(A.DCSN_SCTN_CD, '01', 1, 0)) > 0 THEN 'Y'
		          ELSE 'N' END TM_YN
		    ,CASE WHEN SUM(DECODE(A.DCSN_SCTN_CD, '02', 1, '03', 1, 0)) > 0 THEN 'Y'
		          ELSE 'N' END WM_YN
	    FROM TB_OM03022 A
	        ,TB_OM03015 B
	        ,TB_OM03002 C
	   WHERE A.SALES_ORD_NO   = ${salesOrdNo}
	     AND A.EO_NO          = B.EO_NO
	     AND B.SALES_ORD_NO   = C.SALES_ORD_NO
	     AND B.WORK_ROUTE_SEQ = C.WORK_ROUTE_SEQ
	    {#1}
	<append condition="${lineNo}.NOTEMPTY" id="#1">
	     AND C.LINE_NO        = ${lineNo}   
	</append>		  
  </statement>

	<statement name="retrievePortInOutInfo">
		SELECT B.POL_CD
		     , DECODE(A.RPT_CUST_CD, 'P1000', DECODE(E.EXP_TYPE_CD, '01', 'Y', '02', 'Y', 'N')
		                           , 'P1591', DECODE(E.EXP_TYPE_CD, '01', 'Y', '02', 'Y', 'N')
		                           , 'Y') PORT_YN
		  FROM TB_OM02001 A
		     , TB_OM02003 E
		     , TB_OM02019 B
		     , TB_MA01005 C
		     , TB_MA01002 D
		 WHERE A.SALES_ORD_NO = B.SALES_ORD_NO
		   AND A.SALES_ORD_NO = E.SALES_ORD_NO
		   AND A.RPT_CUST_CD  = D.PTN_CD
		   AND A.SALES_ORD_NO = ${salesOrdNo}
		   AND B.BOOKING_NO   = ${bookingNo}
		   AND D.PTN_CD IN ('P1000', 'P1591', 'P1100')
		   AND B.POL_CD       = C.WORK_PL_CD
		   AND C.WM_YN        = 'Y'
	</statement>
	<statement name="retrievePortInOutInfoDirect">
		SELECT B.POL_CD
		     , MAX(DECODE(A.RPT_CUST_CD, 'P1000', DECODE(E.EXP_TYPE_CD, '01', 'Y', '02', 'Y', 'N')
		                               , 'P1591', DECODE(E.EXP_TYPE_CD, '01', 'Y', '02', 'Y', 'N')
		                               , 'Y')) PORT_YN
		  FROM TB_OM02001 A
			 , TB_OM02002 B
		     , TB_OM02003 E
		     , TB_MA01005 C
		     , TB_MA01002 D
		 WHERE A.SALES_ORD_NO = B.SALES_ORD_NO
		   AND A.SALES_ORD_NO = E.SALES_ORD_NO
		   AND A.RPT_CUST_CD  = D.PTN_CD
		   AND A.SALES_ORD_NO = ${salesOrdNo}
		   AND D.PTN_CD IN ('P1000', 'P1591', 'P1100')
		   AND B.POL_CD       = C.WORK_PL_CD
		   AND C.WM_YN        = 'Y'
		   AND B.DEL_YN = 'N'
	     GROUP BY B.POL_CD
	</statement>
  
	<statement name="retrieveMaxLineNo">
		SELECT MAX(TO_NUMBER(LINE_NO)) LINE_NO
		  FROM TB_OM02002 A
		 WHERE A.SALES_ORD_NO = ${salesOrdNo}
	</statement> 
	
	<statement name="retrievePtnExistYn">
		SELECT ptn_nm FROM tb_ma01002 WHERE ptn_cd = ${ctrtCustCd} AND ptn_sctn_cd = '03'
	</statement>
	
<!-- 해상수입판매오더포워딩 조회 (파트너용) -->
    <statement name="retrieveOceanImpPtnFwdOrd">
		SELECT 
		       a.sales_ord_no       														--판매오더번호
			  , a.sales_ord_stat_cd 														--판매오더상태코드
			  , MACOMM_GETCD_FN('ORD_STAT_CD', a.sales_ord_stat_cd ) AS sales_ord_stat_nm 	--판매오더상태명
		      , a.sales_ord_creat_ymd 														--판매오더생성일자
		      , a.sales_ord_creat_hms 														--판매오더생성시간
		      , a.ctrt_cust_cd        														--계약고객코드
		      , MACOMM_GETPTNNM_FN(a.ctrt_cust_cd ) AS ctrt_cust_nm 						--계약고객명
			  , a.ord_req_cust_cd 															--오더요청고객코드
			  , MACOMM_GETPTNNM_FN( a.ord_req_cust_cd) as ord_req_cust_nm					--오더요청고객명
		      , a.ord_type_cd  																--오더형태
	 	      , ( SELECT ord_type_nm
		    	  FROM	 TB_MA01006
		    	  WHERE	 ord_type_cd = a.ord_type_cd) as ord_type_nm						--오더명
		      , a.ctrt_no      																--계약번호
		      , a.ctrt_no||' '||( SELECT y.ctrt_nm
				  FROM   tb_sm04110 x, tb_sm07110 y
				  WHERE  x.corp_cd 	 	= y.corp_cd
				  AND	 x.prmt_biz_no 	= y.prmt_biz_no
				  AND    x.cust_cd 	 	= a.ctrt_cust_cd
				  AND    x.sell_ctrt_no = a.ctrt_no) as ctrt_nm 							--계약명
		  	  , a.bilg_cust_cd 																--청구고객코드
			  , MACOMM_GETPTNNM_FN( a.bilg_cust_cd ) AS bilg_cust_nm 						--청구고객명
			  , LTrim(a.sell_dept_cd, '0') as sell_dept_cd 									--매출부서코드
			  , MACOMM_GETDEPTNM_FN( a.corp_cd, a.sell_dept_cd ) AS sell_dept_nm 			--매출부서명
			  , a.sales_ofcr_id 															--영업사원아이디
			  , MACOMM_GETUSERNM_FN( a.sales_ofcr_id ) AS sales_ofcr_nm 					--영업사원명
		      , LTrim(a.ord_mngt_fwd_dept_cd, '0') as ord_mngt_fwd_dept_cd 					--오더관리포워딩부서코드
			  , MACOMM_GETDEPTNM_FN( a.corp_cd, a.ord_mngt_fwd_dept_cd ) AS ord_mngt_fwd_dept_nm 	--오더관리포워딩부서명
			  , a.ord_mngt_fwd_ofcr_id 														--오더관리포워딩담당자아이디
			  , MACOMM_GETUSERNM_FN( a.ord_mngt_fwd_ofcr_id ) AS ord_mngt_fwd_ofcr_nm 		--오더관리포워딩담당자명
		      , b.fwd_eo_no          						--포워딩오더번호
		      , a.sales_ord_cncl_yn  						--취소여부
		      , b.hbl_no									--House BL
		      , b.bl_kind_cd         						--B/L Type
		      , b.ci_no              						--C/I No (Invoice No)
		      , b.mbl_no									--Master BL
		      , a.cargo_form_cd      						--Cargo Type
			  --, macomm_getcd_fn( 'CARGO_FORM_CD', a.cargo_form_cd) cargo_form_nm
			  , decode(a.cargo_form_cd,'C','Container','B','Bulk') cargo_form_nm
		      , b.fcl_lcl_sctn_cd    						--FCL/LCL
		      , b.dpt_svc_term_cd    						--출발ServiceTerm
		      , b.arv_svc_term_cd    						--도착ServiceTerm
		      , b.incoterms_cd       						--INCOTERMS
		      , b.TRAN_COST_PAY_COND_CD		-- Freight 운임지급조건코드
		      , b.EXTR_EXPN_PAY_COND_CD		-- Other 부대비용지급조건코드
		      , b.PTN_CD
		      , b.PTN_NM									-- Partner
		      , b.PTN_OFCR_NM							-- Partner PIC
		      , b.ship_co_cd         						--Liner 코드
		      , b.ship_nm           						--Vessel
		      , b.port_cnt          						--Voyage
		      , b.pol_cd             						--POL코드
		      , b.pol_nm             						--POL명
		      , b.pod_cd             						--POD코드
		      , b.pod_nm             						--POD명
		      , b.dpt_port_prar_ymd  						--ETD
		      , b.arv_port_prar_ymd  						--ETA
		      , b.pckg_qty           						--Total Package수량
		      , b.pckg_unit_cd       						--Total Package코드
		      , MACOMM_GETCD_FN('PCKG_UNIT_CD', b.pckg_unit_cd) as pckg_unit_nm       						--Total Package코드
		      , b.tot_wgt            						--Gross Wgt
		      , b.tot_cbm            						--CBM
		      , b.RPT_ITEM_NM						-- Main Item
		      , a.cust_ref_no        						--Ref No
		      , b.lc_no              						--L/C No
		      , decode(b.BOND_TRAN_YN,'Y','1','0') bond_tran_yn					-- Bonded Trans
		      , decode(b.MNFEST_DCLR_TGT_YN,'Y','1','0') MNFEST_DCLR_TGT_YN		-- Target on Declation
		      , a.rmk                						--비고
		      , b.SHIPPER_CD							--Shipper
		      , b.SHIPPER_NM
		      , b.SHIPPER_ADDR1
		      , b.SHIPPER_ADDR2
		      , b.SHIPPER_ADDR3
		      , b.SHIPPER_ADDR4
		      , b.cnee_cd            						--Consignee코드
		      , b.cnee_nm            						--Consignee명
		      , b.cnee_addr1
		      , b.cnee_addr2
		      , b.cnee_addr3
		      , b.cnee_addr4
		      , b.NTFY_CD								-- NOTiFY
		      , b.NTFY_NM
		      , b.NTFY_ADDR1
		      , b.NTFY_ADDR2
		      , b.NTFY_ADDR3
		      , b.NTFY_ADDR4
		      , b.cntr_kind_cd1     
		      , b.cntr_qty1 
		      , b.cntr_kind_cd2 
		      , b.cntr_qty2 
		      , b.cntr_kind_cd3 
		      , b.cntr_qty3 
		      , b.cntr_kind_cd4 
		      , b.cntr_qty4 
		      , b.cntr_kind_cd5 
		      , b.cntr_qty5
		      , a.dpt_ar_cd         						--Door코드
		      , a.dpt_ar_type_cd         						--Door코드
		    , case when a.dpt_ar_type_cd = '02' then
		    	(select name 
		    	from vw_ma01_01 
		    	where code = a.dpt_ar_cd 
		    	AND	  PTN_CD = a.RPT_CUST_CD
		    	and work_sctn_cd = a.dpt_ar_type_cd) 
			  else 	    	
		    	(select name 
		    	from vw_ma01_01 
		    	where code = a.dpt_ar_cd 
		    	and work_sctn_cd = a.dpt_ar_type_cd
		    	and rownum = 1) 
		      end  as dpt_ar_nm
		      , a.dpt_ar_zip_cd     						--Door 우편번호
		      , a.dpt_ar_zip_addr   						--Door 우편주소
		      , a.dpt_ar_dtl_addr   						--Door 상세주소
		      , a.dpt_ar_ofcr_nm    						--Door PIC
		      , a.dpt_ar_ofcr_tel_no 						--Door Tel
		      , a.strt_req_ymd       						--Door Date
		      , a.strt_req_hm        						--Door Time
		      , b.TRAN_COST_PAY_COND_CD
		      , b.EXTR_EXPN_PAY_COND_CD
--		      , (select upper_ptn_cd from tb_ma01002 where ptn_cd = a.ctrt_cust_cd) as rpt_cust_cd --
		      , a.rpt_cust_cd as upper_ptn_cd -- 
		      , a.cust_ofcr_nm --고객담당자명
		      , a.cust_ofcr_tel_no --고객담당자연락번호
		      , a.sales_ord_cncl_reason --오더취소사유
		      , a.cust_expr_yn --고객긴급여부
		      , a.cls_expr_yn --마감긴급여부
		      , a.lead_time_expr_yn --리드타임긴급여부
		      , a.dtod_yn --택배여부
		      , a.load_dly_yn --상차지연여부
		      , a.back_ord_yn --대기오더여부
		      , a.aft_ord_yn --사후오더여부
		      , a.ltrm_ord_yn --장기오더여부
		      , a.arv_ar_cd
		      , a.arv_ar_type_cd
		      , a.arv_ar_zip_cd
		      ,	a.arv_ar_zip_addr
		      ,	a.arv_ar_dtl_addr
		      ,	a.arv_ar_ofcr_nm
		      ,	a.arv_ar_ofcr_tel_no
		      , a.aptd_req_ymd
		      , a.aptd_req_hm
		      , a.work_info_mngt_type_cd
		      , a.line_sctn_cd
		      ,	a.ord_mngt_exce_ofcr_id
		      ,	a.rpt_cust_cd
		      ,	a.ord_mngt_exce_dept_cd
		      , '' flag
			  , case when a.dpt_ar_type_cd = '02' then
		    	(select name 
		    	from vw_ma01_01 
		    	where code = a.arv_ar_cd 
		    	AND	  PTN_CD = a.RPT_CUST_CD
		    	and work_sctn_cd = a.arv_ar_type_cd) 
			  else 	    	
		    	(select name 
		    	from vw_ma01_01 
		    	where code = a.arv_ar_cd 
		    	and work_sctn_cd = a.arv_ar_type_cd
		    	and rownum = 1) 
		      end  as arv_ar_nm
		     ,  ( select ENG_SHIP_CO_NM as ship_co_nm
					FROM tb_ma01017 
					where ship_co_sign_cd = b.ship_co_cd
				) ship_co_nm	
	     	 , (SELECT COMN_CD_NM 
			  	 FROM TB_MA01015 X
			  	 	, TB_OM04002 Y
			  	 WHERE	X.CLAS_CD 		= 'FWD_RSLT_SCTN_CD'
			  	 AND	X.COMN_CD 		= Y.RSLT_SCTN_CD
			  	 AND	Y.SALES_ORD_NO  = A.SALES_ORD_NO
			  	 AND	Y.RSLT_SCTN_CD  = (SELECT MAX(RSLT_SCTN_CD) 
			  	 						   FROM 	 TB_OM04002 
			  	 						   WHERE   SALES_ORD_NO = Y.SALES_ORD_NO) ) FWD_STAT_NM
	     	 , (SELECT COMN_CD
			  	 FROM TB_MA01015 X
			  	 	, TB_OM04002 Y
			  	 WHERE	X.CLAS_CD 		= 'FWD_RSLT_SCTN_CD'
			  	 AND	X.COMN_CD 		= Y.RSLT_SCTN_CD
			  	 AND	Y.SALES_ORD_NO  = A.SALES_ORD_NO
			  	 AND	Y.RSLT_SCTN_CD  = (SELECT MAX(RSLT_SCTN_CD) 
			  	 						   FROM 	 TB_OM04002 
			  	 						   WHERE   SALES_ORD_NO = Y.SALES_ORD_NO) ) FWD_STAT_CD
					, '' upd_flag
					, a.tran_Plan_Cntr_Cd
					, b.ocean_air_sctn_cd
					, a.exp_imp_dom_sctn_cd
		FROM   tb_om02001 a
		     , tb_om02003 b
		WHERE 1=1
		{#1}
		AND   a.sales_ord_no = b.sales_ord_no
		AND	  a.SALES_ORD_CNCL_YN = 'N'
		AND	  b.ocean_air_sctn_cd	= 'S'
	<append condition="${ctrtCustCd}.NOTEMPTY" id="#1">
		AND	  a.ctrt_cust_cd  = ${ctrtCustCd}
	</append>
	<append condition="${blKindCd}.NOTEMPTY" id="#1">
		AND	  b.bl_kind_cd = ${blKindCd}
	</append>
	<append condition="${ptnCd}.NOTEMPTY" id="#1">
		AND	  B.PTN_CD = ${ptnCd}
	</append>
	<append condition="${blKindGbn}.EQ.MBL" id="#1">
		AND	  b.mbl_no = ${blNo}
	</append>
	<append condition="${blKindGbn}.EQ.HBL" id="#1">
		AND	  b.hbl_no = ${blNo}
	</append>
    </statement>
  
<!-- 해상수입판매오더포워딩 라인아이템 조회 (파트너용) -->
  <statement name="retrieveOceanImpPtnFwdOrdItemList">
	  SELECT a.sales_ord_no
		    ,0 chk
	        , a.line_no
	        , a.cust_cd
	        , a.item_cd
	        ,(select x.item_nm
	            from tb_ma02010 x
	           where x.ptn_cd  = a.cust_cd
	             and x.item_cd = a.item_cd) item_nm
	        , a.pckg_unit_cd
            , MACOMM_GETCD_FN('PCKG_UNIT_CD', a.pckg_unit_cd) as pckg_unit_nm       						--Total Package코드
	        , a.pckg_qty
	        , a.qty_unit_cd
 	        , a.ord_qty
	        , a.wgt_unit_cd
	        , a.ord_wgt
	        , a.cntr_no
	        , a.seal_no1
	        , a.seal_no2
	        , DECODE((SELECT COUNT(line_no)
		                FROM tb_om03002
		               WHERE sales_ord_no = a.sales_ord_no
		                 AND LINE_NO		= A.LINE_NO
		                 and work_route_seq in (select work_route_seq
		               							  from tb_om03001
		               							 where sales_ord_no = a.sales_ord_no
		               							   and del_yn = 'N') ), 0, 'N', 'Y') AS trans_div_yn
	        , a.dpt_ar_cd
	        , a.dpt_ar_type_cd
		    , case when a.dpt_ar_type_cd = '02' then
		    	       (select name 
		    	          from vw_ma01_01 
		    	         where code = a.dpt_ar_cd 
		    	           AND PTN_CD = b.RPT_CUST_CD
		    	           and work_sctn_cd = a.dpt_ar_type_cd) 
		           else 	    	
		    	       (select name 
		    	          from vw_ma01_01 
		    	         where code = a.dpt_ar_cd 
		    	           and work_sctn_cd = a.dpt_ar_type_cd
		    	           and rownum = 1) 
		      end  as dpt_ar_nm
		    , a.dpt_ar_zip_cd
	        , a.dpt_ar_zip_addr
	        , a.dpt_ar_dtl_addr
	        , a.strt_req_ymd
	        , a.strt_req_hm
	        , '' as flag
		    , a.arv_ar_cd		
		    , a.arv_ar_zip_cd		
		    , a.arv_ar_type_cd
		    , a.arv_ar_zip_addr		
		    , a.arv_ar_dtl_addr		
		    , a.arv_ar_ofcr_nm		
		    , a.arv_ar_ofcr_tel_no	
		    , a.strt_req_ymd		
		    , a.strt_req_hm		
		    , a.aptd_req_ymd		
		    , a.aptd_req_hm	
		    , a.ord_cbm
		    , a.basis_item_cd
		    , a.fe_sctn_cd 	 
			, case when a.arv_ar_type_cd = '02' then
		    	       (select name 
		    	          from vw_ma01_01 
		    	         where code = b.arv_ar_cd 
		    	           AND PTN_CD = b.RPT_CUST_CD
		    	           and work_sctn_cd = b.arv_ar_type_cd) 
			       else 	    	
		    	       (select name 
		    	          from vw_ma01_01 
		    	         where code = b.arv_ar_cd 
		    	           and work_sctn_cd = b.arv_ar_type_cd
		    	           and rownum = 1) 
		      end  as arv_ar_nm
			, a.rpt_item_nm as main_item_cd
		    , c.ocean_air_sctn_cd
		    , b.exp_imp_dom_sctn_cd
		    , '' upd_flag
		    , a.dcsn_yn --확정여부
		    , a.basis_Unit_Cd
	    FROM  tb_om02002 a
	        , tb_om02001 b
	        , tb_om02003 c
	   WHERE  b.ctrt_cust_cd  = ${ctrtCustCd}
	     AND  c.bl_kind_cd = ${blKindCd}
	    {#1}
	     AND  a.sales_ord_no = b.sales_ord_no
	     AND  b.sales_ord_no = c.sales_ord_no     
	     AND  a.del_yn='N'
	     AND  b.SALES_ORD_CNCL_YN = 'N'
	     AND  c.ocean_air_sctn_cd	= 'S'
  	   order by to_number(a.line_no)
	<append condition="${blKindGbn}.EQ.MBL" id="#1">
		 AND  c.mbl_no = ${blNo}
	</append>
	<append condition="${blKindGbn}.EQ.HBL" id="#1">
		 AND  c.hbl_no = ${blNo}
	</append>
  </statement>
	 
  <statement name="retrieveNewBookingNo">
	  SELECT 'BK' || lpad(nvl(max(to_number(substr(booking_no, 3, 3))), 0) + 1, 3, '0')  as booking_no
		FROM (
		      SELECT max(booking_no) booking_no
		        FROM tb_om02019
		       WHERE sales_ord_No = ${salesOrdNo}
		      ) 
  </statement>
	 
  <statement name="retrieveExpTypeCd">
	 	SELECT  a.exp_imp_dom_sctn_cd, b.EXP_TYPE_CD,a.cust_ord_no
	 	FROM	TB_OM02003 b
	 		  , tb_om02001 a
	 	WHERE	a.SALES_ORD_NO = ${salesOrdNo}
	 	and		a.sales_ord_no = b.sales_ord_no
  </statement>

  <statement name="retrieveAvailCancelImpBl">
		SELECT EXTERNRECEIPTKEY
		     , STATUS
		FROM {#1}
		WHERE BLNO   = ${blNo}
		AND   BLSEQ  = ${blNo} || ${custOrdNo}
		AND   WHSEID = ${workPlCd}
		AND	  SOKEY  = ${salesOrdNo}
		AND	  STATUS != '19'
		<append condition="${workPlCd}.NOTEMPTY"  id="#1">
				IDWMS.RECEIPT a
		</append>
  </statement>	 
  <statement name="retrieveAvailCancelImpBl_old">
		SELECT EXTERNRECEIPTKEY
		     , STATUS
		FROM {#1}
		WHERE BLNO   = ${blNo}
		AND   BLSEQ  = ${blNo} || ${custOrdNo}
		AND   WHSEID = ${workPlCd}
		AND	  SOKEY  = ${salesOrdNo}
		AND	  STATUS != '19'
		<append condition="${workPlCd}.NOTEMPTY"  id="#1">
				${workPlCd:not}.RECEIPT a
		</append>
  </statement>
<!-- 항공수입판매오더포워딩 조회 (파트너용) -->
  <statement name="retrieveAirImpPtnFwdOrd">
		SELECT 
		       a.sales_ord_no       														--판매오더번호
			  , a.sales_ord_stat_cd 														--판매오더상태코드
			  , MACOMM_GETCD_FN('ORD_STAT_CD', a.sales_ord_stat_cd ) AS sales_ord_stat_nm 	--판매오더상태명
		      , a.sales_ord_creat_ymd 														--판매오더생성일자
		      , a.sales_ord_creat_hms 														--판매오더생성시간
		      , a.ctrt_cust_cd        														--계약고객코드
		      , MACOMM_GETPTNNM_FN(a.ctrt_cust_cd ) AS ctrt_cust_nm 						--계약고객명
			  , a.ord_req_cust_cd 															--오더요청고객코드
			  , MACOMM_GETPTNNM_FN( a.ord_req_cust_cd) as ord_req_cust_nm					--오더요청고객명
		      , a.ord_type_cd  																--오더형태
	 	      , ( SELECT ord_type_nm
		    	  FROM	 TB_MA01006
		    	  WHERE	 ord_type_cd = a.ord_type_cd) as ord_type_nm						--오더명
		      , a.ctrt_no      																--계약번호
		      , a.ctrt_no||' '||( SELECT y.ctrt_nm
				  FROM   tb_sm04110 x, tb_sm07110 y
				  WHERE  x.corp_cd 	 	= y.corp_cd
				  AND	 x.prmt_biz_no 	= y.prmt_biz_no
				  AND    x.cust_cd 	 	= a.ctrt_cust_cd
				  AND    x.sell_ctrt_no = a.ctrt_no) as ctrt_nm 							--계약명
		  	  , a.bilg_cust_cd 																--청구고객코드
			  , MACOMM_GETPTNNM_FN( a.bilg_cust_cd ) AS bilg_cust_nm 						--청구고객명
			  , LTrim(a.sell_dept_cd, '0') as sell_dept_cd 									--매출부서코드
			  , MACOMM_GETDEPTNM_FN( a.corp_cd, a.sell_dept_cd ) AS sell_dept_nm 			--매출부서명
			  , a.sales_ofcr_id 															--영업사원아이디
			  , MACOMM_GETUSERNM_FN( a.sales_ofcr_id ) AS sales_ofcr_nm 					--영업사원명
		      , LTrim(a.ord_mngt_fwd_dept_cd, '0') as ord_mngt_fwd_dept_cd 					--오더관리포워딩부서코드
			  , MACOMM_GETDEPTNM_FN( a.corp_cd, a.ord_mngt_fwd_dept_cd ) AS ord_mngt_fwd_dept_nm 	--오더관리포워딩부서명
			  , a.ord_mngt_fwd_ofcr_id 														--오더관리포워딩담당자아이디
			  , MACOMM_GETUSERNM_FN( a.ord_mngt_fwd_ofcr_id ) AS ord_mngt_fwd_ofcr_nm 		--오더관리포워딩담당자명
		      , b.fwd_eo_no          						--포워딩오더번호
		      , a.sales_ord_cncl_yn  						--취소여부
		      , b.hbl_no									--House BL
		      , b.bl_kind_cd         						--B/L Type
		      , b.ci_no              						--C/I No (Invoice No)
		      , b.mbl_no									--Master BL
		      , a.cargo_form_cd      						--Cargo Type
			  , macomm_getcd_fn( 'CARGO_FORM_CD', a.cargo_form_cd) cargo_form_nm
		      , b.fcl_lcl_sctn_cd    						--FCL/LCL
		      , b.dpt_svc_term_cd    						--출발ServiceTerm
		      , b.arv_svc_term_cd    						--도착ServiceTerm
		      , b.incoterms_cd       						--INCOTERMS
		      , b.TRAN_COST_PAY_COND_CD		-- Freight 운임지급조건코드
		      , b.EXTR_EXPN_PAY_COND_CD		-- Other 부대비용지급조건코드
		      , b.PTN_CD
		      , b.PTN_NM									-- Partner
		      , b.PTN_OFCR_NM							-- Partner PIC
		      , b.airline_cd         						
			  , macomm_getcd_fn( 'IATA_CD', b.airline_cd) as airline__nm	
			  , b.co_load_entp_cd
		      , (SELECT c.ptn_nm FROM tb_ma01002 c WHERE c.ptn_cd = b.co_load_entp_cd ) co_load_entp_nm	
		      , b.ship_co_cd         						--Liner 코드
		      , b.ship_nm           						--Vessel
		      , b.port_cnt          						--Voyage
		      , b.pol_cd             						--POL코드
		      , b.pol_nm             						--POL명
		      , b.pod_cd             						--POD코드
		      , b.pod_nm             						--POD명
		      , b.dpt_port_prar_ymd  						--ETD
		      , b.arv_port_prar_ymd  						--ETA
		      , b.pckg_qty           						--Total Package수량
		      , b.pckg_unit_cd       						--Total Package코드
		      , MACOMM_GETCD_FN('PCKG_UNIT_CD', b.pckg_unit_cd) as pckg_unit_nm       						--Total Package코드
		      , b.tot_wgt            						--Gross Wgt
		      , b.tot_cbm            						--CBM
		      , b.RPT_ITEM_NM						-- Main Item
		      , a.cust_ref_no        						--Ref No
		      , b.lc_no              						--L/C No
		      , decode(b.BOND_TRAN_YN,'Y','1','0') bond_tran_yn					-- Bonded Trans
		      , decode(b.MNFEST_DCLR_TGT_YN,'Y','1','0') MNFEST_DCLR_TGT_YN		-- Target on Declation
		      , a.rmk                						--비고
		      , b.SHIPPER_CD							--Shipper
		      , b.SHIPPER_NM
		      , b.SHIPPER_ADDR1
		      , b.SHIPPER_ADDR2
		      , b.SHIPPER_ADDR3
		      , b.SHIPPER_ADDR4
		      , b.cnee_cd            						--Consignee코드
		      , b.cnee_nm            						--Consignee명
		      , b.cnee_addr1
		      , b.cnee_addr2
		      , b.cnee_addr3
		      , b.cnee_addr4
		      , b.NTFY_CD								-- NOTiFY
		      , b.NTFY_NM
		      , b.NTFY_ADDR1
		      , b.NTFY_ADDR2
		      , b.NTFY_ADDR3
		      , b.NTFY_ADDR4
		      , b.cntr_kind_cd1     
		      , b.cntr_qty1 
		      , b.cntr_kind_cd2 
		      , b.cntr_qty2 
		      , b.cntr_kind_cd3 
		      , b.cntr_qty3 
		      , b.cntr_kind_cd4 
		      , b.cntr_qty4 
		      , b.cntr_kind_cd5 
		      , b.cntr_qty5
		      , a.dpt_ar_cd         						--Door코드
		      , a.dpt_ar_type_cd         						--Door코드
		    , case when a.dpt_ar_type_cd = '02' then
		    	(select name 
		    	from vw_ma01_01 
		    	where code = a.dpt_ar_cd 
		    	AND	  PTN_CD = a.RPT_CUST_CD
		    	and work_sctn_cd = a.dpt_ar_type_cd) 
			  else 	    	
		    	(select name 
		    	from vw_ma01_01 
		    	where code = a.dpt_ar_cd 
		    	and work_sctn_cd = a.dpt_ar_type_cd
		    	and rownum = 1) 
		      end  as dpt_ar_nm
		      , a.dpt_ar_zip_cd     						--Door 우편번호
		      , a.dpt_ar_zip_addr   						--Door 우편주소
		      , a.dpt_ar_dtl_addr   						--Door 상세주소
		      , a.dpt_ar_ofcr_nm    						--Door PIC
		      , a.dpt_ar_ofcr_tel_no 						--Door Tel
		      , a.strt_req_ymd       						--Door Date
		      , a.strt_req_hm        						--Door Time
		      , b.TRAN_COST_PAY_COND_CD
		      , b.EXTR_EXPN_PAY_COND_CD
--		      , (select upper_ptn_cd from tb_ma01002 where ptn_cd = a.ctrt_cust_cd) as rpt_cust_cd --대표고객코드 
		      , a.rpt_cust_cd as upper_ptn_cd --대표고객
		      , a.cust_ofcr_nm --고객담당자명
		      , a.cust_ofcr_tel_no --고객담당자연락번호
		      , a.sales_ord_cncl_reason --오더취소사유
		      , a.cust_expr_yn --고객긴급여부
		      , a.cls_expr_yn --마감긴급여부
		      , a.lead_time_expr_yn --리드타임긴급여부
		      , a.dtod_yn --택배여부
		      , a.load_dly_yn --상차지연여부
		      , a.back_ord_yn --대기오더여부
		      , a.aft_ord_yn --사후오더여부
		      , a.ltrm_ord_yn --장기오더여부
		      , a.arv_ar_cd
		      , a.arv_ar_type_cd
		      , a.arv_ar_zip_cd
		      ,	a.arv_ar_zip_addr
		      ,	a.arv_ar_dtl_addr
		      ,	a.arv_ar_ofcr_nm
		      ,	a.arv_ar_ofcr_tel_no
		      , a.aptd_req_ymd
		      , a.aptd_req_hm
		      , a.work_info_mngt_type_cd
		      , a.line_sctn_cd
		      ,	a.ord_mngt_exce_ofcr_id
		      ,	a.rpt_cust_cd
		      ,	a.ord_mngt_exce_dept_cd
		      , '' flag
			  , case when a.dpt_ar_type_cd = '02' then
		    	(select name 
		    	from vw_ma01_01 
		    	where code = a.arv_ar_cd 
		    	AND	  PTN_CD = a.RPT_CUST_CD
		    	and work_sctn_cd = a.arv_ar_type_cd) 
			  else 	    	
		    	(select name 
		    	from vw_ma01_01 
		    	where code = a.arv_ar_cd 
		    	and work_sctn_cd = a.arv_ar_type_cd
		    	and rownum = 1) 
		      end  as arv_ar_nm
		     ,  ( select ENG_SHIP_CO_NM as ship_co_nm
					FROM tb_ma01017 
					where ship_co_sign_cd = b.ship_co_cd
				) ship_co_nm	
	     	 , (SELECT COMN_CD_NM 
			  	 FROM TB_MA01015 X
			  	 	, TB_OM04002 Y
			  	 WHERE	X.CLAS_CD 		= 'FWD_RSLT_SCTN_CD'
			  	 AND	X.COMN_CD 		= Y.RSLT_SCTN_CD
			  	 AND	Y.SALES_ORD_NO  = A.SALES_ORD_NO
			  	 AND	Y.RSLT_SCTN_CD  = (SELECT MAX(RSLT_SCTN_CD) 
			  	 						   FROM 	 TB_OM04002 
			  	 						   WHERE   SALES_ORD_NO = Y.SALES_ORD_NO) ) FWD_STAT_NM
	     	 , (SELECT COMN_CD
			  	 FROM TB_MA01015 X
			  	 	, TB_OM04002 Y
			  	 WHERE	X.CLAS_CD 		= 'FWD_RSLT_SCTN_CD'
			  	 AND	X.COMN_CD 		= Y.RSLT_SCTN_CD
			  	 AND	Y.SALES_ORD_NO  = A.SALES_ORD_NO
			  	 AND	Y.RSLT_SCTN_CD  = (SELECT MAX(RSLT_SCTN_CD) 
			  	 						   FROM 	 TB_OM04002 
			  	 						   WHERE   SALES_ORD_NO = Y.SALES_ORD_NO) ) FWD_STAT_CD
					, '' upd_flag
					, a.tran_Plan_Cntr_Cd
		FROM   tb_om02001 a
		     , tb_om02003 b
		WHERE 1=1
		AND   a.sales_ord_no = b.sales_ord_no
		AND	  a.SALES_ORD_CNCL_YN = 'N'
		AND    b.ocean_air_sctn_cd = 'A' --항공
		AND    a.exp_imp_dom_sctn_cd = '02' --수입	
		{#1}
	<append condition="${ctrtCustCd}.NOTEMPTY" id="#1">
		AND	  a.ctrt_cust_cd  = ${ctrtCustCd}
	</append>
	<append condition="${blKindCd}.NOTEMPTY" id="#1">
		AND	  b.bl_kind_cd = ${blKindCd}
	</append>
	<append condition="${ptnCd}.NOTEMPTY" id="#1">
		AND		B.PTN_CD = ${ptnCd}
	</append>
	<append condition="${blKindGbn}.EQ.MBL" id="#1">
		AND	  b.mbl_no = ${blNo}
	</append>
	<append condition="${blKindGbn}.EQ.HBL" id="#1">
		AND	  b.hbl_no = ${blNo}
	</append>
  </statement>	
  
  	<statement name="retrieveOceanImpGiOrd_back">
		SELECT a.sales_ord_no
		     , a.cust_ord_no
		     , a.ord_type_cd
		     , a.rpt_cust_cd
		     , a.load_dly_yn
		     , a.LOAD_DLY_RLTD_SALES_ORD_NO
		     , b.cust_ord_line_no
		     , b.line_no
		     , b.arv_ar_cd
		     , b.arv_ar_type_cd
			 , CASE WHEN b.arv_ar_type_cd = '02' THEN
		    	(SELECT name 
		    	   FROM vw_ma01_01 
		    	  WHERE code = b.arv_ar_cd 
		    	    AND ptn_cd = a.rpt_cust_cd
		    		AND work_sctn_cd = b.arv_ar_type_cd) 
			  ELSE 	    	
		    	(SELECT name 
		    	   FROM vw_ma01_01 
		    	  WHERE code = b.arv_ar_cd 
		    	  	AND work_sctn_cd = b.arv_ar_type_cd
		    		AND ROWNUM = 1) 
		      END  AS arv_ar_nm
		     , b.arv_ar_zip_cd
		     , b.arv_ar_zip_addr
		     , b.arv_ar_dtl_addr
		     , b.item_cd
		     , c.item_nm
		     , b.admt ord_admt
		     , b.wgt_unit_cd
			 , a.ARV_AR_OFCR_NM
		     , a.ctrt_cust_cd
		     , b.dpt_ar_cd
		     , b.dpt_ar_type_cd
		     , b.dpt_ar_zip_cd
		     , b.dpt_ar_zip_addr
		     , b.dpt_ar_dtl_addr
		     , b.strt_req_ymd
		     , b.strt_req_hm
		     , b.aptd_req_ymd
		     , b.aptd_req_hm
	         , (SELECT wm_work_pl_cd FROM tb_ma01005 WHERE work_pl_cd = b.dpt_ar_cd AND wm_yn = 'Y') work_pl_cd
	         , a.ord_verify_yn
 			 , (SELECT SUM(NVL(y.admt, 0))
			   	FROM tb_om03001 x, tb_om03002 y 
			   	WHERE x.sales_ord_no = a.sales_ord_no
				AND	x.del_yn = 'N'
				AND	x.sales_ord_no = y.sales_ord_no
				AND x.work_route_seq = y.work_route_seq
				AND	y.line_no = b.line_no) unit_admt
			 , CASE WHEN NVL(b.admt, 0) - (SELECT SUM(NVL(y.admt, 0))
										   	FROM tb_om03001 x, tb_om03002 y 
										   	WHERE x.sales_ord_no = a.sales_ord_no
											AND	x.del_yn = 'N'
											AND	x.sales_ord_no = y.sales_ord_no
											AND x.work_route_seq = y.work_route_seq
											AND	y.line_no = b.line_no) > 0 
				THEN NVL(b.admt, 0) - (SELECT SUM(NVL(y.admt, 0))
			   							FROM tb_om03001 x, tb_om03002 y 
									   	WHERE x.sales_ord_no = a.sales_ord_no
										AND	x.del_yn = 'N'
										AND	x.sales_ord_no = y.sales_ord_no
										AND x.work_route_seq = y.work_route_seq
										AND	y.line_no = b.line_no)
                ELSE 0 END bal_admt
	         , '' drct_load_yn
	         , '' bl_no
	         , '' bl_cust_ord_no
	         , CASE WHEN a.sales_ord_stat_cd = '06' THEN '완료'
	         	    WHEN a.sales_ord_cncl_yn = 'Y'  THEN '취소'
	         	    WHEN b.ord_reason_cd IS NOT NULL THEN '아이템종결'
	         	    ELSE '가능' END divide_possible
	         , CASE WHEN a.sales_ord_stat_cd = '06' THEN 'N'
	         	    WHEN a.sales_ord_cncl_yn = 'Y'  THEN 'N'
	         	    WHEN b.ord_reason_cd IS NOT NULL THEN 'N'
	         	    ELSE 'Y' END divide_possible_yn
	         , b.ord_reason_cd
	         , IDUSR.OMCOMM_GETCUSTREASONNM_FN(a.rpt_cust_cd, b.ord_reason_cd) AS ord_reason_nm
	         , '' tran_cond_cd
	         ,(SELECT work_cntr_cd
                 FROM   tb_om01002
                 WHERE  cust_cd = a.cust_cd
                 AND    cust_ord_no = a.cust_ord_no
                 AND    cust_ord_line_no = b.cust_ord_line_no
                 AND    ROWNUM = 1) AS work_cntr_cd
             , a.cust_move_type_cd
		FROM   tb_om02001 a
		     , tb_om02002 b
		     , TB_MA02010 c
		     , tb_om02003 d
		     , tb_ma01006 e
		WHERE  a.sales_ord_no = b.sales_ord_no     
		AND	   a.sales_ord_no = d.sales_ord_no
		AND    b.cust_cd      = c.ptn_cd
		AND    b.item_cd      = c.item_cd
		AND	   a.exp_imp_dom_sctn_cd = '02'
		AND	   d.ocean_air_sctn_cd = 'S'
		and	   e.ord_type_cd = a.ord_type_cd
		and	   e.logis_ar_cd = '3'
		and    b.del_yn='N'
		and	   e.logis_svc_sctn_cd IN ('02', '04', '06')
		{#1}
		ORDER BY a.sales_ord_no
		      	 , a.cust_ord_no
		     	 , b.line_no
	<append condition="${ctrtCustCd}.NOTEMPTY" id="#1">
		AND    a.ctrt_cust_cd = ${ctrtCustCd}
	</append>
	<append condition="${dptArCd}.NOTEMPTY" id="#1">
		AND    a.dpt_ar_cd    = ${dptArCd}
	</append>
	<append condition="${arvArCd}.NOTEMPTY" id="#1">
		AND    a.arv_ar_cd    = ${arvArCd}
	</append>	
	<append condition="${aptdReqYmdFr}.NOTEMPTY&amp;${aptdReqYmdTo}.NOTEMPTY" id="#1">
		AND    b.aptd_req_ymd BETWEEN ${aptdReqYmdFr} AND ${aptdReqYmdTo}
	</append>
  	</statement>
  	
  	
  	<statement name="retrieveOceanImpGiOrd">
		SELECT a.sales_ord_no
		     , a.cust_ord_no
		     , a.ord_type_cd
		     , a.rpt_cust_cd
		     , a.load_dly_yn
		     , a.LOAD_DLY_RLTD_SALES_ORD_NO
		     , b.cust_ord_line_no
		     , b.line_no
		     , b.arv_ar_cd
		     , b.arv_ar_type_cd
			 , CASE WHEN b.arv_ar_type_cd = '02' THEN
		    	(SELECT name 
		    	   FROM vw_ma01_01 
		    	  WHERE code = b.arv_ar_cd 
		    	    AND ptn_cd = a.rpt_cust_cd
		    		AND work_sctn_cd = b.arv_ar_type_cd) 
			  ELSE 	    	
		    	(SELECT name 
		    	   FROM vw_ma01_01 
		    	  WHERE code = b.arv_ar_cd 
		    	  	AND work_sctn_cd = b.arv_ar_type_cd
		    		AND ROWNUM = 1) 
		      END  AS arv_ar_nm
		     , b.arv_ar_zip_cd
		     , b.arv_ar_zip_addr
		     , b.arv_ar_dtl_addr
		     , b.item_cd
		     , c.item_nm
		     , b.admt ord_admt
		     , b.wgt_unit_cd
			 , a.ARV_AR_OFCR_NM
		     , a.ctrt_cust_cd
		     , b.dpt_ar_cd
		     , b.dpt_ar_type_cd
		     , b.dpt_ar_zip_cd
		     , b.dpt_ar_zip_addr
		     , b.dpt_ar_dtl_addr
		     , b.strt_req_ymd
		     , b.strt_req_hm
		     , b.aptd_req_ymd
		     , b.aptd_req_hm
	         , (SELECT wm_work_pl_cd FROM tb_ma01005 WHERE work_pl_cd = b.dpt_ar_cd AND wm_yn = 'Y') work_pl_cd
	         , a.ord_verify_yn
 			 , (SELECT SUM(NVL(y.admt, 0))
			   	  FROM tb_om03001 x, tb_om03002 y 
			   	 WHERE x.sales_ord_no = a.sales_ord_no
				   AND x.del_yn = 'N'
				   AND x.sales_ord_no = y.sales_ord_no
				   AND x.work_route_seq = y.work_route_seq
				   AND y.line_no = b.line_no) unit_admt
			 , CASE WHEN NVL(b.admt, 0) - (SELECT SUM(NVL(y.admt, 0))
										   	 FROM tb_om03001 x, tb_om03002 y 
										   	WHERE x.sales_ord_no = a.sales_ord_no
											AND	x.del_yn = 'N'
											AND	x.sales_ord_no = y.sales_ord_no
											AND x.work_route_seq = y.work_route_seq
											AND	y.line_no = b.line_no) > 0 
				    THEN NVL(b.admt, 0) - (SELECT SUM(NVL(y.admt, 0))
			   							     FROM tb_om03001 x, tb_om03002 y 
									   	    WHERE x.sales_ord_no = a.sales_ord_no
										      AND x.del_yn = 'N'
										      AND x.sales_ord_no = y.sales_ord_no
										      AND x.work_route_seq = y.work_route_seq
										      AND y.line_no = b.line_no)
                ELSE 0 END bal_admt
	         , '' drct_load_yn
	         , '' bl_no
	         , '' bl_cust_ord_no
	         , CASE WHEN a.sales_ord_stat_cd = '06' THEN '완료'
	         	    WHEN a.sales_ord_cncl_yn = 'Y'  THEN '취소'
	         	    WHEN b.ord_reason_cd IS NOT NULL THEN '아이템종결'
	         	    ELSE '가능' END divide_possible
	         , CASE WHEN a.sales_ord_stat_cd = '06' THEN 'N'
	         	    WHEN a.sales_ord_cncl_yn = 'Y'  THEN 'N'
	         	    WHEN b.ord_reason_cd IS NOT NULL THEN 'N'
	         	    ELSE 'Y' END divide_possible_yn
	         , b.ord_reason_cd
	         , IDUSR.OMCOMM_GETCUSTREASONNM_FN(a.rpt_cust_cd, b.ord_reason_cd) AS ord_reason_nm
	         , '' tran_cond_cd
	         ,(SELECT work_cntr_cd
                 FROM   tb_om01002
                 WHERE  cust_cd = a.cust_cd
                 AND    cust_ord_no = a.cust_ord_no
                 AND    cust_ord_line_no = b.cust_ord_line_no
                 AND    ROWNUM = 1) AS work_cntr_cd
             ,a.cust_move_type_cd
		FROM   tb_om02001 a
		     , tb_om02002 b
		     , TB_MA02010 c
		WHERE 1=1      
		 {#1}
		 {#2}
		  AND a.ord_type_cd in ('3078','3079','3058','3068','3070','3072','3080')
		  AND a.sales_ord_no = b.sales_ord_no
		  AND b.cust_cd      = c.ptn_cd
		  AND b.item_cd      = c.item_cd
      	  and b.del_yn='N'
		ORDER BY a.sales_ord_no
		      	 , a.cust_ord_no
		     	 , b.line_no
	<append condition="${ctrtCustCd}.NOTEMPTY" id="#1">
		  AND b.cust_cd  = ${ctrtCustCd}
	</append>
	<append condition="${dptArCd}.NOTEMPTY" id="#1">
		  AND b.dpt_ar_cd    = ${dptArCd}
	</append>
	<append condition="${arvArCd}.NOTEMPTY" id="#1">
		  AND b.arv_ar_cd    = ${arvArCd}
	</append>	
	<append condition="${aptdReqYmdFr}.NOTEMPTY&amp;${aptdReqYmdTo}.NOTEMPTY" id="#2">
		  AND b.aptd_req_ymd BETWEEN ${aptdReqYmdFr} AND ${aptdReqYmdTo}
	</append>
  	</statement>

  	<statement name="retrieveOceanImpGiOrd_bak_20120529">
		SELECT a.sales_ord_no
		     , a.cust_ord_no
		     , a.ord_type_cd
		     , a.rpt_cust_cd
		     , a.load_dly_yn
		     , a.LOAD_DLY_RLTD_SALES_ORD_NO
		     , b.cust_ord_line_no
		     , b.line_no
		     , b.arv_ar_cd
		     , b.arv_ar_type_cd
			 , CASE WHEN b.arv_ar_type_cd = '02' THEN
		    	(SELECT name 
		    	   FROM vw_ma01_01 
		    	  WHERE code = b.arv_ar_cd 
		    	    AND ptn_cd = a.rpt_cust_cd
		    		AND work_sctn_cd = b.arv_ar_type_cd) 
			  ELSE 	    	
		    	(SELECT name 
		    	   FROM vw_ma01_01 
		    	  WHERE code = b.arv_ar_cd 
		    	  	AND work_sctn_cd = b.arv_ar_type_cd
		    		AND ROWNUM = 1) 
		      END  AS arv_ar_nm
		     , b.arv_ar_zip_cd
		     , b.arv_ar_zip_addr
		     , b.arv_ar_dtl_addr
		     , b.item_cd
		     , c.item_nm
		     , b.admt ord_admt
		     , b.wgt_unit_cd
			 , a.ARV_AR_OFCR_NM
		     , a.ctrt_cust_cd
		     , b.dpt_ar_cd
		     , b.dpt_ar_type_cd
		     , b.dpt_ar_zip_cd
		     , b.dpt_ar_zip_addr
		     , b.dpt_ar_dtl_addr
		     , b.strt_req_ymd
		     , b.strt_req_hm
		     , b.aptd_req_ymd
		     , b.aptd_req_hm
	         , (SELECT wm_work_pl_cd FROM tb_ma01005 WHERE work_pl_cd = b.dpt_ar_cd AND wm_yn = 'Y') work_pl_cd
	         , a.ord_verify_yn
 			 , (SELECT SUM(NVL(y.admt, 0))
			   	  FROM tb_om03001 x, tb_om03002 y 
			   	 WHERE x.sales_ord_no = a.sales_ord_no
				   AND x.del_yn = 'N'
				   AND x.sales_ord_no = y.sales_ord_no
				   AND x.work_route_seq = y.work_route_seq
				   AND y.line_no = b.line_no) unit_admt
			 , CASE WHEN NVL(b.admt, 0) - (SELECT SUM(NVL(y.admt, 0))
										   	 FROM tb_om03001 x, tb_om03002 y 
										   	WHERE x.sales_ord_no = a.sales_ord_no
											AND	x.del_yn = 'N'
											AND	x.sales_ord_no = y.sales_ord_no
											AND x.work_route_seq = y.work_route_seq
											AND	y.line_no = b.line_no) > 0 
				    THEN NVL(b.admt, 0) - (SELECT SUM(NVL(y.admt, 0))
			   							     FROM tb_om03001 x, tb_om03002 y 
									   	    WHERE x.sales_ord_no = a.sales_ord_no
										      AND x.del_yn = 'N'
										      AND x.sales_ord_no = y.sales_ord_no
										      AND x.work_route_seq = y.work_route_seq
										      AND y.line_no = b.line_no)
                ELSE 0 END bal_admt
	         , '' drct_load_yn
	         , '' bl_no
	         , '' bl_cust_ord_no
	         , CASE WHEN a.sales_ord_stat_cd = '06' THEN '완료'
	         	    WHEN a.sales_ord_cncl_yn = 'Y'  THEN '취소'
	         	    WHEN b.ord_reason_cd IS NOT NULL THEN '아이템종결'
	         	    ELSE '가능' END divide_possible
	         , CASE WHEN a.sales_ord_stat_cd = '06' THEN 'N'
	         	    WHEN a.sales_ord_cncl_yn = 'Y'  THEN 'N'
	         	    WHEN b.ord_reason_cd IS NOT NULL THEN 'N'
	         	    ELSE 'Y' END divide_possible_yn
	         , b.ord_reason_cd
	         , IDUSR.OMCOMM_GETCUSTREASONNM_FN(a.rpt_cust_cd, b.ord_reason_cd) AS ord_reason_nm
	         , '' tran_cond_cd
	         ,(SELECT work_cntr_cd
                 FROM   tb_om01002
                 WHERE  cust_cd = a.cust_cd
                 AND    cust_ord_no = a.cust_ord_no
                 AND    cust_ord_line_no = b.cust_ord_line_no
                 AND    ROWNUM = 1) AS work_cntr_cd
		FROM   tb_om02001 a
		     , tb_om02002 b
		     , TB_MA02010 c
		WHERE 1=1      
		 {#1}
		 {#2}
		  AND a.ord_type_cd in ('3078','3079','3058','3068','3070','3072','3080')
		  AND a.sales_ord_no = b.sales_ord_no
		  AND b.cust_cd      = c.ptn_cd
		  AND b.item_cd      = c.item_cd
      	  and b.del_yn='N'
		ORDER BY a.sales_ord_no
		      	 , a.cust_ord_no
		     	 , b.line_no
	<append condition="${ctrtCustCd}.NOTEMPTY" id="#1">
		  AND a.rpt_cust_cd  = ${ctrtCustCd}
	</append>
	<append condition="${dptArCd}.NOTEMPTY" id="#1">
		  AND a.dpt_ar_cd    = ${dptArCd}
	</append>
	<append condition="${arvArCd}.NOTEMPTY" id="#1">
		  AND a.arv_ar_cd    = ${arvArCd}
	</append>	
	<append condition="${aptdReqYmdFr}.NOTEMPTY&amp;${aptdReqYmdTo}.NOTEMPTY" id="#2">
		  AND a.aptd_req_ymd BETWEEN ${aptdReqYmdFr} AND ${aptdReqYmdTo}
	</append>
  	</statement>

  	<statement name="retrieveOceanImpGiOrd_back_20120518">
		SELECT a.sales_ord_no
		     , a.cust_ord_no
		     , a.ord_type_cd
		     , a.rpt_cust_cd
		     , a.load_dly_yn
		     , a.LOAD_DLY_RLTD_SALES_ORD_NO
		     , b.cust_ord_line_no
		     , b.line_no
		     , b.arv_ar_cd
		     , b.arv_ar_type_cd
			 , CASE WHEN b.arv_ar_type_cd = '02' THEN
		    	(SELECT name 
		    	   FROM vw_ma01_01 
		    	  WHERE code = b.arv_ar_cd 
		    	    AND ptn_cd = a.rpt_cust_cd
		    		AND work_sctn_cd = b.arv_ar_type_cd) 
			  ELSE 	    	
		    	(SELECT name 
		    	   FROM vw_ma01_01 
		    	  WHERE code = b.arv_ar_cd 
		    	  	AND work_sctn_cd = b.arv_ar_type_cd
		    		AND ROWNUM = 1) 
		      END  AS arv_ar_nm
		     , b.arv_ar_zip_cd
		     , b.arv_ar_zip_addr
		     , b.arv_ar_dtl_addr
		     , b.item_cd
		     , c.item_nm
		     , b.admt ord_admt
		     , b.wgt_unit_cd
			 , a.ARV_AR_OFCR_NM
		     , a.ctrt_cust_cd
		     , b.dpt_ar_cd
		     , b.dpt_ar_type_cd
		     , b.dpt_ar_zip_cd
		     , b.dpt_ar_zip_addr
		     , b.dpt_ar_dtl_addr
		     , b.strt_req_ymd
		     , b.strt_req_hm
		     , b.aptd_req_ymd
		     , b.aptd_req_hm
	         , (SELECT wm_work_pl_cd FROM tb_ma01005 WHERE work_pl_cd = b.dpt_ar_cd AND wm_yn = 'Y') work_pl_cd
	         , a.ord_verify_yn
 			 , (SELECT SUM(NVL(y.admt, 0))
			   	  FROM tb_om03001 x, tb_om03002 y 
			   	 WHERE x.sales_ord_no = a.sales_ord_no
				   AND x.del_yn = 'N'
				   AND x.sales_ord_no = y.sales_ord_no
				   AND x.work_route_seq = y.work_route_seq
				   AND y.line_no = b.line_no) unit_admt
			 , CASE WHEN NVL(b.admt, 0) - (SELECT SUM(NVL(y.admt, 0))
										   	 FROM tb_om03001 x, tb_om03002 y 
										   	WHERE x.sales_ord_no = a.sales_ord_no
											AND	x.del_yn = 'N'
											AND	x.sales_ord_no = y.sales_ord_no
											AND x.work_route_seq = y.work_route_seq
											AND	y.line_no = b.line_no) > 0 
				    THEN NVL(b.admt, 0) - (SELECT SUM(NVL(y.admt, 0))
			   							     FROM tb_om03001 x, tb_om03002 y 
									   	    WHERE x.sales_ord_no = a.sales_ord_no
										      AND x.del_yn = 'N'
										      AND x.sales_ord_no = y.sales_ord_no
										      AND x.work_route_seq = y.work_route_seq
										      AND y.line_no = b.line_no)
                ELSE 0 END bal_admt
	         , '' drct_load_yn
	         , '' bl_no
	         , '' bl_cust_ord_no
	         , CASE WHEN a.sales_ord_stat_cd = '06' THEN '완료'
	         	    WHEN a.sales_ord_cncl_yn = 'Y'  THEN '취소'
	         	    WHEN b.ord_reason_cd IS NOT NULL THEN '아이템종결'
	         	    ELSE '가능' END divide_possible
	         , CASE WHEN a.sales_ord_stat_cd = '06' THEN 'N'
	         	    WHEN a.sales_ord_cncl_yn = 'Y'  THEN 'N'
	         	    WHEN b.ord_reason_cd IS NOT NULL THEN 'N'
	         	    ELSE 'Y' END divide_possible_yn
	         , b.ord_reason_cd
	         , IDUSR.OMCOMM_GETCUSTREASONNM_FN(a.rpt_cust_cd, b.ord_reason_cd) AS ord_reason_nm
	         , '' tran_cond_cd
	         ,(SELECT work_cntr_cd
                 FROM   tb_om01002
                 WHERE  cust_cd = a.cust_cd
                 AND    cust_ord_no = a.cust_ord_no
                 AND    cust_ord_line_no = b.cust_ord_line_no
                 AND    ROWNUM = 1) AS work_cntr_cd
		FROM   tb_om02001 a
		     , tb_om02002 b
		     , TB_MA02010 c
		WHERE 1=1      
		 {#1}
		 {#2}
		  AND a.ord_type_cd in ('3078','3079','3058','3068','3070','3072','3080')
		  AND a.sales_ord_no = b.sales_ord_no
		  AND b.cust_cd      = c.ptn_cd
		  AND b.item_cd      = c.item_cd
      	  and b.del_yn='N'
		ORDER BY a.sales_ord_no
		      	 , a.cust_ord_no
		     	 , b.line_no
	<append condition="${ctrtCustCd}.NOTEMPTY" id="#1">
		  AND a.rpt_cust_cd  = ${ctrtCustCd}
	</append>
	<append condition="${dptArCd}.NOTEMPTY" id="#1">
		  AND b.dpt_ar_cd    = ${dptArCd}
	</append>
	<append condition="${arvArCd}.NOTEMPTY" id="#1">
		  AND b.arv_ar_cd    = ${arvArCd}
	</append>	
	<append condition="${aptdReqYmdFr}.NOTEMPTY&amp;${aptdReqYmdTo}.NOTEMPTY" id="#2">
		  AND b.aptd_req_ymd BETWEEN ${aptdReqYmdFr} AND ${aptdReqYmdTo}
	</append>
  	</statement>

  	<statement name="retrieveOceanImpGiOrd_back2">
		SELECT /*+ INDEX( b TB_OM02002_IX13 ) */ 
		       a.sales_ord_no
		     , a.cust_ord_no
		     , a.ord_type_cd
		     , a.rpt_cust_cd
		     , a.load_dly_yn
		     , a.LOAD_DLY_RLTD_SALES_ORD_NO
		     , b.cust_ord_line_no
		     , b.line_no
		     , b.arv_ar_cd
		     , b.arv_ar_type_cd
			 , CASE WHEN b.arv_ar_type_cd = '02' THEN
		    	(SELECT name 
		    	   FROM vw_ma01_01 
		    	  WHERE code = b.arv_ar_cd 
		    	    AND ptn_cd = a.rpt_cust_cd
		    		AND work_sctn_cd = b.arv_ar_type_cd) 
			  ELSE 	    	
		    	(SELECT name 
		    	   FROM vw_ma01_01 
		    	  WHERE code = b.arv_ar_cd 
		    	  	AND work_sctn_cd = b.arv_ar_type_cd
		    		AND ROWNUM = 1) 
		      END  AS arv_ar_nm
		     , b.arv_ar_zip_cd
		     , b.arv_ar_zip_addr
		     , b.arv_ar_dtl_addr
		     , b.item_cd
		     , c.item_nm
		     , b.admt ord_admt
		     , b.wgt_unit_cd
			 , a.ARV_AR_OFCR_NM
		     , a.ctrt_cust_cd
		     , b.dpt_ar_cd
		     , b.dpt_ar_type_cd
		     , b.dpt_ar_zip_cd
		     , b.dpt_ar_zip_addr
		     , b.dpt_ar_dtl_addr
		     , b.strt_req_ymd
		     , b.strt_req_hm
		     , b.aptd_req_ymd
		     , b.aptd_req_hm
	         , (SELECT wm_work_pl_cd FROM tb_ma01005 WHERE work_pl_cd = b.dpt_ar_cd AND wm_yn = 'Y') work_pl_cd
	         , a.ord_verify_yn
 			 , (SELECT SUM(NVL(y.admt, 0))
			   	FROM tb_om03001 x, tb_om03002 y 
			   	WHERE x.sales_ord_no = a.sales_ord_no
				AND	x.del_yn = 'N'
				AND	x.sales_ord_no = y.sales_ord_no
				AND x.work_route_seq = y.work_route_seq
				AND	y.line_no = b.line_no) unit_admt
			 , CASE WHEN NVL(b.admt, 0) - (SELECT SUM(NVL(y.admt, 0))
										   	FROM tb_om03001 x, tb_om03002 y 
										   	WHERE x.sales_ord_no = a.sales_ord_no
											AND	x.del_yn = 'N'
											AND	x.sales_ord_no = y.sales_ord_no
											AND x.work_route_seq = y.work_route_seq
											AND	y.line_no = b.line_no) > 0 
				THEN NVL(b.admt, 0) - (SELECT SUM(NVL(y.admt, 0))
			   							FROM tb_om03001 x, tb_om03002 y 
									   	WHERE x.sales_ord_no = a.sales_ord_no
										AND	x.del_yn = 'N'
										AND	x.sales_ord_no = y.sales_ord_no
										AND x.work_route_seq = y.work_route_seq
										AND	y.line_no = b.line_no)
                ELSE 0 END bal_admt
	         , '' drct_load_yn
	         , '' bl_no
	         , '' bl_cust_ord_no
	         , CASE WHEN a.sales_ord_stat_cd = '06' THEN '완료'
	         	    WHEN a.sales_ord_cncl_yn = 'Y'  THEN '취소'
	         	    WHEN b.ord_reason_cd IS NOT NULL THEN '아이템종결'
	         	    ELSE '가능' END divide_possible
	         , CASE WHEN a.sales_ord_stat_cd = '06' THEN 'N'
	         	    WHEN a.sales_ord_cncl_yn = 'Y'  THEN 'N'
	         	    WHEN b.ord_reason_cd IS NOT NULL THEN 'N'
	         	    ELSE 'Y' END divide_possible_yn
	         , b.ord_reason_cd
	         , IDUSR.OMCOMM_GETCUSTREASONNM_FN(a.rpt_cust_cd, b.ord_reason_cd) AS ord_reason_nm
	         , '' tran_cond_cd
	         ,(SELECT work_cntr_cd
                 FROM   tb_om01002
                 WHERE  cust_cd = a.cust_cd
                 AND    cust_ord_no = a.cust_ord_no
                 AND    cust_ord_line_no = b.cust_ord_line_no
                 AND    ROWNUM = 1) AS work_cntr_cd
		FROM   tb_om02001 a
		     , tb_om02002 b
		     , TB_MA02010 c
		WHERE  a.sales_ord_no = b.sales_ord_no     
		{#1}
		AND	   a.exp_imp_dom_sctn_cd = '02'
		AND    b.cust_cd      = c.ptn_cd
		AND    b.item_cd      = c.item_cd
		{#2}
		and    b.del_yn='N'
		and exists (  select   /*+ USE_HASH(A,E) */
                                        'x' 
                            from tb_ma01006 e 
                            where ord_type_cd=a.ord_type_cd
                            and logis_ar_cd = '3' 
                            and e.logis_svc_sctn_cd IN ('02', '04', '06') 
                            )
		
		ORDER BY a.sales_ord_no
		      	 , a.cust_ord_no
		     	 , b.line_no
	<append condition="${ctrtCustCd}.NOTEMPTY" id="#1">
		AND    a.rpt_cust_cd  = ${ctrtCustCd}
	</append>
	<append condition="${dptArCd}.NOTEMPTY" id="#1">
		AND    b.dpt_ar_cd    = ${dptArCd}
	</append>
	<append condition="${arvArCd}.NOTEMPTY" id="#1">
		AND    b.arv_ar_cd    = ${arvArCd}
	</append>	
	<append condition="${aptdReqYmdFr}.NOTEMPTY&amp;${aptdReqYmdTo}.NOTEMPTY" id="#2">
		AND    b.aptd_req_ymd BETWEEN ${aptdReqYmdFr} AND ${aptdReqYmdTo}
	</append>
  	</statement>
 
   	<statement name="retrieveOceanImpGiOrd_back">
		SELECT a.sales_ord_no
		     , a.cust_ord_no
		     , a.ord_type_cd
		     , a.rpt_cust_cd
		     , a.load_dly_yn
		     , a.LOAD_DLY_RLTD_SALES_ORD_NO
		     , b.cust_ord_line_no
		     , b.line_no
		     , b.arv_ar_cd
		     , b.arv_ar_type_cd
			 , CASE WHEN b.arv_ar_type_cd = '02' THEN
		    	(SELECT name 
		    	   FROM vw_ma01_01 
		    	  WHERE code = b.arv_ar_cd 
		    	    AND ptn_cd = a.rpt_cust_cd
		    		AND work_sctn_cd = b.arv_ar_type_cd) 
			  ELSE 	    	
		    	(SELECT name 
		    	   FROM vw_ma01_01 
		    	  WHERE code = b.arv_ar_cd 
		    	  	AND work_sctn_cd = b.arv_ar_type_cd
		    		AND ROWNUM = 1) 
		      END  AS arv_ar_nm
		     , b.arv_ar_zip_cd
		     , b.arv_ar_zip_addr
		     , b.arv_ar_dtl_addr
		     , b.item_cd
		     , c.item_nm
		     , b.admt ord_admt
		     , b.wgt_unit_cd
			 , a.ARV_AR_OFCR_NM
		     , a.ctrt_cust_cd
		     , b.dpt_ar_cd
		     , b.dpt_ar_type_cd
		     , b.dpt_ar_zip_cd
		     , b.dpt_ar_zip_addr
		     , b.dpt_ar_dtl_addr
		     , b.strt_req_ymd
		     , b.strt_req_hm
		     , b.aptd_req_ymd
		     , b.aptd_req_hm
	         , (SELECT wm_work_pl_cd FROM tb_ma01005 WHERE work_pl_cd = b.dpt_ar_cd AND wm_yn = 'Y') work_pl_cd
	         , a.ord_verify_yn
 			 , (SELECT SUM(NVL(y.admt, 0))
			   	FROM tb_om03001 x, tb_om03002 y 
			   	WHERE x.sales_ord_no = a.sales_ord_no
				AND	x.del_yn = 'N'
				AND	x.sales_ord_no = y.sales_ord_no
				AND x.work_route_seq = y.work_route_seq
				AND	y.line_no = b.line_no) unit_admt
			 , CASE WHEN NVL(b.admt, 0) - (SELECT SUM(NVL(y.admt, 0))
										   	FROM tb_om03001 x, tb_om03002 y 
										   	WHERE x.sales_ord_no = a.sales_ord_no
											AND	x.del_yn = 'N'
											AND	x.sales_ord_no = y.sales_ord_no
											AND x.work_route_seq = y.work_route_seq
											AND	y.line_no = b.line_no) > 0 
				THEN NVL(b.admt, 0) - (SELECT SUM(NVL(y.admt, 0))
			   							FROM tb_om03001 x, tb_om03002 y 
									   	WHERE x.sales_ord_no = a.sales_ord_no
										AND	x.del_yn = 'N'
										AND	x.sales_ord_no = y.sales_ord_no
										AND x.work_route_seq = y.work_route_seq
										AND	y.line_no = b.line_no)
                ELSE 0 END bal_admt
	         , '' drct_load_yn
	         , '' bl_no
	         , '' bl_cust_ord_no
	         , CASE WHEN a.sales_ord_stat_cd = '06' THEN '완료'
	         	    WHEN a.sales_ord_cncl_yn = 'Y'  THEN '취소'
	         	    WHEN b.ord_reason_cd IS NOT NULL THEN '아이템종결'
	         	    ELSE '가능' END divide_possible
	         , CASE WHEN a.sales_ord_stat_cd = '06' THEN 'N'
	         	    WHEN a.sales_ord_cncl_yn = 'Y'  THEN 'N'
	         	    WHEN b.ord_reason_cd IS NOT NULL THEN 'N'
	         	    ELSE 'Y' END divide_possible_yn
	         , b.ord_reason_cd
	         , IDUSR.OMCOMM_GETCUSTREASONNM_FN(a.rpt_cust_cd, b.ord_reason_cd) AS ord_reason_nm
	         , '' tran_cond_cd
	         ,(SELECT work_cntr_cd
                 FROM   tb_om01002
                 WHERE  cust_cd = a.cust_cd
                 AND    cust_ord_no = a.cust_ord_no
                 AND    cust_ord_line_no = b.cust_ord_line_no
                 AND    ROWNUM = 1) AS work_cntr_cd
		FROM   tb_om02001 a
		     , tb_om02002 b
		     , TB_MA02010 c
		     , tb_om02003 d
		WHERE  a.sales_ord_no = b.sales_ord_no     
		AND	   a.sales_ord_no = d.sales_ord_no
		AND    b.cust_cd      = c.ptn_cd
		AND    b.item_cd      = c.item_cd
		AND	   a.exp_imp_dom_sctn_cd = '02'
		AND	   d.ocean_air_sctn_cd = 'S'
		and    b.del_yn='N'
		and exists (  select   /*+ USE_HASH(A,E) */
                                        'x' 
                            from tb_ma01006 e 
                            where logis_ar_cd = '3' 
                            and e.logis_svc_sctn_cd IN ('02', '04', '06') 
                            and ord_type_cd=a.ord_type_cd)
		{#1}
		ORDER BY a.sales_ord_no
		      	 , a.cust_ord_no
		     	 , b.line_no
	<append condition="${ctrtCustCd}.NOTEMPTY" id="#1">
		AND    a.ctrt_cust_cd = ${ctrtCustCd}
	</append>
	<append condition="${ctrtCustCd}.NOTEMPTY" id="#1">
		AND    a.rpt_cust_cd  = ${ctrtCustCd}
	</append>
	<append condition="${dptArCd}.NOTEMPTY" id="#1">
		AND    a.dpt_ar_cd    = ${dptArCd}
	</append>
	<append condition="${arvArCd}.NOTEMPTY" id="#1">
		AND    a.arv_ar_cd    = ${arvArCd}
	</append>	
	<append condition="${aptdReqYmdFr}.NOTEMPTY&amp;${aptdReqYmdTo}.NOTEMPTY" id="#1">
		AND    b.aptd_req_ymd BETWEEN ${aptdReqYmdFr} AND ${aptdReqYmdTo}
	</append>
  	</statement> 	

  	<statement name="retrieveAvailBlListHw">
		SELECT 'F' chk 
              ,m.sales_ord_no
              ,m.line_no
              ,m.cust_cd
              ,m.mbl_no
              ,m.ship_nm
              ,m.Arv_Port_Ymd
              ,m.cust_ord_no
              ,m.tran_cond_cd
              ,m.cargo_form_cd
              ,m.cntr_kind_cd
              ,m.consol_yn
              ,m.item_cd
              ,(SELECT item_nm
                  FROM tb_ma02010
                 WHERE ptn_cd = m.cust_cd
                   AND item_cd = m.item_cd) AS item_nm
              ,m.ord_qty
              ,m.ord_wgt
              ,m.admt
              ,0 div_cnt
              ,0 div_qty
              ,0 div_wgt
              ,0 div_admt
              ,(floor((m.ord_wgt/m.ord_qty)*10))/10 AS unit_wgt
              ,(floor((m.admt/m.ord_qty)*10))/10 AS unit_admt
              ,m.avail_qty AS avail_qty
              ,m.avail_qty*(m.ord_wgt/m.ord_qty) AS avail_wgt
              ,m.avail_qty*(m.admt/m.ord_qty) AS avail_admt
              ,m.loc
          FROM   
			( select a.sales_ord_no
		            ,a.line_no
		            ,(select mbl_no from tb_om01001 where sales_ord_no=b.sales_ord_no) mbl_no
                    ,(select ship_nm from tb_om02003 where sales_ord_no=b.sales_ord_no) ship_nm 
                    ,(select Arv_Port_Ymd from tb_om02003 where sales_ord_no=b.sales_ord_no) Arv_Port_Ymd
		            ,b.cust_ord_no
		            ,b.tran_cond_cd
		            ,b.cargo_form_cd
		            ,(SELECT cntr_kind_cd
		                FROM tb_om02020
		               WHERE sales_ord_no = a.sales_ord_no
		                 AND ROWNUM = 1) AS cntr_kind_cd
		            ,'N' AS consol_yn
		            ,a.item_cd
		            ,a.ord_qty
		            ,a.ord_wgt
		            ,a.admt
		            ,a.cust_cd
		            ,d.AVAIL_QTY
		            ,d.loc		      
                FROM (SELECT *
                        FROM V_ATCBYBL_GZ_QTY
                       WHERE STORERKEY    = ${ctrtCustCd}
                         AND ITEMCD       = ${itemCd}
                         AND WHSEID       = ${whseid}) D,
                     TB_OM02001                   B,
                     TB_OM02002                   A
               WHERE D.BLNO         =  B.CUST_ORD_NO || B.CUST_ORD_NO 
                 AND B.SALES_ORD_NO =  A.SALES_ORD_NO 
                 AND B.RPT_CUST_CD  =  ${ctrtCustCd}
                 AND a.arv_ar_cd    =  ${dptArCd}
                 AND A.ITEM_CD      =  ${itemCd}
                 and b.SALES_ORD_CNCL_YN = 'N'
               ) m
          order by m.loc,m.mbl_no

  	</statement>

  	<statement name="retrieveAvailBlList">
		SELECT 'F' chk 
              ,m.sales_ord_no
              ,m.line_no
              ,m.cust_cd
              ,m.mbl_no
              ,m.ship_nm
              ,m.Arv_Port_Ymd
              ,m.cust_ord_no
              ,m.tran_cond_cd
              ,m.cargo_form_cd
              ,m.cntr_kind_cd
              ,m.consol_yn
              ,m.item_cd
              ,(SELECT item_nm
                  FROM tb_ma02010
                 WHERE ptn_cd = m.cust_cd
                   AND item_cd = m.item_cd) AS item_nm
              ,m.ord_qty
              ,m.ord_wgt
              ,m.admt
              ,0 div_cnt
              ,0 div_qty
              ,0 div_wgt
              ,0 div_admt
              ,(floor((m.ord_wgt/m.ord_qty)*10))/10 AS unit_wgt
              ,(floor((m.admt/m.ord_qty)*10))/10 AS unit_admt
              ,m.avail_qty AS avail_qty
              ,m.avail_qty*(m.ord_wgt/m.ord_qty) AS avail_wgt
              ,m.avail_qty*(m.admt/m.ord_qty) AS avail_admt
          FROM   
			( select a.sales_ord_no
		            ,a.line_no
		            ,(select mbl_no from tb_om02003 where sales_ord_no=b.sales_ord_no) mbl_no
                    ,(select ship_nm from tb_om02003 where sales_ord_no=b.sales_ord_no) ship_nm 
                    ,(select Arv_Port_Ymd from tb_om02003 where sales_ord_no=b.sales_ord_no) Arv_Port_Ymd
		            ,b.cust_ord_no
		            ,b.tran_cond_cd
		            ,b.cargo_form_cd
		            ,(SELECT cntr_kind_cd
		                FROM tb_om02020
		               WHERE sales_ord_no = a.sales_ord_no
		                 AND ROWNUM = 1) AS cntr_kind_cd
		            ,'N' AS consol_yn
		            ,a.item_cd
		            ,a.ord_qty
		            ,a.ord_wgt
		            ,a.admt
		            ,a.cust_cd
		            ,d.AVAIL_QTY		      
                FROM (SELECT *
                        FROM {#1}
                       WHERE STORERKEY    = ${ctrtCustCd}
                         AND ITEMCD       = ${itemCd}
                         {#4}) D,
                     TB_OM02001                   B,
                     TB_OM02002                   A
               WHERE D.LOTTABLE03   =  B.CUST_ORD_NO  
                 AND B.SALES_ORD_NO =  A.SALES_ORD_NO 
                 AND B.RPT_CUST_CD  =  ${ctrtCustCd}
                 AND a.arv_ar_cd    =  ${dptArCd}
                 AND A.ITEM_CD      =  ${itemCd}
                 {#3}
                 and b.SALES_ORD_CNCL_YN = 'N'
               ) m
          order by m.arv_port_ymd
		<append condition="${workPlCd}.NOTEMPTY" id="#1">
				${workPlCd:not}.V_ATCBYBL_QTY@DL_WMS_IF
		</append>

		<append condition="${workPlCd}.EMPTY" id="#1">
				V_ATCBYBL_QTY
		</append>
		
		<append condition="${ctrtCustCd}.NOTEMPTY&amp;${ctrtCustCd}.EQ.P1000&amp;${custMoveTypeCd}.EQ.Z03" id="#3">
                AND (SELECT work_cntr_cd
                       FROM tb_om01002
                      WHERE cust_cd = b.cust_cd
                        AND cust_ord_no = b.cust_ord_no
                        AND cust_ord_line_no = a.cust_ord_line_no
                        AND ROWNUM = 1) = ${workCntrCd}
		</append>		
		<append condition="${ctrtCustCd}.NOTEMPTY&amp;${ctrtCustCd}.EQ.P1591&amp;${custMoveTypeCd}.EQ.Z03" id="#3">
                AND (SELECT work_cntr_cd
                       FROM tb_om01002
                      WHERE cust_cd = b.cust_cd
                        AND cust_ord_no = b.cust_ord_no
                        AND cust_ord_line_no = a.cust_ord_line_no
                        AND ROWNUM = 1) = ${workCntrCd}
		</append>
		<append condition="${whseid}.NOTEMPTY" id="#4">
                AND WHSEID       = ${whseid}
		</append>
  	</statement>
  	
  	<statement name="retrieveAvailBlList_back7">
		SELECT 'F' chk 
              ,m.sales_ord_no
              ,m.line_no
              ,m.cust_cd
              ,m.mbl_no
              ,m.ship_nm
              ,m.Arv_Port_Ymd
              ,m.cust_ord_no
              ,m.tran_cond_cd
              ,m.cargo_form_cd
              ,m.cntr_kind_cd
              ,m.consol_yn
              ,m.item_cd
              ,(SELECT item_nm
                  FROM tb_ma02010
                 WHERE ptn_cd = m.cust_cd
                   AND item_cd = m.item_cd) AS item_nm
              ,m.ord_qty
              ,m.ord_wgt
              ,m.admt
              ,0 div_cnt
              ,0 div_qty
              ,0 div_wgt
              ,0 div_admt
              ,(floor((m.ord_wgt/m.ord_qty)*10))/10 AS unit_wgt
              ,(floor((m.admt/m.ord_qty)*10))/10 AS unit_admt
              ,m.avail_qty AS avail_qty
              ,m.avail_qty*(m.ord_wgt/m.ord_qty) AS avail_wgt
              ,m.avail_qty*(m.admt/m.ord_qty) AS avail_admt
          FROM   
			( select a.sales_ord_no
		            ,a.line_no
		            ,(select mbl_no from tb_om02003 where sales_ord_no=b.sales_ord_no) mbl_no
                    ,(select ship_nm from tb_om02003 where sales_ord_no=b.sales_ord_no) ship_nm 
                    ,(select Arv_Port_Ymd from tb_om02003 where sales_ord_no=b.sales_ord_no) Arv_Port_Ymd
		            ,b.cust_ord_no
		            ,b.tran_cond_cd
		            ,b.cargo_form_cd
		            ,(SELECT cntr_kind_cd
		                FROM tb_om02020
		               WHERE sales_ord_no = a.sales_ord_no
		                 AND ROWNUM = 1) AS cntr_kind_cd
		            ,'N' AS consol_yn
		            ,a.item_cd
		            ,a.ord_qty
		            ,a.ord_wgt
		            ,a.admt
		            ,a.cust_cd
		            ,d.AVAIL_QTY		      
                FROM (SELECT *
                        FROM {#1}
                       WHERE STORERKEY    = ${ctrtCustCd}
                         AND ITEMCD       = ${itemCd}) D,
                     TB_OM02001                   B,
                     TB_OM02002                   A
               WHERE D.LOTTABLE03   =  B.CUST_ORD_NO  
                 AND B.SALES_ORD_NO =  A.SALES_ORD_NO 
                 AND B.RPT_CUST_CD  =  ${ctrtCustCd}
                 AND a.arv_ar_cd    =  ${dptArCd}
                 AND A.ITEM_CD      =  ${itemCd}
                 {#3}
                 and b.SALES_ORD_CNCL_YN = 'N'
               ) m
          order by m.arv_port_ymd
		<append condition="${workPlCd}.NOTEMPTY" id="#1">
				${workPlCd:not}.V_ATCBYBL_QTY@DL_WMS_IF
		</append>

		<append condition="${workPlCd}.EMPTY" id="#1">
				V_ATCBYBL_QTY
		</append>
		
		<append condition="${ctrtCustCd}.NOTEMPTY&amp;${ctrtCustCd}.EQ.P1000" id="#3">
                 AND (SELECT work_cntr_cd
                        FROM tb_om01002
                       WHERE cust_cd = b.cust_cd
                         AND cust_ord_no = b.cust_ord_no
                         AND cust_ord_line_no = a.cust_ord_line_no
                         AND ROWNUM = 1) = ${workCntrCd}
		</append>		
  	</statement>

  	<statement name="retrieveAvailBlList_back6">
		SELECT 'F' chk 
              ,m.sales_ord_no
              ,m.line_no
              ,m.cust_cd
              ,m.mbl_no
              ,m.ship_nm
              ,m.Arv_Port_Ymd
              ,m.cust_ord_no
              ,m.tran_cond_cd
              ,m.cargo_form_cd
              ,m.cntr_kind_cd
              ,m.consol_yn
              ,m.item_cd
              ,(SELECT item_nm
                  FROM tb_ma02010
                 WHERE ptn_cd = m.cust_cd
                   AND item_cd = m.item_cd) AS item_nm
              ,m.ord_qty
              ,m.ord_wgt
              ,m.admt
              ,0 div_cnt
              ,0 div_qty
              ,0 div_wgt
              ,0 div_admt
              ,(floor((m.ord_wgt/m.ord_qty)*10))/10 AS unit_wgt
              ,(floor((m.admt/m.ord_qty)*10))/10 AS unit_admt
              ,m.avail_qty AS avail_qty
              ,m.avail_qty*(m.ord_wgt/m.ord_qty) AS avail_wgt
              ,m.avail_qty*(m.admt/m.ord_qty) AS avail_admt
          FROM   
			( select a.sales_ord_no
		            ,a.line_no
		            ,(select mbl_no from tb_om02003 where sales_ord_no=b.sales_ord_no) mbl_no
                    ,(select ship_nm from tb_om02003 where sales_ord_no=b.sales_ord_no) ship_nm 
                    ,(select Arv_Port_Ymd from tb_om02003 where sales_ord_no=b.sales_ord_no) Arv_Port_Ymd
		            ,b.cust_ord_no
		            ,b.tran_cond_cd
		            ,b.cargo_form_cd
		            ,(SELECT cntr_kind_cd
		                FROM tb_om02020
		               WHERE sales_ord_no = a.sales_ord_no
		                 AND ROWNUM = 1) AS cntr_kind_cd
		            ,'N' AS consol_yn
		            ,a.item_cd
		            ,a.ord_qty
		            ,a.ord_wgt
		            ,a.admt
		            ,a.cust_cd
		            ,d.AVAIL_QTY		      
                FROM (SELECT *
                        FROM {#1}
                       WHERE STORERKEY    = ${ctrtCustCd}
                         AND ITEMCD       = ${itemCd}) D,
                     TB_OM02001                   B,
                     TB_OM02002                   A
               WHERE D.STORERKEY    =  B.RPT_CUST_CD
                 AND D.LOTTABLE03   =  B.CUST_ORD_NO  
                 AND B.SALES_ORD_NO =  A.SALES_ORD_NO 
                 AND B.RPT_CUST_CD  =  ${ctrtCustCd}
                 AND A.ITEM_CD      =  ${itemCd}
                 {#3}
                 and b.SALES_ORD_CNCL_YN = 'N'
               ) m
          order by m.arv_port_ymd
		<append condition="${workPlCd}.NOTEMPTY" id="#1">
				${workPlCd:not}.V_ATCBYBL_QTY@DL_WMS_IF
		</append>
	
		<append condition="${workPlCd}.NOTEMPTY" id="#2">
		         AND WHSEID = ${workPlCd}
		</append>
		
		<append condition="${ctrtCustCd}.NOTEMPTY&amp;${ctrtCustCd}.EQ.P1000" id="#3">
                 AND (SELECT work_cntr_cd
                        FROM tb_om01002
                       WHERE cust_cd = b.cust_cd
                         AND cust_ord_no = b.cust_ord_no
                         AND cust_ord_line_no = a.cust_ord_line_no
                         AND ROWNUM = 1) = ${workCntrCd}
		</append>		
  	</statement>

  	<statement name="retrieveAvailBlList_back5">
		SELECT 'F' chk 
              ,m.sales_ord_no
              ,m.line_no
              ,m.cust_cd
              ,m.mbl_no
              ,m.ship_nm
              ,m.Arv_Port_Ymd
              ,m.cust_ord_no
              ,m.tran_cond_cd
              ,m.cargo_form_cd
              ,m.cntr_kind_cd
              ,m.consol_yn
              ,m.item_cd
              ,(SELECT item_nm
                  FROM tb_ma02010
                 WHERE ptn_cd = m.cust_cd
                   AND item_cd = m.item_cd) AS item_nm
               ,m.ord_qty
              ,m.ord_wgt
              ,m.admt
              ,0 div_cnt
              ,0 div_qty
              ,0 div_wgt
              ,0 div_admt
              ,(floor((m.ord_wgt/m.ord_qty)*10))/10 AS unit_wgt
              ,(floor((m.admt/m.ord_qty)*10))/10 AS unit_admt
              ,m.avail_qty AS avail_qty
              ,m.avail_qty*(m.ord_wgt/m.ord_qty) AS avail_wgt
              ,m.avail_qty*(m.admt/m.ord_qty) AS avail_admt
          FROM   
			(SELECT n.sales_ord_no
                  ,n.line_no
                  ,n.mbl_no  
                  ,n.ship_nm
                  ,n.Arv_Port_Ymd
                  ,n.cust_ord_no 
                  ,n.tran_cond_cd
                  ,n.cargo_form_cd
                  ,n.cntr_kind_cd
                  ,n.consol_yn
                  ,n.item_cd
                  ,n.ord_qty
                  ,n.ord_wgt
                  ,n.admt
                  ,n.cust_cd
                  ,(SELECT sum(cntr_stock_qty - alloc_stock_qty - picking_stock_qty - dly_stock_qty) - max(gi_prar_stock_qty) 
					  FROM {#1}
                     WHERE blno      = n.mbl_no||n.cust_ord_no
                       {#2}
                       and STORERKEY = ${ctrtCustCd}
                       AND itemcd    = ${itemCd}
                     ) AS avail_qty    
               FROM 
	             (
		           SELECT a.sales_ord_no
		        	     ,a.line_no
		                 ,c.mbl_no
                         ,c.ship_nm 
                         ,c.Arv_Port_Ymd
		                 ,b.cust_ord_no
		                 ,b.tran_cond_cd
		                 ,b.cargo_form_cd
		                 ,(SELECT cntr_kind_cd
		                     FROM tb_om02020
		                    WHERE sales_ord_no = a.sales_ord_no
		                      AND ROWNUM = 1) AS cntr_kind_cd
		                 ,'N' AS consol_yn
		                 ,a.item_cd
		                 ,a.ord_qty
		                 ,a.ord_wgt
		                 ,a.admt
		                 ,a.cust_cd
		             FROM tb_om02002 a
		                 ,tb_om02001 b
		                 ,tb_om02003 c
		            WHERE a.sales_ord_no = b.sales_ord_no
		              AND a.sales_ord_no = c.sales_ord_no
		              AND b.rpt_cust_cd = ${ctrtCustCd}
		              AND a.arv_ar_cd = ${dptArCd}
		              AND a.item_cd = ${itemCd}
		              AND a.arv_ar_type_cd = '01'
		              AND b.sales_ord_cncl_yn = 'N'
		              AND b.cargo_form_cd = 'C'		
		              {#3}
                   UNION ALL
                   SELECT a.sales_ord_no
                         ,a.line_no
 		                 ,c.mbl_no
                         ,c.ship_nm 
                         ,c.Arv_Port_Ymd
                         ,b.cust_ord_no
                         ,b.tran_cond_cd
                         ,b.cargo_form_cd
                         ,'' AS cntr_kind_cd
                         ,'N' AS consol_yn
                         ,a.item_cd
                         ,a.ord_qty
                         ,a.ord_wgt
                         ,a.admt
                         ,a.cust_cd
                    FROM tb_om02002 a
                        ,tb_om02001 b
                        ,tb_om02003 c
                   WHERE a.sales_ord_no = b.sales_ord_no
                     AND a.sales_ord_no = c.sales_ord_no
                     AND b.rpt_cust_cd = ${ctrtCustCd}
                     AND a.arv_ar_cd = ${dptArCd}
                     AND a.item_cd = ${itemCd}
                     AND a.arv_ar_type_cd = '01'
                     AND b.sales_ord_cncl_yn = 'N'
                     AND b.cargo_form_cd = 'B'                     
                     {#3}
                     ) n
		       ) m
          WHERE m.avail_qty > 0
          order by m.arv_port_ymd
		<append condition="${workPlCd}.NOTEMPTY" id="#1">
				${workPlCd:not}.V_ATCBYBL_NEW@DL_WMS_IF
		</append>
	
		<append condition="${workPlCd}.NOTEMPTY" id="#2">
		            AND WHSEID = ${workPlCd}
		</append>
		
		<append condition="${ctrtCustCd}.NOTEMPTY&amp;${ctrtCustCd}.EQ.P1000" id="#3">
                    AND (SELECT work_cntr_cd
                           FROM tb_om01002
                          WHERE cust_cd = b.cust_cd
                            AND cust_ord_no = b.cust_ord_no
                            AND cust_ord_line_no = a.cust_ord_line_no
                            AND ROWNUM = 1) = ${workCntrCd}
		</append>		
  	</statement>

  	<statement name="retrieveAvailBlList_back4">
		SELECT 'F' chk 
              ,m.sales_ord_no
              ,m.line_no
              ,m.cust_cd
              ,m.mbl_no
              ,m.ship_nm
              ,m.Arv_Port_Ymd
              ,m.cust_ord_no
              ,m.tran_cond_cd
              ,m.cargo_form_cd
              ,m.cntr_kind_cd
              ,m.consol_yn
              ,m.item_cd
              ,(SELECT item_nm
                  FROM tb_ma02010
                 WHERE ptn_cd = m.cust_cd
                   AND item_cd = m.item_cd) AS item_nm
              
              ,m.ord_qty
              ,m.ord_wgt
              ,m.admt
              ,0 div_cnt
              ,0 div_qty
              ,0 div_wgt
              ,0 div_admt
              ,(floor((m.ord_wgt/m.ord_qty)*10))/10 AS unit_wgt
              ,(floor((m.admt/m.ord_qty)*10))/10 AS unit_admt
              ,m.avail_qty AS avail_qty
              ,m.avail_qty*(m.ord_wgt/m.ord_qty) AS avail_wgt
              ,m.avail_qty*(m.admt/m.ord_qty) AS avail_admt
          FROM   
			(SELECT n.sales_ord_no
                  ,n.line_no
                  ,n.mbl_no  
                  ,n.ship_nm
                  ,n.Arv_Port_Ymd
                  ,n.cust_ord_no 
                  ,n.tran_cond_cd
                  ,n.cargo_form_cd
                  ,n.cntr_kind_cd
                  ,n.consol_yn
                  ,n.item_cd
                  ,n.ord_qty
                  ,n.ord_wgt
                  ,n.admt
                  ,n.cust_cd
                  ,(SELECT sum(cntr_stock_qty - alloc_stock_qty - picking_stock_qty - dly_stock_qty) - max(gi_prar_stock_qty) 
					  FROM {#1}
                     WHERE blno      = n.mbl_no||n.cust_ord_no
                       AND itemcd    = n.item_cd
                       {#2}
                       and STORERKEY = ${ctrtCustCd}
                    ) AS avail_qty    
               FROM 
	             (
		           SELECT a.sales_ord_no
		        	     ,a.line_no
		                 ,(select mbl_no  from tb_om02003 where sales_ord_no = a.sales_ord_no) mbl_no
                         ,(select ship_nm  from tb_om02003 where sales_ord_no = a.sales_ord_no) ship_nm 
                         ,(select Arv_Port_Ymd  from tb_om02003 where sales_ord_no = a.sales_ord_no) Arv_Port_Ymd
		                 ,b.cust_ord_no
		                 ,b.tran_cond_cd
		                 ,b.cargo_form_cd
		                 ,(SELECT cntr_kind_cd
		                     FROM tb_om02020
		                    WHERE sales_ord_no = a.sales_ord_no
		                      AND ROWNUM = 1) AS cntr_kind_cd
		                 ,'N' AS consol_yn
		                 ,a.item_cd
		                 ,a.ord_qty
		                 ,a.ord_wgt
		                 ,a.admt
		                 ,a.cust_cd
		             FROM tb_om02002 a
		                 ,tb_om02001 b
		            WHERE a.sales_ord_no = b.sales_ord_no
		              AND a.arv_ar_cd = ${dptArCd}
		              AND a.arv_ar_type_cd = '01'
		              AND a.item_cd = ${itemCd}
		              AND b.sales_ord_cncl_yn = 'N'
		              AND b.cargo_form_cd = 'C'		
		              AND b.rpt_cust_cd = ${ctrtCustCd}              
		              {#3}
                   UNION ALL
                   SELECT a.sales_ord_no
                         ,a.line_no
 		                 ,(select mbl_no  from tb_om02003 where sales_ord_no = a.sales_ord_no) mbl_no
                         ,(select ship_nm  from tb_om02003 where sales_ord_no = a.sales_ord_no) ship_nm 
                         ,(select Arv_Port_Ymd  from tb_om02003 where sales_ord_no = a.sales_ord_no) Arv_Port_Ymd
                         ,b.cust_ord_no
                         ,b.tran_cond_cd
                         ,b.cargo_form_cd
                         ,'' AS cntr_kind_cd
                         ,'N' AS consol_yn
                         ,a.item_cd
                         ,a.ord_qty
                         ,a.ord_wgt
                         ,a.admt
                         ,a.cust_cd
                    FROM tb_om02002 a
                        ,tb_om02001 b
                   WHERE a.sales_ord_no = b.sales_ord_no
                     AND a.arv_ar_cd = ${dptArCd}
                     AND a.arv_ar_type_cd = '01'
                     AND a.item_cd = ${itemCd}
                     AND b.rpt_cust_cd = ${ctrtCustCd}
                     AND b.sales_ord_cncl_yn = 'N'
                     AND b.cargo_form_cd = 'B'                     
                     {#3}
                     ) n
		       ) m
          WHERE 1=1
            AND m.avail_qty > 0
          order by m.arv_port_ymd
		<append condition="${workPlCd}.NOTEMPTY" id="#1">
				${workPlCd:not}.V_ATCBYBL_NEW@DL_WMS_IF
		</append>
	
		<append condition="${workPlCd}.NOTEMPTY" id="#2">
		            AND WHSEID = ${workPlCd}
		</append>
		
		<append condition="${ctrtCustCd}.NOTEMPTY&amp;${ctrtCustCd}.EQ.P1000" id="#3">
                    AND (SELECT work_cntr_cd
                           FROM tb_om01002
                          WHERE cust_cd = b.cust_cd
                            AND cust_ord_no = b.cust_ord_no
                            AND cust_ord_line_no = a.cust_ord_line_no
                            AND ROWNUM = 1) = ${workCntrCd}
		</append>		
  	</statement>

 	<statement name="retrieveAvailBlList_back3">
		SELECT 'F' chk 
              ,m.sales_ord_no
              ,m.line_no
              ,m.cust_cd
              ,m.mbl_no
              ,m.ship_nm
              ,m.Arv_Port_Ymd
              ,m.cust_ord_no
              ,m.tran_cond_cd
              ,m.cargo_form_cd
              ,m.cntr_kind_cd
              ,m.consol_yn
              ,m.item_cd
              ,(SELECT item_nm
                  FROM tb_ma02010
                 WHERE ptn_cd = m.cust_cd
                   AND item_cd = m.item_cd) AS item_nm
              ,m.ord_qty
              ,m.ord_wgt
              ,m.admt
              ,0 div_qty
              ,0 div_wgt
              ,0 div_admt
              ,(floor((m.ord_wgt/m.ord_qty)*10))/10 AS unit_wgt
              ,(floor((m.admt/m.ord_qty)*10))/10 AS unit_admt
              ,m.avail_qty AS avail_qty
              ,m.avail_qty*(m.ord_wgt/m.ord_qty) AS avail_wgt
              ,m.avail_qty*(m.admt/m.ord_qty) AS avail_admt
          FROM   
			(SELECT n.sales_ord_no
                  ,n.line_no
                  ,n.mbl_no  
                  ,n.ship_nm
                  ,n.Arv_Port_Ymd
                  ,n.cust_ord_no 
                  ,n.tran_cond_cd
                  ,n.cargo_form_cd
                  ,n.cntr_kind_cd
                  ,n.consol_yn
                  ,n.item_cd
                  ,n.ord_qty
                  ,n.ord_wgt
                  ,n.admt
                  ,n.cust_cd
                  ,(SELECT sum(cntr_stock_qty - alloc_stock_qty - picking_stock_qty - dly_stock_qty) - max(gi_prar_stock_qty) 
					  FROM {#1}
                     WHERE blno      = n.mbl_no||n.cust_ord_no
                       AND itemcd    = n.item_cd
                       {#2}
                       and STORERKEY = ${ctrtCustCd}
                    ) AS avail_qty    
               FROM 
	             (
		           SELECT a.sales_ord_no
		        	     ,a.line_no
		                 ,(select mbl_no  from tb_om02003 where sales_ord_no = a.sales_ord_no) mbl_no
                         ,(select ship_nm  from tb_om02003 where sales_ord_no = a.sales_ord_no) ship_nm 
                         ,(select Arv_Port_Ymd  from tb_om02003 where sales_ord_no = a.sales_ord_no) Arv_Port_Ymd
		                 ,b.cust_ord_no
		                 ,b.tran_cond_cd
		                 ,b.cargo_form_cd
		                 ,(SELECT cntr_kind_cd
		                     FROM tb_om02020
		                    WHERE sales_ord_no = a.sales_ord_no
		                      AND ROWNUM = 1) AS cntr_kind_cd
		                 ,'N' AS consol_yn
		                 ,a.item_cd
		                 ,a.ord_qty
		                 ,a.ord_wgt
		                 ,a.admt
		                 ,a.cust_cd
		             FROM tb_om02002 a
		                 ,tb_om02001 b
		            WHERE a.sales_ord_no = b.sales_ord_no
		              AND a.arv_ar_cd = ${dptArCd}
		              AND a.arv_ar_type_cd = '01'
		              AND a.item_cd = ${itemCd}
		              AND b.sales_ord_cncl_yn = 'N'
		              AND b.cargo_form_cd = 'C'		
		              AND b.rpt_cust_cd = ${ctrtCustCd}              
		              {#3}
                   UNION ALL
                   SELECT a.sales_ord_no
                         ,a.line_no
 		                 ,(select mbl_no  from tb_om02003 where sales_ord_no = a.sales_ord_no) mbl_no
                         ,(select ship_nm  from tb_om02003 where sales_ord_no = a.sales_ord_no) ship_nm 
                         ,(select Arv_Port_Ymd  from tb_om02003 where sales_ord_no = a.sales_ord_no) Arv_Port_Ymd
                         ,b.cust_ord_no
                         ,b.tran_cond_cd
                         ,b.cargo_form_cd
                         ,'' AS cntr_kind_cd
                         ,'N' AS consol_yn
                         ,a.item_cd
                         ,a.ord_qty
                         ,a.ord_wgt
                         ,a.admt
                         ,a.cust_cd
                    FROM tb_om02002 a
                        ,tb_om02001 b
                   WHERE a.sales_ord_no = b.sales_ord_no
                     AND a.arv_ar_cd = ${dptArCd}
                     AND a.arv_ar_type_cd = '01'
                     AND a.item_cd = ${itemCd}
                     AND b.rpt_cust_cd = ${ctrtCustCd}
                     AND b.sales_ord_cncl_yn = 'N'
                     AND b.cargo_form_cd = 'B'                     
                     {#3}
                     ) n
		       ) m
          WHERE 1=1
            AND m.avail_qty > 0
          order by m.arv_port_ymd
		<append condition="${workPlCd}.NOTEMPTY" id="#1">
				${workPlCd:not}.V_ATCBYBL_NEW@DL_WMS_IF
		</append>
	
		<append condition="${workPlCd}.NOTEMPTY" id="#2">
		            AND WHSEID = ${workPlCd}
		</append>
		
		<append condition="${ctrtCustCd}.NOTEMPTY&amp;${ctrtCustCd}.EQ.P1000" id="#3">
                    AND (SELECT work_cntr_cd
                           FROM tb_om01002
                          WHERE cust_cd = b.cust_cd
                            AND cust_ord_no = b.cust_ord_no
                            AND cust_ord_line_no = a.cust_ord_line_no
                            AND ROWNUM = 1) = ${workCntrCd}
		</append>		
  	</statement>


  	
  	<!-- ************************ -->
  	<!-- 수입BL가용재고를 생성한 테이블에서 조회함 -->
  	<!-- ************************ -->
  	<statement name="retrieveAvailBlListImprv">
		SELECT 'F' chk 
              ,m.sales_ord_no
              ,m.line_no
              ,m.cust_cd
              ,m.mbl_no
              ,m.ship_nm
              ,m.Arv_Port_Ymd
              ,m.cust_ord_no
              ,m.tran_cond_cd
              ,m.cargo_form_cd
              ,m.cntr_kind_cd
              ,m.consol_yn
              ,m.item_cd
              ,(SELECT item_nm
                  FROM tb_ma02010
                 WHERE ptn_cd = m.cust_cd
                   AND item_cd = m.item_cd) AS item_nm
              ,m.ord_qty
              ,m.ord_wgt
              ,m.admt
              ,0 div_qty
              ,0 div_wgt
              ,0 div_admt
              ,(floor((m.ord_wgt/m.ord_qty)*10))/10 AS unit_wgt
              ,(floor((m.admt/m.ord_qty)*10))/10 AS unit_admt
              ,m.avail_qty AS avail_qty
              ,m.avail_qty*(m.ord_wgt/m.ord_qty) AS avail_wgt
              ,m.avail_qty*(m.admt/m.ord_qty) AS avail_admt
          FROM   
			(SELECT n.sales_ord_no
                  ,n.line_no
                  ,n.mbl_no  
                  ,n.ship_nm
                  ,n.Arv_Port_Ymd
                  ,n.cust_ord_no 
                  ,n.tran_cond_cd
                  ,n.cargo_form_cd
                  ,n.cntr_kind_cd
                  ,n.consol_yn
                  ,n.item_cd
                  ,n.ord_qty
                  ,n.ord_wgt
                  ,n.admt
                  ,n.cust_cd
                  ,(SELECT sum(cntr_stock_qty - alloc_stock_qty - picking_stock_qty - dly_stock_qty) - max(gi_prar_stock_qty) 
					  FROM {#1}
                     WHERE blno      = n.mbl_no||n.cust_ord_no
                       AND itemcd    = n.item_cd
                       {#2}
                       and STORERKEY = ${ctrtCustCd}
                    ) AS avail_qty    
               FROM 
	             (
		           SELECT a.sales_ord_no
		        	     ,a.line_no
		                 ,(select mbl_no  from tb_om02003 where sales_ord_no = a.sales_ord_no) mbl_no
                         ,(select ship_nm  from tb_om02003 where sales_ord_no = a.sales_ord_no) ship_nm 
                         ,(select Arv_Port_Ymd  from tb_om02003 where sales_ord_no = a.sales_ord_no) Arv_Port_Ymd
		                 ,b.cust_ord_no
		                 ,b.tran_cond_cd
		                 ,b.cargo_form_cd
		                 ,(SELECT cntr_kind_cd
		                     FROM tb_om02020
		                    WHERE sales_ord_no = a.sales_ord_no
		                      AND ROWNUM = 1) AS cntr_kind_cd
		                 ,'N' AS consol_yn
		                 ,a.item_cd
		                 ,a.ord_qty
		                 ,a.ord_wgt
		                 ,a.admt
		                 ,a.cust_cd
		             FROM tb_om02002 a
		                 ,tb_om02001 b
		            WHERE a.sales_ord_no = b.sales_ord_no
		              AND a.arv_ar_cd = ${dptArCd}
		              AND a.arv_ar_type_cd = '01'
		              AND a.item_cd = ${itemCd}
		              AND b.sales_ord_cncl_yn = 'N'
		              AND b.cargo_form_cd = 'C'		
		              AND b.rpt_cust_cd = ${ctrtCustCd}              
		              {#3}
                   UNION ALL
                   SELECT a.sales_ord_no
                         ,a.line_no
 		                 ,(select mbl_no  from tb_om02003 where sales_ord_no = a.sales_ord_no) mbl_no
                         ,(select ship_nm  from tb_om02003 where sales_ord_no = a.sales_ord_no) ship_nm 
                         ,(select Arv_Port_Ymd  from tb_om02003 where sales_ord_no = a.sales_ord_no) Arv_Port_Ymd
                         ,b.cust_ord_no
                         ,b.tran_cond_cd
                         ,b.cargo_form_cd
                         ,'' AS cntr_kind_cd
                         ,'N' AS consol_yn
                         ,a.item_cd
                         ,a.ord_qty
                         ,a.ord_wgt
                         ,a.admt
                         ,a.cust_cd
                    FROM tb_om02002 a
                        ,tb_om02001 b
                   WHERE a.sales_ord_no = b.sales_ord_no
                     AND a.arv_ar_cd = ${dptArCd}
                     AND a.arv_ar_type_cd = '01'
                     AND a.item_cd = ${itemCd}
                     AND b.rpt_cust_cd = ${ctrtCustCd}
                     AND b.sales_ord_cncl_yn = 'N'
                     AND b.cargo_form_cd = 'B'                     
                     {#3}
                     ) n
		       ) m
          WHERE 1=1
            AND m.avail_qty > 0
          order by m.arv_port_ymd
		<append condition="${workPlCd}.NOTEMPTY" id="#1">
				TB_OM03021_BL
		</append>
	
		<append condition="${workPlCd}.NOTEMPTY" id="#2">
		            AND WHSEID = ${workPlCd}
		</append>
		
		<append condition="${ctrtCustCd}.NOTEMPTY&amp;${ctrtCustCd}.EQ.P1000" id="#3">
                    AND (SELECT work_cntr_cd
                           FROM tb_om01002
                          WHERE cust_cd = b.cust_cd
                            AND cust_ord_no = b.cust_ord_no
                            AND cust_ord_line_no = a.cust_ord_line_no
                            AND ROWNUM = 1) = ${workCntrCd}
		</append>		
		<append condition="${ctrtCustCd}.NOTEMPTY&amp;${ctrtCustCd}.EQ.P1591" id="#3">
                    AND (SELECT work_cntr_cd
                           FROM tb_om01002
                          WHERE cust_cd = b.cust_cd
                            AND cust_ord_no = b.cust_ord_no
                            AND cust_ord_line_no = a.cust_ord_line_no
                            AND ROWNUM = 1) = ${workCntrCd}
		</append>		
  	</statement>

  	<statement name="retrieveAvailBlList_back">
		SELECT 'F' chk 
              ,m.sales_ord_no
              ,m.line_no
              ,m.cust_cd
              ,m.mbl_no
              ,m.ship_nm
              ,m.Arv_Port_Ymd
              ,m.cust_ord_no
              ,m.tran_cond_cd
              ,m.cargo_form_cd
              ,m.cntr_kind_cd
              ,m.consol_yn
              ,m.item_cd
              ,(SELECT item_nm
                  FROM tb_ma02010
                 WHERE ptn_cd = m.cust_cd
                   AND item_cd = m.item_cd) AS item_nm
              ,m.ord_qty
              ,m.ord_wgt
              ,m.admt
              ,0 div_qty
              ,0 div_wgt
              ,0 div_admt
              ,(floor((m.ord_wgt/m.ord_qty)*10))/10 AS unit_wgt
              ,(floor((m.admt/m.ord_qty)*10))/10 AS unit_admt
              ,m.avail_qty AS avail_qty
              ,m.avail_qty*(m.ord_wgt/m.ord_qty) AS avail_wgt
              ,m.avail_qty*(m.admt/m.ord_qty) AS avail_admt
          FROM   
			  (SELECT n.sales_ord_no
                     ,n.line_no
                     ,n.mbl_no  
                     ,n.ship_nm
                     ,n.Arv_Port_Ymd
                     ,n.cust_ord_no 
                     ,n.tran_cond_cd
                     ,n.cargo_form_cd
                     ,n.cntr_kind_cd
                     ,n.consol_yn
                     ,n.item_cd
                     ,n.ord_qty
                     ,n.ord_wgt
                     ,n.admt
                     ,n.cust_cd
                     ,(SELECT sum(cntr_stock_qty - alloc_stock_qty - picking_stock_qty - dly_stock_qty) - max(gi_prar_stock_qty) 
				         FROM {#1}
                        WHERE blno   = n.mbl_no||n.cust_ord_no
                          AND itemcd = n.item_cd) AS avail_qty    
                 FROM 
                     (SELECT a.sales_ord_no
                            ,a.line_no
                            ,c.mbl_no  
                            ,c.ship_nm
                            ,c.Arv_Port_Ymd
                            ,b.cust_ord_no 
                            ,b.tran_cond_cd
                            ,b.cargo_form_cd
                            ,(SELECT cntr_kind_cd
                                FROM tb_om02020
                               WHERE sales_ord_no = a.sales_ord_no
                                 AND ROWNUM = 1) AS cntr_kind_cd
                            ,d.consol_yn
                            ,a.item_cd
                            ,a.ord_qty
                            ,a.ord_wgt
                            ,a.admt
                            ,a.cust_cd
                        FROM tb_om02002 a
                            ,tb_om02001 b
                            ,tb_om02003 c
                            ,( SELECT sales_ord_no 
                                     ,CASE WHEN MAX(item_cnt) > 1 THEN 'Y' 
                                           ELSE 'N' 
                                       END AS consol_yn
                                 FROM (
                                       SELECT sales_ord_no,
                                              COUNT(ROWNUM) item_cnt
                                         FROM tb_om02021
                                        WHERE item_cd = ${itemCd}
                                        GROUP BY sales_ord_no, cntr_no)
                                 GROUP BY sales_ord_no) d                   
                  
                            ,(SELECT ea.sales_ord_no
                                FROM (SELECT sales_ord_no, COUNT(ROWNUM) tot_cnt
                                        FROM tb_om02002
                                       WHERE arv_ar_cd = ${dptArCd}
                                         AND arv_ar_type_cd = '01'
                                       GROUP BY sales_ord_no) ea
                            ,(SELECT sales_ord_no, COUNT(ROWNUM) mat_cnt
                                FROM tb_om02002
                               WHERE arv_ar_cd = ${dptArCd}
                                 AND arv_ar_type_cd = '01'
                                 and sales_ord_no = ${salesOrdNo}
                               GROUP BY sales_ord_no) eb
                       WHERE ea.sales_ord_no = eb.sales_ord_no
                         AND ea.tot_cnt = eb.mat_cnt
                         AND ea.sales_ord_no != ${salesOrdNo}) e                    
                WHERE a.sales_ord_no = b.sales_ord_no
                  AND a.sales_ord_no = c.sales_ord_no
                  AND a.sales_ord_no = d.sales_ord_no
                  AND a.sales_ord_no = e.sales_ord_no
                  AND b.sales_ord_cncl_yn = 'N'
                  AND b.cargo_form_cd = 'C'
                  AND a.arv_ar_cd = ${dptArCd}
                  AND a.arv_ar_type_cd = '01'
                  AND d.consol_yn = 'Y'
                  AND ((b.rpt_cust_cd = 'P1000' AND (SELECT work_cntr_cd
                                                       FROM tb_om01002
                                                      WHERE cust_cd = b.cust_cd
                                                        AND cust_ord_no = b.cust_ord_no
                                                        AND cust_ord_line_no = a.cust_ord_line_no
                                                        AND ROWNUM = 1) = ${workCntrCd})
                                                OR b.rpt_cust_cd != 'P1000')
                  AND b.ctrt_cust_cd = ${ctrtCustCd}
			  UNION ALL
		      SELECT a.sales_ord_no
		            ,a.line_no
		            ,c.mbl_no  
                    ,c.ship_nm
                    ,c.Arv_Port_Ymd
		            ,b.cust_ord_no
		            ,b.tran_cond_cd
		            ,b.cargo_form_cd
		            ,(SELECT cntr_kind_cd
		                FROM tb_om02020
		               WHERE sales_ord_no = a.sales_ord_no
		                 AND ROWNUM = 1) AS cntr_kind_cd
		            ,d.consol_yn
		            ,a.item_cd
		            ,a.ord_qty
		            ,a.ord_wgt
		            ,a.admt
		            ,a.cust_cd
		        FROM tb_om02002 a
		            ,tb_om02001 b
		            ,tb_om02003 c
		            ,(SELECT sales_ord_no
		                    ,CASE WHEN MAX(item_cnt) > 1 THEN 'Y'
		                          ELSE 'N' 
		                     END AS consol_yn
		                FROM (SELECT sales_ord_no, COUNT(ROWNUM) item_cnt
		                        FROM tb_om02021
		                       GROUP BY sales_ord_no, cntr_no)
		                GROUP BY sales_ord_no) d
		        WHERE a.sales_ord_no = b.sales_ord_no
		          AND a.sales_ord_no = c.sales_ord_no
		          AND a.sales_ord_no = d.sales_ord_no
		          AND b.sales_ord_cncl_yn = 'N'
		          AND b.cargo_form_cd = 'C'
		          AND a.arv_ar_cd = ${dptArCd}
		          AND a.arv_ar_type_cd = '01'
		          AND d.consol_yn = 'N'
		          AND a.item_cd = ${itemCd}
		          AND ((b.rpt_cust_cd = 'P1000' AND (SELECT work_cntr_cd
                                                       FROM tb_om01002
                                                      WHERE cust_cd = b.cust_cd
                                                        AND cust_ord_no = b.cust_ord_no
                                                        AND cust_ord_line_no = a.cust_ord_line_no
                                                        AND ROWNUM = 1) = ${workCntrCd})
                                                 OR b.rpt_cust_cd != 'P1000')
		          AND b.ctrt_cust_cd = ${ctrtCustCd}
			  UNION ALL
              SELECT a.sales_ord_no
                    ,a.line_no
                    ,c.mbl_no
                    ,c.ship_nm
                    ,c.Arv_Port_Ymd
                    ,b.cust_ord_no
                    ,b.tran_cond_cd
                    ,b.cargo_form_cd
                    ,'' AS cntr_kind_cd
                    ,'N' AS consol_yn
                    ,a.item_cd
                    ,a.ord_qty
                    ,a.ord_wgt
                    ,a.admt
                    ,a.cust_cd
                FROM tb_om02002 a
                    ,tb_om02001 b
                    ,tb_om02003 c
               WHERE a.sales_ord_no = b.sales_ord_no
                 AND a.sales_ord_no = c.sales_ord_no
                 AND b.sales_ord_cncl_yn = 'N'
                 AND b.cargo_form_cd = 'B'
                 AND a.arv_ar_cd = ${dptArCd}
                 AND a.arv_ar_type_cd = '01'
                 AND a.item_cd = ${itemCd}
                 AND ((b.rpt_cust_cd = 'P1000' AND (SELECT work_cntr_cd
                                                      FROM tb_om01002
                                                     WHERE cust_cd = b.cust_cd
                                                       AND cust_ord_no = b.cust_ord_no
                                                       AND cust_ord_line_no = a.cust_ord_line_no
                                                       AND ROWNUM = 1) = ${workCntrCd})
                                                OR b.rpt_cust_cd != 'P1000')
                 AND    b.ctrt_cust_cd = ${ctrtCustCd}) n
		      ) m
         WHERE 1=1
           AND m.avail_qty > 0
         order by m.arv_port_ymd
		<append condition="${workPlCd}.NOTEMPTY" id="#1">
				           ${workPlCd:not}.V_ATCBYBL@DL_WMS_IF
		</append>
  	</statement>
  	
  	<statement name="retrieveOceanImpGiDivHist">
		SELECT  'F' chk
		       ,a.sales_ord_no
		       ,a.work_route_seq
		       ,a.ord_div_dgr_cnt
		       ,b.line_no
		       ,c.item_cd
		       ,(SELECT item_nm
		           FROM tb_ma02010
		          WHERE ptn_cd = c.cust_cd
		            AND item_cd = c.item_cd) AS item_nm
			   ,a.bl_no
		       ,b.ord_qty
		       ,b.ord_wgt
		       ,b.admt
		       ,a.load_dly_yn
		       ,a.load_dly_rltd_sales_ord_no
		       ,a.drct_load_yn
		       ,idusr.omcomm_check_dcsn_sctn_fn(a.sales_ord_no, a.work_route_seq) dcsn_sctn
		   FROM tb_om03001 a
		       ,tb_om03002 b
		       ,tb_om02002 c
		  WHERE a.sales_ord_no = b.sales_ord_no
		    AND a.work_route_seq = b.work_route_seq
		    AND b.sales_ord_no = c.sales_ord_no
		    AND b.line_no = c.line_no
		    AND a.del_yn = 'N'
		    AND a.sales_ord_no = ${salesOrdNo}
		    AND a.work_route_seq IN (SELECT work_route_seq
		                               FROM tb_om03002
		                              WHERE sales_ord_no = ${salesOrdNo}
		                                AND line_no = ${lineNo})
	 </statement>
	 
	 <statement name="retrieveBilgCustInfo">
	 	 select substr(a.bilg_Cust_Info, 1, 7) bilg_cust_cd
	 		  , LTrim(substr(a.bilg_Cust_Info, 8), '0') sell_dept_cd
	 	   from	(select iscomm_getbilgcustinfo_fn(${corpCd}, ${rptCustCd}, ${expImpDomSctnCd}, ${ordTypeCd}, ${dptArTypeCd}, ${dptArCd}, ${arvArTypeCd}, ${arvArCd}, ${plantCd}, ${moveTypeCd}) bilg_Cust_Info
	 			   from dual) a
	 </statement>

	 <statement name="retrieveBilgCustInfoInh">
	 	 select substr(a.bilg_Cust_Info, 1, 7) bilg_cust_cd
                , LTrim(substr(a.bilg_Cust_Info, 8, 10), '0') sell_dept_cd
                , substr(a.bilg_Cust_Info, 18) ctrt_no
   	       from	(select iscomm_getbilgcustinfo_fn(${corpCd}, ${rptCustCd}, ${expImpDomSctnCd}, ${ordTypeCd}, ${dptArTypeCd}, ${dptArCd}, ${arvArTypeCd}, ${arvArCd}, ${plantCd}, ${moveTypeCd}) bilg_Cust_Info
	 			   from dual) a
	 </statement>

	 <statement name="retrieveBilgCustInfoCiiInh">
	 	 select substr(a.bilg_Cust_Info, 1, 7) bilg_cust_cd
                , LTrim(substr(a.bilg_Cust_Info, 8, 10), '0') sell_dept_cd
                , substr(a.bilg_Cust_Info, 18) ctrt_no
   	       from	(select iscomm_getbilgcustinfo_cii_fn(${corpCd}, ${rptCustCd}, ${expImpDomSctnCd}, ${ordTypeCd}, ${dptArTypeCd}, ${dptArCd}, ${arvArTypeCd}, ${arvArCd}, ${plantCd}, ${moveTypeCd}) bilg_Cust_Info
	 			   from dual) a
	 </statement>

	 <statement name="retrieveBilgCustInfoFw">
	 	 select substr(a.bilg_Cust_Info, 1, 7) bilg_cust_cd
                , LTrim(substr(a.bilg_Cust_Info, 8, 10), '0') sell_dept_cd
                , substr(a.bilg_Cust_Info, 18) ctrt_no
   	      from	(select iscomm_getbilgcustinfo_fw_fn(${corpCd},${rptCustCd},${expImpDomSctnCd},${ordTypeCd},${salesOfcrId},${areaCd},${bilgCustCd}) bilg_Cust_Info
	 			   from dual) a
	 </statement>

	 <statement name="retrieveBilgCustInfoEuor">
	 	 select substr(a.bilg_Cust_Info, 1, 7) bilg_cust_cd
                , LTrim(substr(a.bilg_Cust_Info, 8, 10), '0') sell_dept_cd
                , substr(a.bilg_Cust_Info, 18,10) ctrt_no
                , substr(a.bilg_Cust_Info, 28) sales_ofcr_id
   	      from	(select iscomm_getbilgcustinfo_Euor_fn(${corpCd},${rptCustCd},${expImpDomSctnCd},${ordTypeCd}) bilg_Cust_Info
	 			   from dual) a
	 </statement>
	 
	 <statement name="retrieveImpCntrSalesOrdExist">
	 	 SELECT SALES_ORD_NO
	 	   FROM	TB_OM02001
	 	  WHERE	SALES_ORD_NO = ( SELECT SALES_ORD_NO
	 							   FROM TB_OM01001
	 							  WHERE CUST_ORD_NO = ${custOrdNo}
	 							  {#1}
	 							  {#2}
	 							  {#3}
	 							  {#4}
	 							  {#5}
	 							    )
	        AND SALES_ORD_CNCL_YN != 'Y'
	        
	    <append condition="${ctrtCustCd}.NOTEMPTY&amp;${ctrtCustCd}.EQ.P1000||${rptCustCd}.NOTEMPTY&amp;${rptCustCd}.EQ.P1000" id="#1">
                    AND CUST_CD =  'P1000'
		</append>
	    <append condition="${ctrtCustCd}.NOTEMPTY&amp;${ctrtCustCd}.EQ.P1591||${rptCustCd}.NOTEMPTY&amp;${rptCustCd}.EQ.P1591" id="#2">
                    AND CUST_CD =  'P1591'
		</append>
	    <append condition="${ctrtCustCd}.NOTEMPTY&amp;${ctrtCustCd}.NE.P1000&amp;${ctrtCustCd}.NE.P1591" id="#3">
                    AND CUST_CD =  ${ctrtCustCd}
		</append>
		<append condition="${rptCustCd}.NOTEMPTY&amp;${rptCustCd}.NE.P1000&amp;${rptCustCd}.NE.P1591" id="#4">
                    AND CUST_CD =  ${rptCustCd}
		</append>
	    <append condition="${ctrtCustCd}.EMPTY&amp;${rptCustCd}.EMPTY" id="#5">
                    AND CUST_CD IN ('P1591', 'P1000')
		</append>
	 </statement>
	 <statement name="retrieveImpCntrSalesOrdCmptExist">
	 	 SELECT SALES_ORD_NO
	 	   FROM TB_OM02001
	 	  WHERE SALES_ORD_NO = ${salesOrdNo}
	        AND SALES_ORD_STAT_CD = '06'
	 </statement>
	 
	 <statement name="retrieveBlCargoFormCd">
	 	 SELECT CARGO_FORM_CD
	 	   FROM TB_OM02001
	 	  WHERE CUST_ORD_NO = ${blCustOrdNo}
	 	    AND CUST_CD = ${ctrtCustCd}
	        AND SALES_ORD_CNCL_YN != 'Y'
	 </statement>
	 <statement name="retrieveCancelGiPossItem">
	 	 select decode(count(*), 0, 'Y', 'N') poss_yn
	 	   from	tb_om02001 a
	 		  , tb_om02002 b
	 	  where	a.sales_ord_no = b.sales_ord_no
	 	    and	b.ord_reason_cd is not null
	 	    and	a.sales_ord_no = ${salesOrdNo}
	 	    and	b.line_no = ${lineNo}
	 </statement>
	 
    <statement name="retrieveGiCnclPossYn">
		SELECT CASE WHEN a.cancel_gi_yn||b.cancel_gi_yn||c.cancel_gi_yn||d.cancel_gi_yn = 'YYYY' THEN
		            'Y'
		            ELSE
		            'N'
		       END  cancel_gi_yn
		FROM   (SELECT decode(COUNT(*),0,'Y','N') AS cancel_gi_yn
		        FROM   tb_is01001
		        WHERE  substr(op_rslt_mngt_no,length(op_rslt_mngt_no)-7,8) = ${shipmentNo}
		        AND    dcsn_sctn_cd >= 2
		        AND    inco_trs_yn = 'N'
		        AND    op_sys_sctn_cd = 'TM'
		        and    sales_ord_no in (select sales_ord_no from tb_om04001 where shipment_no=${shipmentNo})
		        AND    del_yn = 'N') a -- 운송료 매출
		      ,(SELECT decode(COUNT(*),0,'Y','N') AS cancel_gi_yn
		        FROM   tb_is02001
		        WHERE  op_rslt_mngt_no = ${shipmentNo}
		        AND    dcsn_sctn_cd >= 1
		        AND    inco_trs_yn = 'N'
		        AND    op_sys_sctn_cd = 'TM'
		        AND    del_yn = 'N') b -- 운송료 매입
		      ,(SELECT decode(COUNT(*),0,'Y','N') AS cancel_gi_yn
		        FROM   tb_is01001 ca
		              ,tb_is07002 cb
		        WHERE  ca.op_rslt_mngt_no = cb.op_rslt_mngt_no
		        AND    ca.op_rslt_mngt_no_seq = cb.op_rslt_mngt_no_seq
		        AND    cb.shipment_no = ${shipmentNo}
		        AND    ca.dcsn_sctn_cd >= 2
		        AND    ca.inco_trs_yn = 'N'
		        AND    ca.op_sys_sctn_cd = 'WM'
		        AND    ca.del_yn = 'N'
		        AND    cb.del_yn = 'N') c -- 하역료 매출
		      ,(SELECT decode(COUNT(*),0,'Y','N') AS cancel_gi_yn
		        FROM   tb_is02001 ca
		              ,tb_is07003 cb
		        WHERE  ca.op_rslt_mngt_no = cb.op_rslt_mngt_no
		        AND    ca.op_rslt_mngt_no_seq = cb.op_rslt_mngt_no_seq
		        AND    cb.shipment_no = ${shipmentNo}
		        AND    ca.dcsn_sctn_cd >= 1
		        AND    ca.inco_trs_yn = 'N'
		        AND    ca.op_sys_sctn_cd = 'WM'
		        AND    ca.del_yn = 'N'
		        AND    cb.del_yn = 'N') d -- 하역료 매입
  </statement>
  
  <statement name="retrieveGiCnclPossYn2">
	  SELECT decode((rslt.r_cnt + dcsn.d_cnt), 0, 'Y', 'N') cancel_gi_yn
        FROM (SELECT COUNT(ROWNUM) r_cnt
                FROM tb_om03015 a
                    ,tb_om04001 b
               WHERE a.sales_ord_no = b.sales_ord_no
                 AND a.work_route_seq = b.work_route_seq
                 AND a.work_step_seq = b.work_step_seq
                 AND a.eo_no = b.eo_no
                 AND a.sales_ord_no = ${salesOrdNo}
                 AND a.work_route_seq = ${workRouteSeq}
                 AND a.gi_work_step_seq = ${workStepSeq}
                 AND a.rslt_dgr_cnt = ${rsltDgrCnt}) rslt
            ,(SELECT COUNT(ROWNUM) d_cnt
                FROM tb_om03015 a
                    ,tb_om03022 b
               WHERE a.eo_no = b.eo_no
                 AND a.sales_ord_no = b.sales_ord_no
                 AND a.sales_ord_no = ${salesOrdNo}
                 AND a.work_route_seq = ${workRouteSeq}
                 AND a.gi_work_step_seq = ${workStepSeq}
                 AND a.rslt_dgr_cnt = ${rsltDgrCnt}) dcsn
  </statement>
  
  <statement name="retrieveGiCnclPossYn3">
        select decode(sum(cancel_gi_cnt), 0, 'Y', 'N') cancel_gi_yn
          from (
	             SELECT count(*) as  cancel_gi_cnt
	               FROM tb_om03022
	              WHERE sales_ord_no in (
	 	                                 SELECT sales_ord_no
	 	                                   FROM tb_om02001
	 	                                  WHERE RLTD_GI_EO_NO = ${eoNo}
	 	                                    AND ord_div_dgr_cnt = ${ordDivDgrCnt})	
	             union all
	             SELECT count(*) as  cancel_gi_cnt
	               FROM tb_om04001
	              WHERE sales_ord_no in (
	 	                                 SELECT sales_ord_no
	 	                                   FROM tb_om02001
	 	                                  WHERE RLTD_GI_EO_NO = ${eoNo}
	 	                                    AND ord_div_dgr_cnt = ${ordDivDgrCnt})	
	           )
  </statement>  	 

  <statement name="retrieveCustOfCustGrItemList">
		SELECT 	a.sales_ord_no
				 ,a.line_no
				 ,a.cust_cd 
				 ,a.item_cd 
				 ,a.basis_item_cd 
				 ,a.cust_ord_line_no 
				 ,a.item_grade_cd 
				 ,a.qty_unit_cd 
				 ,a.wgt_unit_cd 
				 ,a.admt 
				 ,a.basis_unit_cd 
				 ,a.bat_no 
				 ,a.cust_bat_no 
				 ,a.lot_no 
				 ,a.prdt_req_no 
				 ,a.prdt_prar_ymd 
				 ,a.plant_cd 
				 ,a.sales_uprice 
				 ,a.cust_ref_no 
				 ,a.fe_sctn_cd 
				 ,a.cntr_size_cd 
				 ,a.cntr_no 
				 ,a.danger_sctn_cd 
				 ,a.seal_no1 
				 ,a.seal_no2 
				 ,a.pckg_unit_cd 
				 ,a.pckg_qty 
				 ,a.max_tmpt 
				 ,a.min_tmpt 
				 ,a.dpt_ar_cd 
				 ,a.dpt_ar_type_cd 
				 ,a.dpt_ar_zip_cd 
				 ,a.dpt_ar_zip_addr 
				 ,a.dpt_ar_dtl_addr 
				 ,a.dpt_ar_ofcr_nm 
				 ,a.dpt_ar_ofcr_tel_no 
				 ,a.arv_ar_cd 
				 ,a.arv_ar_type_cd 
				 ,a.arv_ar_zip_cd 
				 ,a.arv_ar_zip_addr 
				 ,a.arv_ar_dtl_addr 
				 ,a.arv_ar_ofcr_nm 
				 ,a.arv_ar_ofcr_tel_no 
				 ,a.strt_req_ymd 
				 ,a.strt_req_hm 
				 ,a.aptd_req_ymd 
				 ,a.aptd_req_hm 
				 ,a.ord_reason_cd 
				 ,a.booking_no 
				 ,a.prog_stat_cd 
				 ,a.vanning_grp_id 
				 ,a.prdt_ymd 
				 ,a.pol_cd 
				 ,a.schd_no 
				 ,a.sctn_cd 
				 ,a.rpt_item_nm 
				 ,a.cls_expr_yn 
				 ,a.lead_time_expr_yn 
				 ,a.ltrm_ord_yn 
				 ,a.rmk 
				 ,a.exp_ord_no 
				 ,a.dpt_port_prar_ymd 
				 ,a.arv_port_prar_ymd 
				 ,a.gi_req_ymd 
				 ,a.std_wgt 
				 ,a.pallet_qty 
				 ,a.more_pmsr 
				 ,a.less_pmsr 
				 ,a.cntr_dcsn_ofcr_id 
				 ,a.cntr_dcsn_date 
				 ,a.pcul_cd 
				 ,a.mn_cd 
				 ,a.dcsn_yn 
				 ,a.work_cntr_cd 
				 ,a.deliv_dly_yn 
				 ,a.cmpt_ymd 
				 ,a.ord_verify_yn 
				 ,a.del_yn
				 ,c.lot_no mnf_no
				 ,c.rslt_qty ord_qty
				 ,c.rslt_wgt ord_wgt
				 ,c.rslt_cbm ord_cbm
				 ,c.prdt_lot_no
                 ,c.dia_supl
                 ,c.papstyle_gds_supl
		FROM tb_om02002 a, tb_om04001 b, tb_om04003 c
		WHERE  b.sales_ord_no = ${salesOrdNo}
		AND	  a.sales_ord_no = b.sales_ord_no
		AND	  b.work_route_seq = ${workRouteSeq}
		AND	  b.work_step_seq = ${workStepSeq}
		AND	  b.rslt_dgr_cnt = ${rsltDgrCnt}
		AND	  b.sales_ord_no = c.sales_ord_no
		AND	  b.work_route_seq = c.work_route_seq
		AND	  b.work_step_seq = c.work_step_seq
		AND	  b.rslt_dgr_cnt = c.rslt_dgr_cnt
		AND	  a.line_no = c.line_no
		AND	  c.cncl_ord_no IS NULL
		AND	  a.del_yn = 'N'
	 </statement>
	 
	<statement name="retrieveBookingNoList">
		SELECT   
			  max(b.ship_co_booking_no) ship_co_booking_no
			, max(b.booking_ymd) booking_ymd
			, b.ship_co_cd
			, max(b.ship_co_nm) ship_co_nm
			, max(b.ship_co_ofcr_nm) ship_co_ofcr_nm
			, max(b.ship_co_tel_no) ship_co_tel_no
			, max(b.ship_co_fax_no) ship_co_fax_no
			, max(b.ship_nm) ship_nm
			, max(b.port_cnt) port_cnt
			, b.pol_cd
			, max(b.pol_nm) pol_nm
			, b.pod_cd
			, max(b.pod_nm) pod_nm
			, max(b.dpt_port_prar_ymd) dpt_port_prar_ymd
			, b.arv_port_prar_ymd
			, max(b.cy_cls_ymd) cy_cls_ymd
			, max(b.cy_cls_hms) cy_cls_hms
			, max(b.sr_cls_ymd) sr_cls_ymd
			, max(b.sr_cls_hms) sr_cls_hms
			, max( b.cntr_kind_cd1) cntr_kind_cd1
			, max( b.cntr_qty1) cntr_qty1
			, max( b.cntr_kind_cd2) cntr_kind_cd2
			, max( b.cntr_qty2) cntr_qty2
			, max( b.cntr_kind_cd3) cntr_kind_cd3
			, max( b.cntr_qty3) cntr_qty3
			, max( b.cntr_kind_cd4) cntr_kind_cd4
			, max( b.cntr_qty4) cntr_qty4
			, max( b.cntr_kind_cd5) cntr_kind_cd5
			, max( b.cntr_qty5) cntr_qty5
			, max( b.booking_wgt) booking_wgt
			, max( b.wgt_unit_cd) wgt_unit_cd
			, max( b.cy_dtl_conts) cy_dtl_conts
			, max( b.schd_no) schd_no
			, max( b.schd_ofcr_nm) schd_ofcr_nm
			, max( b.vanning_cmpt_yn) vanning_cmpt_yn
		FROM   TB_OM02019 b
			, tb_om02001 a
		WHERE  a.sales_ord_no = b.sales_ord_no
		{#1}
		GROUP BY ship_co_cd, pol_cd, pod_cd, arv_port_prar_ymd
		order by ship_co_booking_no, ship_co_cd, pol_cd, pod_cd, arv_port_prar_ymd
		<append condition="${custCd}.NOTEMPTY" id="#1">
			and	a.ctrt_cust_cd = ${custCd}
		</append>
		<append condition="${shipCoBookingNo}.NOTEMPTY" id="#1">
			and	b.ship_co_booking_no = ${shipCoBookingNo}
		</append>
		<append condition="${arvPortPrarYmd}.NOTEMPTY" id="#1">
			and	b.arv_port_prar_ymd = ${arvPortPrarYmd}
		</append>
		<append condition="${polCd}.NOTEMPTY" id="#1">
			and	b.pol_cd = ${polCd}
		</append>
		<append condition="${podCd}.NOTEMPTY" id="#1">
			and	b.pod_cd = ${podCd}
		</append>
		<append condition="${shipCoCd}.NOTEMPTY" id="#1">
			and	b.ship_co_cd = ${shipCoCd}
		</append>
			
	</statement>
	<statement name="retrieveExistBookingData">
		select a.ship_co_booking_no
		from	tb_om02019 a
			  , tb_om02001 b
		WHERE	A.SALES_ORD_NO = B.SALES_ORD_NO
			and	b.ctrt_cust_cd = ${custCd}
			and	a.dpt_port_prar_ymd = ${dptPortPrarYmd}
			and	a.arv_port_prar_ymd = ${arvPortPrarYmd}
			and	a.ship_nm = ${shipNm}
			and	a.port_cnt = ${portCnt}
			and	a.pol_cd = ${polCd}
			and	a.pod_cd = ${podCd}
			and	a.ship_co_cd = ${shipCoCd}
			and	a.ship_co_booking_no != ${shipCoBookingNo}
		
	</statement> 
	<statement name="retrieveExistBookingNo">
		select a.ship_co_booking_no
		from	tb_om02019 a
			  , tb_om02001 b
		WHERE	A.SALES_ORD_NO = B.SALES_ORD_NO
			and	(b.ctrt_cust_cd != ${custCd}
				or	a.dpt_port_prar_ymd != ${dptPortPrarYmd}
				or	a.arv_port_prar_ymd != ${arvPortPrarYmd}
				or	a.ship_nm != ${shipNm}
				or	a.port_cnt != ${portCnt}
				or	a.pol_cd != ${polCd}
				or	a.pod_cd != ${podCd}
				or	a.ship_co_cd != ${shipCoCd} )
			and	a.ship_co_booking_no = ${shipCoBookingNo}
		
	</statement> 
	
	<statement name="retrieveBookingExistSalesOrd">
		SELECT count(*) CNT
		FROM	TB_OM02019 a
        	  , TB_OM02001 B
        	  , TB_MA01006 C
		WHERE	A.SALES_ORD_NO 		= B.SALES_ORD_NO
		and		b.ord_type_cd		= c.ord_type_cd
		and		c.cmpd_tran_yn		= 'Y'
	    AND 	B.RPT_CUST_CD 		= ${custCd}
		AND		SHIP_CO_BOOKING_NO 	= ${shipCoBookingNo}
		AND		SHIP_CO_CD 			= ${shipCoCd}
		AND		ARV_PORT_PRAR_YMD 	= ${arvPortPrarYmd}
		AND		POL_CD 				= ${polCd}
		AND		POD_CD 				= ${podCd}
		AND		VANNING_CMPT_YN 	= 'N'
	</statement>
	
	<statement name="retrieveTransferCyAsnData">
		SELECT c.bl_no
              ,d.rpt_cust_cd
              ,c.arv_ar_cd
              ,e.ship_co_cd
              ,b.cntr_no
              ,(SELECT f.cntr_kind_cd
                FROM   tb_om02020 f
                WHERE  f.sales_ord_no = g.sales_ord_no
                AND    f.cntr_no = b.cntr_no) cntr_kind_cd
              ,e.arv_port_ymd
              ,to_char(a.work_date,'YYYYMMDD') work_date
              ,c.dpt_ar_cd
        FROM   tb_om04001 a
              ,tb_om03014 b
              ,tb_om03001 c
              ,tb_om02001 d
              ,tb_om02003 e
              ,tb_om02001 g
        WHERE  a.sales_ord_no = b.sales_ord_no
        AND    a.work_route_seq = b.work_route_seq
        AND    a.shipment_no = b.shipment_no
        AND    a.sales_ord_no = c.sales_ord_no
        AND    a.work_route_seq = c.work_route_seq
        AND    a.sales_ord_no = d.sales_ord_no
        AND    c.bl_cust_ord_no = g.cust_ord_no
        AND    g.sales_ord_cncl_yn = 'N'
        AND    g.sales_ord_no = e.sales_ord_no
        AND    d.rpt_cust_cd = 'P1100'
        AND    d.exp_imp_dom_sctn_cd = '02'
        AND    c.arv_ar_cd = '1000'
        AND    a.sales_ord_no = ${salesOrdNo}
		AND    a.work_route_seq = ${workRouteSeq}
		AND    a.work_step_seq = ${workStepSeq}
		AND    a.rslt_dgr_cnt = ${rsltDgrCnt}
	</statement>
	
	<statement name="retrieveGiRsltExist">
		SELECT COUNT(*) CNT
		FROM	TB_OM04001
		WHERE	SALES_ORD_NO = ${salesOrdNo}
		AND		RSLT_SCTN_CD = '05'
		AND		DEL_YN != 'Y'
	</statement>
	
	<statement name="retrieveCustOrdStat">
		{#1}
		<append condition="${statSctnCd}.EQ.02" id="#1">
		SELECT A.CUST_CD RPT_CUST_CD,
		       A.CUST_ORD_NO,
		       TO_CHAR(A.CUST_ORD_RECP_DATE , 'YYYYMMDD') RECP_YMD,
		       TO_CHAR(A.CUST_ORD_RECP_DATE , 'HH24MISS') RECP_HMS,
		       (SELECT OFCR_TEL_NO
		        FROM TB_OM02102 X
		        WHERE X.CUST_CD                    = A.CUST_CD
		        AND   NVL(X.CUST_ORD_TYPE_CD ,'%') = NVL(A.CUST_ORD_TYPE_CD ,'%')
		        AND   NVL(X.CUST_MOVE_TYPE_CD,'%') = NVL(A.CUST_MOVE_TYPE_CD,'%')
		        AND   X.OFCR_TEL_NO       IS NOT NULL
		        AND   ROWNUM = 1) OFCR_TEL_NO     
		FROM TB_OM01005 A
		WHERE A.CUST_ORD_NO = ${custOrdNo}
		AND   A.CUST_CD		= ${custCd}
		</append>
		<append condition="${statSctnCd}.EQ.01" id="#1">
		SELECT RPT_CUST_CD,
		       CUST_ORD_NO,
		       (SELECT CUST_OFCR_TEL_NO
		        FROM TB_OM05007 X
		        WHERE X.ORD_CHRG_DEPT_CD       = A.ORD_MNGT_EXCE_DEPT_CD
		        AND   X.CUST_CD                = A.RPT_CUST_CD
		        AND   X.EXP_IMP_DOM_SCTN_CD    = A.EXP_IMP_DOM_SCTN_CD) OFCR_TEL_NO,
		       BACK_ORD_YN          
		FROM TB_OM02001 A
		WHERE A.CUST_ORD_NO = ${custOrdNo}
		AND   A.RPT_CUST_CD	= ${custCd}		
		</append>				
		<append condition="${statSctnCd}.NE.01&amp;${statSctnCd}.NE.02" id="#1">
		SELECT A.CUST_ORD_NO,
			   A.RPT_CUST_CD,
			   A.CUST_ORD_TYPE_CD,
			   (SELECT X.CUST_NM
			    FROM TB_MA02020 X
			    WHERE X.PTN_CD      = A.RPT_CUST_CD
			    AND   X.CUST_PTN_CD = A.CUST_OF_CUST_CD) CUST_OF_CUST_NM,
		       TO_CHAR(A.CUST_ORD_RECP_DATE , 'YYYYMMDD') RECP_YMD,
		       TO_CHAR(A.CUST_ORD_RECP_DATE , 'HH24MISS') RECP_HMS,
		       TO_CHAR(A.SALES_ORD_CMPT_DATE, 'YYYYMMDD') CMPT_YMD,
		       TO_CHAR(A.SALES_ORD_CMPT_DATE, 'HH24MISS') CMPT_HMS,
			   B.ORD_WGT,
			   SUBSTR(B.BAT_NO, 5,5) GRADE,
		       (SELECT X.CUST_OFCR_TEL_NO
		        FROM TB_OM05007 X
		        WHERE X.ORD_CHRG_DEPT_CD       = A.ORD_MNGT_EXCE_DEPT_CD
		        AND   X.CUST_CD                = A.RPT_CUST_CD
		        AND   X.EXP_IMP_DOM_SCTN_CD    = A.EXP_IMP_DOM_SCTN_CD) OFCR_TEL_NO         
		FROM TB_OM02001 A
		    ,TB_OM02002 B
		WHERE A.SALES_ORD_NO = ${salesOrdNo}
		AND   A.SALES_ORD_NO = B.SALES_ORD_NO
		AND   B.DEL_YN		 = 'N'
		AND   ROWNUM		 = 1
		</append>	
	</statement>	
	
	<statement name="retrieveExpTplTran">
		SELECT MACOMM_GETCD_FN('EXP_IMP_DOM_SCTN', A.EXP_IMP_DOM_SCTN_CD) EXP_IMP_DOM_SCTN_NM
		      ,MACOMM_GETPTNNM_FN(A.RPT_CUST_CD) CUST_NM
		      ,A.RPT_CUST_CD
		      ,B.CY_CLS_YMD
		      ,B.CNTR_KIND_CD1	
		      ,B.CNTR_QTY1	
		      ,B.CNTR_KIND_CD2	
		      ,B.CNTR_QTY2	
		      ,B.CNTR_KIND_CD3	
		      ,B.CNTR_QTY3	
		      ,B.CNTR_KIND_CD4	
		      ,B.CNTR_QTY4	
		      ,B.CNTR_KIND_CD5	
		      ,B.CNTR_QTY5
		      ,A.SALES_ORD_NO
		      ,B.SHIP_CO_BOOKING_NO BOOKING_NO  
		FROM TB_OM02001 A
		    ,TB_OM02019 B
		WHERE 1=1
		AND   A.EXP_IMP_DOM_SCTN_CD   = '01'
		AND   A.SALES_ORD_NO          = B.SALES_ORD_NO
		AND   B.BOOKING_NO            = ${bookingNo}
		AND   A.SALES_ORD_NO          = ${salesOrdNo}	
	</statement>	
		
	<statement name="retrieveImpTplTran">
		SELECT MACOMM_GETCD_FN('EXP_IMP_DOM_SCTN', A.EXP_IMP_DOM_SCTN_CD) EXP_IMP_DOM_SCTN_NM
		      ,MACOMM_GETPTNNM_FN(A.RPT_CUST_CD) CUST_NM
		      ,A.RPT_CUST_CD
		      ,A.APTD_REQ_YMD
              ,A.SALES_ORD_NO
              ,(SELECT Y.CNTR_KIND_CD
                FROM TB_OM02003 X
                    ,TB_OM02020 Y
                WHERE X.MBL_NO       = D.BL_NO
                AND   X.SALES_ORD_NO = Y.SALES_ORD_NO
                AND   ROWNUM = 1) CNTR_KIND_CD
              ,C.ORD_QTY  
              ,D.BL_NO
              ,A.SALES_ORD_NO
	    FROM TB_OM02001 A
		    ,TB_OM02003 B
		    ,TB_OM03002 C
            ,TB_OM03001 D
		WHERE 1=1
        AND   A.DPT_AR_CD             = 'KRPUS'
        AND   A.EXP_IMP_DOM_SCTN_CD   = '02'
        AND   A.SALES_ORD_NO          = B.SALES_ORD_NO
        AND   A.SALES_ORD_NO          = ${salesOrdNo}
        AND   A.SALES_ORD_NO		  = C.SALES_ORD_NO
        AND   C.WORK_ROUTE_SEQ		  = ${workRouteSeq}
        AND   C.SALES_ORD_NO          = D.SALES_ORD_NO
        AND   C.WORK_ROUTE_SEQ        = D.WORK_ROUTE_SEQ
	</statement>

	<statement name="retrieveImpTplTranForwarding">
		SELECT MACOMM_GETCD_FN('EXP_IMP_DOM_SCTN', A.EXP_IMP_DOM_SCTN_CD) EXP_IMP_DOM_SCTN_NM
		      ,MACOMM_GETPTNNM_FN(A.RPT_CUST_CD) CUST_NM
		      ,A.RPT_CUST_CD
		      ,A.APTD_REQ_YMD
		      ,B.CNTR_KIND_CD1	
		      ,B.CNTR_QTY1	
		      ,B.CNTR_KIND_CD2	
		      ,B.CNTR_QTY2	
		      ,B.CNTR_KIND_CD3	
		      ,B.CNTR_QTY3	
		      ,B.CNTR_KIND_CD4	
		      ,B.CNTR_QTY4	
		      ,B.CNTR_KIND_CD5	
		      ,B.CNTR_QTY5
		      ,A.SALES_ORD_NO
		      ,B.MBL_NO BL_NO
		FROM TB_OM02001 A
		    ,TB_OM02003 B
		WHERE 1=1
		AND   A.EXP_IMP_DOM_SCTN_CD   = '02'
		AND   A.SALES_ORD_NO          = B.SALES_ORD_NO
		AND   A.SALES_ORD_NO          = ${salesOrdNo}	
	</statement>	
	
	<statement name="retrieveOrdAccessAuth">
	     SELECT CASE WHEN (SELECT 1
	                       FROM TB_OM05008 X
	                       WHERE X.DEPT_CD = A.ORD_MNGT_EXCE_DEPT_CD
	                       AND   X.USER_ID = ${userId}) IS NOT NULL THEN 'Y'
	                 WHEN (SELECT 1
	                       FROM TB_OM05008 X
	                       WHERE X.DEPT_CD = B.ORD_CHRG_DEPT_CD
	                       AND   X.USER_ID = ${userId}) IS NOT NULL THEN 'Y'   
	                 WHEN (SELECT 1
	                       FROM TB_OM05008 X
	                       WHERE X.DEPT_CD = C.ORD_CHRG_DEPT_CD
	                       AND   X.USER_ID = ${userId}) IS NOT NULL THEN 'Y'     
	                 ELSE 'N' END AUTH_YN                                             
	          , A.SALES_ORD_NO                 
	     FROM TB_OM02001 A
	         ,TB_MA01005 B
	         ,TB_MA01005 C
	     WHERE A.DPT_AR_CD = B.WORK_PL_CD(+)
	     AND   A.ARV_AR_CD = C.WORK_PL_CD(+)
	     {#1}
	     {#2}	     
	     {#3}	 
	     {#4}    
		<append condition="${salesOrdNo}.NOTEMPTY" id="#1">
		 AND   A.SALES_ORD_NO = ${salesOrdNo}
		</append>	     
		<append condition="${custOrdNo}.NOTEMPTY"  id="#2">
		 AND   A.CUST_ORD_NO  = ${custOrdNo}
		</append>	     
		<append condition="${shipmentNo}.NOTEMPTY" id="#3">
		 AND   A.SALES_ORD_NO in (SELECT SALES_ORD_NO
		 					      FROM	TB_OM03016
		 					      WHERE  SHIPMENT_NO = ${shipmentNo} )
		</append>
		<append condition="${custRefNo}.NOTEMPTY"  id="#4">
		 AND   A.CUST_REF_NO  = ${custRefNo}
		</append>			     
	</statement>
	
	<statement name="retrieveExpOrdAccessAuth">
	     SELECT CASE WHEN (SELECT 1
	                       FROM TB_OM05008 X
	                       WHERE X.DEPT_CD = A.ORD_MNGT_EXCE_DEPT_CD
	                       AND   X.USER_ID = ${userId}) IS NOT NULL THEN 'Y'
	                 WHEN (SELECT 1
	                       FROM TB_OM05008 X
	                       WHERE X.DEPT_CD = B.ORD_CHRG_DEPT_CD
	                       AND   X.USER_ID = ${userId}) IS NOT NULL THEN 'Y'   
	                 WHEN (SELECT 1
	                       FROM TB_OM05008 X
	                       WHERE X.DEPT_CD = C.ORD_CHRG_DEPT_CD
	                       AND   X.USER_ID = ${userId}) IS NOT NULL THEN 'Y'     
	                 ELSE 'N' END AUTH_YN                                             
	          , A.SALES_ORD_NO                 
	     FROM TB_OM02001 A
	         ,TB_MA01005 B
	         ,TB_MA01005 C
	         ,TB_OM02002 D
	     WHERE A.DPT_AR_CD    = B.WORK_PL_CD(+)
	     AND   A.ARV_AR_CD    = C.WORK_PL_CD(+)
	     AND   A.SALES_ORD_NO = D.SALES_ORD_NO
	     {#1}
	     {#2}
	     AND   ROWNUM = 1	     
		<append condition="${salesOrdNo}.NOTEMPTY" id="#1">
		 AND   A.SALES_ORD_NO = ${salesOrdNo}
		</append>	     
		<append condition="${custOrdNo}.NOTEMPTY"  id="#2">
		 AND   D.EXP_ORD_NO   = ${custOrdNo}
		</append>	     
	</statement>	
	
	<statement name="retrieveIndirDelivOrdAccessAuth">
	     SELECT CASE WHEN (SELECT 1
	                       FROM TB_OM05008 X
	                       WHERE X.DEPT_CD = A.ORD_CHRG_DEPT_CD
	                       AND   X.USER_ID = ${userId}) IS NOT NULL THEN 'Y'   
	                 WHEN (SELECT 1
	                       FROM TB_OM05008 X
	                       WHERE X.DEPT_CD = B.ORD_CHRG_DEPT_CD
	                       AND   X.USER_ID = ${userId}) IS NOT NULL THEN 'Y'     
	                 ELSE 'N' END AUTH_YN                                             
	     FROM TB_MA01005 A
	         ,TB_MA01005 B
	     WHERE A.WORK_PL_CD = ${dptArCd}
	     AND   B.WORK_PL_CD = ${arvArCd}
	</statement>	
			
	<statement name="retrievePortStockOrdBooking">
	SELECT b.cust_ord_no cust_ref_no
		   , a.booking_no 
		   , a.vanning_cmpt_yn
		   , a.ship_co_cd
		   , a.ship_co_nm 
		   , a.ship_nm 
		   , a.pol_cd 
		   , a.pol_nm 
		   , a.pod_cd 
		   , a.pod_nm 
		   , a.arv_port_prar_ymd
		   , a.cntr_kind_cd1 
		   , a.cntr_qty1 
		   , a.cntr_kind_cd2 
		   , a.cntr_qty2 
		   , a.cntr_kind_cd3 
		   , a.cntr_qty3 
		   , a.cntr_kind_cd4 
		   , a.cntr_qty4 
		   , a.cntr_kind_cd5 
		   , a.cntr_qty5 
		   , a.booking_wgt 
		   , a.wgt_unit_cd
		   , a.schd_ofcr_nm
		   , NVL(a.cntr_qty1, 0) + NVL(a.cntr_qty2, 0) + NVL(a.cntr_qty3, 0) + NVL(a.cntr_qty4, 0) + NVL(a.cntr_qty5, 0) cntr_sum
		   , a.sales_ord_no
		   , a.ship_co_booking_no
 		   , a.booking_ymd
		   , b.rpt_cust_cd cust_cd
		   , b.cargo_form_cd
	FROM   tb_om02019 a
	      ,tb_om02001 b
	WHERE  a.sales_ord_no(+) = b.sales_ord_no
	AND    b.cust_ord_no
	   IN (
		   SELECT x.cust_ref_no
		   FROM   tb_om02001 x
		   WHERE  x.ord_type_cd = '2058'
		   {#1}
		   )
		<append condition="${custRefNo}.NOTEMPTY" id="#1">
			AND    x.cust_ref_no = ${custRefNo}
		</append>
		<append condition="${ordMngtExceDeptCd}.NOTEMPTY" id="#1">
			AND    x.ord_mngt_exce_dept_cd = LPad(${ordMngtExceDeptCd}, 10, '0')
		</append>
		<append condition="${polCd}.NOTEMPTY" id="#1">
			AND	   x.arv_ar_cd = ${polCd}
		</append>
		<append condition="${aptdReqYmdFr}.NOTEMPTY" id="#1">
			AND    x.aptd_req_ymd BETWEEN ${aptdReqYmdFr} AND ${aptdReqYmdTo}
		</append>
	</statement>	
	
	<statement name="retrievePortStockOrdList">
	SELECT a.aptd_req_ymd
		   , a.sales_ord_no
		   , a.cust_ref_no
		   , a.cust_ord_no
		   , a.cargo_form_cd
		   , macomm_getcd_fn( 'CARGO_FORM_CD', a.cargo_form_cd) cargo_form_nm
		   , c.col04
		   , c.col08
		   , d.booking_no
		   , d.work_route_seq
		   , d.ship_co_booking_no
		   , DECODE(d.sales_ord_no, null, 0, IDUSR.OMCOMM_CHECK_DCSN_SCTN_FN(d.sales_ord_no, d.work_route_seq)) dcsn_sctn_yn
		   , 'F' chk
	   	   , a.arv_ar_zip_addr
	   	   , a.arv_ar_dtl_addr
		   , a.strt_req_ymd
		   , a.strt_req_hm
		   , a.aptd_req_hm
		   , a.cls_expr_yn
		   , a.lead_time_expr_yn
		   , a.ltrm_ord_yn
		   , a.load_dly_yn
		   , a.load_dly_rltd_sales_ord_no 
		   , a.dpt_ar_cd
		   , a.arv_ar_cd
		   , a.dpt_ar_type_cd
		   , a.arv_ar_type_cd
		   , a.tran_cond_cd
		   , e.ord_wgt
	FROM   tb_om02001 a
		  ,tb_om02004 c
		  , (select x.sales_ord_no, sum(z.ord_wgt) ord_wgt
		     from	tb_om02001 x
		     	,   tb_om02002 z
		     where	x.sales_ord_no = z.sales_ord_no
		     {#2}
		     group by x.sales_ord_no
		     ) e
		  ,(select z.sales_ord_no, z.work_route_seq, z.booking_no, zz.ship_co_booking_no
		   from	 tb_om02001 x, tb_om03001 z, tb_om02019 zz
		   where  x.sales_ord_no = z.sales_ord_no
		   AND	  z.sales_ord_no = zz.sales_ord_no
		   AND	  z.booking_no = zz.booking_no 
		   AND    x.ord_type_cd = '2058'
		   {#2}
		   AND	  z.del_yn = 'N') d
	WHERE  a.sales_ord_no = c.sales_ord_no
	AND	   a.sales_ord_no = d.sales_ord_no(+)
	and	   a.sales_ord_no = e.sales_ord_no
	and    a.sales_ord_cncl_yn = 'N'
	AND    a.ord_type_cd = '2058'
	{#1}
		<append condition="${custRefNo}.NOTEMPTY" id="#1">
			AND    a.cust_ref_no = ${custRefNo}
		</append>
		<append condition="${ordMngtExceDeptCd}.NOTEMPTY" id="#1">
			AND    a.ord_mngt_exce_dept_cd = LPad(${ordMngtExceDeptCd}, 10, '0')
		</append>
		<append condition="${polCd}.NOTEMPTY" id="#1">
			AND	   a.arv_ar_cd = ${polCd}
		</append>
		<append condition="${aptdReqYmdFr}.NOTEMPTY" id="#1">
			AND    a.aptd_req_ymd BETWEEN ${aptdReqYmdFr} AND ${aptdReqYmdTo}
		</append>
		<append condition="${divYn}.NOTEMPTY&amp;${divYn}.EQ.Y" id="#1">
			AND    EXISTS (select 1
						   from	 tb_om03001
						   where sales_ord_no = a.sales_ord_no
						   and	 del_yn = 'N')
		</append>
		<append condition="${custRefNo}.NOTEMPTY" id="#2">
			AND    x.cust_ref_no = ${custRefNo}
		</append>
		<append condition="${ordMngtExceDeptCd}.NOTEMPTY" id="#2">
			AND    x.ord_mngt_exce_dept_cd = LPad(${ordMngtExceDeptCd}, 10, '0')
		</append>
		<append condition="${polCd}.NOTEMPTY" id="#2">
			AND	   x.arv_ar_cd = ${polCd}
		</append>
		<append condition="${aptdReqYmdFr}.NOTEMPTY" id="#2">
			AND    x.aptd_req_ymd BETWEEN ${aptdReqYmdFr} AND ${aptdReqYmdTo}
		</append>
	</statement>
	
	<statement name="retrievePortStockOrdItem">
		SELECT a.sales_ord_no
		, a.line_no
		, a.cust_cd
		, a.item_cd
		, a.ord_qty
		, a.ord_wgt
		, a.ord_cbm
		, a.admt
		, a.pallet_qty
		, 0 pallet_unit_cbm
		, ${regrId} as regr_id
		, ${mdfrId} as mdfr_id
		FROM tb_om02002 a
		WHERE a.sales_ord_no= ${salesOrdNo}
		AND	  a.del_yn = 'N'
	</statement>
	
	<statement name="retrieveLafCustOrdDscnInfo">
		SELECT 'H'                           TPL   
		      ,A.CUST_ORD_TYPE_CD            DCTO
		      ,SUBSTR(A.CUST_ORD_NO,3)       DOCO
		      ,B.CUST_ORD_LINE_NO            LNID
		      ,'C'                           SO15
		      ,C.COL03                       KCOO
		      ,A.DPT_AR_CD                   MCU
		      ,B.ITEM_CD                     LITM
		      ,D.LOT_NO                      LOTN
		      ,D.ORD_QTY                     UORG
		      ,D.ORD_WGT                     ITWT
		      ,D.QTY_UNIT_CD                 UOM
		      ,D.WGT_UNIT_CD                 WTUM
		      ,'525'                         LTTR
		      ,'527'                         NXTR
		      ,A.CUST_OF_CUST_CD             AN8
		      ,TO_CHAR(SYSDATE, 'YYYYMMDD')  DTCO
		      ,TO_CHAR(SYSDATE, 'HH24MISS')  TMCO
		      ,'0'                           TRAN
		      ,D.COL12                       TAX1
		      ,D.COL13                       EXR1
		      ,C.COL09                       SFXO
		      ,D.COL14                       SHAN
		      ,D.COL15                       ASN
		      ,D.col16                       PDDJ
		      ,A.SALES_ORD_NO
		      ,B.LINE_NO
		      ,A.CUST_ORD_NO
		FROM TB_OM02001 A
		    ,TB_OM02002 B
		    ,TB_OM01001 C
		    ,TB_OM01002 D
		WHERE A.RPT_CUST_CD      = 'P1300'
		AND   A.SALES_ORD_NO     = ${salesOrdNo}
		AND   A.SALES_ORD_NO     = B.SALES_ORD_NO
		AND   B.LINE_NO		     = ${lineNo}
		AND   A.CUST_CD          = C.CUST_CD
		AND   A.CUST_ORD_NO      = C.CUST_ORD_NO
		AND   C.CUST_CD          = D.CUST_CD
		AND   C.CUST_ORD_NO      = D.CUST_ORD_NO
		AND   B.CUST_ORD_LINE_NO = D.CUST_ORD_LINE_NO
		AND   EXISTS (SELECT 'X'
                  FROM   tb_om02102 e
                  WHERE  e.cust_cd = a.rpt_cust_cd
                  AND    e.cust_ord_type_cd = a.cust_ord_type_cd
                  AND    trim(e.cust_dcsn_trms_cd) IS NOT NULL)
	</statement>	

	<statement name="retrieveEveCustOrdDscnInfo">
		SELECT A.CUST_ORD_TYPE_CD   
		      ,A.CUST_MOVE_TYPE_CD         
		      ,A.SALES_ORD_NO
		      ,A.CUST_ORD_NO
		      ,A.RPT_CUST_CD
		FROM TB_OM02001 A
		WHERE A.RPT_CUST_CD      IN ( 'R1209', 'R1728' )
		AND   A.SALES_ORD_NO     = ${salesOrdNo}
		AND   EXISTS (SELECT 'X'
                  FROM   tb_om02102 e
                  WHERE  e.cust_cd = a.rpt_cust_cd
                  AND    e.cust_ord_type_cd = a.cust_ord_type_cd
                  AND    e.cust_move_type_cd = a.cust_move_type_cd
                  AND    trim(e.cust_dcsn_trms_cd) IS NOT NULL)
	</statement>	

	
	<statement name="retrieveExcelVanningCheck">
		select count(*) excel_yn
		from	tb_om02016
		where	sales_ord_no = ${salesOrdNo}
		and		xls_ul_yn = 'Y'
	</statement>
	
	<statement name="retrieveBookingNoCheck">
		SELECT 	BOOKING_NO
		FROM	TB_OM02019
		WHERE	BOOKING_NO 	 = ${bookingNo}
		AND		SALES_ORD_NO = ${salesOrdNo}
	</statement>
	
	<statement name="retrieveSalesOrdCmptSctnInfo">
		SELECT SALES_ORD_NO
			,  SALES_ORD_CMPT_SCTN_CD
		FROM	TB_OM02001
		WHERE	SALES_ORD_NO = ${salesOrdNo}
	</statement>
	
	<!-- WMS 접속 - 출고실행오더 전송 -->
	<statement name="retrieveEoWms">
    	SELECT a.wrhs_eo_no                       as externorderkey
          	  ,a.trms_seq                         as trms_seq
              ,a.trms_sctn_cd                     as chgflag
              ,c.wm_work_pl_cd                    as whseid
              ,a.ord_mngt_exce_ofcr_id            as susr1
              ,a.ord_mngt_exce_ofcr_tel_no        as susr2
              ,a.sales_ord_no                     as sokey
              ,a.cust_ord_no                      as pokey
              ,nvl(a.move_type_cd,' ')            as type
              ,a.ord_type_cd                      as ord_type_cd
              ,a.rpt_cust_cd                      as storerkey
              ,decode(a.rpt_cust_cd,'R1209',a.cust_ord_type_cd||a.col10,'R1728',a.cust_ord_type_cd||a.col10,a.cust_ord_type_cd) as custordertypecd
              ,a.ord_req_cust_cd                  as orderstorerkey 
              ,a.rpt_cust_cd||decode(a.cust_of_cust_cd,a.rpt_cust_cd,null,a.cust_of_cust_cd) 
                                                  as consigneekey 
              ,a.cust_nm                          as c_company 
              ,a.rpt_cust_cd||decode(d.wm_work_pl_cd,null,a.arv_ar_cd,d.ul_wm_cd)
                                                  as c_address3
              ,a.arv_ar_zip_cd                    as c_zip
              ,a.arv_ar_zip_addr                  as c_address1
              ,a.arv_ar_dtl_addr                  as c_address2
              ,a.arv_ar_ofcr_nm                   as c_contact1
              ,a.arv_ar_ofcr_tel_no               as c_contact2
              ,a.aptd_req_ymd
               ||decode(greatest(substr(a.aptd_req_hm,1,2),'23'),substr(a.aptd_req_hm,1,2),'23',
                  substr(a.aptd_req_hm,1,2))
               ||decode(greatest(substr(a.aptd_req_hm,3,2),'59'),substr(a.aptd_req_hm,3,2),'59',
                  substr(a.aptd_req_hm,3,2))
                                                  as requestedshipdate
              --,decode(a.rpt_cust_cd,'P1010',b.col19, 'P1028',b.col19, a.rmk) as notes
              ,case when a.rpt_cust_cd in ('P1010', 'P1028') and a.cust_ord_type_cd != 'ZC3' then
                         a.rmk
               else
                         a.rmk
               END notes              
              ,a.cust_expr_yn                     as susr3
              ,a.cls_expr_yn                      as susr4
              ,a.lead_time_expr_yn                as susr5
              ,a.ltrm_ord_yn                      as ltrmordyn
              ,a.booking_no                       as bookingno
              ,a.bl_no                            as blno
              ,decode(a.bl_no,null,null,a.bl_no||a.bl_cust_ord_no) as blseq
              --,nvl(a.bl_tot_wgt,0)                as bltotmt
              --,nvl(a.bl_tot_admt,0)               as bltotadmt
              --,b.ord_wgt                          as bltotmt
              --,b.ord_wgt                          as bltotadmt
              --,(select sum(nvl(ord_wgt,0)) from tb_om02002 where sales_ord_no=a.sales_ord_no and line_no=b.SALES_ORD_LINE_NO) bltotmt
              --,(select sum(nvl(ord_wgt,0)) from tb_om02002 where sales_ord_no=a.sales_ord_no and line_no=b.SALES_ORD_LINE_NO) bltotadmt
              ,nvl(b.bl_tot_wgt,0)                as bltotmt
              ,nvl(b.bl_tot_admt,0)               as bltotadmt
              ,a.load_dly_yn                      as load_delay_yn
              ,a.col07                            as ord_descr
              ,a.cargo_form_cd                    as cargo_form_cd 
              ,lpad(b.line_no, 5,'0')             as orderlinenumber
              ,b.sales_ord_line_no                as externlineno
              ,b.cust_ord_line_no                 as polineno
              ,b.line_no                          as solineno
              ,trim(b.item_cd)||trim(b.bat_no)    as sku
              ,trim(b.item_cd)                    as itemcd   
              ,trim(b.bat_no)                     as batchcd
              ,nvl(b.std_ord_qty,0)               as originalqty
              ,nvl(b.std_ord_qty,0)               as openqty
              ,nvl(b.origin_ord_qty,0)            as originordqty
              ,b.ord_qty                          as item_cnt
              ,b.qty_unit_cd                      as item_cnt_uom
              ,b.ord_wgt                          as item_wgt
              ,b.wgt_unit_cd                      as item_wgt_uom 
              ,nvl(b.lot_no,' ')                  as lottable01
              ,nvl(b.prdt_req_no,' ')             as lottable03
              ,b.plant_cd                         as susr2_d
              ,b.ord_reason_cd                    as susr3_d
              ,b.cntr_no                          as cntrno                       
              --,decode(a.bl_no,null,decode(a.booking_no,null,' ',a.booking_no),a.bl_no||a.bl_cust_ord_no) as lottable02
              , case when a.cust_ord_type_cd='ZDS' THEN
                   NVL(a.CUST_ORD_NO||B.CUST_ORD_LINE_NO, ' ')
                when a.cust_ord_type_cd='ZC1' AND B.COL14 = 'Y' THEN
                   NVL(a.CUST_ORD_NO||B.CUST_ORD_LINE_NO, ' ')    
                when a.cust_ord_type_cd = 'ZTD2' THEN
                   NVL(b.col15||B.COL16, ' ')
                when a.cust_ord_type_cd = 'ZC2' THEN
                   NVL(a.CUST_ORD_NO||B.CUST_ORD_LINE_NO, ' ')  
                when a.cust_ord_type_cd = 'ZC3' AND b.col22 = 'C' THEN
                   NVL(a.CUST_ORD_NO||B.CUST_ORD_LINE_NO, ' ')
                else   
                  decode(a.rpt_cust_cd, 'R1209', ' '
                                               , decode(a.bl_no,null,decode(a.booking_no,null,' ',a.booking_no),a.bl_no||a.bl_cust_ord_no) )
                end                               as lottable02
              ,nvl(b.cntr_no,' ')                 as lottable10
              ,nvl(b.bl_unit_wgt,0)               as blmt
              ,nvl(b.bl_unit_admt,0)              as bladmt
              ,a.work_pl_cd                       as work_cntr_cd
              ,nvl(b.pcul_mn_cd,' ')              as lottable07
              ,row_number() over(partition by a.wrhs_eo_no, a.trms_seq order by a.wrhs_eo_no, a.trms_seq, b.line_no)
                                                  as ord_no_seq
              ,count(*) over(partition by a.wrhs_eo_no, a.trms_seq)
                                                  as ord_no_cnt
              ,a.TRAN_YN
              ,decode(a.rpt_cust_cd,'R1209',MACOMM_GETCD_FN('EVE_SALES_ORD_TYPE_CD', a.col10)
                                   ,'R1728',MACOMM_GETCD_FN('EVE_SALES_ORD_TYPE_CD', a.col10)
                                   ,'P1000',(select pol_cd from tb_om02003 where sales_ord_no=a.sales_ord_no)
                                   ,'P1591',(select pol_cd from tb_om02003 where sales_ord_no=a.sales_ord_no)
                                   ,'')    as c_address4
              ,decode(a.rpt_cust_cd,'R1209',b.col10,'R1728',b.col10,'')                        as unitprice
              ,a.col10        as c_email1
              ,a.col04        as c_email2
              ,a.col08        as C_PHONE2
              ,decode(a.rpt_cust_cd,'R1209',b.col05,'R1728',b.col05,'')  as notes_detail
              ,nvl(a.col20,' ')        as ordergroup           -- 포트출고에 대한  포트입고실행오더번호
              ,decode(a.rpt_cust_cd,'R1209',b.col05,'R1728',b.col05,'') labelname
              --,decode(a.rpt_cust_cd,'P1010',b.col17, 'P1028',b.col17,'') componentqty -- 절수
              , case when a.rpt_cust_cd in ('P1010', 'P1028') then
                     replace(replace(UPPER(b.col17), 'A', ''), 'B', '')
                else ''
                end  as componentqty -- 절수      
              ,decode(a.rpt_cust_cd,'P1010',b.col18, 'P1028',b.col18,'') altsku -- 재단from item
              ,decode(a.rpt_cust_cd,'P1010',substrb(b.col20, 0,50), 'P1028',substrb(b.col20, 0,50),'') componentreference -- 재단완료예정시간 
              ,decode(a.cust_ord_type_cd, 'ZC2', 'Y', decode(a.rpt_cust_cd,'P1010',b.col14, 'P1028',b.col14,''))  as subflag -- 재단여부
              ,case when a.rpt_cust_cd in ('P1010', 'P1028') then
                   --decode(a.cust_ord_type_cd, 'ZC2', decode(b.col14, 'Y', '02', '03'), decode(b.col14, 'Y', '01', ' '))
                   decode(a.cust_ord_type_cd, 'ZC3', decode(b.col22, 'C','02', ' '), 'ZC2', decode(b.col14, 'Y', '02', '03'), decode(b.col14, 'Y', '01', ' '))
               else
                   ' '
               END pickcode
              ,case when a.rpt_cust_cd in ('P1010', 'P1028') and a.cust_ord_type_cd in ('ZC3','ZC1','ZDS','ZTD2') then
                         b.col19
               else
                   ''
               END externallot  --  EXTERNALLOT
              ,case when a.rpt_cust_cd in ('P1010', 'P1028') and a.cust_ord_type_cd in ('ZC3','ZC1','ZDS','ZTD2') then
                         b.col21
               else
                   ''
               END pickinginstructions --  PICKINGINSTRUCTIONS               
              --,case when a.rpt_cust_cd in ('P1010', 'P1028') and a.cust_ord_type_cd in ('ZC3','ZC1') then
              --           b.col18
              -- else
              --     ''
              -- END altsku
              ,decode(a.ctrt_cust_cd,'R1209',a.bl_no,' ') as id
          FROM tb_om03009i a 
              ,tb_om03010i b                     
              ,tb_ma01005  c 
              ,tb_ma01005  d
              ,(SELECT wrhs_eo_no, trms_seq, trms_sctn_cd 
                  FROM tb_om03009i h
                 WHERE if_yn      in ('N','E')
                   AND if_yn      like ${ifYn}
                   AND wrhs_eo_no like ${eoNo}
                   AND trms_seq   like decode(${trmsSeq},null,'%',0,'%',${trmsSeq})
                   AND rpt_cust_cd is not null
                   AND EXISTS (SELECT 'Y'
                                 FROM tb_ma01005 
                                WHERE work_pl_cd = h.work_pl_cd
                                  AND wm_work_pl_cd is not null
                              )
                   AND (h.trms_seq   = 1
                        OR EXISTS (SELECT 'Y' 
                                     FROM tb_om03009i
                                    WHERE wrhs_eo_no = h.wrhs_eo_no
                                      AND trms_seq   = h.trms_seq - 1
                                      AND if_yn      = 'Y'
                                   )
                       )
                   AND rownum &lt;= 10
               ) e
          WHERE 1 = 1
            AND a.wrhs_eo_no   = b.wrhs_eo_no                       
            AND a.trms_seq     = b.trms_seq 
            AND b.work_pl_cd   = c.work_pl_cd
            AND a.arv_ar_cd    = d.work_pl_cd (+)
            AND a.wrhs_eo_no   = e.wrhs_eo_no                       
            AND a.trms_seq     = e.trms_seq 
            AND a.trms_sctn_cd = e.trms_sctn_cd
          ORDER BY a.wrhs_eo_no, a.trms_seq, b.line_no
	</statement>

	<statement name="retrieveEoWmsInh">
    	SELECT a.wrhs_eo_no                       as externorderkey
          	  ,a.trms_seq                         as trms_seq
              ,a.trms_sctn_cd                     as chgflag
              ,c.wm_work_pl_cd                    as whseid
              ,a.ord_mngt_exce_ofcr_id            as susr1
              ,a.ord_mngt_exce_ofcr_tel_no        as susr2
              ,a.sales_ord_no                     as sokey
              ,a.cust_ord_no                      as pokey
              ,nvl(a.move_type_cd,' ')            as type
              ,a.ord_type_cd                      as ord_type_cd
              ,a.rpt_cust_cd                      as storerkey
              ,decode(a.rpt_cust_cd,'R1209',a.cust_ord_type_cd||a.col10,'R1728',a.cust_ord_type_cd||a.col10,a.cust_ord_type_cd) as custordertypecd
              ,a.ord_req_cust_cd                  as orderstorerkey 
              ,a.rpt_cust_cd||decode(a.cust_of_cust_cd,a.rpt_cust_cd,null,a.cust_of_cust_cd) 
                                                  as consigneekey 
              ,a.cust_nm                          as c_company 
              ,a.rpt_cust_cd||decode(d.wm_work_pl_cd,null,a.arv_ar_cd,d.ul_wm_cd)
                                                  as c_address3
              ,a.arv_ar_zip_cd                    as c_zip
              ,a.arv_ar_zip_addr                  as c_address1
              ,case when a.rpt_cust_cd = 'P1200' and a.cust_ord_type_cd in ('ZD09', 'ZF06') then
                   DECODE(a.cust_ord_type_cd, 'ZD09', a.col09, 'S')
               else
                   a.arv_ar_dtl_addr
               end as c_address2
              ,a.arv_ar_ofcr_nm                   as c_contact1
              ,a.arv_ar_ofcr_tel_no               as c_contact2
              ,a.aptd_req_ymd
              -- ||decode(greatest(substr(a.aptd_req_hm,1,2),'23'),substr(a.aptd_req_hm,1,2),'23',
              --    substr(a.aptd_req_hm,1,2))
              -- ||decode(greatest(substr(a.aptd_req_hm,3,2),'59'),substr(a.aptd_req_hm,3,2),'59',
              --    substr(a.aptd_req_hm,3,2))
                                                  as requestedshipdate
              --,decode(a.rpt_cust_cd,'P1010',b.col19, 'P1028',b.col19, a.rmk) as notes
              ,case when a.rpt_cust_cd in ('P1010', 'P1028') and a.cust_ord_type_cd != 'ZC3' then
                         --a.rmk
                         UFN_HPL_REMARK(a.rpt_cust_cd, a.cust_ord_no, b.line_no, 'N')
               else
                         a.rmk
               END notes              
              ,a.cust_expr_yn                     as susr3
              ,a.cls_expr_yn                      as susr4
              ,a.lead_time_expr_yn                as susr5
              ,a.ltrm_ord_yn                      as ltrmordyn
              ,a.booking_no                       as bookingno
              ,a.bl_no                            as blno
              ,decode(a.bl_no,null,null,a.bl_no||a.bl_cust_ord_no) as blseq
              --,nvl(a.bl_tot_wgt,0)                as bltotmt
              --,nvl(a.bl_tot_admt,0)               as bltotadmt
              --,b.ord_wgt                          as bltotmt
              --,b.ord_wgt                          as bltotadmt
              --,(select sum(nvl(ord_wgt,0)) from tb_om02002 where sales_ord_no=a.sales_ord_no and line_no=b.SALES_ORD_LINE_NO) bltotmt
              --,(select sum(nvl(ord_wgt,0)) from tb_om02002 where sales_ord_no=a.sales_ord_no and line_no=b.SALES_ORD_LINE_NO) bltotadmt
              ,nvl(b.bl_tot_wgt,0)                as bltotmt
              ,nvl(b.bl_tot_admt,0)               as bltotadmt
              ,a.load_dly_yn                      as load_delay_yn
              ,a.col07                            as ord_descr
              ,a.cargo_form_cd                    as cargo_form_cd 
              ,lpad(b.line_no, 5,'0')             as orderlinenumber
              ,b.sales_ord_line_no                as externlineno
              ,b.cust_ord_line_no                 as polineno
              ,b.line_no                          as solineno
              ,trim(b.item_cd)||trim(b.bat_no)    as sku
              ,trim(b.item_cd)                    as itemcd   
              ,trim(b.bat_no)                     as batchcd
              ,nvl(b.std_ord_qty,0)               as originalqty
              ,nvl(b.std_ord_qty,0)               as openqty
              ,nvl(b.origin_ord_qty,0)            as originordqty
              ,b.ord_qty                          as item_cnt
              ,b.qty_unit_cd                      as item_cnt_uom
              ,b.ord_wgt                          as item_wgt
              ,b.wgt_unit_cd                      as item_wgt_uom 
              ,nvl(b.lot_no,' ')                  as lottable01
              ,decode(a.cust_ord_type_cd , 'DOPX', a.cust_ord_no, nvl(b.prdt_req_no,' ') )   as lottable03
              ,b.plant_cd                         as susr2_d
              ,b.ord_reason_cd                    as susr3_d
              ,b.cntr_no                          as cntrno                       
              --,decode(a.bl_no,null,decode(a.booking_no,null,' ',a.booking_no),a.bl_no||a.bl_cust_ord_no) as lottable02
              , case when a.cust_ord_type_cd='ZDS' THEN
                   NVL(a.CUST_ORD_NO||B.CUST_ORD_LINE_NO, ' ')
                when a.cust_ord_type_cd='ZC1' AND B.COL14 = 'Y' THEN
                   NVL(a.CUST_ORD_NO||B.CUST_ORD_LINE_NO, ' ')    
                when a.cust_ord_type_cd = 'ZTD2' THEN
                   NVL(b.col15||B.COL16, ' ')
                when a.cust_ord_type_cd = 'ZC2' THEN
                   NVL(a.CUST_ORD_NO||B.CUST_ORD_LINE_NO, ' ')  
                when a.cust_ord_type_cd = 'ZC3' AND b.col22 = 'C' THEN
                   NVL(a.CUST_ORD_NO||B.CUST_ORD_LINE_NO, ' ')
                else   
                  decode(a.rpt_cust_cd, 'R1209', ' '
                                               , decode(a.bl_no,null,decode(a.booking_no,null,' ',a.booking_no),a.bl_no||a.bl_cust_ord_no)) 
                end                               as lottable02
              ,nvl(b.cntr_no,' ')                 as lottable10
              ,nvl(b.bl_unit_wgt,0)               as blmt
              ,nvl(b.bl_unit_admt,0)              as bladmt
              ,a.work_pl_cd                       as work_cntr_cd
              ,decode(a.rpt_cust_cd , 'R1209', decode(a.col29, 'Y', a.col30, ' '), ' ') as lottable06
              --,nvl(b.pcul_mn_cd,' ')              as lottable07
              ,decode(a.rpt_cust_cd, 'P1200', decode(a.cust_ord_type_cd, 'ZD09', a.cust_ord_no||b.cust_ord_line_no, nvl(b.pcul_mn_cd,' ')), nvl(b.pcul_mn_cd,' ')) as lottable07
              ,row_number() over(partition by a.wrhs_eo_no, a.trms_seq order by a.wrhs_eo_no, a.trms_seq, b.line_no)
                                                  as ord_no_seq
              ,count(*) over(partition by a.wrhs_eo_no, a.trms_seq)
                                                  as ord_no_cnt
              ,a.TRAN_YN
              ,decode(a.rpt_cust_cd,'R1209',MACOMM_GETCD_FN('EVE_SALES_ORD_TYPE_CD', a.col10)
                                   ,'R1728',MACOMM_GETCD_FN('EVE_SALES_ORD_TYPE_CD', a.col10)
                                   ,'P1000',(select pol_cd from tb_om02003 where sales_ord_no=a.sales_ord_no)
                                   ,'P1591',(select pol_cd from tb_om02003 where sales_ord_no=a.sales_ord_no)
                                   ,'')    as c_address4
              ,decode(a.rpt_cust_cd,'R1209',b.col10,'R1728',b.col10,'')                        as unitprice
              ,a.col10        as c_email1
              ,a.col04        as c_email2
              ,a.col08        as C_PHONE2
              ,case when a.rpt_cust_cd in ('P1000', 'P1591' ,'P1200') then              
                  UFN_HPL_REMARK(a.rpt_cust_cd, a.cust_ord_no, b.line_no, 'N')
               else
                  decode(a.rpt_cust_cd,'R1209',b.col05,'R1728',b.col05,'')   
               end as notes_detail
              ,nvl(a.col20,' ')        as ordergroup           -- 포트출고에 대한  포트입고실행오더번호
              ,decode(a.rpt_cust_cd,'R1209',b.col05,'R1728',b.col05,'') labelname
              --,decode(a.rpt_cust_cd,'P1010',b.col17, 'P1028',b.col17,'') componentqty -- 절수
              , case when a.rpt_cust_cd in ('P1010', 'P1028') then
                     replace(replace(UPPER(b.col17), 'A', ''), 'B', '')
                else ''
                end  as componentqty -- 절수      
              ,decode(a.rpt_cust_cd,'P1010',b.col18, 'P1028',b.col18,'') altsku -- 재단from item
              ,decode(a.rpt_cust_cd,'P1010',substrb(b.col20, 0,50), 'P1028',substrb(b.col20, 0,50),'') componentreference -- 재단완료예정시간 
              ,decode(a.cust_ord_type_cd, 'ZC2', 'Y', decode(a.rpt_cust_cd,'P1010',b.col14, 'P1028',b.col14,''))  as subflag -- 재단여부
              ,case when a.rpt_cust_cd in ('P1010', 'P1028') then
                   --decode(a.cust_ord_type_cd, 'ZC2', decode(b.col14, 'Y', '02', '03'), decode(b.col14, 'Y', '01', ' '))
                   decode(a.cust_ord_type_cd, 'ZC3', decode(b.col22, 'C','02', ' '), 'ZC2', decode(b.col14, 'Y', '02', '03'), decode(b.col14, 'Y', '01', ' '))
               else
                   ' '
               END pickcode
              ,case when a.rpt_cust_cd in ('P1010', 'P1028') and a.cust_ord_type_cd in ('ZC3','ZC1','ZDS','ZTD2') then
                         b.col19
               else
                   ''
               END externallot  --  EXTERNALLOT
              ,case when a.rpt_cust_cd in ('P1010', 'P1028') and a.cust_ord_type_cd in ('ZC3','ZC1','ZDS','ZTD2') then
                         b.col21
               else
                   ''
               END pickinginstructions --  PICKINGINSTRUCTIONS               
              --,case when a.rpt_cust_cd in ('P1010', 'P1028') and a.cust_ord_type_cd in ('ZC3','ZC1') then
              --           b.col18
              -- else
              --     ''
              -- END altsku
              ,decode(a.ctrt_cust_cd,'R1209',a.bl_no,' ') as id
              , decode(a.rpt_cust_cd,'R1209', a.col28, '') as incoterm
              , case when a.rpt_cust_cd = 'R1209'  then
                    case when NVL(A.COL29, 'N') = 'Y' then
                        decode(a.col28, '1-08', a.col27, '2-02', a.col27, a.col30)
                    else
                        decode(a.col28, '1-08', a.col27, '2-02', a.col27, '')
                    end 
                else 
                    ''
                end as pmtterm
          FROM tb_om03009i a 
              ,tb_om03010i b                     
              ,tb_ma01005  c 
              ,tb_ma01005  d
              ,(SELECT wrhs_eo_no, trms_seq, trms_sctn_cd 
                  FROM tb_om03009i h
                 WHERE if_yn      in ('N','E')
                   AND if_yn      like ${ifYn}
                   AND wrhs_eo_no like ${eoNo}
                   AND trms_seq   like decode(${trmsSeq},null,'%',0,'%',${trmsSeq})
                   AND rpt_cust_cd is not null
                   AND EXISTS (SELECT 'Y'
                                 FROM tb_ma01005 
                                WHERE work_pl_cd = h.work_pl_cd
                                  AND wm_work_pl_cd is not null
                              )
                   AND (h.trms_seq   = 1
                        OR EXISTS (SELECT 'Y' 
                                     FROM tb_om03009i
                                    WHERE wrhs_eo_no = h.wrhs_eo_no
                                      AND trms_seq   = h.trms_seq - 1
                                      AND if_yn      = 'Y'
                                   )
                       )
                   AND rownum &lt;= 10
               ) e
          WHERE 1 = 1
            AND a.wrhs_eo_no   = b.wrhs_eo_no                       
            AND a.trms_seq     = b.trms_seq 
            AND b.work_pl_cd   = c.work_pl_cd
            AND a.arv_ar_cd    = d.work_pl_cd (+)
            AND a.wrhs_eo_no   = e.wrhs_eo_no                       
            AND a.trms_seq     = e.trms_seq 
            AND a.trms_sctn_cd = e.trms_sctn_cd
          ORDER BY a.wrhs_eo_no, a.trms_seq, b.line_no
	</statement>

	<!-- WMS 접속 - 출고실행오더 전송 : Simple -->
	<statement name="retrieveSimpleEoWms">
        SELECT a.wrhs_eo_no                       as externorderkey
              ,a.trms_seq                         as trms_seq
              ,a.trms_sctn_cd                     as chgflag
              ,'WH14'                             as whseid
              ,a.ord_mngt_exce_ofcr_id            as susr1
              ,a.ord_mngt_exce_ofcr_tel_no        as susr2
              ,a.sales_ord_no                     as sokey
              ,a.cust_ord_no                      as pokey
              ,nvl(a.move_type_cd,' ')            as type
              ,a.ord_type_cd                      as ord_type_cd
              ,a.rpt_cust_cd                      as storerkey
              ,decode(a.rpt_cust_cd,'R1209',a.cust_ord_type_cd||a.col10,'R1728',a.cust_ord_type_cd||a.col10,a.cust_ord_type_cd) as custordertypecd
              ,a.ord_req_cust_cd                  as orderstorerkey 
              ,a.rpt_cust_cd||decode(a.cust_of_cust_cd,a.rpt_cust_cd,null,a.cust_of_cust_cd) 
                                                  as consigneekey 
              ,a.cust_nm                          as c_company 
              ,a.rpt_cust_cd||a.arv_ar_cd
                                                  as c_address3
              ,a.arv_ar_zip_cd                    as c_zip
              ,a.arv_ar_zip_addr                  as c_address1
              ,a.arv_ar_dtl_addr                  as c_address2
              ,a.arv_ar_ofcr_nm                   as c_contact1
              ,a.arv_ar_ofcr_tel_no               as c_contact2
              ,a.aptd_req_ymd
               ||decode(greatest(substr(a.aptd_req_hm,1,2),'23'),substr(a.aptd_req_hm,1,2),'23',
                  substr(a.aptd_req_hm,1,2))
               ||decode(greatest(substr(a.aptd_req_hm,3,2),'59'),substr(a.aptd_req_hm,3,2),'59',
                  substr(a.aptd_req_hm,3,2))
                                                  as requestedshipdate
              ,a.rmk                              as notes
              ,a.cust_expr_yn                     as susr3
              ,a.cls_expr_yn                      as susr4
              ,a.lead_time_expr_yn                as susr5
              ,a.ltrm_ord_yn                      as ltrmordyn
              ,a.booking_no                       as bookingno
              ,a.bl_no                            as blno
              ,decode(a.bl_no,null,null,a.bl_no||a.bl_cust_ord_no) as blseq
              ,nvl(a.bl_tot_wgt,0)                as bltotmt
              ,nvl(a.bl_tot_admt,0)               as bltotadmt
              ,a.load_dly_yn                      as load_delay_yn
              ,a.col07                            as ord_descr
              ,a.cargo_form_cd                    as cargo_form_cd 
              ,lpad(b.line_no, 5,'0')             as orderlinenumber
              ,b.sales_ord_line_no                as externlineno
              ,b.cust_ord_line_no                 as polineno
              ,b.line_no                          as solineno
              ,trim(b.item_cd)||trim(b.bat_no)    as sku
              ,trim(b.item_cd)                    as itemcd   
              ,trim(b.bat_no)                     as batchcd
              ,nvl(b.std_ord_qty,0)               as originalqty
              ,nvl(b.std_ord_qty,0)               as openqty
              ,nvl(b.origin_ord_qty,0)            as originordqty
              ,b.ord_qty                          as item_cnt
              ,b.qty_unit_cd                      as item_cnt_uom
              ,b.ord_wgt                          as item_wgt
              ,b.wgt_unit_cd                      as item_wgt_uom 
              ,nvl(b.lot_no,' ')                  as lottable01
              ,nvl(b.prdt_req_no,' ')             as lottable03
              ,b.plant_cd                         as susr2_d
              ,b.ord_reason_cd                    as susr3_d
              ,b.cntr_no                          as cntrno                       
              ,decode(a.rpt_cust_cd, 'R1209', ' '
                                            , decode(a.bl_no,null,decode(a.booking_no,null,' ',a.booking_no),a.bl_no||a.bl_cust_ord_no))
                                                  as lottable02
              ,nvl(b.cntr_no,' ')                 as lottable10
              ,nvl(b.bl_unit_wgt,0)               as blmt
              ,nvl(b.bl_unit_admt,0)              as bladmt
              ,a.work_pl_cd                       as work_cntr_cd
              ,nvl(b.pcul_mn_cd,' ')              as lottable07
              ,row_number() over(partition by a.wrhs_eo_no, a.trms_seq order by a.wrhs_eo_no, a.trms_seq, b.line_no)
                                                  as ord_no_seq
              ,count(*) over(partition by a.wrhs_eo_no, a.trms_seq)
                                                  as ord_no_cnt
              ,a.TRAN_YN
              ,decode(a.rpt_cust_cd,'R1209',MACOMM_GETCD_FN('EVE_SALES_ORD_TYPE_CD', a.col10),'R1728',MACOMM_GETCD_FN('EVE_SALES_ORD_TYPE_CD', a.col10),'')    as c_address4
              ,decode(a.rpt_cust_cd,'R1209',b.col10,'R1728',b.col10,'')                        as unitprice
              ,a.col04        as c_email2
              ,a.col08        as C_PHONE2
              ,b.col05        as notes_detail
              ,decode(a.rpt_cust_cd,'R1209',b.col05,'R1728',b.col05,'') labelname
              ,decode(a.ctrt_cust_cd,'R1209',a.bl_no,' ') as id
          FROM tb_om03009i a 
              ,tb_om03010i b                     
              ,(SELECT wrhs_eo_no, trms_seq, trms_sctn_cd 
                  FROM tb_om03009i h
                 WHERE if_yn      in ('N','E')
                   AND if_yn      like ${ifYn}
                   AND wrhs_eo_no like ${eoNo}
                   AND trms_seq   like decode(${trmsSeq},null,'%',0,'%',${trmsSeq})
                   AND rownum &lt;= 10
                ) e
          WHERE a.wrhs_eo_no   = b.wrhs_eo_no                       
            AND a.trms_seq     = b.trms_seq 
            AND a.wrhs_eo_no   = e.wrhs_eo_no                       
            AND a.trms_seq     = e.trms_seq 
            AND a.trms_sctn_cd = e.trms_sctn_cd
          ORDER BY a.wrhs_eo_no, a.trms_seq, b.line_no
	</statement>

	<!-- Lepsilon 접속 - 출고실행오더 전송 -->
	<statement name="retrieveEoLepsilon">
        SELECT a.wrhs_eo_no                       as eo_no   -- externorderkey
              ,a.trms_seq                         as trms_seq
              ,a.trms_sctn_cd                     as chgflag 
              ,c.wm_work_pl_cd                    as wcode   -- whseid
              ,a.ord_mngt_exce_ofcr_id            as susr1
              ,a.ord_mngt_exce_ofcr_tel_no        as susr2
              ,a.sales_ord_no                     as sales_ord_no -- sokey   
              ,a.cust_ord_no                      as REFERENCENO  -- pokey
              ,nvl(a.move_type_cd,' ')            as type
              ,a.ord_type_cd                      as ord_type_cd
              ,a.rpt_cust_cd                      as OWNER        -- storerkey
              ,decode(a.rpt_cust_cd,'R1209',a.cust_ord_type_cd||a.col10,'R1728',a.cust_ord_type_cd||a.col10,a.cust_ord_type_cd) as custordertypecd
              ,a.ord_req_cust_cd                  as orderstorerkey 
              ,decode(a.rpt_cust_cd,'R1732',a.col11
                                   ,'R1400',a.cust_of_cust_cd
                                   ,'R2078',a.cust_of_cust_cd
                                   ,'R2116',a.cust_of_cust_cd
                                   ,'R2160',a.cust_of_cust_cd
                                   ,'R2400',a.cust_of_cust_cd
                                   ,'R2411',a.cust_of_cust_cd
                                   ,'R2432',a.cust_of_cust_cd
                                   ,'R2433',a.cust_of_cust_cd
                                   ,'R2443',a.cust_of_cust_cd
                                   ,'R2451',a.cust_of_cust_cd
                                   ,'R8018',a.cust_of_cust_cd
                                   ,'R2455',a.cust_of_cust_cd
                                   ,'R1866',a.cust_of_cust_cd
                                           ,a.rpt_cust_cd||decode(a.cust_of_cust_cd,a.rpt_cust_cd,null,a.cust_of_cust_cd) 
                                           )  as BUYERCODE  -- consigneekey 
              ,decode(a.rpt_cust_cd,'R1732',a.col01
                                   ,'R1744',a.col01
                                   ,'R1278',a.col01
                                   ,'R1801',a.col01
                                   ,'R1400',nvl(a.arv_ar_ofcr_nm,a.col01)
                                   ,'R2001',a.col01
                                   ,'R2078',a.col01
                                   ,'R2116',a.col01
                                   ,'R2160',a.col01
                                   ,'R2400',a.col01
                                   ,'R2411',a.col01
                                   ,'R2432',a.col01
                                   ,'R2433',a.col01
                                   ,'R2443',a.col01
                                   ,'R2451',a.col01
                                   ,'R1866',a.col01
                                   ,'R8018',a.cust_nm
                                   ,'')                  as consigneename
              ,decode(a.rpt_cust_cd,'E1181',a.cust_nm
                                   ,'R1732',a.cust_nm
                                   ,'R1744',a.cust_nm
                                   ,'R1206',a.cust_nm
                                   ,'R2443',a.cust_nm
                                   ,'R2451',a.cust_nm
                                   ,'R8018',a.cust_nm
                                   ,'R1866',a.cust_nm
                                   ,'E8001',a.cust_nm
                                           ,a.arv_ar_ofcr_nm)  as SHIPTONAME -- c_company 
              ,decode(a.rpt_cust_cd,'R1206',a.arv_ar_cd
                                   ,'E1181',a.arv_ar_cd
                                   ,'R1732',a.arv_ar_cd
                                   ,'R1744',a.cust_of_cust_cd
                                   ,'E8001',a.arv_ar_cd
                                   ,'R8001',a.arv_ar_cd
                                   ,'R8002',a.arv_ar_cd
                                   ,'R8003',a.arv_ar_cd
                                   ,'R2078',a.arv_ar_cd
                                   ,'R2116',a.arv_ar_cd
                                   ,'E1383',a.arv_ar_cd
                                   ,'R2160',a.arv_ar_cd
                                   ,'R2400',a.arv_ar_cd
                                   ,'R2411',a.arv_ar_cd
                                   ,'R2432',a.arv_ar_cd
                                   ,'R2433',a.arv_ar_cd
                                   ,'R2443',a.arv_ar_cd
                                   ,'R2451',a.arv_ar_cd
                                   ,'R8018',a.arv_ar_cd
                                   ,'R2455',a.arv_ar_cd
                                   ,'R1866',a.arv_ar_cd
                                   ,'E1400',a.arv_ar_cd
                                           ,a.rpt_cust_cd||decode(d.wm_work_pl_cd,null,a.arv_ar_cd,d.ul_wm_cd))
                                              as SHIPTOCODE  -- c_address3
              ,a.arv_ar_zip_cd                    as SHIPTOZIP   -- c_zip
              ,a.arv_ar_zip_addr                  as SHIPTOADDR1 -- c_address1
              ,a.arv_ar_dtl_addr                  as SHIPTOADDR2 -- c_address2
              ,decode(a.rpt_cust_cd,'R1400',a.col02
                                   ,'R1206',a.col02
                                   ,'')           as SHIPTOADDR3 -- c_contact1
              ,a.arv_ar_ofcr_tel_no               as SHIPTOFAX   -- c_contact2  
              ,decode(a.rpt_cust_cd,'R1400',a.arv_ar_zip_addr||' '||a.arv_ar_dtl_addr
          					       ,'R1278',a.arv_ar_zip_addr||' '||a.arv_ar_dtl_addr
          					       ,'R1801',a.arv_ar_zip_addr||' '||a.arv_ar_dtl_addr
          					       ,'R8001',a.arv_ar_zip_addr||' '||a.arv_ar_dtl_addr
          					       ,'R8002',a.arv_ar_zip_addr||' '||a.arv_ar_dtl_addr
          					       ,'R8003',a.arv_ar_zip_addr||' '||a.arv_ar_dtl_addr
          					       ,'R2001',a.arv_ar_zip_addr||' '||a.arv_ar_dtl_addr
          					       ,'R2078',a.arv_ar_zip_addr||' '||a.arv_ar_dtl_addr
          					       ,'R2116',a.arv_ar_zip_addr||' '||a.arv_ar_dtl_addr
          					       ,'R2160',a.arv_ar_zip_addr||' '||a.arv_ar_dtl_addr
          					       ,'R2400',a.arv_ar_zip_addr||' '||a.arv_ar_dtl_addr
          					       ,'R2411',a.arv_ar_zip_addr||' '||a.arv_ar_dtl_addr
          					       ,'R2432',a.arv_ar_zip_addr||' '||a.arv_ar_dtl_addr
          					       ,'R2433',a.arv_ar_zip_addr||' '||a.arv_ar_dtl_addr
          					       ,'R2443',a.arv_ar_zip_addr||' '||a.arv_ar_dtl_addr
          					       ,'R8018',a.arv_ar_zip_addr||' '||a.arv_ar_dtl_addr
          					       ,'R2451',a.col19
          					       ,'R2455',a.arv_ar_zip_addr||' '||a.arv_ar_dtl_addr
          					       ,'R1866',a.arv_ar_zip_addr||' '||a.arv_ar_dtl_addr
                                           ,a.arv_ar_zip_addr)                  as consigneeaddr1
              ,decode(a.rpt_cust_cd,'R1732',nvl(a.arv_ar_ofcr_nm,a.col01)
                                   ,'R1744',nvl(a.arv_ar_ofcr_nm,a.col01)
                                   ,'R1278',nvl(a.arv_ar_ofcr_nm,a.col01)
                                   ,'R1801',nvl(a.arv_ar_ofcr_nm,a.col01)
                                   ,'R1400',nvl(a.arv_ar_ofcr_nm,a.col01)
                                   ,'R2001',nvl(a.arv_ar_ofcr_nm,a.col01)
                                   ,'R2078',nvl(a.arv_ar_ofcr_nm,a.col01)
                                   ,'R2116',nvl(a.arv_ar_ofcr_nm,a.col01)
                                   ,'R2160',nvl(a.arv_ar_ofcr_nm,a.col01)
                                   ,'R2400',nvl(a.arv_ar_ofcr_nm,a.col01)
                                   ,'R2411',nvl(a.arv_ar_ofcr_nm,a.col01)
                                   ,'R2432',nvl(a.arv_ar_ofcr_nm,a.col01)
                                   ,'R2433',nvl(a.arv_ar_ofcr_nm,a.col01)
                                   ,'R2443',nvl(a.arv_ar_ofcr_nm,a.col01)
                                   ,'R8018',nvl(a.arv_ar_ofcr_nm,a.col01)
                                   ,'R2451',a.col18
                                   ,'R2455',nvl(a.arv_ar_ofcr_nm,a.col01)
                                   ,'R1866',nvl(a.arv_ar_ofcr_nm,a.col01)
                                           ,a.arv_ar_ofcr_nm)                  as consigneeaofcr                                       
--            ,decode(a.rpt_cust_cd,'R2451',a.col18
--                                           ,a.arv_ar_ofcr_nm)                   as consigneeaofcr
              ,decode(a.rpt_cust_cd,'R2451',a.col12
                                           ,a.arv_ar_ofcr_tel_no)               as consigneetel
              ,a.col04                            as as_Order
              ,a.col02                            as pre_Sale
              ,a.col03                            as truckno
              ,decode(a.rpt_cust_cd,'R2411','','R2432','','R2433','','R2443','','R2451','','R8018','','R2455','',b.col01) as grs_Price
              ,decode(a.rpt_cust_cd,'R2411','','R2432','','R2433','','R2443','','R2451','','R8018','','R2455','',b.col02) as vat_Price
              ,decode(a.rpt_cust_cd,'R2411','','R2432','','R2433','','R2443','','R2451','','R2455','',b.col03) as net_Price          
              ,a.aptd_req_ymd
               ||decode(greatest(substr(a.aptd_req_hm,1,2),'23'),substr(a.aptd_req_hm,1,2),'23',
                  substr(a.aptd_req_hm,1,2))
               ||decode(greatest(substr(a.aptd_req_hm,3,2),'59'),substr(a.aptd_req_hm,3,2),'59',
                  substr(a.aptd_req_hm,3,2))
                                              as DELIVERYDATE -- requestedshipdate
              ,a.rmk                              as DESCR        -- notes
              ,a.cust_expr_yn                     as susr3
              ,a.cls_expr_yn                      as susr4
              ,a.lead_time_expr_yn                as susr5
              ,a.ltrm_ord_yn                      as ltrmordyn
              ,a.booking_no                       as bookingno
              ,a.bl_no                            as blno
              ,decode(a.bl_no,null,null,a.bl_no||a.bl_cust_ord_no) as blseq
              ,nvl(a.bl_tot_wgt,0)                as bltotmt
              ,nvl(a.bl_tot_admt,0)               as bltotadmt
              ,a.load_dly_yn                      as load_delay_yn
              ,a.col07                            as ord_descr
              ,a.cargo_form_cd                    as cargo_form_cd 
              ,lpad(b.line_no, 5,'0')             as LINENO         --   orderlinenumber
              ,b.sales_ord_line_no                as SALES_ORD_LINE_NO  -- solineno
              ,b.cust_ord_line_no                 as CUST_ORD_LINE_NO   -- polineno
              ,b.line_no                          as EO_LINE_NO     --   externlineno
              ,trim(b.item_cd)||trim(b.bat_no)    as STOCK              -- sku
              ,trim(b.item_cd)                    as itemcd   
              ,trim(b.bat_no)                     as batchcd
      --      ,nvl(b.std_ord_qty,0)               as QTY                -- originalqty
      --      ,decode(nvl(b.bl_unit_admt,0),0,nvl(b.std_ord_qty,0),b.bl_unit_admt) as qty
              ,case when (a.rpt_cust_cd='R1400' or a.rpt_cust_cd='R2078' or a.rpt_cust_cd='R2160' or a.rpt_cust_cd='R2443') 
                         and (a.cust_ord_type_cd='CN' or a.cust_ord_type_cd='DCN') then
                         nvl(b.std_ord_qty,0)
                    when (a.rpt_cust_cd='R2443' or a.rpt_cust_cd='R8018') and b.qty_unit_cd='EA' then  b.ord_qty     
                    else decode(nvl(b.bl_unit_admt,0),0,nvl(b.std_ord_qty,0),b.bl_unit_admt) 
               end as qty      
              ,nvl(b.std_ord_qty,0)               as openqty
              ,nvl(b.origin_ord_qty,0)            as originordqty
      --      ,b.ord_qty                          as item_cnt
              ,case when (a.rpt_cust_cd='R2443' or a.rpt_cust_cd='R8018') and b.qty_unit_cd='EA' then  nvl(b.bl_unit_admt,0)
                    else b.ord_qty
                end as item_cnt
      --      ,b.qty_unit_cd                      as item_cnt_uom
              ,case when (a.rpt_cust_cd='R2443' or a.rpt_cust_cd='R8018') and b.qty_unit_cd='EA' then
                         (select spec_unit_cd from tb_ma02010 where ptn_cd=a.rpt_cust_cd and item_cd=b.item_cd)
                    else b.qty_unit_cd
                end as item_cnt_uom
              ,b.ord_wgt                          as item_wgt
              ,b.wgt_unit_cd                      as item_wgt_uom 
              ,decode(a.rpt_cust_cd,'E8001',nvl(b.lot_no,'')
                                           ,nvl(b.lot_no,''))        as LOTABLE1   -- lottable01        
       --     ,decode(a.rpt_cust_cd,'R1206',b.col02,b.prdt_req_no) as LOTABLE3   -- lottable03  
       	      ,b.prdt_req_no                      as LOTABLE3         -- lottable03     
              ,b.plant_cd                         as susr2_d
              ,b.ord_reason_cd                    as susr3_d
              ,b.cntr_no                          as cntrno                       
              ,decode(a.rpt_cust_cd,'R1206',a.col05
                                   ,decode(a.bl_no,null,decode(a.booking_no,null,'',a.booking_no),a.bl_no||a.bl_cust_ord_no))
                                                  as LOTABLE2           -- lottable02
              ,nvl(b.cntr_no,'')                  as lottable10
              ,nvl(b.bl_unit_wgt,0)               as blmt
              ,nvl(b.bl_unit_admt,0)              as bladmt
              ,a.work_pl_cd                       as work_cntr_cd
              ,nvl(b.pcul_mn_cd,'')               as lottable07
              ,row_number() over(partition by a.wrhs_eo_no, a.trms_seq order by a.wrhs_eo_no, a.trms_seq, b.line_no)
                                                  as ord_no_seq
              ,count(*) over(partition by a.wrhs_eo_no, a.trms_seq)
                                                  as ord_no_cnt
              ,a.TRAN_YN
              ,decode(a.rpt_cust_cd,'R1209',MACOMM_GETCD_FN('EVE_SALES_ORD_TYPE_CD', a.col10),'R1728',MACOMM_GETCD_FN('EVE_SALES_ORD_TYPE_CD', a.col10),'')    as c_address4
              ,decode(a.rpt_cust_cd,'R1209',b.col10,'R1728',b.col10,'')                        as unitprice
              ,decode(a.rpt_cust_cd,'R1206',a.col07
                                   ,'R1400',a.col07
                                   ,'R1278',a.col07
                                   ,'R1801',a.col07
                                   ,'R2001',a.col07
                                   ,'R2116',a.col07
                                   ,'R2400',a.col07
                                   ,'R2411',a.col07
                                   ,'R2432',a.col07
                                   ,'R2433',a.col07
                                   ,'R2443',a.col07
                                   ,'R8018',a.col07
                                   ,'') departurecd
              ,decode(a.rpt_cust_cd,'R1206',a.col08
                                   ,'R1400',a.col08
                                   ,'R1278',a.col08
                                   ,'R1801',a.col08
                                   ,'R2001',a.col08
                                   ,'R2116',a.col08
                                   ,'R2400',a.col08
                                   ,'R2411',a.col08
                                   ,'R2432',a.col08
                                   ,'R2433',a.col08
                                   ,'R2443',a.col08
                                   ,'R8018',a.col08
                                   ,'') loadid
              ,decode(a.rpt_cust_cd,'R1206',a.col09
                                   ,'E1181',a.col09
                                   ,'R1400',a.col09
                                   ,'R1278',a.col09
                                   ,'R1801',a.col09
                                   ,'R2001',a.col09
                                   ,'R2116',a.col09
                                   ,'R2400',a.col09
                                   ,'R2411',a.col09
                                   ,'R2432',a.col09
                                   ,'R2433',a.col09
                                   ,'R2443',a.col09
                                   ,'R8018',a.col09
                                   ,'') shiptotel
              ,decode(a.rpt_cust_cd,'R1206',a.col10
                                   ,'R1400',a.col10
                                   ,'R1278',a.col10
                                   ,'R1801',a.col10
                                   ,'R2001',a.col10
                                   ,'R2116',a.col10
                                   ,'R2400',a.col10
                                   ,'R2411',a.col10
                                   ,'R2432',a.col10
                                   ,'R2433',a.col10
                                   ,'R2443',a.col10
                                   ,'R8018',a.col10
                                   ,'') billtoaddr1
              ,decode(a.rpt_cust_cd,'R1206',a.col11
                                   ,'R1400',a.col11
                                   ,'R1278',a.col11
                                   ,'R1801',a.col11
                                   ,'R2001',a.col11
                                   ,'R2116',a.col11
                                   ,'R2400',a.col11
                                   ,'R2411',a.col11
                                   ,'R2432',a.col11
                                   ,'R2433',a.col11
                                   ,'R2443',a.col11
                                   ,'R8018',a.col11
                                   ,'') billtoaddr2
              ,decode(a.rpt_cust_cd,'R1732',a.col05,'') billtoname
              ,decode(a.rpt_cust_cd,'R1206',a.col04,'') route
              ,decode(a.rpt_cust_cd,'R1206',b.col01,'') validdate
              ,decode(a.rpt_cust_cd,'R1206',b.col03,'') as LOTABLE4
              ,decode(a.rpt_cust_cd,'R1732',b.col12
                                   ,b.col11) remark
              ,decode(a.rpt_cust_cd,'R1732',b.col12
                                   ,'') cust_ref_no_dt                     
              ,b.ord_reason_cd                    as ord_reason_cd
              ,decode(a.rpt_cust_cd,'R1732',a.col06,'') req_Ofcr
              ,decode(a.rpt_cust_cd,'R1732',a.col07,'') req_Div
              ,decode(a.rpt_cust_cd,'R1278',a.col03
                                   ,'R1801',a.col03
                                   ,'R1400',a.col03
                                   ,'R2001',a.col03
                                   ,'R2116',a.col03
                                   ,'R2400',a.col03
                                   ,'R2411',a.col03
                                   ,'R2432',a.col03
                                   ,'R2433',a.col03
                                   ,'R2443',a.col03
                                   ,'R8018',a.col03
                                   ,'') as consigneeaddr2
              ,decode(a.rpt_cust_cd,'R1732',nvl(a.col08,'N')
                                   ,'') as stop
              ,decode(a.rpt_cust_cd,'R1732',a.cust_of_cust_cd
                                   ,'') as billtocode  
              ,decode(a.rpt_cust_cd,'R1400',a.col12
                                   ,'R1801',a.col12
                                   ,'R2078',a.col12
                                   ,'R2116',a.col12
                                   ,'R2160',a.col12
                                   ,'R2400',a.col12
                                   ,'R2411',a.col12
                                   ,'R2432',a.col12
                                   ,'R2433',a.col12
                                   ,'R2443',a.col12
                                   ,'R8018',a.col12
                                   ,'R2455',a.col12
                                   ,'R1866',a.col12
                                   ,'') tml_cd        
              ,decode(a.rpt_cust_cd,'R1400',a.col13
                                   ,'R1801',a.col13
                                   ,'R2078',a.col13
                                   ,'R2116',a.col13
                                   ,'R2160',a.col13
                                   ,'R2400',a.col13
                                   ,'R2411',a.col13
                                   ,'R2432',a.col13
                                   ,'R2433',a.col13
                                   ,'R2443',a.col13
                                   ,'R2451',a.col13
                                   ,'R8018',a.col13
                                   ,'R2455',a.col13
                                   ,'R1866',a.col13
                                   ,'') tml_nm     
              ,decode(a.rpt_cust_cd,'R1400',a.col14
                                   ,'R1801',a.col14
                                   ,'R2078',a.col14
                                   ,'R2116',a.col14
                                   ,'R2160',a.col14
                                   ,'R2400',a.col14
                                   ,'R2411',a.col14
                                   ,'R2432',a.col14
                                   ,'R2433',a.col14
                                   ,'R2443',a.col14
                                   ,'R2451',a.col14
                                   ,'R8018',a.col14
                                   ,'R2455',a.col14
                                   ,'R1866',a.col14
                                   ,'') city01
              ,decode(a.rpt_cust_cd,'R1400',a.col15
                                   ,'R1801',a.col15
                                   ,'R2078',a.col15
                                   ,'R2116',a.col15
                                   ,'R2160',a.col15
                                   ,'R2400',a.col15
                                   ,'R2411',a.col15
                                   ,'R2432',a.col15
                                   ,'R2433',a.col15
                                   ,'R2443',a.col15
                                   ,'R2451',a.col15
                                   ,'R8018',a.col15
                                   ,'R2455',a.col15
                                   ,'R1866',a.col15
                                   ,'') city02     
              ,decode(a.rpt_cust_cd,'R1400',a.col16
                                   ,'R1801',a.col16
                                   ,'R2078',a.col16
                                   ,'R2116',a.col16
                                   ,'R2160',a.col16
                                   ,'R2400',a.col16
                                   ,'R2411',a.col16
                                   ,'R2432',a.col16
                                   ,'R2433',a.col16
                                   ,'R2443',a.col16
                                   ,'R2451',a.col16
                                   ,'R8018',a.col16
                                   ,'R2455',a.col16
                                   ,'R1866',a.col16
                                   ,'') filt_cd
              ,decode(a.rpt_cust_cd,'R1400',a.col17
                                   ,'R1801',a.col17
                                   ,'R2078',a.col17
                                   ,'R2116',a.col17
                                   ,'R2160',a.col17
                                   ,'R2400',a.col17
                                   ,'R2411',a.col17
                                   ,'R2432',a.col17
                                   ,'R2433',a.col17
                                   ,'R2443',a.col17
                                   ,'R2451',a.col17
                                   ,'R8018',a.col17
                                   ,'R2455',a.col17
                                   ,'R1866',a.col17
                                   ,'') bnch_nm  
              ,b.col04  as acceptanceno 
              ,a.col20  as interfaceid   
              ,decode(a.rpt_cust_cd, 'R2443', b.item_grade_cd, '') as lottable4                                                                                                                                                                                                                            
           FROM tb_om03009i a 
              ,tb_om03010i b                     
              ,tb_ma01005  c 
              ,tb_ma01005  d
              ,(SELECT wrhs_eo_no, trms_seq, trms_sctn_cd 
                  FROM tb_om03009i h
                 WHERE if_yn      in ('N','E')
                   AND if_yn      like ${ifYn}
                   AND wrhs_eo_no like ${eoNo}
                   AND trms_seq   like decode(${trmsSeq},null,'%',0,'%',${trmsSeq})
                   AND rpt_cust_cd is not null
                   AND EXISTS (SELECT 'Y'
                                 FROM tb_ma01005 
                                WHERE work_pl_cd = h.work_pl_cd
                                  AND wm_work_pl_cd is not null
                               )
                   AND (h.trms_seq   = 1
                        OR EXISTS (SELECT 'Y' 
                                     FROM tb_om03009i
                                    WHERE wrhs_eo_no = h.wrhs_eo_no
                                      AND trms_seq   = h.trms_seq - 1
                                      AND if_yn      = 'Y'
                                   )
                        )
                   AND rownum &lt;= 10
                ) e
          WHERE 1 = 1
            AND a.wrhs_eo_no   = b.wrhs_eo_no                       
            AND a.trms_seq     = b.trms_seq 
            AND b.work_pl_cd   = c.work_pl_cd
            AND a.arv_ar_cd    = d.work_pl_cd (+)
            AND a.wrhs_eo_no   = e.wrhs_eo_no                       
            AND a.trms_seq     = e.trms_seq 
            AND a.trms_sctn_cd = e.trms_sctn_cd
          ORDER BY a.wrhs_eo_no, a.trms_seq, b.line_no
	</statement>
	
	<statement name="retrieveWmsStatus">
        SELECT serialkey
        	 , cast(status as varchar2(10)) as status
        	 , cast(orderkey as varchar2(14)) as orderkey
          FROM {#1}
         WHERE externorderkey = ${externorderkey}
           and orderkey = (select max(orderkey) 
        				     from {#1} 
        				    where externorderkey = ${externorderkey} )
		<append condition="${whseid}.NOTEMPTY" 	   id="#1">
			   ${whseid:not}.orders
		</append>	
	</statement>

	<statement name="retrieveWmsInhStatus">
        SELECT cast(status as varchar2(10)) as status
        	 , cast(orderkey as varchar2(14)) as orderkey
          FROM idwms.orders
         WHERE externorderkey = ${externorderkey}
           and orderkey = (select max(orderkey) 
        				     from idwms.orders
        				    where externorderkey = ${externorderkey} 
        				      and whseid = ${whseid})
           and whseid = ${whseid}			      
	</statement>
	
	<statement name="retrieveOrderKeyWms">
		SELECT {#1} as serialkey FROM dual
		<append condition="${whseid}.NOTEMPTY" 	   id="#1">
			   ${whseid:not}.orders_seq.nextval
		</append>	
	</statement>

	<statement name="retrieveOrderKeyWmsInh">
		SELECT idwms.seq_orderkey.nextval as serialkey FROM dual
	</statement>

	<statement name="retrieveLepsilonStatusOld">
        SELECT -- serialkey,
        	   cast(status as varchar2(10))     as status
        	 , cast(shipmentno as varchar2(14)) as shipmentno
          FROM tshipment
         WHERE eo_no      = ${eoNo}
           and shipmentno = (select max(shipmentno) 
        				       from tshipment 
        				      where eo_no = ${eoNo} )
		
	</statement>

	<statement name="retrieveLepsilonStatus">
        SELECT -- serialkey,
        	   cast(s.status as varchar2(10))     as status
        	 , cast(sd.RESERVESTATUS as varchar2(10))     as reservestatus
        	 , cast(s.shipmentno as varchar2(14)) as shipmentno
  		  FROM TSHIPMENT S, TSHIPMENTDETAIL SD 
 		 WHERE S.SHIPMENTNO = SD.SHIPMENTNO
   		   and s.eo_no      = ${eoNo}
           and s.shipmentno = (select max(shipmentno)
                                 from tshipment
                                where eo_no = ${eoNo})
		
	</statement>

	<statement name="retrieveLepsilonStatusTm">
        SELECT cast(s.status as varchar2(10))         as status
        	 , cast(sd.RESERVESTATUS as varchar2(10)) as reservestatus
        	 , cast(s.shipmentno as varchar2(14))     as shipmentno
  		  FROM TSHIPMENT_TM S, TSHIPMENTDETAIL_TM SD 
 		 WHERE S.SHIPMENTNO = SD.SHIPMENTNO
   		   and s.eo_no      = ${eoNo}
           and s.shipmentno = (select max(shipmentno)
                                 from tshipment_TM
                                where eo_no = ${eoNo})
		
	</statement>

	<statement name="retrieveOrderKeyLepsilon">
		SELECT 'O'||trim(to_char(seq_tshipment_key.nextval, '000000000')) as shipmentno
		  FROM dual

	</statement>

	<statement name="retrieveShipmentNoWms">
		SELECT {#1} as m_shipment_no FROM dual
		<append condition="${whseid}.NOTEMPTY" 	   id="#1">
			   'M'||LPAD(${whseid:not}.SHIPMENTORDER_SEQ.NEXTVAL,7,'0')				
		</append>	
	</statement>

	<statement name="retrieveShipmentNoWmsInh">
		SELECT 'M'||LPAD(idwms.SEQ_SHIPMENTORDER.NEXTVAL,7,'0') as m_shipment_no FROM dual
	</statement>
	
	
	<!-- WMS 접속 - 입고실행오더 전송 -->
	<statement name="retrieveGrEoWms">
        SELECT a.wrhs_eo_no                    as externreceiptkey                                                                                                    
              ,a.trms_seq                      as trms_seq                                                                                                            
              ,a.trms_sctn_cd                  as chgflag                                                                                                             
              ,c.wm_work_pl_cd                 as whseid                                                                                                              
              ,a.ord_mngt_exce_ofcr_id         as susr1                                                                                                               
              ,a.ord_mngt_exce_ofcr_tel_no     as susr2                                                                                                               
              ,a.sales_ord_no                  as sokey                                                                                                               
              ,a.cust_ord_no                   as pokey                                                                                                               
              ,nvl(a.move_type_cd,' ')         as type                                                                                                                
              ,a.ord_type_cd                   as ord_type_cd                                                                                                         
              ,a.rpt_cust_cd                   as storerkey                                                                                                           
              ,decode(a.rpt_cust_cd,'R1209',a.cust_ord_type_cd||a.col10,'R1728',a.cust_ord_type_cd||a.col10,a.cust_ord_type_cd) as custordertypecd                                                                                                     
              ,a.car_no                        as trailernumber                                                                                                       
              ,a.cargo_form_cd                 as cargo_form_cd                                                                                                       
              ,decode(d.ul_wm_cd,null,a.dpt_ar_cd,d.ul_wm_cd)                                                                                                         
                                               as carrierkey                                                                                                          
              ,a.dpt_ar_nm                     as carriercompanyname                                                                                                  
              ,a.dpt_ar_zip_cd                 as carrierzip                                                                                                          
              ,a.dpt_ar_zip_addr               as carrieraddress1                                                                                                     
              ,a.dpt_ar_dtl_addr               as carrieraddress2                                                                                                     
              ,a.dpt_ar_ofcr_nm                as carriername                                                                                                         
              ,a.dpt_ar_ofcr_tel_no            as carrierreference                                                                                                    
              ,a.aptd_req_ymd                                                                                                                                         
               ||decode(greatest(substr(a.aptd_req_hm,1,2),'23'),substr(a.aptd_req_hm,1,2),'23',                                                                   
                  substr(a.aptd_req_hm,1,2))                                                                                                                      
               ||decode(greatest(substr(a.aptd_req_hm,3,2),'59'),substr(a.aptd_req_hm,3,2),'59',                                                                   
                  substr(a.aptd_req_hm,3,2))                                                                                                                      
                                               as expectedreceiptdate                                                                                                 
              ,to_char(a.gi_date,'yyyymmddhh24miss')   as gi_date                                                                                                       
              ,decode(a.ctrt_cust_cd,'R1209',b.col03,'R1728',b.col03, 'P1010', b.col22, 'P1028', b.col22, a.rmk)         as notes                                                                                                               
              ,a.rltd_gi_eo_no                 as rtndgiordno                                                                                                         
              ,a.ord_reason_cd                 as reasoncode                                                                                                          
              ,a.ord_reason_cd_nm              as reasoncddesc                                                                                                        
              ,a.gi_cncl_regr_yn               as reflag                                                                                                              
              ,a.booking_no                    as bookingno                                                                                                           
              --,a.bl_no                         as blno  
              ,case when a.rpt_cust_cd  in ('P2070') and a.CUST_ORD_TYPE_CD IN ('GZ') then
                         a.cust_ord_no
                    else a.bl_no end as blno
              --,case when a.rpt_cust_cd  in ('P2070') then
              --           a.bl_no
              --      else
              --           decode(a.bl_no,null,null,a.bl_no||a.bl_cust_ord_no) 
              -- end as blseq       
              ,case when a.rpt_cust_cd  in ('P2070') and a.CUST_ORD_TYPE_CD IN ('GZ') then
                         a.cust_ord_no||a.cust_ord_no
                    else decode(a.bl_no,null,null,a.bl_no||a.bl_cust_ord_no) end as blseq                                                                                   
              ,nvl(a.tot_qty,0)                as openqty                                                                                                             
              --,nvl(a.tot_wgt,0)                as bltotmt                                                                                                             
              --,nvl(a.tot_admt,0)               as bltotadmt  
              --,b.ord_wgt                       as bltotmt
              --,b.ord_wgt                       as bltotadmt 
              ,(select sum(nvl(ord_wgt,0)) from tb_om02002 where sales_ord_no=a.sales_ord_no and line_no=b.SALES_ORD_LINE_NO) bltotmt
              ,(select sum(nvl(admt,0)) from tb_om02002 where sales_ord_no=a.sales_ord_no and line_no=b.SALES_ORD_LINE_NO) bltotadmt                                                                                                                      
              ,decode(b.cust_cd,'P2070',trim(b.item_cd),trim(b.item_cd)||trim(b.bat_no)) as sku                                                                                                                 
              ,nvl(a.tot_qty,0)                as item_tot_cnt                                                                                                        
              ,nvl(a.tot_wgt,0)                as item_tot_wgt
              ,a.shipment_no                   as shipmentno 
              ,lpad(b.line_no, 5,'0')          as receiptlinenumber                                                                                                   
              ,b.sales_ord_line_no             as externlineno                                                                                                        
              ,b.cust_ord_line_no              as polineno                                                                                                            
              ,b.line_no                       as solineno                                                                                                            
              ,trim(b.item_cd)                 as susr2_d                                                                                                             
              ,trim(b.bat_no)                  as susr3_d                                                                                                             
              ,nvl(b.std_ord_qty,0)            as qtyexpected                                                                                                         
              ,  CASE WHEN a.cust_ord_type_cd =  'Z27'  AND a.ctrt_cust_cd  IN ('P1000', 'P1591') THEN
                     decode((select work_cntr_cd||save_Loc_cd from tb_om01001 where sales_ord_no = a.sales_ord_no )
                             , '20001450', 'JHCFS', '30001450', 'DJCFS', '50001450', 'CACFS',  decode(substr(a.work_pl_cd,1,2),'KR',a.work_pl_cd,'STAGE'))
                 else
                  decode(substr(a.work_pl_cd,1,2),'KR',a.work_pl_cd,'STAGE')
                 end   as toloc   
              --,decode(substr(a.work_pl_cd,1,2),'KR',a.work_pl_cd,'STAGE')
              --                                 as toloc                                                                                                                         
              ,b.ord_qty                       as item_cnt                                                                                                            
              ,b.qty_unit_cd                   as item_cnt_uom                                                                                                        
              ,b.ord_wgt                       as item_wgt                                                                                                            
              ,b.wgt_unit_cd                   as item_wgt_uom                                                                                                        
              ,nvl(b.lot_no,' ')               as lottable01                                                                                                          
              ,b.ord_reason_cd                 as reasoncode_d                                                                                                        
              ,b.plant_cd                      as susr1_d                                                                                                             
              --,nvl(b.prdt_req_no,' ')          as lottable03 
              ,case when a.rpt_cust_cd  in ('P1000', 'P1591') then
                  decode(nvl(a.col05, 'N'), 'G00', nvl(a.col30, ' '), nvl(b.prdt_req_no,' '))
               else
                  nvl(b.prdt_req_no,' ')
               end
                         as lottable03
              --,nvl(decode(b.cust_cd , 'P1010', a.cust_ord_no, 'P1028', a.cust_ord_no, b.prdt_req_no),' ') as lottable03                                                                                                         
              --,b.prdt_ymd                      as lottable04                                                                                                          
              ,decode(b.cust_cd , 'P1010', to_char(a.reg_date, 'YYYYMMDD'), 'P1028', to_char(a.reg_date, 'YYYYMMDD'), b.prdt_ymd) as lottable04
              --,decode(b.cust_cd, 'Z1062',nvl(b.col05,' '),to_char(b.gr_date,'yyyymmddhh24miss'))
              ,to_char(b.gr_date,'yyyymmddhh24miss')
                                               as lottable05                                                                                                          
              --,nvl(b.prdt_lot_no,' ')          as lottable06
              , case when a.ctrt_cust_cd ='R1209' then
                  decode(a.col29, 'Y', a.col30, nvl(b.prdt_lot_no,' ')) 
                 else
                     nvl(b.prdt_lot_no,' ') 
                 end as lottable06                                                                                                            
              ,nvl(b.dia_supl,' ')             as lottable08                                                                                                          
              ,CASE WHEN a.ctrt_cust_cd in ('Z1062') and a.ord_type_cd in ('1047') then
                  decode(b.papstyle_gds_supl, null , ' ', ' '||substr(b.papstyle_gds_supl, 2))
               else              
                   nvl(b.papstyle_gds_supl,' ')
               end    as lottable09                                                                                                          
              ,b.cntr_no                       as cntrno                                                                                                              
              --,decode(a.ctrt_cust_cd,'P1300',b.plant_cd,decode(c.work_pl_sctn_cd,'05', 
              --              decode(a.bl_no, null,decode(a.booking_no,null,' ',a.booking_no),a.bl_no||a.bl_cust_ord_no),' '))
              --                                 as lottable02                                                                                                          
              , case when b.cust_cd = 'P2070' AND a.CUST_ORD_TYPE_CD='GZ' then
              			   --nvl(a.bl_no,' ')
              			     nvl(a.cust_ord_no||a.cust_ord_no,' ')
                     when b.cust_cd = 'P1010' OR b.cust_cd = 'P1028' then 
                         case when a.CUST_ORD_TYPE_CD IN ('ZB', 'ZD', 'ZF' ) then
                  	              nvl(b.col15||b.col16, ' ')
                         else
                                  nvl(a.cust_ord_no||b.cust_ord_line_no, ' ')
                         end
                     when b.cust_cd = 'Z1062' then 
                          nvl(a.bl_no,' ')
                     else  
                         CASE WHEN a.cust_ord_type_cd IN ('Z25', 'Z27', 'Z29', 'Z31') AND a.ctrt_cust_cd  ='P1000' THEN
                             --NVL(a.bl_no||a.bl_cust_ord_no, ' ')
                             ' '
                             WHEN a.cust_ord_type_cd IN ('Z25', 'Z27', 'Z29', 'Z31') AND a.ctrt_cust_cd  ='P1591' THEN
                             --NVL(a.bl_no||a.bl_cust_ord_no, ' ')
                             ' '
                         ELSE 
                           decode(a.ctrt_cust_cd,'P1300',b.plant_cd
                                                , 'R1209', ' '
                                                , decode(c.work_pl_sctn_cd,'05', decode(a.bl_no, null,decode(a.booking_no,null,' ',a.booking_no),a.bl_no||a.bl_cust_ord_no),' '))
                         END
                end                            as lottable02 
              , case when a.ctrt_cust_cd in ('P1010', 'P1028') then
                          nvl(a.cust_ord_no||b.cust_ord_line_no, ' ')
                     when a.ctrt_cust_cd in ('Z1062') then
                          nvl(b.cntr_no,' ')
                     when a.ctrt_cust_cd in ('P2070') and a.CUST_ORD_TYPE_CD='GZ' then
                          nvl(a.col10,' ')
                     else
              		      decode(c.work_pl_sctn_cd,'05',nvl(b.cntr_no,' '),' ')                                                              
                end                               as lottable10                                                                                                          
              ,nvl(b.bl_unit_admt,0)           as bladmt                                                                                                              
              ,nvl(b.bl_unit_wgt,0)            as blmt                                                                                                                
              ,a.work_pl_cd                    as work_cntr_cd                                                                                                        
              ,decode(d.work_pl_cd,null,a.dpt_ar_cd,d.work_pl_cd)                                                                                                     
                                               as from_work_cntr_cd                                                                                                   
              , case when a.CUST_ORD_TYPE_CD IN ('ZB', 'ZD', 'ZF') then
                    'R'
                when a.ctrt_cust_cd = 'P2070' then
                    to_char(b.ord_qty)
                else             
                    case when a.ctrt_cust_cd = 'P1200' AND a.CUST_ORD_TYPE_CD = 'ZC' then
                        decode(b.col30, '154042', nvl(b.col06, 'S'), ' ')
                    else
                        nvl(b.pcul_mn_cd,' ')
                    end
                end lottable07                                                                                                          
              ,decode(a.trms_sctn_cd,'Z','Y','N') as item_cmpt_yn                                                                                                        
              ,row_number() over(partition by a.wrhs_eo_no, a.trms_seq order by a.wrhs_eo_no, a.trms_seq, b.line_no)                                                  
                                               as ord_no_seq                                                                                                          
              ,count(*) over(partition by a.wrhs_eo_no, a.trms_seq)                                                                                                   
                                               as ord_no_cnt   
      --      ,b.col03                         as notes  
              ,decode(a.ctrt_cust_cd, 'P1010', a.col07, 'P1028', a.col07, '')         as hnotes    
              ,decode(a.CUST_ORD_TYPE_CD,'ZO','N','') as CSN_RSBT_YN      
              ,decode(a.ctrt_cust_cd,'R1209',a.bl_no,' ') as id 
              ,decode(a.ctrt_cust_cd,'R1209', a.col28 , '')         as incoterms                                                                                                                          
          FROM tb_om03005i a                                                                                                                                          
              ,tb_om03006i b                                                                                                                                          
              ,tb_ma01005  c                                                                                                                                          
              ,tb_ma01005  d                                                                                                                                          
              ,(SELECT wrhs_eo_no, trms_seq, trms_sctn_cd 
                  FROM tb_om03005i h
                 WHERE if_yn      in ('N','E')
                   AND if_yn      like ${ifYn} 
                   AND wrhs_eo_no like ${eoNo}
                   AND trms_seq   like decode(${trmsSeq},null,'%',0,'%',${trmsSeq})
                   AND rpt_cust_cd is not null
                   AND EXISTS (SELECT 'Y'
                                 FROM tb_ma01005 
                                WHERE work_pl_cd = h.work_pl_cd
                                  AND wm_work_pl_cd is not null
                               )
                   AND (h.trms_seq   = 1
                        OR EXISTS (SELECT 'Y' 
                                     FROM tb_om03005i
                                    WHERE wrhs_eo_no = h.wrhs_eo_no
                                      AND trms_seq   = h.trms_seq - 1
                                      AND if_yn      = 'Y'
                                   )
                        )
                   AND rownum &lt;= 5
                 ) e
         WHERE 1 = 1                                                                                                                                                  
           AND a.wrhs_eo_no   = b.wrhs_eo_no                                                                                                                            
           AND a.trms_seq     = b.trms_seq                                                                                                                              
           AND b.work_pl_cd   = c.work_pl_cd                                                                                                                            
           AND a.dpt_ar_cd    = d.work_pl_cd (+)   
           AND a.wrhs_eo_no   = e.wrhs_eo_no
           AND a.trms_seq     = e.trms_seq      
           AND a.trms_sctn_cd = e.trms_sctn_cd        
         ORDER BY a.wrhs_eo_no, a.trms_seq, b.line_no                               
	</statement>	

	<!-- Lepsilon 접속 - 입고실행오더 전송 -->
	<statement name="retrieveGrEoLepsilon">
        SELECT a.wrhs_eo_no                    as EO_NO    -- externreceiptkey                                                                                                    
              ,a.trms_seq                      as trms_seq                                                                                                            
              ,a.trms_sctn_cd                  as isclosing                                                                                                             
              ,c.wm_work_pl_cd                 as WCODE          -- whseid                                                                                                              
              ,a.ord_mngt_exce_ofcr_id         as susr1                                                                                                               
              ,a.ord_mngt_exce_ofcr_tel_no     as susr2                                                                                                               
              ,a.sales_ord_no                  as SALES_ORD_NO   -- sokey                                                                                                               
              ,a.cust_ord_no                   as CUSTOMERPONO   -- pokey                                                                                                               
              ,nvl(a.move_type_cd,'')          as type                                                                                                                
              ,a.ord_type_cd                   as ord_type_cd                                                                                                         
              ,a.rpt_cust_cd                   as OWNER          -- storerkey                                                                                                           
              ,decode(a.rpt_cust_cd,'R1209',a.cust_ord_type_cd||a.col10,'R1728',a.cust_ord_type_cd||a.col10,a.cust_ord_type_cd) as CUST_ORD_TYPE_CD  -- custordertypecd                                                                                                     
              ,a.car_no                        as trailernumber                                                                                                       
              ,a.cargo_form_cd                 as cargo_form_cd                                                                                                       
              ,decode(d.ul_wm_cd,null,a.dpt_ar_cd,d.ul_wm_cd)                                                                                                         
                                               as SHIPTOCODE     -- carrierkey                                                                                                          
              ,a.dpt_ar_nm                     as SHIPTONAME     -- carriercompanyname     
              ,a.dpt_ar_zip_cd                 as SHIPTOZIP      -- carrierzip                                                                                                          
              ,a.dpt_ar_zip_addr               as SHIPTOADDR1    -- carrieraddress1                                                                                                     
              ,a.dpt_ar_dtl_addr               as SHIPTOADDR2    -- carrieraddress2                                                                                                  
              ,a.dpt_ar_ofcr_nm                as SHIPTOADDR3    -- carriername                                                                                                         
              ,a.dpt_ar_ofcr_tel_no            as SHIPTOTEL      -- carrierreference    
              ,decode(d.ul_wm_cd,null,a.dpt_ar_cd,d.ul_wm_cd)    as supplier 
                                                                                                          
              ,a.aptd_req_ymd                                                                                                                                         
               ||decode(greatest(substr(a.aptd_req_hm,1,2),'23'),substr(a.aptd_req_hm,1,2),'23',                                                                   
                  substr(a.aptd_req_hm,1,2))                                                                                                                      
               ||decode(greatest(substr(a.aptd_req_hm,3,2),'59'),substr(a.aptd_req_hm,3,2),'59',                                                                   
                  substr(a.aptd_req_hm,3,2))                                                                                                                      
                                           as INDATE         -- expectedreceiptdate                                                                                                 
              ,to_char(a.gi_date,'yyyymmddhh24miss')   as gi_date                                                                                                       
              ,a.rmk                           as REMARK1    -- notes                                                                                                               
              ,a.rltd_gi_eo_no                 as rtndgiordno                                                                                                         
              ,a.ord_reason_cd                 as reasoncode                                                                                                          
              ,a.ord_reason_cd_nm              as reasoncddesc                                                                                                        
              ,a.gi_cncl_regr_yn               as reflag                                                                                                              
              ,a.booking_no                    as bookingno                                                                                                           
              ,a.bl_no                         as blno                                                                                                                
              ,decode(a.bl_no,null,null,a.bl_no||a.bl_cust_ord_no) as blseq                                                                                           
              ,nvl(a.tot_qty,0)                as openqty                                                                                                             
              ,nvl(a.tot_wgt,0)                as bltotmt                                                                                                             
              ,nvl(a.tot_admt,0)               as bltotadmt                                                                                                           
              ,trim(b.item_cd)||trim(b.bat_no) as STOCK              -- sku                                                                                                                 
              ,nvl(a.tot_qty,0)                as item_tot_cnt                                                                                                        
              ,nvl(a.tot_wgt,0)                as item_tot_wgt
              ,a.shipment_no                   as shipmentno 
              ,lpad(b.line_no, 5,'0')          as LINENO           -- receiptlinenumber                                                                                                   
              ,b.sales_ord_line_no             as sales_ord_line_no            -- solineno                                                                                                        
              ,b.cust_ord_line_no              as CUST_ORD_LINE_NO   -- polineno                                                                                                            
              ,b.line_no                       as EO_LINE_NO  -- externlineno                                                                                                            
              ,trim(b.item_cd)                 as susr2_d                                                                                                             
              ,trim(b.bat_no)                  as susr3_d                                                                                                             
         --   ,nvl(b.std_ord_qty,0)            as QTY            
              ,case when (a.rpt_cust_cd='R2443' or a.rpt_cust_cd='R8018') and b.qty_unit_cd='EA' then  b.ord_qty
                    else decode(nvl(b.bl_unit_admt,0),0,nvl(b.std_ord_qty,0),b.bl_unit_admt)
                end as qty
         --     ,decode(nvl(b.bl_unit_admt,0),0,nvl(b.std_ord_qty,0),b.bl_unit_admt) as qty      -- qtyexpected                                                                                                 
              ,decode(substr(a.work_pl_cd,1,2),'KR',a.work_pl_cd,'STAGE')
                                               as toloc   
              ,case when (a.rpt_cust_cd='R2443' or a.rpt_cust_cd='R8018') and b.qty_unit_cd='EA' then  nvl(b.bl_unit_admt,0)
                    else b.ord_qty
                end as item_cnt                                                                                                                                                                       
         --     ,b.ord_qty                       as item_cnt                                                                                                            
              ,b.qty_unit_cd                   as item_cnt_uom    
              ,b.qty_unit_cd                   as baggagetype                                                                                                               
              ,b.ord_wgt                       as item_wgt                                                                                                            
              ,b.wgt_unit_cd                   as item_wgt_uom                                                                                                        
          --  ,nvl(b.lot_no,'')                as LOTABLE1              
		      ,decode(a.rpt_cust_cd,'E8001',nvl(b.lot_no,'')
		                           ,'R1206',a.cust_ord_no 
		                           ,'E1400',b.col03
                                   ,nvl(b.lot_no,'')) as LOTABLE1      -- lottable01
          --  ,decode(a.rpt_cust_cd,'R1206',a.cust_ord_no,b.lot_no )  as LOTABLE1                                                                                                      
              ,b.ord_reason_cd                 as reasoncode_d                                                                                                        
              ,b.plant_cd                      as susr1_d    
		      ,decode(a.rpt_cust_cd,'E8001',nvl(b.prdt_req_no,'')
                                           ,nvl(b.prdt_req_no,'')) as LOTABLE3  -- lottable03                                                                                                                 
          --  ,nvl(b.prdt_req_no,'')           as LOTABLE3            
          --  ,decode(a.rpt_cust_cd,'R1206',b.col02,b.prdt_req_no)   as LOTABLE3  
                                                                                                    
              ,decode(a.rpt_cust_cd,'R1206',b.col03
                                   ,'R1400','A'
                                   ,'R8001',b.item_grade_cd
                                   ,'R8002',b.item_grade_cd
                                   ,'R8003',b.item_grade_cd
                                   ,'E1383',b.item_grade_cd
                                           ,b.prdt_ymd)      as LOTABLE4           -- lottable04                                                                                                              
              ,decode(a.rpt_cust_cd,'R8001',b.lot_no
                                   ,'R8002',b.lot_no
                                   ,'R8003',b.lot_no
                                   ,'E1383',b.lot_no
                                   ,'R1312',decode(a.col10,'GR_STOCK','STOCK','GR_VMI','VMI','TR')
                                           ,'')              as LOTABLE5  
              ,decode(a.rpt_cust_cd,'R8001',b.col02
                                   ,'R8002',b.col02
                                   ,'R8003',b.col02
                                   ,'E1383',b.col02
                                           ,'')              as PRODUCTTIME                                                                                                                                      
              ,nvl(b.prdt_lot_no,'')           as lottable06                                                                                                          
              ,nvl(b.dia_supl, '')             as lottable08                                                                                                          
              ,nvl(b.papstyle_gds_supl,'')     as lottable09                                                                                                          
              ,b.cntr_no                       as cntrno                                                                                                              
          --  ,decode(a.ctrt_cust_cd,'P1300',b.plant_cd,decode(c.work_pl_sctn_cd,'05', 
          --          decode(a.bl_no, null,decode(a.booking_no,null,'',a.booking_no),a.bl_no||a.bl_cust_ord_no),''))
          --                                   as lottable02 
              --,a.col05                         as LOTABLE2 
              ,decode(a.rpt_cust_cd, 'R2455', b.col03, a.col05) as  LOTABLE2
              ,decode(c.work_pl_sctn_cd,'05',nvl(b.cntr_no,''),'')                                                              
                                               as lottable10                                                                                                          
              ,nvl(b.bl_unit_admt,0)           as bladmt                                                                                                              
              ,nvl(b.bl_unit_wgt,0)            as blmt                                                                                                                
              ,a.work_pl_cd                    as work_cntr_cd                                                                                                        
              ,decode(d.work_pl_cd,null,a.dpt_ar_cd,d.work_pl_cd)                                                                                                     
                                               as from_work_cntr_cd                                                                                                   
              ,nvl(b.pcul_mn_cd,'')            as lottable07                                                                                                          
              ,decode(a.trms_sctn_cd,'Z','Y','N') as item_cmpt_yn                                                                                                        
              ,row_number() over(partition by a.wrhs_eo_no, a.trms_seq order by a.wrhs_eo_no, a.trms_seq, b.line_no)                                                  
                                               as ord_no_seq                                                                                                          
              ,count(*) over(partition by a.wrhs_eo_no, a.trms_seq)                                                                                                   
                                               as ord_no_cnt  
              ,decode(a.rpt_cust_cd,'R1206',b.col01
                                   ,'R8001',b.col01
                                   ,'R8002',b.col01
                                   ,'R8003',b.col01
                                   ,'E1383',b.col01
                                           ,'')           as validtime 
              ,b.col11                         as note
              ,a.col12                         as groupid
              ,a.col04                         as as_Order
              ,decode(a.rpt_cust_cd,'R1278',a.col02
                                   ,'R1801',a.col02
                                   ,'R2001',a.col02
                                   ,'R2411',a.col02
                                   ,'') as consigneename
              ,decode(a.rpt_cust_cd,'R1732',b.col12
                                           ,'')           as cust_ref_no_dt    
              ,decode(a.rpt_cust_cd,'R1732',b.col03
                                           ,'')           as net_price    
              ,decode(a.rpt_cust_cd,'R1312',a.col07     
                                           ,'')           as shiptocity  
              ,decode(a.rpt_cust_cd,'R1312',a.col08     
                                           ,'')           as shiptofax    
              ,nvl(b.col13,b.col05) as dispositioncode  
              ,a.col20  as interfaceid                                                                                                                                                                    
          FROM tb_om03005i a                                                                                                                                          
              ,tb_om03006i b                                                                                                                                          
              ,tb_ma01005  c                                                                                                                                          
              ,tb_ma01005  d                                                                                                                                          
              ,(SELECT wrhs_eo_no, trms_seq, trms_sctn_cd 
                  FROM tb_om03005i h
                 WHERE if_yn      in ('N','E')
                   AND if_yn      like ${ifYn} 
                   AND wrhs_eo_no like ${eoNo}
                   AND trms_seq   like decode(${trmsSeq},null,'%',0,'%',${trmsSeq})
                   AND rpt_cust_cd is not null
                   AND EXISTS (SELECT 'Y'
                                 FROM tb_ma01005 
                                WHERE work_pl_cd = h.work_pl_cd
                                  AND wm_work_pl_cd is not null
                               )
                   AND (h.trms_seq   = 1
                        OR EXISTS (SELECT 'Y' 
                                     FROM tb_om03005i
                                    WHERE wrhs_eo_no = h.wrhs_eo_no
                                      AND trms_seq   = h.trms_seq - 1
                                      AND if_yn      = 'Y'
                                   )
                        )
                   AND rownum &lt;= 5
                 ) e
         WHERE 1 = 1                                                                                                                                                  
           AND a.wrhs_eo_no = b.wrhs_eo_no                                                                                                                            
           AND a.trms_seq   = b.trms_seq                                                                                                                              
           AND b.work_pl_cd = c.work_pl_cd                                                                                                                            
           AND a.dpt_ar_cd  = d.work_pl_cd (+)   
           AND a.wrhs_eo_no = e.wrhs_eo_no
           AND a.trms_seq   = e.trms_seq      
           AND a.trms_sctn_cd = e.trms_sctn_cd        
         ORDER BY a.wrhs_eo_no, a.trms_seq, b.line_no                               
	</statement>	
	
	<statement name="retrieveGrWmsStatus">
        SELECT serialkey
        	 , cast(status     as varchar2(10)) as status
        	 , cast(receiptkey as varchar2(14)) as receiptkey
        	 , blno
          FROM {#1}
         WHERE externreceiptkey = ${externreceiptkey}
           AND status		  != '19'
		<append condition="${whseid}.NOTEMPTY" 	   id="#1">
			   ${whseid:not}.receipt
		</append>	
	</statement>
	
	<statement name="retrieveReceiptKeyWms">
		SELECT 'R'||trim(to_char({#1}, '000000000')) as serialkey FROM dual
		<append condition="${whseid}.NOTEMPTY" 	   id="#1">
			   ${whseid:not}.receipt_seq.nextval
		</append>	
	</statement>

	<statement name="retrieveGrWmsInhStatus">
        SELECT cast(status     as varchar2(10)) as status
        	 , cast(receiptkey as varchar2(14)) as receiptkey
        	 , blno
          FROM idwms.receipt
         WHERE externreceiptkey = ${externreceiptkey}
           AND status		  != '19'
	</statement>
	
	<statement name="retrieveReceiptKeyWmsInh">
		SELECT 'R'||trim(to_char(idwms.seq_receiptkey.nextval, '000000000')) as serialkey FROM dual
	</statement>

	<statement name="retrieveGrLepsilonStatus">
        SELECT  --  serialkey,
        	   cast(status     as varchar2(10)) as status
        	 , cast(RECEIPTNO as varchar2(14)) as RECEIPTNO
        --   , blno
          FROM treceipt
         WHERE EO_NO = ${eoNo}
    --     AND status		  != '19'
		
	</statement>
	
	<statement name="retrieveReceiptKeyLepsilon">
		SELECT 'R'||trim(to_char(seq_treceipt_key.nextval, '000000000')) as RECEIPTNO -- serialkey 
		  FROM dual
	</statement>
		
	<statement name="retrieveSalesOrdItemList">
	    select sales_ord_no
		     , line_no
		     , cust_cd
		     , item_cd
		     , basis_item_cd
		     , cust_ord_line_no
		     , item_grade_cd
		     , ord_qty
		     , qty_unit_cd
		     , ord_wgt
		     , wgt_unit_cd
		     , admt
		     , ord_cbm
		     , basis_unit_cd
		     , bat_no
		     , cust_bat_no
		     , mnf_no
		     , lot_no
		     , prdt_req_no
		     , prdt_prar_ymd
		     , plant_cd
		     , sales_uprice
		     , cust_ref_no
		     , fe_sctn_cd
		     , cntr_size_cd
		     , cntr_no
		     , danger_sctn_cd
		     , seal_no1
		     , seal_no2
		     , pckg_unit_cd
		     , pckg_qty
		     , max_tmpt
		     , min_tmpt
		     , dpt_ar_cd
		     , dpt_ar_type_cd
		     , dpt_ar_zip_cd
		     , dpt_ar_zip_addr
		     , dpt_ar_dtl_addr
		     , dpt_ar_ofcr_nm
		     , dpt_ar_ofcr_tel_no
		     , arv_ar_cd
		     , arv_ar_type_cd
		     , arv_ar_zip_cd
		     , arv_ar_zip_addr
		     , arv_ar_dtl_addr
		     , arv_ar_ofcr_nm
		     , arv_ar_ofcr_tel_no
		     , strt_req_ymd
		     , strt_req_hm
		     , aptd_req_ymd
		     , aptd_req_hm
		     , ord_reason_cd
		     , booking_no
		     , prog_stat_cd
		     , vanning_grp_id
		     , prdt_ymd
		     , pol_cd
		     , schd_no
		     , sctn_cd
		     , rpt_item_nm
		     , cls_expr_yn
		     , lead_time_expr_yn
		     , ltrm_ord_yn
		     , rmk
		     , exp_ord_no
		     , dpt_port_prar_ymd
		     , arv_port_prar_ymd
		     , gi_req_ymd
		     , std_wgt
		     , pallet_qty
		     , more_pmsr
		     , less_pmsr
		     , cntr_dcsn_ofcr_id
		     , cntr_dcsn_date
		     , pcul_cd
		     , mn_cd
		     , dcsn_yn
		     , work_cntr_cd
		     , deliv_dly_yn
		     , cmpt_ymd
		     , ord_verify_yn
		     , del_yn
		     , ${regrId} as regr_id
		     , ${mdfrId} as mdfr_id
	     from tb_om02002
	    where sales_ord_no = ${salesOrdNo}
	      and del_yn != 'Y'
	      and ord_reason_cd is null
	</statement>
	
	<statement name="retrieveChungwonPortData">
		SELECT a.cust_ref_no AS exp_ord_no
		      ,c.col01 AS cust_ord_line_no
		      ,CASE WHEN sum(decode(d.sales_ord_no, null, 0, b.ord_qty)) = 0 AND sum(decode(d.sales_ord_no, null, 0, b.ord_wgt)) = 0 THEN
		          '2'
		       ELSE
		          '4'
		       END AS prog_stat_cd
		      ,sum(decode(d.sales_ord_no, null, 0, b.ord_qty)) AS gi_qty
		      ,sum(decode(d.sales_ord_no, null, 0, b.ord_wgt)) AS gi_wgt
		  FROM tb_om02001 a
		      ,tb_om02002 b
		      ,tb_om02005 c
		      ,tb_om03001 d
		 WHERE a.sales_ord_no = b.sales_ord_no
		   AND b.sales_ord_no = c.sales_ord_no
		   AND b.line_no = c.line_no
		   AND a.cust_ref_no = ${custRefNo}
		   AND c.col01 IN (SELECT DISTINCT col01
		                     FROM tb_om02005
		                    WHERE sales_ord_no = ${salesOrdNo})
		   AND a.sales_ord_cncl_yn = 'N'
		   AND a.sales_ord_no = d.sales_ord_no (+)
		   AND d.del_yn (+) = 'N'
		 GROUP BY a.cust_ref_no
		         ,c.col01	
	</statement>
	
	<statement name="retrieveSalesOrdStcCntr">
		SELECT  a.sales_ord_no
			  , a.BOOKING_NO
			  , (select count(*) from tb_om02020 where sales_ord_no = a.sales_ord_no) cnt
		  FROM	tb_om02019 a
		 WHERE	a.SALES_ORD_NO = ${salesOrdNo}
	</statement>
	
	<statement name="retrieveTransferGiEoPartial">
		select 	
			  wrhs_eo_no
			, (SELECT nvl(MAX(trms_seq), 0) + 1 FROM tb_om03009i WHERE wrhs_eo_no = ${eoNo}) AS trms_seq
			, trms_seq as prev_trms_seq
			, ${trmsSctnCd} as trms_sctn_cd
			, corp_cd
			, work_pl_cd
			, ord_mngt_exce_ofcr_id
			, ord_mngt_exce_ofcr_tel_no
			, sales_ord_no
			, cust_ord_no
			, ord_type_cd
			, rpt_cust_cd
			, ctrt_cust_cd
			, cust_ord_type_cd
			, ord_req_cust_cd
			, cust_of_cust_cd
			, cust_nm
			, arv_ar_cd
			, arv_ar_zip_cd
			, arv_ar_zip_addr
			, arv_ar_dtl_addr
			, arv_ar_ofcr_nm
			, arv_ar_ofcr_tel_no
			, aptd_req_ymd
			, aptd_req_hm
			, rmk
			, cust_expr_yn
			, cls_expr_yn
			, lead_time_expr_yn
			, ltrm_ord_yn
			, booking_no
			, bl_no
			, bl_cust_ord_no
			, load_dly_yn
			, move_type_cd
			, cargo_form_cd
			, bl_tot_wgt
			, bl_tot_admt
			, tran_yn
			, col01
			, col02
			, col03
			, col04
			, col05
			, col06
			, col07
			, col08
			, col09
			, col10
			, col11
			, col12
			, col13
			, col14
			, col15
			, col16
			, col17
			, col18
			, col19
			, col20
			, col21
			, col22
			, col23
			, col24
			, col25
			, col26
			, col27
			, col28
			, col29
			, col30
			, 'N' as if_yn
			, ${regrId} as regr_id
			, ${mdfrId} as mdfr_id
		 from tb_om03009i a
		where wrhs_eo_no = ${eoNo}
		  and trms_seq = (select max(trms_seq) 
							from tb_om03009i 
						   where wrhs_eo_no = a.wrhs_eo_no 
							 and trms_sctn_cd in ('C', 'U'))
	</statement>

	<statement name="retrieveTransferGrEoPartial">
		select 	
			  wrhs_eo_no
			, (SELECT nvl(MAX(trms_seq), 0) + 1 FROM tb_om03005i WHERE wrhs_eo_no = ${eoNo}) AS trms_seq
			, trms_seq as prev_trms_seq
			, ${trmsSctnCd} as trms_sctn_cd
			, corp_cd
			, work_pl_cd
			, ord_mngt_exce_ofcr_id
			, ord_mngt_exce_ofcr_tel_no
			, sales_ord_no
			, cust_ord_no
			, ord_type_cd
			, rpt_cust_cd
			, ctrt_cust_cd
			, cust_ord_type_cd
			, dpt_ar_cd
			, dpt_ar_nm
			, dpt_ar_zip_cd
			, dpt_ar_zip_addr
			, dpt_ar_dtl_addr
			, dpt_ar_ofcr_nm
			, dpt_ar_ofcr_tel_no
			, aptd_req_ymd
			, aptd_req_hm
			, rmk
			, rltd_gi_eo_no
			, ord_reason_cd
			, ord_reason_cd_nm as ord_reason_nm
			, gi_cncl_regr_yn
			, booking_no
			, bl_no
			, bl_cust_ord_no
			, tot_qty
			, tot_wgt
			, tot_admt
			, bl_unit_wgt
			, bl_unit_admt
			, move_type_cd
			, car_no
			, cargo_form_cd
			, to_char(gi_date, 'yyyymmddhh24miss') gi_date
			, shipment_no
			, col01
			, col02
			, col03
			, col04
			, col05
			, col06
			, col07
			, col08
			, col09
			, col10
			, col11
			, col12
			, col13
			, col14
			, col15
			, col16
			, col17
			, col18
			, col19
			, col20
			, col21
			, col22
			, col23
			, col24
			, col25
			, col26
			, col27
			, col28
			, col29
			, col30
			, 'N' as if_yn
			, ${regrId} as regr_id
			, ${mdfrId} as mdfr_id
		from tb_om03005i a
	   where wrhs_eo_no = ${eoNo}
		 and trms_seq = (select max(trms_seq) 
						   from tb_om03005i 
						  where	wrhs_eo_no = a.wrhs_eo_no 
							and trms_sctn_cd in ('C', 'U'))
	</statement>

	<statement name="retrieveTransferTranEoPartial">
		select 	
			  tran_eo_no
			, (SELECT nvl(MAX(trms_seq), 0) + 1 FROM tb_om03007i WHERE tran_eo_no = ${eoNo}) AS trms_seq
			, trms_seq as prev_trms_seq
			, ${trmsSctnCd} as trms_sctn_cd
			, corp_cd
			, tran_plan_cntr_cd
			, ord_mngt_exce_dept_cd
			, ord_mngt_exce_ofcr_id
			, ord_mngt_exce_ofcr_tel_no
			, sales_ord_no
			, cust_ord_no
			, ord_type_cd
			, ord_type_nm
			, logis_ar_cd
			, logis_domn_cd
			, ord_kind_cd
			, logis_svc_sctn_cd
			, add_svc_type_cd
			, ctrt_cust_cd
			, rpt_cust_cd
			, bilg_cust_cd
			, cust_ofcr_nm
			, cust_ofcr_tel_no
			, cust_of_cust_cd
			, cust_nm
			, cust_expr_yn
			, cls_expr_yn
			, lead_time_expr_yn
			, aft_ord_yn
			, dpt_ar_cd
			, dpt_ar_type_cd
			, dpt_ar_zip_cd
			, dpt_ar_zip_addr
			, dpt_ar_dtl_addr
			, dpt_ar_ofcr_nm
			, dpt_ar_ofcr_tel_no
			, arv_ar_cd
			, arv_ar_type_cd
			, arv_ar_zip_cd
			, arv_ar_zip_addr
			, arv_ar_dtl_addr
			, arv_ar_ofcr_nm
			, arv_ar_ofcr_tel_no
			, strt_req_ymd
			, strt_req_hm
			, aptd_req_ymd
			, aptd_req_hm
			, rmk
			, sales_ord_creat_ymd
			, sales_ord_creat_hms
			, exp_imp_dom_sctn_cd
			, ocean_air_sctn_cd
			, cargo_form_cd
			, fcl_lcl_sctn_cd
			, hbl_no
			, mbl_no
			, pol_cd
			, pod_cd
			, booking_no
			, ship_co_cd
			, ship_nm
			, port_cnt
			, dpt_port_prar_ymd
			, arv_port_prar_ymd
			, cy_cls_ymd
			, cy_cls_hms
			, cust_ord_type_cd
			, load_dly_yn
			, move_type_cd
			, move_type_nm
			, ord_creat_mthd_cd
			, self_tran_yn
			, drct_load_yn
			, exp_type_cd
			, plan_vanning_yn
			, col01
			, col02
			, col03
			, col04
			, col05
			, col06
			, col07
			, col08
			, col09
			, col10
			, col11
			, col12
			, col13
			, col14
			, col15
			, col16
			, col17
			, col18
			, col19
			, col20
			, col21
			, col22
			, col23
			, col24
			, col25
			, col26
			, col27
			, col28
			, col29
			, col30
			, 'N' as if_yn
			, ${regrId} as regr_id
			, ${mdfrId} as mdfr_id
		from tb_om03007i a
	   where tran_eo_no = ${eoNo}
		 and trms_seq = (select max(trms_seq) 
						   from tb_om03007i 
						  where	tran_eo_no = a.tran_eo_no 
							and trms_sctn_cd in ('C', 'U'))
	</statement>
	
	<statement name="retrieveTransferGiEoPartialItemList">
		select 
			  wrhs_eo_no
			, ${trmsSeq} as trms_seq
			, line_no
			, work_pl_cd
			, cust_cd
			, item_cd
			, bat_no
			, item_grade_cd
			, std_ord_qty
			, origin_ord_qty
			, ord_qty
			, qty_unit_cd
			, ord_wgt
			, wgt_unit_cd
			, lot_no
			, prdt_req_no
			, plant_cd
			, ord_reason_cd
			, cust_ord_line_no
			, cntr_no
			, bl_tot_wgt
			, bl_tot_admt
			, bl_unit_wgt
			, bl_unit_admt
			, pcul_mn_cd
			, col01
			, col02
			, col03
			, col04
			, col05
			, col06
			, col07
			, col08
			, col09
			, col10
			, col11
			, col12
			, col13
			, col14
			, col15
			, col16
			, col17
			, col18
			, col19
			, col20
			, col21
			, col22
			, col23
			, col24
			, col25
			, col26
			, col27
			, col28
			, col29
			, col30
			, sales_ord_line_no
			, ${regrId} as regr_id
			, ${mdfrId} as mdfr_id
		from  tb_om03010i
	   where  wrhs_eo_no = ${eoNo}
		 and  trms_seq = ${prevTrmsSeq}
		{#1}
	 <append condition="${trmsSctnCd}.EQ.Z" id="#1">
		 AND  sales_ord_line_no = ${lineNo}
	 </append>
		
	</statement>
	
	<statement name="retrieveTransferGrEoPartialItemList">
		select 
			  wrhs_eo_no
			, ${trmsSeq} as trms_seq
			, line_no
			, work_pl_cd
			, cust_cd
			, item_cd
			, bat_no
			, item_grade_cd
			, std_ord_qty
			, ord_qty
			, qty_unit_cd
			, ord_wgt
			, wgt_unit_cd
			, lot_no
			, ord_reason_cd
			, plant_cd
			, prdt_req_no
			, prdt_ymd
			, prdt_lot_no
			, dia_supl
			, papstyle_gds_supl
			, cntr_no
			, cust_ord_line_no
			, bl_unit_wgt
			, bl_unit_admt
			, pcul_mn_cd
			, to_char(gr_date, 'yyyymmddHH24miss') as gr_date
			, col01
			, col02
			, col03
			, col04
			, col05
			, col06
			, col07
			, col08
			, col09
			, col10
			, col11
			, col12
			, col13
			, col14
			, col15
			, col16
			, col17
			, col18
			, col19
			, col20
			, col21
			, col22
			, col23
			, col24
			, col25
			, col26
			, col27
			, col28
			, col29
			, col30
			, sales_ord_line_no
			, ${regrId} as regr_id
			, ${mdfrId} as mdfr_id
		from  tb_om03006i
	   where  wrhs_eo_no = ${eoNo}
		 and  trms_seq = ${prevTrmsSeq}
		{#1}
	  <append condition="${trmsSctnCd}.EQ.Z" id="#1">
		 AND  sales_ord_line_no = ${lineNo}
	  </append>
	</statement>
	
	<statement name="retrieveTransferTranEoPartialItemList">
		select 
			  tran_eo_no
			, ${trmsSeq} as trms_seq
			, line_no
			, cust_cd
			, item_cd
			, bat_no
			, ord_qty
			, qty_unit_cd
			, ord_wgt
			, wgt_unit_cd
			, ord_cbm
			, plant_cd
			, lot_no
			, prdt_req_no
			, prdt_prar_ymd
			, fe_sctn_cd
			, cntr_size_cd
			, cntr_no
			, danger_sctn_cd
			, seal_no1
			, seal_no2
			, pckg_unit_cd
			, pckg_qty
			, max_tmpt
			, min_tmpt
			, ord_reason_cd
			, cust_ord_line_no
			, pallet_qty
			, ref_wgt
			, bl_unit_wgt
			, bl_unit_admt
			, cntr_qty
			, pallet_unit_cbm
			, col01
			, col02
			, col03
			, col04
			, col05
			, col06
			, col07
			, col08
			, col09
			, col10
			, col11
			, col12
			, col13
			, col14
			, col15
			, col16
			, col17
			, col18
			, col19
			, col20
			, col21
			, col22
			, col23
			, col24
			, col25
			, col26
			, col27
			, col28
			, col29
			, col30
			, ${regrId} as regr_id
			, ${mdfrId} as mdfr_id
		from  tb_om03008i
	   where  tran_eo_no = ${eoNo}
		 and  trms_seq = ${prevTrmsSeq}
		 {#1}
	  <append condition="${trmsSctnCd}.EQ.Z" id="#1">
		 AND  line_no = ${lineNo}
	  </append>
	</statement>	
	
	<statement name="retrieveBlNoToSalesOrdPopup">
		SELECT A.SALES_ORD_NO
			,  DECODE(A.SALES_ORD_CNCL_YN, 'Y', '07', A.SALES_ORD_STAT_CD) SALES_ORD_STAT_CD
			,  B.HBL_NO
			,  B.MBL_NO
			,  A.RPT_CUST_CD AS CUST_CD
		    ,  MACOMM_GETPTNNM_FN(a.rpt_cust_cd ) AS cust_nm
		    ,  A.ORD_MNGT_FWD_OFCR_ID
		    ,  MACOMM_GETUSERNM_FN( a.ord_mngt_fwd_ofcr_id ) AS ord_mngt_fwd_ofcr_nm 
		    ,  A.SALES_ORD_CREAT_YMD || SALES_ORD_CREAT_HMS SALES_ORD_CREAT_TIME
		    ,  ${kind} as gubun
		  FROM TB_OM02001 A
			 , TB_OM02003 B
		 WHERE A.SALES_ORD_NO = B.SALES_ORD_NO
		   AND B.OCEAN_AIR_SCTN_CD = ${name}
		   AND A.EXP_IMP_DOM_SCTN_CD = '02'
		  {#1}
		<append condition="${kind}.EQ.H" id="#1">
		   AND B.HBL_NO = ${code}
		</append>
		<append condition="${kind}.EQ.M" id="#1">
		   AND B.MBL_NO = ${code}
		</append>
		
	</statement>

	<statement name="retrieveBlNoToSalesOrdPopup2">
		SELECT A.SALES_ORD_NO
			,  DECODE(A.SALES_ORD_CNCL_YN, 'Y', '07', A.SALES_ORD_STAT_CD) SALES_ORD_STAT_CD
			,  B.HBL_NO
			,  B.MBL_NO
			,  A.RPT_CUST_CD AS CUST_CD
		    ,  MACOMM_GETPTNNM_FN(a.rpt_cust_cd ) AS cust_nm
		    ,  A.ORD_MNGT_FWD_OFCR_ID
		    ,  MACOMM_GETUSERNM_FN( a.ord_mngt_fwd_ofcr_id ) AS ord_mngt_fwd_ofcr_nm 
		    ,  A.SALES_ORD_CREAT_YMD || SALES_ORD_CREAT_HMS SALES_ORD_CREAT_TIME
		    ,  ${kind} as gubun
		  FROM TB_OM02001 A
			 , TB_OM02003 B
		 WHERE A.SALES_ORD_NO = B.SALES_ORD_NO
		   AND B.OCEAN_AIR_SCTN_CD   = ${name}
		   AND A.EXP_IMP_DOM_SCTN_CD = ${comboCd}
		  {#1}
		<append condition="${kind}.EQ.H" id="#1">
		   AND B.HBL_NO = ${code}
		</append>
		<append condition="${kind}.EQ.M" id="#1">
		   AND B.MBL_NO = ${code}
		</append>
		
	</statement>	
	
	<statement name="retrieveCustOrdNoToSalesOrdPopup">
		SELECT a.SALES_ORD_NO as code
		     , a.rpt_cust_cd as CUST_CD
		     , MACOMM_GETPTNNM_FN(a.rpt_cust_cd ) AS cust_nm
		     , a.cust_ord_no
		     , b.mbl_no
		     , a.sales_ord_stat_cd
		     , a.sales_ord_cncl_yn
		     , a.sales_ord_cncl_reason
		  FROM TB_OM02001 A
			  ,TB_OM02003 B
		 WHERE A.SALES_ORD_NO = B.SALES_ORD_NO(+)
		   AND A.SALES_ORD_NO IN (
				SELECT DISTINCT SALES_ORD_NO
				  FROM ( SELECT SALES_ORD_NO
						   FROM	TB_OM02001
						  WHERE	CUST_ORD_NO = ${code}
						 union all
						 SELECT SALES_ORD_NO
						   FROM	TB_OM02002
						  WHERE	EXP_ORD_NO = ${code}
						)
			   )
		 order by a.rpt_cust_cd, a.sales_ord_no
	</statement>
	
	<statement name="retrieveSalesOrdCmptCheck">
		SELECT SALES_ORD_STAT_CD
		  FROM TB_OM02001
		 WHERE SALES_ORD_NO = ${salesOrdNo}
	</statement>

	<statement name="retrieveSaleOrdItemCmptCheck">
		SELECT COUNT(*) CNT
		  FROM TB_OM02002
		 WHERE SALES_ORD_NO = ${salesOrdNo}
		   AND DEL_YN != 'Y'
		   AND ORD_REASON_CD IS NULL
	</statement>

	<statement name="retrieveSaleOrdItemCmptList">
	    SELECT SALES_ORD_NO, LINE_NO
	      FROM (
		        SELECT  A.SALES_ORD_NO, A.LINE_NO, sum(A.ord_wgt) ord_wgt, sum(A.rslt_wgt) rslt_wgt
		          FROM TB_OM03002 a
			         , tb_om02002 b
			         , tb_om03001 c
		         WHERE a.SALES_ORD_NO = ${salesOrdNo}
		           AND A.SALES_ORD_NO = B.SALES_ORD_NO
		           AND A.SALES_ORD_NO = c.SALES_ORD_NO
		           AND A.WORK_ROUTE_SEQ = C.WORK_ROUTE_SEQ		
		           AND A.LINE_NO = B.LINE_NO
		           AND b.DEL_YN != 'Y'
		           and c.del_yn != 'Y'		
		           AND b.ORD_REASON_CD IS NULL
		         GROUP BY A.SALES_ORD_NO, A.LINE_NO)
	      WHERE ORD_WGT > RSLT_WGT
	</statement>

	<statement name="retrieveSaleOrdItemCmptList_temp">
	    SELECT SALES_ORD_NO, LINE_NO
	      FROM (
		         SELECT A.SALES_ORD_NO, A.LINE_NO, sum(A.ord_wgt) ord_wgt, sum(A.rslt_wgt) rslt_wgt
		           FROM TB_OM03002 a
			          , tb_om02002 b
		          WHERE	a.SALES_ORD_NO = ${salesOrdNo}
		            AND	A.SALES_ORD_NO = B.SALES_ORD_NO
		            AND	A.LINE_NO = B.LINE_NO
		            AND	b.DEL_YN != 'Y'
		            AND	b.ORD_REASON_CD IS NULL
		          GROUP BY A.SALES_ORD_NO, A.LINE_NO)
	      WHERE ORD_WGT > RSLT_WGT
	</statement>

	<statement name="retrieveSaleOrdItemCmptList_temp2">
	    SELECT SALES_ORD_NO, LINE_NO
	      FROM (
		         SELECT A.SALES_ORD_NO, A.LINE_NO, sum(A.ord_wgt) ord_wgt, sum(A.rslt_wgt) rslt_wgt
		           FROM TB_OM03002 a
			          , tb_om02002 b
			          , tb_om03001 c
		          WHERE	a.SALES_ORD_NO = ${salesOrdNo}
		            AND	A.SALES_ORD_NO = B.SALES_ORD_NO
		            AND A.SALES_ORD_NO = c.SALES_ORD_NO		
		            AND	A.LINE_NO = B.LINE_NO
		            AND	b.DEL_YN != 'Y'
		            and c.del_yn != 'Y'		
		            AND	b.ORD_REASON_CD IS NULL
		          GROUP BY A.SALES_ORD_NO, A.LINE_NO)
	     WHERE RSLT_WGT >= ORD_WGT
	</statement>

	<statement name="retrieveGiDocNoList">
		select deliv_doc_no as gi_doc_no
			 , sum(rslt_wgt) as rslt_wgt
		  from tb_om04003
		 where sales_ord_no 	= ${salesOrdNo}
		   and work_route_seq 	= ${workRouteSeq}
		   and work_step_seq 	= ${workStepSeq}
		   and rslt_dgr_cnt 	= ${rsltDgrCnt}
		   and line_no IN 	( ${lineNoList:varchar:in} )
		 group by deliv_doc_no
	</statement>

	<statement name="retrieveGiDocNoListBySalesOrdNo">
		select deliv_doc_no as gi_doc_no
		     , sales_ord_no
			 , sum(rslt_wgt) as rslt_wgt
		  from tb_om04003
		 where sales_ord_no 	= ${salesOrdNo}
		   and work_route_seq 	= ${workRouteSeq}
		   and work_step_seq 	= ${workStepSeq}
		   and rslt_dgr_cnt 	= ${rsltDgrCnt}
		   and line_no IN ( ${lineNoList:varchar:in} )
		 group by deliv_doc_no,sales_ord_no
	</statement>

	
	<statement name="retrieveOrdTypeSalesOrd">
		SELECT a.ord_type_cd
			 , a.logis_svc_sctn_cd
			 , a.logis_ar_cd
			 , a.ord_kind_cd
			 , nvl(a.avail_stock_conf_yn,'N') avail_stock_conf_yn
			 , b.upper_comn_cd AS exp_imp_dom_sctn_cd
			 , nvl(a.expr_mngt_yn,'N') expr_mngt_yn	
		  FROM  tb_om02001 m
		      , tb_ma01006 a 		
		      , tb_ma01015 b
		 WHERE m.ord_type_cd  = a.ord_type_cd
		   AND m.sales_ord_no = ${salesOrdNo}
		   AND b.clas_cd 	  = 'LOGIS_AR_CD'
		   AND a.logis_ar_cd  = b.comn_cd
  </statement>
  
  <statement name="retrieveSalesOrdCancelYn">
  	  SELECT SALES_ORD_CNCL_YN
  	    FROM TB_OM02001
  	   WHERE SALES_ORD_NO = ${salesOrdNo}
  </statement>
  
  <statement name="retrieveSalesOrdPartCmptPossCheck_back">
	SELECT CASE WHEN nvl(A.OUT_RSLT_QTY, 0) = nvl(B.IN_RSLT_QTY, 0) AND nvl(A.OUT_RSLT_WGT, 0) = nvl(B.IN_RSLT_WGT, 0) THEN
	                 'Y'
	            ELSE
	                 'N'
	       END POSS_CHECK
	FROM (
	    SELECT SUM(B.RSLT_QTY) OUT_RSLT_QTY
	         , SUM(B.RSLT_WGT) OUT_RSLT_WGT
	    FROM   TB_OM04001 A
	         , TB_OM04003 B
	    WHERE  A.SALES_ORD_NO = B.SALES_ORD_NO
	    AND    A.WORK_ROUTE_SEQ = B.WORK_ROUTE_SEQ
	    AND    A.WORK_STEP_SEQ = B.WORK_STEP_SEQ
	    AND    A.RSLT_DGR_CNT = B.RSLT_DGR_CNT
	    AND    A.SALES_ORD_NO = ${salesOrdNo}
	    AND	   B.LINE_NO      = ${lineNo}
	    AND    A.RSLT_SCTN_CD = '04') A
	 , (SELECT SUM(B.RSLT_QTY) IN_RSLT_QTY
	         , SUM(B.RSLT_WGT) IN_RSLT_WGT
	    FROM   TB_OM04001 A
	         , TB_OM04003 B
	    WHERE  A.SALES_ORD_NO = B.SALES_ORD_NO
	    AND    A.WORK_ROUTE_SEQ = B.WORK_ROUTE_SEQ
	    AND    A.WORK_STEP_SEQ = B.WORK_STEP_SEQ
	    AND    A.RSLT_DGR_CNT = B.RSLT_DGR_CNT
	    AND    A.SALES_ORD_NO = ${salesOrdNo}
	    AND	   B.LINE_NO      = ${lineNo}
	    AND    A.RSLT_SCTN_CD = '05') B
	</statement>
	
	<statement name="retrieveSalesOrdPartCmptPossCheck">
	<![CDATA[
	    SELECT CASE WHEN c.FLTR_CONTS1= 'QTY_UNIT_CD' and nvl(A.OUT_RSLT_QTY, 0) = nvl(B.IN_RSLT_QTY, 0) THEN  'Y' 
                    WHEN c.FLTR_CONTS1= 'WGT_UNIT_CD' AND nvl(A.OUT_RSLT_WGT, 0) = nvl(B.IN_RSLT_WGT, 0) THEN  'Y'   
                    WHEN c.FLTR_CONTS1= 'CBM'         AND nvl(A.OUT_RSLT_CBM, 0) = nvl(B.IN_RSLT_CBM, 0) THEN  'Y'
                    ELSE 'N'
               END POSS_CHECK
          FROM (SELECT SUM(B.RSLT_QTY) OUT_RSLT_QTY
                     , SUM(B.RSLT_WGT) OUT_RSLT_WGT
                     , SUM(B.RSLT_CBM) OUT_RSLT_CBM
                  FROM TB_OM04001 A
                     , TB_OM04003 B
                 WHERE A.SALES_ORD_NO   = B.SALES_ORD_NO
                   AND A.WORK_ROUTE_SEQ = B.WORK_ROUTE_SEQ
                   AND A.WORK_STEP_SEQ  = B.WORK_STEP_SEQ
                   AND A.RSLT_DGR_CNT   = B.RSLT_DGR_CNT
                   AND A.SALES_ORD_NO   = ${salesOrdNo}
                   AND B.LINE_NO        = ${lineNo}
                   AND A.RSLT_SCTN_CD   = '04') A
              ,(SELECT SUM(B.RSLT_QTY) IN_RSLT_QTY
                     , SUM(B.RSLT_WGT) IN_RSLT_WGT
                     , SUM(B.RSLT_CBM) IN_RSLT_CBM
                  FROM TB_OM04001 A
                     , TB_OM04003 B
                 WHERE A.SALES_ORD_NO   = B.SALES_ORD_NO
                   AND A.WORK_ROUTE_SEQ = B.WORK_ROUTE_SEQ
                   AND A.WORK_STEP_SEQ  = B.WORK_STEP_SEQ
                   AND A.RSLT_DGR_CNT   = B.RSLT_DGR_CNT
                   AND A.SALES_ORD_NO   = ${salesOrdNo}
                   AND B.LINE_NO        = ${lineNo}
                   AND A.RSLT_SCTN_CD   = '05') B
              ,(SELECT SALES_ORD_NO, LINE_NO, ORD_QTY, ORD_WGT, ORD_CBM, FLTR_CONTS1
                  FROM TB_OM02002 A
                     , TB_MA01015 B
                 WHERE A.SALES_ORD_NO   = ${salesOrdNo}
                   and a.line_no        = ${lineNo}
                   AND B.CLAS_CD        = 'BASIC_UNIT_CD'
                   AND A.BASIS_UNIT_CD  =  B.COMN_CD
                   and a.del_yn         = 'N' ) C
	]]> 
	</statement>
	
	<statement name="retrieveCustDcsnTrmsCd">
	    SELECT cust_dcsn_trms_cd
          FROM tb_om02102
         WHERE cust_cd = ${rptCustCd}
          {#1}
          {#2}
           AND ROWNUM = 1
      <append condition="${custOrdTypeCd}.NOTEMPTY" id="#1">
           AND cust_ord_type_cd = ${custOrdTypeCd}
      </append>
      <append condition="${custMoveTypeCd}.NOTEMPTY" id="#2">
           AND cust_move_type_cd = ${custMoveTypeCd}
      </append>
	</statement>

	<statement name="retrieveSalesOrdHeaderAll">
		SELECT   a.sales_ord_no
			, a.corp_cd
			, a.rpt_cust_cd
			, a.ord_type_cd
			, a.add_svc_type_cd
			, a.exp_imp_dom_sctn_cd
			, a.cargo_form_cd
			, a.ord_mngt_exce_dept_cd
			, a.ord_mngt_fwd_dept_cd
			, a.ord_mngt_exce_ofcr_id
			, a.ord_mngt_fwd_ofcr_id
			, a.tran_plan_cntr_cd
			, a.sales_ord_stat_cd
			, a.cust_ord_no
			, a.cust_cd
			, a.cust_ord_type_cd
			, a.cust_move_type_cd
			, a.cust_ord_recp_date
			, a.cust_ord_recp_chn_cd
			, a.ctrt_cust_cd
			, a.ctrt_no
			, a.ord_req_cust_cd
			, a.bilg_cust_cd
			, a.cust_ofcr_nm
			, a.cust_ofcr_tel_no
			, a.cust_of_cust_cd
			, a.sup_pl_cd
			, a.plant_cd
			, a.cust_ref_no
			, a.dpt_ar_cd
			, a.dpt_ar_type_cd
			, a.dpt_ar_zip_cd
			, a.dpt_ar_zip_addr
			, a.dpt_ar_dtl_addr
			, a.dpt_ar_ofcr_nm
			, a.dpt_ar_ofcr_tel_no
			, a.arv_ar_cd
			, a.arv_ar_type_cd
			, a.arv_ar_zip_cd
			, a.arv_ar_zip_addr
			, a.arv_ar_dtl_addr
			, a.arv_ar_ofcr_nm
			, a.arv_ar_ofcr_tel_no
			, a.work_pl_cd
			, a.strt_req_ymd
			, a.strt_req_hm
			, a.aptd_req_ymd
			, a.aptd_req_hm
			, a.sell_dept_cd
			, a.sales_ofcr_id
			, a.sell_dcsn_sctn_cd
			, a.cust_expr_yn
			, a.cls_expr_yn
			, a.lead_time_expr_yn
			, a.dtod_yn
			, a.rmk
			, a.load_dly_yn
			, a.load_dly_rltd_sales_ord_no
			, a.back_ord_yn
			, a.aft_ord_yn
			, a.chg_aptd_ymd
			, a.chg_aptd_hm
			, a.sales_ord_creat_ymd
			, a.sales_ord_creat_hms
			, a.sales_ord_cncl_yn
			, a.sales_ord_cncl_date
			, a.sales_ord_cncl_reason
			, a.sales_ord_cmpt_sctn_cd
			, a.sales_ord_cmpt_date
			, a.ord_reason_cd
			, a.rltd_gi_ord_no
			, a.work_info_mngt_type_cd
			, a.if_id
			, a.tran_eo_no
			, a.ltrm_ord_yn
			, a.rltd_gi_eo_no
			, a.ord_div_dgr_cnt
			, a.line_sctn_cd
			, a.dcnct_ord_yn
			, a.pay_cond_cd
			, a.move_type_cd
			, a.tran_cond_cd
			, a.gi_cncl_reason_cd
			, a.aptd_dly_cd
			, a.self_tran_yn
			, a.ord_verify_yn
			, b.ocean_air_sctn_cd
			, b.fcl_lcl_sctn_cd
			, b.bl_kind_cd
			, b.hbl_no
			, b.mbl_no
			, b.ctry_cd
			, b.pol_cd
			, b.pol_nm
			, b.pod_cd
			, b.pod_nm
			, b.dlv_pl_cd 
			, b.dlv_pl_nm 
			, b.fdest_cd
			, b.fdest_nm
			, b.ship_co_cd
			, b.ship_co_nm
			, b.ship_co_agnt_cd
			, b.airline_cd
			, b.ship_nm
			, b.port_cnt
			, b.incoterms_cd
			, b.dpt_svc_term_cd
			, b.arv_svc_term_cd
			, b.mark_conts
			, b.desc_conts
			, b.dpt_port_prar_ymd 
			, b.dpt_port_prar_hm
			, b.arv_port_prar_ymd 
			, b.arv_port_prar_hm
			, b.shipper_cd
			, b.shipper_nm
			, b.shipper_addr1
			, b.shipper_addr2
			, b.shipper_addr3
			, b.shipper_addr4
			, b.cnee_cd
			, b.cnee_nm
			, b.cnee_addr1
			, b.cnee_addr2
			, b.cnee_addr3
			, b.cnee_addr4
			, b.ntfy_cd
			, b.ntfy_nm
			, b.ntfy_addr1
			, b.ntfy_addr2
			, b.ntfy_addr3
			, b.ntfy_addr4
			, b.ptn_cd
			, b.ptn_nm
			, b.ptn_ofcr_nm
			, b.lc_no
			, b.ci_no
			, b.cntr_kind_cd1
			, b.cntr_qty1 
			, b.cntr_kind_cd2
			, b.cntr_qty2 
			, b.cntr_kind_cd3
			, b.cntr_qty3 
			, b.cntr_kind_cd4
			, b.cntr_qty4 
			, b.cntr_kind_cd5
			, b.cntr_qty5 
			, b.pckg_unit_cd
			, b.pckg_qty
			, b.tot_qty
			, b.qty_unit_cd
			, b.tot_wgt
			, b.wgt_unit_cd
			, b.tot_admt
			, b.tran_cost_wgt
			, b.tot_cbm
			, b.rpt_item_nm
			, b.danger_sctn_cd 
			, b.bond_tran_yn
			, b.tran_cost_pay_cond_cd
			, b.extr_expn_pay_cond_cd
			, b.mnfest_dclr_tgt_yn
			, b.ts_cd1
			, b.ts_cd2
			, b.ts_cd3
			, b.carr_cd1
			, b.carr_cd2
			, b.carr_cd3
			, b.co_load_entp_cd
			, b.arv_port_ymd
			, b.cgwrk_ymd 
			, b.det_frtime_days
			, b.dem_frtime_days
			, b.tot_frtime_days
			, b.frtime_expi_ymd
			, b.lc_expi_ymd
			, b.exp_cust_ord_sctn_cd
			, b.exp_type_cd
			, b.booking_no
		FROM	TB_OM02001 a
			, 	tb_om02003 b
		WHERE	a.SALES_ORD_NO = ${salesOrdNo}
		and		a.sales_ord_no = b.sales_ord_no(+)
	</statement>
	
  <statement name="retrieveSalesOrdPrclList">
  	SELECT   SALES_ORD_NO
			, COL01
			, COL02
			, COL03
			, COL04
			, COL05
			, COL06
			, COL07
			, COL08
			, COL09
			, COL10
			, COL11
			, COL12
			, COL13
			, COL14
			, COL15
			, COL16
			, COL17
			, COL18
			, COL19
			, COL20
			, COL21
			, COL22
			, COL23
			, COL24
			, COL25
			, COL26
			, COL27
			, COL28
			, COL29
			, COL30
  	FROM	TB_OM02004
  	WHERE	SALES_ORD_NO = ${salesOrdNo}
  </statement>	
  <statement name="retrieveSalesOrdItemPrclList">
  	SELECT   SALES_ORD_NO
			, LINE_NO
			, COL01
			, COL02
			, COL03
			, COL04
			, COL05
			, COL06
			, COL07
			, COL08
			, COL09
			, COL10
			, COL11
			, COL12
			, COL13
			, COL14
			, COL15
			, COL16
			, COL17
			, COL18
			, COL19
			, COL20
			, COL21
			, COL22
			, COL23
			, COL24
			, COL25
			, COL26
			, COL27
			, COL28
			, COL29
			, COL30
  	FROM	TB_OM02005
  	WHERE	SALES_ORD_NO = ${salesOrdNo}
	and		line_no IN 		( ${lineNo:varchar:in} )
  </statement>		
  
  <statement name="retrieveCancelGiCancelOrd">
  	SELECT COUNT(*) CNT
  	FROM	TB_OM04003 
  	WHERE	SALES_ORD_NO = ${salesOrdNo}
  	AND		WORK_ROUTE_SEQ = ${workRouteSeq}
  	AND		WORK_STEP_SEQ = ${workStepSeq}
  	AND		RSLT_DGR_CNT = ${rsltDgrCnt}
  	AND		LINE_NO = ${lineNo}
  	AND		CNCL_ORD_NO IS NOT NULL
  </statement>
  <statement name="retrieveMesCheck">
	select  count(*) as check_cnt
    from 	{#1}
    where 	WON_WORK_GROUP      = ${giDocNo}
    and 	ip_check_date is not null
       <append condition="${centerCd}.NOTEMPTY&amp;${centerCd}.EQ.0100000003" id="#1">
       	wj1t_warehouse_in@DL_MES_J
       </append>
       <append condition="${centerCd}.NOTEMPTY&amp;${centerCd}.EQ.0100000004" id="#1">
       	wj1t_warehouse_in@DL_MES_D
       </append>
       <append condition="${centerCd}.NOTEMPTY&amp;${centerCd}.EQ.0100000009" id="#1">
       	wj1t_warehouse_in@DL_MES_C
       </append>
       <append condition="${centerCd}.NOTEMPTY&amp;${centerCd}.EQ.0100000019" id="#1">
       	wj1t_warehouse_in@DL_MES_O
       </append>
       <append condition="${centerCd}.NOTEMPTY&amp;${centerCd}.EQ.0100000020" id="#1">
       	wj1t_warehouse_in@DL_MES_S
       </append>
       <append condition="${centerCd}.NOTEMPTY&amp;${centerCd}.EQ.0100000021" id="#1">
       	wj1t_warehouse_in@DL_MES_N
       </append>
   </statement>
  
  <statement name="retrieveSalesOrdCmptEoList">
  	SELECT  A.WRHS_EO_NO EO_NO
  		  , B.LINE_NO
  		  , ${regrId} as regr_id
  		  , ${mdfrId} as mdfr_id
  	FROM	TB_OM03009I A
  		,   TB_OM03010I B
  		, 	tb_om03015 c
  	WHERE	A.WRHS_EO_NO	= C.EO_NO
  	AND		A.WRHS_EO_NO 	= B.WRHS_EO_NO
  	AND		A.TRMS_SEQ 		= B.TRMS_SEQ
  	AND		A.SALES_ORD_NO 	= ${salesOrdNo}
  	AND		A.TRMS_SEQ 		= (SELECT MAX(TRMS_SEQ) FROM TB_OM03009I WHERE WRHS_EO_NO = A.WRHS_EO_NO AND TRMS_SCTN_CD in ('C', 'U'))
  	AND		B.SALES_ORD_LINE_NO IN ( ${lineNoList:varchar:in} )
  </statement>

	<statement name="retrieveSaleOrdItemCmptTargetList">
	SELECT X.SALES_ORD_NO, X.LINE_NO
	FROM (
		SELECT B.SALES_ORD_NO, B.LINE_NO
			 ,  SUM(A.RSLT_WGT) RSLT_WGT
			 ,  SUM(B.ORD_WGT) ORD_WGT
		 FROM	TB_OM03002 A
		 	  , TB_OM02002 B
		 WHERE	A.SALES_ORD_NO = ${salesOrdNo}
		 AND	A.SALES_ORD_NO = B.SALES_ORD_NO
		 AND	A.LINE_NO = B.LINE_NO
		 AND	B.DEL_YN != 'Y'
		 AND	B.ORD_REASON_CD IS NULL
		 GROUP BY SALES_ORD_NO, LINE_NO ) X
	WHERE  X.RSLT_WGT >= X.ORD_WGT
	</statement>
	
	<statement name="retrieveCancelGiExportHeaderJeonju">
		SELECT /* 전주센터 헤더 조회 */
			   a.rpt_cust_cd
		      ,'2059' AS ord_type_cd
		      ,(SELECT ord_type_nm
		        FROM   tb_ma01006
		        WHERE  ord_type_cd = '2059') AS ord_type_nm
		      ,'01' AS exp_imp_dom_sctn_cd
		      , '' ctrt_no
		      , '' ctrt_nm
		      ,a.cargo_form_cd
		      ,a.ctrt_cust_cd
		      ,(select ptn_nm from tb_ma01002 where ptn_cd = a.ctrt_cust_cd) ctrt_cust_nm
		      ,a.ord_req_cust_cd
		      ,a.SALES_OFCR_ID
	 	      , MACOMM_GETUSERNM_FN( a.sales_ofcr_id ) AS sales_ofcr_nm
		      ,b.pol_cd AS dpt_ar_cd
		      ,'01' AS dpt_ar_type_cd
	          ,( select name 
	            from   vw_ma01_01 
	            where  code         = b.pol_cd
	            and    work_sctn_cd = '01'
	            and    rownum       = 1) as dpt_ar_nm
		      ,c.zip_cd AS dpt_ar_zip_cd
		      ,c.zip_addr AS dpt_ar_zip_addr
		      ,c.dtl_addr AS dpt_ar_dtl_addr
		      ,a.dpt_ar_cd AS arv_ar_cd
		      ,a.dpt_ar_type_cd AS arv_ar_type_cd
	          ,( select name 
	            from   vw_ma01_01 
	            where  code         = a.dpt_ar_cd
	            and    work_sctn_cd = a.dpt_ar_type_cd
	            and    rownum       = 1) as arv_ar_nm
		      ,d.zip_cd AS arv_ar_zip_cd
		      ,d.zip_addr AS arv_ar_zip_addr
		      ,d.dtl_addr AS arv_ar_dtl_addr
		      ,'' as aptd_req_ymd
		      , '' as aptd_req_hm
		      ,a.cust_ord_no AS return_goods_cust_ord_no
		      ,'' AS return_goods_cust_vdsp_no
		      , '' cntr_no
		      , (select nvl(sum(ord_qty), 0)
		      	 from	tb_om02001 x
		      	 	  , tb_om02002 y
		      	 where	x.sales_ord_no = y.sales_ord_no
		      	 AND	X.SALES_ORD_CNCL_YN != 'Y'
		      	 and	x.return_goods_cust_ord_no = a.cust_ord_no) ord_qty_sum
		      , (select nvl(sum(ord_wgt), 0)
		      	 from	tb_om02001 x
		      	 	  , tb_om02002 y
		      	 where	x.sales_ord_no = y.sales_ord_no
		      	 AND	X.SALES_ORD_CNCL_YN != 'Y'
		      	 and	x.return_goods_cust_ord_no = a.cust_ord_no) ord_wgt_sum
		     , '' rmk
		FROM   tb_om02001 a
		      ,tb_om02002 b
		      ,tb_ma01005 c
		      ,tb_ma01005 d
		WHERE  a.sales_ord_no = b.sales_ord_no
		AND    b.pol_cd = c.work_pl_cd
		AND    a.dpt_ar_cd = d.work_pl_cd
		AND    b.line_no = (SELECT MIN(line_no)
		                    FROM   tb_om02002 c
		                    WHERE  c.del_yn = 'N'
		                    AND    c.sales_ord_no = a.sales_ord_no)
		AND    a.rpt_cust_cd = 'P1100'
		AND    a.dpt_ar_cd = '1000'
		AND    a.ord_type_cd = '5083'
		{#1}
       <append condition="${ordNoType}.NOTEMPTY&amp;${ordNoType}.EQ.S" id="#1">
		AND    a.sales_ord_no = ${ordNo}
		</append>
       <append condition="${ordNoType}.NOTEMPTY&amp;${ordNoType}.EQ.C" id="#1">
		AND    a.cust_ord_no = ${ordNo}
		</append>
	</statement>

	<statement name="retrieveCancelGiExportHeaderJeonjuChungWon">
		SELECT /* 전주센터, 청원센터 헤더 조회 */
			   a.rpt_cust_cd
		      ,'2059' AS ord_type_cd
		      ,(SELECT ord_type_nm
		        FROM   tb_ma01006
		        WHERE  ord_type_cd = '2059') AS ord_type_nm
		      ,'01' AS exp_imp_dom_sctn_cd
		      , '' ctrt_no
		      , '' ctrt_nm
		      ,a.cargo_form_cd
		      ,a.ctrt_cust_cd
		      ,(select ptn_nm from tb_ma01002 where ptn_cd = a.ctrt_cust_cd) ctrt_cust_nm
		      ,a.ord_req_cust_cd
		      ,a.SALES_OFCR_ID
	 	      , MACOMM_GETUSERNM_FN( a.sales_ofcr_id ) AS sales_ofcr_nm
		      ,b.pol_cd AS dpt_ar_cd
		      ,'01' AS dpt_ar_type_cd
	          ,( select name 
	            from   vw_ma01_01 
	            where  code         = b.pol_cd
	            and    work_sctn_cd = '01'
	            and    rownum       = 1) as dpt_ar_nm
		      ,c.zip_cd AS dpt_ar_zip_cd
		      ,c.zip_addr AS dpt_ar_zip_addr
		      ,c.dtl_addr AS dpt_ar_dtl_addr
		      ,a.dpt_ar_cd AS arv_ar_cd
		      ,a.dpt_ar_type_cd AS arv_ar_type_cd
	          ,( select name 
	            from   vw_ma01_01 
	            where  code         = a.dpt_ar_cd
	            and    work_sctn_cd = a.dpt_ar_type_cd
	            and    rownum       = 1) as arv_ar_nm
		      ,d.zip_cd AS arv_ar_zip_cd
		      ,d.zip_addr AS arv_ar_zip_addr
		      ,d.dtl_addr AS arv_ar_dtl_addr
		      ,'' as aptd_req_ymd
		      , '' as aptd_req_hm
		      ,a.cust_ord_no AS return_goods_cust_ord_no
		      ,'' AS return_goods_cust_vdsp_no
		      , '' cntr_no
		      , (select nvl(sum(ord_qty), 0)
		      	 from	tb_om02001 x
		      	 	  , tb_om02002 y
		      	 where	x.sales_ord_no = y.sales_ord_no
		      	 AND	X.SALES_ORD_CNCL_YN != 'Y'
		      	 and	x.return_goods_cust_ord_no = a.cust_ord_no) ord_qty_sum
		      , (select nvl(sum(ord_wgt), 0)
		      	 from	tb_om02001 x
		      	 	  , tb_om02002 y
		      	 where	x.sales_ord_no = y.sales_ord_no
		      	 AND	X.SALES_ORD_CNCL_YN != 'Y'
		      	 and	x.return_goods_cust_ord_no = a.cust_ord_no) ord_wgt_sum
		     , '' rmk
		FROM   tb_om02001 a
		      ,tb_om02002 b
		      ,tb_ma01005 c
		      ,tb_ma01005 d
		WHERE  a.sales_ord_no = b.sales_ord_no
		AND    b.pol_cd = c.work_pl_cd
		AND    a.dpt_ar_cd = d.work_pl_cd
		AND    b.line_no = (SELECT MIN(line_no)
		                    FROM   tb_om02002 c
		                    WHERE  c.del_yn = 'N'
		                    AND    c.sales_ord_no = a.sales_ord_no)
		AND    a.rpt_cust_cd = 'P1100'
		AND    a.dpt_ar_cd in ( '1000','1310')
		AND    a.ord_type_cd = '5083'
		{#1}
       <append condition="${ordNoType}.NOTEMPTY&amp;${ordNoType}.EQ.S" id="#1">
		AND    a.sales_ord_no = ${ordNo}
		</append>
       <append condition="${ordNoType}.NOTEMPTY&amp;${ordNoType}.EQ.C" id="#1">
		AND    a.cust_ord_no = ${ordNo}
		</append>
	</statement>

	
	<statement name="retrieveCancelGiExportItemJeonju_back">
		SELECT /* 전주센터 아이템 조회 */
			  'F' chk
			  ,b.cust_cd
			  ,b.line_no
		      ,b.item_cd
		      ,c.item_nm
		      ,b.basis_item_cd
		      ,0 as ord_qty
		      ,b.qty_unit_cd
		      ,0 as ord_wgt
		      ,b.wgt_unit_cd
		      ,b.basis_unit_cd
		      ,b.bat_no
		      ,b.prdt_req_no
		      ,b.plant_cd
		      ,b.pcul_cd
		      ,b.mn_cd
		      ,d.rslt_qty as in_port_qty
		      ,d.rslt_wgt as in_port_wgt
		      ,e.rslt_qty as out_port_qty
		      ,e.rslt_wgt as out_port_wgt
		      ,b.cust_ord_line_no AS return_goods_cust_line_no
		      , '' return_goods_cust_mnf_no
                      ,(SELECT sum(y.ord_qty)
                          FROM tb_om02001 x
                              ,tb_om02002 y
                         WHERE  x.sales_ord_no = y.sales_ord_no
                           AND  x.sales_ord_cncl_yn = 'N'
                           AND  x.return_goods_cust_ord_no = a.cust_ord_no
                           AND  y.return_goods_cust_line_no = b.cust_ord_line_no) AS return_ord_qty
                      ,(SELECT sum(y.ord_wgt)
                          FROM tb_om02001 x
                              ,tb_om02002 y
                         WHERE x.sales_ord_no = y.sales_ord_no
                           AND x.sales_ord_cncl_yn = 'N'
                           AND x.return_goods_cust_ord_no = a.cust_ord_no
                           AND y.return_goods_cust_line_no = b.cust_ord_line_no) AS return_ord_wgt
		FROM   tb_om02001 a
		      ,tb_om02002 b
		      ,tb_ma02010 c
		      ,(select  a.sales_ord_no
		      		  , a.line_no
		      		  , sum(a.RSLT_QTY) rslt_qty
		      		  , sum(a.RSLT_wgt) rslt_wgt
		          from  tb_om04003 a
		        	  , tb_om04001 b
		         where	a.sales_ord_no = b.sales_ord_no
		           and	a.work_route_seq = b.work_route_seq
		           and	a.work_step_seq = b.work_step_seq
		           and	a.rslt_dgr_cnt = b.rslt_dgr_cnt
		           and	b.work_step_seq = '30'
		           and	b.rslt_sctn_cd = '05'
		         group by a.sales_ord_no, a.line_no) d
		      ,(select  a.sales_ord_no
		      		  , a.line_no
		      		  , sum(a.RSLT_QTY) rslt_qty
		      		  , sum(a.RSLT_wgt) rslt_wgt
		          from  tb_om04003 a
		        	  , tb_om04001 b
		         where	a.sales_ord_no = b.sales_ord_no
		           and	a.work_route_seq = b.work_route_seq
		           and	a.work_step_seq = b.work_step_seq
		           and	a.rslt_dgr_cnt = b.rslt_dgr_cnt
		           and	b.work_step_seq = '40'
		           and	b.rslt_sctn_cd = '04'
		         group by a.sales_ord_no, a.line_no) e
		WHERE  a.sales_ord_no = b.sales_ord_no
		  AND  a.rpt_cust_cd = 'P1100'
		  AND  a.dpt_ar_cd = '1000'
		  AND  a.ord_type_cd = '5083'
		  and  b.cust_cd = c.ptn_cd
		  and  b.item_cd = c.item_cd
		  and  b.sales_ord_no = d.sales_ord_no(+)
		  and  b.sales_ord_no = e.sales_ord_no(+)
		  and  b.line_no = d.line_no(+)
		  and  b.line_no = e.line_no(+)
		{#1}
       <append condition="${ordNoType}.NOTEMPTY&amp;${ordNoType}.EQ.S" id="#1">
		  AND    a.sales_ord_no = ${ordNo}
		</append>
       <append condition="${ordNoType}.NOTEMPTY&amp;${ordNoType}.EQ.C" id="#1">
		  AND    a.cust_ord_no = ${ordNo}
		</append>
	</statement>


	<statement name="retrieveCancelGiExportItemJeonju">
		SELECT /* 전주센터 아이템 조회 */
		      /*+ leading(a) use_hash( a b c) */
			  'F' chk
			  ,b.cust_cd
			  ,b.line_no
		      ,b.item_cd
		      ,c.item_nm
		      ,b.basis_item_cd
		      ,0 as ord_qty
		      ,b.qty_unit_cd
		      ,0 as ord_wgt
		      ,b.wgt_unit_cd
		      ,b.basis_unit_cd
		      ,b.bat_no
		      ,b.prdt_req_no
		      ,b.plant_cd
		      ,b.pcul_cd
		      ,b.mn_cd
		      ,(select  sum(x.RSLT_QTY) rslt_qty
		          from  tb_om04003 x
		        	  , tb_om04001 y
		         where	x.sales_ord_no = a.sales_ord_no
		           and  x.line_no      = b.line_no
		           and  x.sales_ord_no = y.sales_ord_no
		           and	x.work_route_seq = y.work_route_seq
		           and	x.work_step_seq = y.work_step_seq
		           and	x.rslt_dgr_cnt = y.rslt_dgr_cnt
		           and	y.work_step_seq = '30'
		           and	y.rslt_sctn_cd = '05'
		         group by x.sales_ord_no, x.line_no) in_port_qty		      
		      ,(select  sum(x.RSLT_wgt) rslt_wgt
		          from  tb_om04003 x
		        	  , tb_om04001 y
		         where	x.sales_ord_no = a.sales_ord_no
		           and  x.line_no      = b.line_no
		           and  x.sales_ord_no = y.sales_ord_no
		           and	x.work_route_seq = y.work_route_seq
		           and	x.work_step_seq = y.work_step_seq
		           and	x.rslt_dgr_cnt = y.rslt_dgr_cnt
		           and	y.work_step_seq = '30'
		           and	y.rslt_sctn_cd = '05'
		         group by x.sales_ord_no, x.line_no) in_port_wgt		      
		      ,(select  sum(x.RSLT_QTY) rslt_qty
		          from  tb_om04003 x
		        	  , tb_om04001 y
		         where	x.sales_ord_no = a.sales_ord_no
		           and  x.line_no      = b.line_no
		           and  x.sales_ord_no = y.sales_ord_no
		           and	x.work_route_seq = y.work_route_seq
		           and	x.work_step_seq = y.work_step_seq
		           and	x.rslt_dgr_cnt = y.rslt_dgr_cnt
		           and	y.work_step_seq = '40'
		           and	y.rslt_sctn_cd = '04'
		         group by x.sales_ord_no, x.line_no) out_port_qty
		      ,(select  sum(x.RSLT_wgt) rslt_wgt
		          from  tb_om04003 x
		        	  , tb_om04001 y
		         where	x.sales_ord_no = a.sales_ord_no
		           and  x.line_no      = b.line_no
		           and  x.sales_ord_no = y.sales_ord_no
		           and	x.work_route_seq = y.work_route_seq
		           and	x.work_step_seq = y.work_step_seq
		           and	x.rslt_dgr_cnt = y.rslt_dgr_cnt
		           and	y.work_step_seq = '40'
		           and	y.rslt_sctn_cd = '04'
		         group by x.sales_ord_no, x.line_no) out_port_wgt		      
		      ,b.cust_ord_line_no AS return_goods_cust_line_no
		      , '' return_goods_cust_mnf_no
                      ,(SELECT   sum(y.ord_qty)
                        FROM   tb_om02001 x
                              ,tb_om02002 y
                        WHERE  x.sales_ord_no = y.sales_ord_no
                        AND    x.sales_ord_cncl_yn = 'N'
                        AND    x.return_goods_cust_ord_no = a.cust_ord_no
                        AND    y.return_goods_cust_line_no = b.cust_ord_line_no) AS return_ord_qty
                      ,(SELECT  sum(y.ord_wgt)
                        FROM   tb_om02001 x
                              ,tb_om02002 y
                        WHERE  x.sales_ord_no = y.sales_ord_no
                        AND    x.sales_ord_cncl_yn = 'N'
                        AND    x.return_goods_cust_ord_no = a.cust_ord_no
                        AND    y.return_goods_cust_line_no = b.cust_ord_line_no) AS return_ord_wgt
		FROM   tb_om02001 a
		      ,tb_om02002 b
		      ,tb_ma02010 c
		WHERE  a.sales_ord_no = b.sales_ord_no
		  AND  a.rpt_cust_cd = 'P1100'
		  AND  a.dpt_ar_cd = '1000'
	      AND  a.ord_type_cd = '5083'
		  and  b.cust_cd = c.ptn_cd
		  and  b.item_cd = c.item_cd
		{#1}
       <append condition="${ordNoType}.NOTEMPTY&amp;${ordNoType}.EQ.S" id="#1">
		AND    a.sales_ord_no = ${ordNo}
		</append>
       <append condition="${ordNoType}.NOTEMPTY&amp;${ordNoType}.EQ.C" id="#1">
		AND    a.cust_ord_no = ${ordNo}
		</append>
	</statement>



	<statement name="retrieveCancelGiExportItemJeonjuChungwon">
		SELECT /* 전주센터, 청원센터  아이템 조회 */
			  'F' chk
			  ,b.cust_cd
			  ,b.line_no
		      ,b.item_cd
		      ,c.item_nm
		      ,b.basis_item_cd
		      ,0 as ord_qty
		      ,b.qty_unit_cd
		      ,0 as ord_wgt
		      ,b.wgt_unit_cd
		      ,b.basis_unit_cd
		      ,b.bat_no
		      ,b.prdt_req_no
		      ,b.plant_cd
		      ,b.pcul_cd
		      ,b.mn_cd
		     -- ,d.rslt_qty as in_port_qty
		      ,(select  sum(x.RSLT_QTY) rslt_qty
		      	  from	tb_om04003 x
		        	  , tb_om04001 y
		        where	x.sales_ord_no = y.sales_ord_no
		        and		x.work_route_seq = y.work_route_seq
		        and		x.work_step_seq = y.work_step_seq
		        and		x.rslt_dgr_cnt = y.rslt_dgr_cnt
		        and		y.work_step_seq = '30'
		        and		y.rslt_sctn_cd = '05'
		        and     x.sales_ord_no = a.sales_ord_no
		        and     x.line_no  = b.line_no
		        and     to_char(y.work_date,'yyyymm') != to_char(sysdate,'yyyymm')
		        ) in_port_qty		      
		     -- ,d.rslt_wgt as in_port_wgt
		      ,(select sum(x.RSLT_wgt) rslt_wgt
		        from	tb_om04003 x
		        	  , tb_om04001 y
		        where	x.sales_ord_no = y.sales_ord_no
		        and		x.work_route_seq = y.work_route_seq
		        and		x.work_step_seq = y.work_step_seq
		        and		x.rslt_dgr_cnt = y.rslt_dgr_cnt
		        and		y.work_step_seq = '30'
		        and		y.rslt_sctn_cd = '05'
		        and     x.sales_ord_no = a.sales_ord_no
		        and     x.line_no  = b.line_no
		        and     to_char(y.work_date,'yyyymm') != to_char(sysdate,'yyyymm')
		        ) in_port_wgt			      
		      ,(select sum(x.RSLT_QTY) rslt_qty
		      		 
		        from	tb_om04003 x
		        	  , tb_om04001 y
		        where	x.sales_ord_no = y.sales_ord_no
		        and		x.work_route_seq = y.work_route_seq
		        and		x.work_step_seq = y.work_step_seq
		        and		x.rslt_dgr_cnt = y.rslt_dgr_cnt
		        and		y.work_step_seq = '40'
		        and		y.rslt_sctn_cd = '04'
		        and     x.sales_ord_no = a.sales_ord_no
		        and     x.line_no  = b.line_no) out_port_qty		      
		     -- ,d.rslt_wgt as in_port_wgt
		      ,(select sum(x.RSLT_wgt) rslt_wgt
		        from	tb_om04003 x
		        	  , tb_om04001 y
		        where	x.sales_ord_no = y.sales_ord_no
		        and		x.work_route_seq = y.work_route_seq
		        and		x.work_step_seq = y.work_step_seq
		        and		x.rslt_dgr_cnt = y.rslt_dgr_cnt
		        and		y.work_step_seq = '40'
		        and		y.rslt_sctn_cd = '04'
		        and     x.sales_ord_no = a.sales_ord_no
		        and     x.line_no  = b.line_no) out_port_wgt	
		        		      
--		      ,e.rslt_qty as out_port_qty
--		      ,e.rslt_wgt as out_port_wgt
		      ,b.cust_ord_line_no AS return_goods_cust_line_no
		      , '' return_goods_cust_mnf_no
                      ,(SELECT sum(y.ord_qty)
                        FROM   tb_om02001 x
                              ,tb_om02002 y
                        WHERE  x.sales_ord_no = y.sales_ord_no
                        AND    x.sales_ord_cncl_yn = 'N'
                        AND    x.return_goods_cust_ord_no = a.cust_ord_no
                        AND    y.return_goods_cust_line_no = b.cust_ord_line_no) AS return_ord_qty
                      ,(SELECT sum(y.ord_wgt)
                        FROM   tb_om02001 x
                              ,tb_om02002 y
                        WHERE  x.sales_ord_no = y.sales_ord_no
                        AND    x.sales_ord_cncl_yn = 'N'
                        AND    x.return_goods_cust_ord_no = a.cust_ord_no
                        AND    y.return_goods_cust_line_no = b.cust_ord_line_no) AS return_ord_wgt
		FROM   tb_om02001 a
		      ,tb_om02002 b
		      ,tb_ma02010 c

		WHERE  a.sales_ord_no = b.sales_ord_no
		AND    a.rpt_cust_cd = 'P1100'
		AND    a.dpt_ar_cd in ( '1000','1310')
		AND    a.ord_type_cd = '5083'
		and		b.cust_cd = c.ptn_cd
		and		b.item_cd = c.item_cd
	
		{#1}
       <append condition="${ordNoType}.NOTEMPTY&amp;${ordNoType}.EQ.S" id="#1">
		AND    a.sales_ord_no = ${ordNo}
		</append>
       <append condition="${ordNoType}.NOTEMPTY&amp;${ordNoType}.EQ.C" id="#1">
		AND    a.cust_ord_no = ${ordNo}
		</append>
	</statement>	

	<statement name="retrieveCancelGiExportItemJeonjuChungwon_back">
		SELECT /* 전주센터, 청원센터  아이템 조회 */
			  'F' chk
			  ,b.cust_cd
			  ,b.line_no
		      ,b.item_cd
		      ,c.item_nm
		      ,b.basis_item_cd
		      ,0 as ord_qty
		      ,b.qty_unit_cd
		      ,0 as ord_wgt
		      ,b.wgt_unit_cd
		      ,b.basis_unit_cd
		      ,b.bat_no
		      ,b.prdt_req_no
		      ,b.plant_cd
		      ,b.pcul_cd
		      ,b.mn_cd
		      ,d.rslt_qty as in_port_qty
		      ,d.rslt_wgt as in_port_wgt
		      ,e.rslt_qty as out_port_qty
		      ,e.rslt_wgt as out_port_wgt
		      ,b.cust_ord_line_no AS return_goods_cust_line_no
		      , '' return_goods_cust_mnf_no
                      ,(SELECT sum(y.ord_qty)
                        FROM   tb_om02001 x
                              ,tb_om02002 y
                        WHERE  x.sales_ord_no = y.sales_ord_no
                        AND    x.sales_ord_cncl_yn = 'N'
                        AND    x.return_goods_cust_ord_no = a.cust_ord_no
                        AND    y.return_goods_cust_line_no = b.cust_ord_line_no) AS return_ord_qty
                      ,(SELECT sum(y.ord_wgt)
                        FROM   tb_om02001 x
                              ,tb_om02002 y
                        WHERE  x.sales_ord_no = y.sales_ord_no
                        AND    x.sales_ord_cncl_yn = 'N'
                        AND    x.return_goods_cust_ord_no = a.cust_ord_no
                        AND    y.return_goods_cust_line_no = b.cust_ord_line_no) AS return_ord_wgt
		FROM   tb_om02001 a
		      ,tb_om02002 b
		      ,tb_ma02010 c
		      ,(select a.sales_ord_no
		      		  , a.line_no
		      		  , sum(a.RSLT_QTY) rslt_qty
		      		  , sum(a.RSLT_wgt) rslt_wgt
		        from	tb_om04003 a
		        	  , tb_om04001 b
		        where	a.sales_ord_no = b.sales_ord_no
		        and		a.work_route_seq = b.work_route_seq
		        and		a.work_step_seq = b.work_step_seq
		        and		a.rslt_dgr_cnt = b.rslt_dgr_cnt
		        and		b.work_step_seq = '30'
		        and		b.rslt_sctn_cd = '05'
		        group by a.sales_ord_no, a.line_no) d
		      ,(select a.sales_ord_no
		      		  , a.line_no
		      		  , sum(a.RSLT_QTY) rslt_qty
		      		  , sum(a.RSLT_wgt) rslt_wgt
		        from	tb_om04003 a
		        	  , tb_om04001 b
		        where	a.sales_ord_no = b.sales_ord_no
		        and		a.work_route_seq = b.work_route_seq
		        and		a.work_step_seq = b.work_step_seq
		        and		a.rslt_dgr_cnt = b.rslt_dgr_cnt
		        and		b.work_step_seq = '40'
		        and		b.rslt_sctn_cd = '04'
		        group by a.sales_ord_no, a.line_no) e
		WHERE  a.sales_ord_no = b.sales_ord_no
		AND    a.rpt_cust_cd = 'P1100'
		AND    a.dpt_ar_cd in ( '1000','1310')
		AND    a.ord_type_cd = '5083'
		and		b.cust_cd = c.ptn_cd
		and		b.item_cd = c.item_cd
		and	   b.sales_ord_no = d.sales_ord_no(+)
		and		b.sales_ord_no = e.sales_ord_no(+)
		and		b.line_no = d.line_no(+)
		and		b.line_no = e.line_no(+)
		{#1}
       <append condition="${ordNoType}.NOTEMPTY&amp;${ordNoType}.EQ.S" id="#1">
		AND    a.sales_ord_no = ${ordNo}
		</append>
       <append condition="${ordNoType}.NOTEMPTY&amp;${ordNoType}.EQ.C" id="#1">
		AND    a.cust_ord_no = ${ordNo}
		</append>
	</statement>		
	<statement name="retrieveCancelGiExportHeaderChungwon">
	/* 청원센터 헤더 조회 */
	SELECT a.rpt_cust_cd
	      ,'2060' AS ord_type_cd
	      ,(SELECT ord_type_nm
	        FROM   tb_ma01006
	        WHERE  ord_type_cd = '2060') AS ord_type_nm
	      ,'01' AS exp_imp_dom_sctn_cd
	      , '' ctrt_no
	      , '' ctrt_nm
	      ,a.cargo_form_cd
	      ,a.ctrt_cust_cd
	      ,(select ptn_nm from tb_ma01002 where ptn_cd = a.ctrt_cust_cd) ctrt_cust_nm
	      ,a.sales_ofcr_id
 	      , MACOMM_GETUSERNM_FN( a.sales_ofcr_id ) AS sales_ofcr_nm
	      ,a.ord_req_cust_cd
	      ,a.arv_ar_cd AS dpt_ar_cd
	      ,'01' AS dpt_ar_type_cd
          ,( select name 
            from   vw_ma01_01 
            where  code         = a.arv_ar_cd
            and    work_sctn_cd = '01'
            and    rownum       = 1) as dpt_ar_nm
		  ,c.zip_cd AS dpt_ar_zip_cd
	      ,c.zip_addr AS dpt_ar_zip_addr
	      ,c.dtl_addr AS dpt_ar_dtl_addr
	      ,'' AS arv_ar_cd
	      ,'' AS arv_ar_type_cd
	      ,'' as arv_ar_nm
	      ,'' AS arv_ar_zip_cd
	      ,'' AS arv_ar_zip_addr
	      ,'' AS arv_ar_dtl_addr
	      ,'' as aptd_req_ymd
	      , '' as aptd_req_hm
	      ,a.cust_ref_no AS return_goods_cust_ord_no
	      ,a.cust_ord_no AS return_goods_cust_vdsp_no
	      ,decode(a.cargo_form_cd, 'C', b.col04, '') as cntr_no
		      , (select nvl(sum(ord_qty), 0)
		      	 from	tb_om02001 x
		      	 	  , tb_om02002 y
		      	 where	x.sales_ord_no = y.sales_ord_no
		      	 AND	X.SALES_ORD_CNCL_YN != 'Y'
		      	 and	x.return_goods_cust_vdsp_no = a.cust_ord_no) ord_qty_sum
		      , (select nvl(sum(ord_wgt), 0)
		      	 from	tb_om02001 x
		      	 	  , tb_om02002 y
		      	 where	x.sales_ord_no = y.sales_ord_no		      	 
		      	 AND	X.SALES_ORD_CNCL_YN != 'Y'
		      	 and	x.return_goods_cust_vdsp_no = a.cust_ord_no) ord_wgt_sum
		  , '' rmk
	FROM   tb_om02001 a
	      ,tb_om02004 b
		  ,tb_ma01005 c
	WHERE  a.sales_ord_no = b.sales_ord_no
	AND    a.arv_ar_cd = c.work_pl_cd
	AND    a.rpt_cust_cd = 'P1100'
	AND    a.ord_type_cd = '2058'
		{#1}
       <append condition="${ordNoType}.NOTEMPTY&amp;${ordNoType}.EQ.S" id="#1">
		AND    a.sales_ord_no = ${ordNo}
		</append>
       <append condition="${ordNoType}.NOTEMPTY&amp;${ordNoType}.EQ.C" id="#1">
		AND    a.cust_ord_no = ${ordNo}
		</append>
	</statement>
	
	<statement name="retrieveCancelGiExportItemChungwonBulk">
		SELECT /* 청원센터 아이템 조회 */
		 	  'F' chk
			  ,b.cust_cd
			  ,b.line_no
			  ,b.item_cd
		      ,f.item_nm
		      ,b.basis_item_cd
		      ,0 as ord_qty
		      ,b.qty_unit_cd
		      ,0 as ord_wgt
		      ,b.wgt_unit_cd
		      ,b.basis_unit_cd
		      ,b.bat_no
		      ,b.prdt_req_no
		      ,b.plant_cd
		      ,b.pcul_cd
		      ,b.mn_cd
		      ,d.rslt_qty as in_port_qty
		      ,d.rslt_wgt as in_port_wgt
		      ,e.rslt_qty as out_port_qty
		      ,e.rslt_wgt as out_port_wgt
		      ,c.col01 AS return_goods_cust_line_no
		      ,b.mnf_no AS return_goods_cust_mnf_no
                      ,(SELECT sum(y.ord_qty)
                        FROM   tb_om02001 x
                              ,tb_om02002 y
                        WHERE  x.sales_ord_no = y.sales_ord_no
                        AND    x.sales_ord_cncl_yn = 'N'
                        AND    x.return_goods_cust_vdsp_no = a.cust_ord_no
                        AND    y.return_goods_cust_mnf_no = b.mnf_no) AS return_ord_qty
                      ,(SELECT sum(y.ord_wgt)
                        FROM   tb_om02001 x
                              ,tb_om02002 y
                        WHERE  x.sales_ord_no = y.sales_ord_no
                        AND    x.sales_ord_cncl_yn = 'N'
                        AND    x.return_goods_cust_vdsp_no = a.cust_ord_no
                        AND    y.return_goods_cust_mnf_no = b.mnf_no) AS return_ord_wgt
		FROM   tb_om02001 a
		      ,tb_om02002 b
		      ,tb_om02005 c
		      ,tb_ma02010 f
		      ,(select a.sales_ord_no
		      		  , a.line_no
		      		  , sum(a.RSLT_QTY) rslt_qty
		      		  , sum(a.RSLT_wgt) rslt_wgt
		        from	tb_om04003 a
		        	  , tb_om04001 b
		        where	a.sales_ord_no = b.sales_ord_no
		        and		a.work_route_seq = b.work_route_seq
		        and		a.work_step_seq = b.work_step_seq
		        and		a.rslt_dgr_cnt = b.rslt_dgr_cnt
		        and		b.work_step_seq = '10'
		        and		b.rslt_sctn_cd = '05'
		        group by a.sales_ord_no, a.line_no) d
		      ,(select a.sales_ord_no
		      		  , a.line_no
		      		  , sum(a.RSLT_QTY) rslt_qty
		      		  , sum(a.RSLT_wgt) rslt_wgt
		        from	tb_om04003 a
		        	  , tb_om04001 b
		        where	a.sales_ord_no = b.sales_ord_no
		        and		a.work_route_seq = b.work_route_seq
		        and		a.work_step_seq = b.work_step_seq
		        and		a.rslt_dgr_cnt = b.rslt_dgr_cnt
		        and		b.work_step_seq = '20'
		        and		b.rslt_sctn_cd = '04'
		        group by a.sales_ord_no, a.line_no) e
		WHERE  a.sales_ord_no = b.sales_ord_no
		AND    b.sales_ord_no = c.sales_ord_no
		AND    b.line_no = c.line_no
		AND    a.rpt_cust_cd = 'P1100'
		AND    a.ord_type_cd = '2058'
		and		b.cust_cd = f.ptn_cd
		and		b.item_cd = f.item_cd
		and	   b.sales_ord_no = d.sales_ord_no(+)
		and		b.sales_ord_no = e.sales_ord_no(+)
		and		b.line_no = d.line_no(+)
		and		b.line_no = e.line_no(+)
		{#1}
       <append condition="${ordNoType}.NOTEMPTY&amp;${ordNoType}.EQ.S" id="#1">
		AND    a.sales_ord_no = ${ordNo}
		</append>
       <append condition="${ordNoType}.NOTEMPTY&amp;${ordNoType}.EQ.C" id="#1">
		AND    a.cust_ord_no = ${ordNo}
		</append>
	</statement>


	<statement name="retrieveCancelGiExportItemChungwonBulkNew">
		SELECT /* 청원센터 아이템 조회 */
		 	  'F' chk
			  ,b.cust_cd
			  ,b.line_no
			  ,b.item_cd
		      ,f.item_nm
		      ,b.basis_item_cd
		      ,0 as ord_qty
		      ,b.qty_unit_cd
		      ,0 as ord_wgt
		      ,b.wgt_unit_cd
		      ,b.basis_unit_cd
		      ,b.bat_no
		      ,b.prdt_req_no
		      ,b.plant_cd
		      ,b.pcul_cd
		      ,b.mn_cd
		      ,g.cust_ref_no AS return_goods_cust_line_no
		      ,g.mnf_no AS return_goods_cust_mnf_no
              ,(SELECT sum(y.ord_qty)		      
                        FROM   tb_om02001 x
                              ,tb_om02002 y
                        WHERE  x.sales_ord_no = y.sales_ord_no
                        AND    x.sales_ord_cncl_yn = 'N'
                        AND    x.return_goods_cust_vdsp_no = a.cust_ord_no
                        AND    y.RETURN_GOODS_CUST_MNF_NO = g.mnf_no) AS return_ord_qty
              ,(SELECT sum(y.ord_wgt)
                        FROM   tb_om02001 x
                              ,tb_om02002 y
                        WHERE  x.sales_ord_no = y.sales_ord_no
                        AND    x.sales_ord_cncl_yn = 'N'
                        AND    x.return_goods_cust_vdsp_no = a.cust_ord_no
                        AND    y.RETURN_GOODS_CUST_MNF_NO = g.mnf_no) AS return_ord_wgt
                        
		      ,(select  sum(a.RSLT_QTY) 
		      	  from	tb_om04003 a
		        	  , tb_om04001 b
		        where	a.sales_ord_no = b.sales_ord_no
		        {#1}
		        {#3}
		        and     a.lot_no = g.mnf_no
		        and		a.work_route_seq = b.work_route_seq
		        and		a.work_step_seq = b.work_step_seq
		        and		a.rslt_dgr_cnt = b.rslt_dgr_cnt
		        and		b.work_step_seq = '10'
		        and		b.rslt_sctn_cd = '05') in_port_qty    
		      ,(select  sum(a.RSLT_WGT)
		      	  from	tb_om04003 a
		        	  , tb_om04001 b
		        where	a.sales_ord_no = b.sales_ord_no
		        {#1}
		        {#3}
		        and     a.lot_no = g.mnf_no
		        and		a.work_route_seq = b.work_route_seq
		        and		a.work_step_seq = b.work_step_seq
		        and		a.rslt_dgr_cnt = b.rslt_dgr_cnt
		        and		b.work_step_seq = '10'
		        and		b.rslt_sctn_cd = '05') in_port_wgt   
		      ,(select  sum(a.RSLT_qty) 
		        from	tb_om04003 a
		        	  , tb_om04001 b
		        where	a.sales_ord_no = b.sales_ord_no
		        {#1}
		        {#3}
		        and     a.lot_no = g.mnf_no
		        and		a.work_route_seq = b.work_route_seq
		        and		a.work_step_seq = b.work_step_seq
		        and		a.rslt_dgr_cnt = b.rslt_dgr_cnt
		        and		b.work_step_seq = '20'
		        and		b.rslt_sctn_cd = '04') out_port_qty	   		        	
		      ,(select  sum(a.RSLT_wgt) 
		        from	tb_om04003 a
		        	  , tb_om04001 b
		        where	a.sales_ord_no = b.sales_ord_no
		        {#1}
		        {#3}
		        and     a.lot_no = g.mnf_no
		        and		a.work_route_seq = b.work_route_seq
		        and		a.work_step_seq = b.work_step_seq
		        and		a.rslt_dgr_cnt = b.rslt_dgr_cnt
		        and		b.work_step_seq = '20'
		        and		b.rslt_sctn_cd = '04') out_port_wgt		        
                          
		FROM   tb_om02001 a
		      ,tb_om02002 b
		      ,tb_om02005 c
		      ,tb_ma02010 f
		      ,tb_om01010 g
		WHERE  a.sales_ord_no = b.sales_ord_no
		AND    b.sales_ord_no = c.sales_ord_no
		and    a.cust_ord_no = g.cust_ord_no
		AND    b.line_no = c.line_no
		AND    a.rpt_cust_cd = 'P1100'
		AND    a.ord_type_cd = '2058'
		and		b.cust_cd = f.ptn_cd
		and		b.item_cd = f.item_cd
		{#1}
		{#2}
       <append condition="${ordNoType}.NOTEMPTY&amp;${ordNoType}.EQ.S" id="#1">
		AND    a.sales_ord_no = ${ordNo}
		</append>
       <append condition="${ordNoType}.NOTEMPTY&amp;${ordNoType}.EQ.C" id="#2">
		AND    a.cust_ord_no = ${ordNo}
		</append>
        <append condition="${ordNoType}.NOTEMPTY&amp;${ordNoType}.EQ.C" id="#3">
		AND    a.sales_ord_no = (select sales_ord_no from tb_om02001 where cust_ord_no = ${ordNo})
		</append>		
		
	</statement>


	
	<statement name="retrieveCancelGiExportItemChungwonCntr">
	  SELECT /* 청원센터 아이템 조회 */
	         'F' chk
	        ,b.cust_cd
	        ,b.item_cd
	          ,f.item_nm
	          ,b.basis_item_cd
	          ,0 as ord_qty
	          ,b.qty_unit_cd
	          ,0 as ord_wgt
	          ,b.wgt_unit_cd
	          ,b.basis_unit_cd
	          ,b.bat_no
	          ,b.prdt_req_no
	          ,b.plant_cd
	          ,b.pcul_cd
	          ,b.mn_cd
	          ,sum(d.rslt_qty) as in_port_qty
	          ,sum(d.rslt_wgt) as in_port_wgt
	          ,sum(e.rslt_qty) as out_port_qty
	          ,sum(e.rslt_wgt) as out_port_wgt
	          ,c.col01 AS return_goods_cust_line_no
	          , '' as return_goods_cust_mnf_no
	          , 0 as return_ord_qty
	          , 0 as return_ord_wgt
	    FROM   tb_om02001 a
	          ,tb_om02002 b
	          ,tb_om02005 c
	          ,tb_ma02010 f
	          ,(select a.sales_ord_no
	                , a.line_no
	                , sum(a.RSLT_QTY) rslt_qty
	                , sum(a.RSLT_wgt) rslt_wgt
	            from  tb_om04003 a
	                , tb_om04001 b
	            where  a.sales_ord_no = b.sales_ord_no
	            and    a.work_route_seq = b.work_route_seq
	            and    a.work_step_seq = b.work_step_seq
	            and    a.rslt_dgr_cnt = b.rslt_dgr_cnt
	            and    b.work_step_seq = '10'
	            and    b.rslt_sctn_cd = '05'
	            group by a.sales_ord_no, a.line_no) d
	          ,(select a.sales_ord_no
	                , a.line_no
	                , sum(a.RSLT_QTY) rslt_qty
	                , sum(a.RSLT_wgt) rslt_wgt
		            from  tb_om04003 a
                , tb_om04001 b
            where  a.sales_ord_no = b.sales_ord_no
            and    a.work_route_seq = b.work_route_seq
            and    a.work_step_seq = b.work_step_seq
            and    a.rslt_dgr_cnt = b.rslt_dgr_cnt
            and    b.work_step_seq = '20'
            and    b.rslt_sctn_cd = '04'
            group by a.sales_ord_no, a.line_no) e
    WHERE  a.sales_ord_no = b.sales_ord_no
    AND    b.sales_ord_no = c.sales_ord_no
    AND    b.line_no = c.line_no
    AND    a.rpt_cust_cd = 'P1100'
	AND    a.ord_type_cd = '2058'
    and    b.cust_cd = f.ptn_cd
    and    b.item_cd = f.item_cd
    and     b.sales_ord_no = d.sales_ord_no(+)
    and    b.sales_ord_no = e.sales_ord_no(+)
    and    b.line_no = d.line_no(+)
    and    b.line_no = e.line_no(+)
		{#1}
    GROUP BY  b.cust_cd
             ,b.item_cd
             ,f.item_nm
             ,b.basis_item_cd
             ,b.qty_unit_cd
             ,b.wgt_unit_cd
             ,b.basis_unit_cd
             ,b.bat_no
             ,b.prdt_req_no
             ,b.plant_cd
             ,b.pcul_cd
             ,b.mn_cd
             ,c.col01 
     ORDER BY 2,3
       <append condition="${ordNoType}.NOTEMPTY&amp;${ordNoType}.EQ.S" id="#1">
		AND    a.sales_ord_no = ${ordNo}
		</append>
       <append condition="${ordNoType}.NOTEMPTY&amp;${ordNoType}.EQ.C" id="#1">
		AND    a.cust_ord_no = ${ordNo}
		</append>
	</statement>
	
	
	
	
	<statement name="retrieveCancelGiExportJeonjuBulk">
	     select nvl(sum(ord_qty), 0) ord_qty_sum, nvl(sum(ord_wgt), 0) ord_wgt_sum 
    	 from	tb_om02001 x
    	 	  , tb_om02002 y
    	 where	x.sales_ord_no = y.sales_ord_no
      	 AND	X.SALES_ORD_CNCL_YN != 'Y'
    	 and	x.return_goods_cust_ord_no = ${returnGoodsCustOrdNo}
	</statement>
	<statement name="retrieveCancelGiExportChungwonBulk">
	     select nvl(sum(ord_qty), 0) ord_qty_sum, nvl(sum(ord_wgt), 0) ord_wgt_sum 
    	 from	tb_om02001 x
    	 	  , tb_om02002 y
    	 where	x.sales_ord_no = y.sales_ord_no
      	 AND	X.SALES_ORD_CNCL_YN != 'Y'
    	 and	x.return_goods_cust_vdsp_no = ${returnGoodsCustVdspNo}
	</statement>
	
	<statement name="retrieveReturnGoodsExist">
		SELECT COUNT(*) CNT
		FROM	TB_OM02001
		WHERE	RETURN_GOODS_CUST_ORD_NO = ${returnGoodsCustOrdNo}
		AND		RETURN_GOODS_CUST_VDSP_NO = ${returnGoodsCustVdspNo}
	</statement>
	
	<statement name="retrieveGiCnclOrdList">
			SELECT SALES_ORD_NO
				  ,MACOMM_GETCD_FN('ORD_STAT_CD', SALES_ORD_STAT_CD) SALES_ORD_STAT_NM
				  ,MACOMM_GETODRTYPE_FN(ORD_TYPE_CD) ORD_TYPE_NM
				  ,MACOMM_GETCD_FN('EXP_IMP_DOM_SCTN', EXP_IMP_DOM_SCTN_CD) EXP_IMP_DOM_SCTN_NM
				  ,MACOMM_GETPTNNM_FN(RPT_CUST_CD) CUST_NM
				  ,MACOMM_GETDEPTNM_FN(CORP_CD, ORD_MNGT_EXCE_DEPT_CD) ORD_MNGT_EXCE_DEPT_NM     
				  ,CASE WHEN DPT_AR_TYPE_CD = '01' THEN 
							(SELECT Z.WORK_PL_NM
							 FROM TB_MA01005 Z
							 WHERE Z.WORK_PL_CD = DPT_AR_CD)
						WHEN DPT_AR_TYPE_CD = '02' THEN 
							(SELECT Z.CUST_NM
							 FROM TB_MA02020 Z
							 WHERE Z.PTN_CD = RPT_CUST_CD
							 AND   Z.CUST_PTN_CD = DPT_AR_CD)
						ELSE (SELECT MACOMM_GETCD_FN('ADDR_MCLAS_CD', Z.ADDR_MCLAS_CD)||' '||Z.ZIP_AR_NM
							  FROM TB_MA01016 Z
							  WHERE Z.RPT_ZIP_CD > '0'
							  AND   Z.ZIP_CD = DPT_AR_CD
							  AND   ROWNUM = 1) END DPT_AR_NM
				  ,CASE WHEN ARV_AR_TYPE_CD = '01' THEN 
							(SELECT Z.WORK_PL_NM
							 FROM TB_MA01005 Z
							 WHERE Z.WORK_PL_CD = ARV_AR_CD)
						WHEN ARV_AR_TYPE_CD = '02' THEN 
							(SELECT Z.CUST_NM
							 FROM TB_MA02020 Z
							 WHERE Z.PTN_CD      = RPT_CUST_CD
							 AND   Z.CUST_PTN_CD = ARV_AR_CD)
						ELSE (SELECT MACOMM_GETCD_FN('ADDR_MCLAS_CD', Z.ADDR_MCLAS_CD)||' '||Z.ZIP_AR_NM
							  FROM TB_MA01016 Z
							  WHERE Z.RPT_ZIP_CD > '0'
							  AND   Z.ZIP_CD = ARV_AR_CD
							  AND   ROWNUM = 1) END ARV_AR_NM    
				  ,SALES_ORD_CREAT_YMD
				  ,EO_NO
				  ,SHIPMENT_NO       
				  ,CAR_NO
				  ,CNTR_NO
				  ,WORK_YMD || WORK_HMS work_time
				  ,CNCL_ORD_NO
				  ,MACOMM_GETCD_FN('ORD_STAT_CD', CNCL_ORD_STAT_CD) CNCL_ORD_STAT_NM  
				  ,CNCL_ORD_CREAT_YMD || CNCL_ORD_CREAT_HMS  cncl_ord_creat_time
				  ,CNCL_ORD_CMPT_YMD || CNCL_ORD_CMPT_HMS  cncl_ord_cmpt_time
			FROM (
				SELECT A.SALES_ORD_NO
					  ,A.SALES_ORD_STAT_CD
					  ,A.RPT_CUST_CD
					  ,A.ORD_TYPE_CD
					  ,A.EXP_IMP_DOM_SCTN_CD
					  ,A.DPT_AR_CD
					  ,A.DPT_AR_TYPE_CD
					  ,A.ARV_AR_CD     
					  ,A.ARV_AR_TYPE_CD
					  ,A.SALES_ORD_CREAT_YMD
					  ,A.CORP_CD 
					  ,A.ORD_MNGT_EXCE_DEPT_CD 
					  ,B.EO_NO
					  ,E.SHIPMENT_NO
					  ,E.CAR_NO
					  ,(SELECT X.CNTR_NO
						FROM TB_OM03014 X
						WHERE X.SALES_ORD_NO   = B.SALES_ORD_NO
						AND   X.WORK_ROUTE_SEQ = B.WORK_ROUTE_SEQ
						AND   X.SHIPMENT_NO    = B.SHIPMENT_NO
						AND   ROWNUM = 1) CNTR_NO
					  ,TO_CHAR(B.WORK_DATE, 'YYYYMMDD') WORK_YMD
					  ,TO_CHAR(B.WORK_DATE, 'HH24MISS') WORK_HMS          
					  ,C.SALES_ORD_NO CNCL_ORD_NO
					  ,C.SALES_ORD_STAT_CD CNCL_ORD_STAT_CD
					  ,C.SALES_ORD_CREAT_YMD CNCL_ORD_CREAT_YMD
					  ,C.SALES_ORD_CREAT_HMS CNCL_ORD_CREAT_HMS
					  ,TO_CHAR(C.SALES_ORD_CMPT_DATE, 'YYYYMMDD') CNCL_ORD_CMPT_YMD
					  ,TO_CHAR(C.SALES_ORD_CMPT_DATE, 'HH24MISS') CNCL_ORD_CMPT_HMS
				FROM TB_OM02001  A
					,TB_OM04001H B
					,TB_OM02001  C
					,TB_OM03016  E
				WHERE A.SALES_ORD_NO      = B.SALES_ORD_NO
				AND   B.RSLT_SCTN_CD      = '04'
				AND   B.EO_NO             = C.RLTD_GI_EO_NO
				AND   C.SALES_ORD_CNCL_YN = 'N'
				AND	  C.ORD_TYPE_CD		  = '1043'
				AND   B.SALES_ORD_NO      = E.SALES_ORD_NO(+)
				AND   B.WORK_ROUTE_SEQ    = E.WORK_ROUTE_SEQ(+)
				AND   B.SHIPMENT_NO       = E.SHIPMENT_NO(+)
				AND   EXISTS (SELECT 1
							  FROM TB_OM04003H Z
							  WHERE Z.SALES_ORD_NO   = B.SALES_ORD_NO
							  AND   Z.WORK_ROUTE_SEQ = B.WORK_ROUTE_SEQ
							  AND   Z.WORK_STEP_SEQ  = B.WORK_STEP_SEQ
							  AND   Z.RSLT_DGR_CNT   = B.RSLT_DGR_CNT
							  AND   Z.CNCL_ORD_NO    IS NOT NULL)
				{#1}
				{#2}
				{#3}
				{#4}
				{#5}
				{#6}
				{#7}
				{#8}
				{#9}
				{#10}
				{#11}
				{#12}
			   )
			ORDER BY SALES_ORD_NO, EO_NO, SHIPMENT_NO, WORK_YMD, WORK_HMS
       <append condition="${custCd}.NOTEMPTY" id="#1">
       		AND  A.RPT_CUST_CD = ${custCd}
	   </append>		
       <append condition="${deptCd}.NOTEMPTY" id="#2">
       		AND  A.ORD_MNGT_EXCE_DEPT_CD = LPad(${deptCd}, 10, '0')
	   </append>		
       <append condition="${dateType}.NOTEMPTY&amp;${dateType}.EQ.C&amp;${startDate}.NOTEMPTY&amp;${endDate}.NOTEMPTY" id="#3">
       		AND  A.SALES_ORD_CREAT_YMD BETWEEN ${startDate} AND ${endDate}
	   </append>		
       <append condition="${dateType}.NOTEMPTY&amp;${dateType}.EQ.R&amp;${startDate}.NOTEMPTY&amp;${endDate}.NOTEMPTY" id="#3">
       		AND  A.APTD_REQ_YMD  BETWEEN ${startDate} AND ${endDate}
	   </append>		
       <append condition="${salesOrdNo}.NOTEMPTY" id="#4">
       		AND	 A.SALES_ORD_NO = ${salesOrdNo}
	   </append>		
       <append condition="${salesOrdStatCd}.NOTEMPTY" id="#5">
       		AND	 A.SALES_ORD_STAT_CD = ${salesOrdStatCd}
	   </append>		
       <append condition="${ordTypeCd}.NOTEMPTY" id="#6">
       		AND	 A.ORD_TYPE_CD = ${ordTypeCd}
	   </append>		
       <append condition="${expImpDomSctnCd}.NOTEMPTY" id="#7">
       		AND	 A.EXP_IMP_DOM_SCTN_CD = ${expImpDomSctnCd}
	   </append>		
       <append condition="${dptArCd}.NOTEMPTY" id="#8">
       		AND	 A.DPT_AR_CD = ${dptArCd}
	   </append>
       <append condition="${carNo}.NOTEMPTY" id="#9">
       		AND	 E.CAR_NO = ${carNo}
	   </append>
       <append condition="${cnclOrdNo}.NOTEMPTY" id="#10">
       		AND	 C.SALES_ORD_NO = ${cnclOrdNo}
	   </append>		
       <append condition="${cnclOrdStatCd}.NOTEMPTY" id="#11">
       		AND	 C.SALES_ORD_STAT_CD = ${cnclOrdStatCd}
	   </append>		
       <append condition="${cnclDateType}.NOTEMPTY&amp;${cnclDateType}.EQ.CR&amp;${cnclStartDate}.NOTEMPTY&amp;${cnclEndDate}.NOTEMPTY" id="#12">
       		AND  C.SALES_ORD_CREAT_YMD BETWEEN ${cnclStartDate} AND ${cnclEndDate}
	   </append>		
       <append condition="${cnclDateType}.NOTEMPTY&amp;${cnclDateType}.EQ.CM&amp;${cnclStartDate}.NOTEMPTY&amp;${cnclEndDate}.NOTEMPTY" id="#12">
       		AND  TO_CHAR(C.SALES_ORD_CMPT_DATE, 'YYYYMMDD')  BETWEEN ${cnclStartDate} AND ${cnclEndDate}
	   </append>		
		
	</statement>
	
	<statement name="retrieveGiCnclSalesOrdItemList">
			SELECT A.SALES_ORD_NO
				  ,MACOMM_GETCD_FN('ORD_STAT_CD', A.SALES_ORD_STAT_CD) SALES_ORD_STAT_NM
				  ,B.LINE_NO
				  ,B.ITEM_CD
				  ,(SELECT Z.ITEM_NM
					FROM TB_MA02010 Z
					WHERE Z.PTN_CD  = B.CUST_CD
					AND   Z.ITEM_CD = B.ITEM_CD) ITEM_NM         
				  ,B.ORD_QTY
				  ,B.QTY_UNIT_CD
				  ,B.ORD_WGT
				  ,B.WGT_UNIT_CD
				  ,B.ORD_CBM
				  ,IDUSR.OMCOMM_GETCUSTREASONNM_FN(a.rpt_cust_cd, b.ord_reason_cd) ORD_REASON_NM
				  ,(SELECT SUM(X.RSLT_QTY)
					FROM TB_OM03002 X
					WHERE X.SALES_ORD_NO = B.SALES_ORD_NO
					AND   X.LINE_NO      = B.LINE_NO) RSLT_QTY
				  ,(SELECT SUM(X.RSLT_WGT)
					FROM TB_OM03002 X
					WHERE X.SALES_ORD_NO = B.SALES_ORD_NO
					AND   X.LINE_NO      = B.LINE_NO) RSLT_WGT     
				  ,(SELECT SUM(X.RSLT_CBM)
					FROM TB_OM03002 X
					WHERE X.SALES_ORD_NO = B.SALES_ORD_NO
					AND   X.LINE_NO      = B.LINE_NO) RSLT_CBM             
			FROM TB_OM02001 A
				,TB_OM02002 B
			WHERE A.SALES_ORD_NO = ${salesOrdNo}
			AND   A.SALES_ORD_NO = B.SALES_ORD_NO
			AND   B.DEL_YN       = 'N'
			ORDER BY TO_NUMBER(B.LINE_NO)
	</statement>
	
	<statement name="retrieveGiCnclOrdItemList">
			SELECT A.SALES_ORD_NO CNCL_ORD_NO
				  ,MACOMM_GETCD_FN('ORD_STAT_CD', A.SALES_ORD_STAT_CD) CNCL_ORD_STAT_NM
				  ,A.SALES_ORD_CREAT_YMD || A.SALES_ORD_CREAT_HMS CNCL_ORD_CREAT_TIME
				  ,TO_CHAR(A.SALES_ORD_CMPT_DATE, 'YYYYMMDDHH24MISS') CNCL_ORD_CMPT_TIME
				  ,B.LINE_NO
				  ,B.ITEM_CD
				  ,(SELECT Z.ITEM_NM
					FROM TB_MA02010 Z
					WHERE Z.PTN_CD  = B.CUST_CD
					AND   Z.ITEM_CD = B.ITEM_CD) ITEM_NM    				  
				  ,B.ORD_QTY
				  ,B.ORD_WGT
				  ,B.ORD_CBM
			FROM TB_OM02001  A
				,TB_OM02002  B
				,TB_OM04001  C
			WHERE A.RLTD_GI_ORD_NO    = ${salesOrdNo}
			AND   A.SALES_ORD_CNCL_YN = 'N'
			AND   A.SALES_ORD_NO      = B.SALES_ORD_NO
			AND   A.SALES_ORD_NO      = C.SALES_ORD_NO(+)
			ORDER BY A.SALES_ORD_NO, TO_NUMBER(B.LINE_NO)
	</statement>
	
	<statement name="existGrGiTranEo">
      select max(exist_Yn) exist_Yn 
        from (
              select decode(count(*),0,'N','Y') exist_Yn
                from tb_om03005i 
               where sales_ord_no = ${salesOrdNo}
                 and TRMS_SCTN_CD != 'D'
                 and TRMS_SEQ = (select max(trms_seq) from tb_om03009i where sales_ord_no = ${salesOrdNo})
              union all
              select decode(count(*),0,'N','Y') exist_Yn
                from tb_om03007i 
               where sales_ord_no = ${salesOrdNo}
                 and TRMS_SCTN_CD != 'D'
                 and TRMS_SEQ = (select max(trms_seq) from tb_om03009i where sales_ord_no = ${salesOrdNo})
              union all
              select decode(count(*),0,'N','Y') exist_Yn
                from tb_om03009i 
               where sales_ord_no = ${salesOrdNo}
                 and TRMS_SCTN_CD != 'D'
                 and TRMS_SEQ = (select max(trms_seq) from tb_om03009i where sales_ord_no = ${salesOrdNo})
        )


	</statement>	

	<statement name="retrieveFwdEo">
	    select FWD_EO_NO eo_no, ORD_MNGT_FWD_DEPT_CD, CUST_ORD_NO, BOOKING_NO as Ship_co_booking_no
	          ,POL_CD,POD_CD,ARV_PORT_PRAR_YMD
          from tb_om03011i 
         where FWD_EO_NO = ${eoNo}
           and TRMS_SCTN_CD not in ('D','Z')
           and TRMS_SEQ = (select max(trms_seq) from tb_om03011i where FWD_EO_NO = ${eoNo})
           and rownum = 1

	</statement>	

  <statement name="existYnMstrBookingNoCnt">
	SELECT count(*) cnt
	FROM   tb_om02019 a
	WHERE a.SHIP_CO_BOOKING_NO =  ${shipCoBookingNo}
	  and a.pol_cd  = ${polCd}
	  and a.pod_cd  = ${podCd}
	  and a.arv_port_prar_ymd = ${arvPortPrarYmd}
	  and a.fwd_eo_no IS NOT NULL
  </statement> 

  <statement name="retrieveBilgCustInfoParam">
	select corp_cd,rpt_cust_cd,exp_imp_dom_sctn_cd,ord_type_cd
          ,dpt_ar_type_cd,dpt_ar_cd,arv_ar_type_cd,arv_ar_cd
          ,(select plant_cd 
              from tb_om02002 a 
             where a.sales_ord_no=b.sales_ord_no and rownum = 1) plant_cd
          ,move_type_cd , sales_ord_no 
      from tb_om02001 b 
     where sales_ord_no=${salesOrdNo}	
  </statement> 

  <statement name="retrieveSORejectHeaderParam">
	select sales_ord_no,cust_move_type_cd,ord_type_cd,rpt_cust_cd,cust_ord_no,cust_ord_type_cd
  	  from tb_om02001 
 	 where sales_ord_no =${salesOrdNo}	
  </statement> 

  <statement name="retrieveSORejectItemParam">
	select a.ptn_cd, a.item_cd, a.item_nm, a.item_lvl1_cd, a.item_lvl2_cd, a.item_lvl3_cd, 
	   	   a.gross_wgt, a.net_wgt, a.wgt_unit_cd, a.qty_unit_cd, a.basis_unit_cd,   
	   	   b.sales_ord_no,b.line_no,b.cust_ord_line_no 
  	  from tb_om02002 b ,tb_ma02010 a
 	 where b.cust_cd = a.ptn_cd
 	   and b.item_cd = a.item_cd
 	   and b.line_no = ${lineNo}
       and b.sales_ord_no= ${salesOrdNo}	
  </statement> 

  <statement name="checkConfirmYn">
	select idusr.ivcomm_confirmcheck_fn(${salesOrdNo},${lineNo})  confirm_yn 
  	  from dual
	
  </statement> 

  <statement name="retrieveHppPartCmptHeader_1123BAK">
       SELECT  /* hansol paper jucksong partialCmpt Batch List  */
              (SELECT comn_cd_nm FROM tb_ma01015 WHERE clas_cd = 'ORD_STAT_CD' AND comn_cd = a.sales_ord_stat_cd) as sales_ord_stat_nm
             ,a.sales_ord_no
             ,a.cust_ord_no
             ,a.aptd_req_ymd
             ,(SELECT ptn_nm  FROM tb_ma01002 WHERE ptn_cd = a.ctrt_cust_cd) as entp_nm
             ,(SELECT dept_nm FROM tb_ma01009 WHERE corp_cd = a.corp_cd 
                                                and dept_cd = a.ord_mngt_exce_dept_cd) as dept_nm
             ,(SELECT ord_type_nm FROM tb_ma01006 WHERE ord_type_cd = a.ord_type_cd) as ord_type_nm
             ,a.sales_ord_creat_ymd 
             ,case when a.dpt_ar_type_cd = '02' then
                       (select name 
                          from vw_ma01_01 
                         where code = a.dpt_ar_cd 
                           AND PTN_CD = a.RPT_CUST_CD
                           and work_sctn_cd = a.dpt_ar_type_cd) 
                   else          
                       (select name 
                          from vw_ma01_01 
                         where code = a.dpt_ar_cd 
                           and work_sctn_cd = a.dpt_ar_type_cd
                           and rownum = 1) 
              end  as dpt_ar_nm
             ,case when a.arv_ar_type_cd = '02' then
                        (select name 
                           from vw_ma01_01 
                          where code = a.arv_ar_cd 
                            AND PTN_CD = a.RPT_CUST_CD
                            and work_sctn_cd = a.arv_ar_type_cd) 
                   else          
                        (select name 
                           from vw_ma01_01 
                          where code = a.arv_ar_cd 
                            and work_sctn_cd = a.arv_ar_type_cd
                            and rownum = 1) 
              end  as arv_ar_nm
             ,(select WORK_PL_NM 
                       from TB_MA01005 
                       where WORK_PL_CD = a.work_pl_cd ) as work_pl_nm
             ,(SELECT user_nm FROM tb_ma01011 WHERE user_id = a.ord_mngt_fwd_ofcr_id) as fwd_nm
             ,(SELECT user_nm FROM tb_ma01011 WHERE user_id = a.ord_mngt_exce_ofcr_id) as user_nm
             ,sales_ord_cmpt_sctn_cd
             ,(SELECT comn_cd_nm 
                 FROM tb_ma01015
                WHERE clas_cd = 'SALES_ORD_CMPT_SCTN_CD' AND comn_cd = sales_ord_cmpt_sctn_cd) as sales_ord_cmpt_sctn_nm
             ,'06' as LOGIS_SVC_SCTN_CD
        FROM  tb_om02001 a
       WHERE  a.rpt_cust_cd  = 'P1000' 
         and  a.dpt_ar_cd    = '1100'
         AND  a.ord_type_cd  = '1028'
         and  a.ord_mngt_exce_dept_cd = '0000160060'   -- 장항센터
         and  a.sales_ord_stat_cd = '05'
         and  a.sales_ord_cmpt_sctn_cd is null 
         AND  a.sales_ord_cncl_yn != 'Y'  
         and  (a.cust_ord_recp_date between (sysdate - 30) and sysdate)
         and  a.cust_ord_recp_date &lt;= (sysdate - 7)  -- 오더생성일로 부터 1주일경과되었으나 종결되지 않은 적송오더
         AND  IDUSR.OMCOMM_CHECKPARTCMPT_FN(a.sales_ord_no) = 'Y'
        -- and   a.exp_imp_dom_sctn_cd = '03'      
       ORDER BY a.sales_ord_no desc 
	
  </statement> 

  <statement name="retrieveHppPartCmptHeader">
   SELECT *
    FROM (SELECT           /* hansol paper jucksong partialCmpt Batch List  */
                 (SELECT comn_cd_nm
                    FROM tb_ma01015
                   WHERE clas_cd = 'ORD_STAT_CD'
                         AND comn_cd = a.sales_ord_stat_cd)
                    AS sales_ord_stat_nm,
                 a.sales_ord_no,
                 a.cust_ord_no,
                 a.aptd_req_ymd,
                 (SELECT ptn_nm
                    FROM tb_ma01002
                   WHERE ptn_cd = a.ctrt_cust_cd)
                    AS entp_nm,
                 (SELECT dept_nm
                    FROM tb_ma01009
                   WHERE corp_cd = a.corp_cd
                         AND dept_cd = a.ord_mngt_exce_dept_cd)
                    AS dept_nm,
                 (SELECT ord_type_nm
                    FROM tb_ma01006
                   WHERE ord_type_cd = a.ord_type_cd)
                    AS ord_type_nm,
                 a.sales_ord_creat_ymd,
                 CASE
                    WHEN a.dpt_ar_type_cd = '02'
                    THEN
                       (SELECT name
                          FROM vw_ma01_01
                         WHERE     code = a.dpt_ar_cd
                               AND PTN_CD = a.RPT_CUST_CD
                               AND work_sctn_cd = a.dpt_ar_type_cd)
                    ELSE
                       (SELECT name
                          FROM vw_ma01_01
                         WHERE     code = a.dpt_ar_cd
                               AND work_sctn_cd = a.dpt_ar_type_cd
                               AND ROWNUM = 1)
                 END
                    AS dpt_ar_nm,
                 CASE
                    WHEN a.arv_ar_type_cd = '02'
                    THEN
                       (SELECT name
                          FROM vw_ma01_01
                         WHERE     code = a.arv_ar_cd
                               AND PTN_CD = a.RPT_CUST_CD
                               AND work_sctn_cd = a.arv_ar_type_cd)
                    ELSE
                       (SELECT name
                          FROM vw_ma01_01
                         WHERE     code = a.arv_ar_cd
                               AND work_sctn_cd = a.arv_ar_type_cd
                               AND ROWNUM = 1)
                 END
                    AS arv_ar_nm,
                 (SELECT WORK_PL_NM
                    FROM TB_MA01005
                   WHERE WORK_PL_CD = a.work_pl_cd)
                    AS work_pl_nm,
                 (SELECT user_nm
                    FROM tb_ma01011
                   WHERE user_id = a.ord_mngt_fwd_ofcr_id)
                    AS fwd_nm,
                 (SELECT user_nm
                    FROM tb_ma01011
                   WHERE user_id = a.ord_mngt_exce_ofcr_id)
                    AS user_nm,
                 sales_ord_cmpt_sctn_cd,
                 (SELECT comn_cd_nm
                    FROM tb_ma01015
                   WHERE clas_cd = 'SALES_ORD_CMPT_SCTN_CD'
                         AND comn_cd = sales_ord_cmpt_sctn_cd)
                    AS sales_ord_cmpt_sctn_nm,
                 '06' AS LOGIS_SVC_SCTN_CD,
                 a.ord_type_cd,
                 a.sales_ord_stat_cd
            FROM tb_om02001 a
           WHERE     a.rpt_cust_cd IN ('P1000', 'P1591')
                 AND a.ord_type_cd = '1028'
                 AND a.sales_ord_stat_cd = '05'
                 AND a.sales_ord_cmpt_sctn_cd IS NULL
                 AND a.sales_ord_cncl_yn != 'Y'
                 AND (a.sales_ord_creat_ymd BETWEEN TO_CHAR (SYSDATE - 30,
                                                             'YYYYMMDD')
                                                AND TO_CHAR (SYSDATE,
                                                             'YYYYMMDD'))
                 AND a.sales_ord_creat_ymd &lt;= TO_CHAR (SYSDATE - 7, 'YYYYMMDD') -- 오더생성일로 부터 1주일경과되었으나 종결되지 않은 적송오더
                 AND IDUSR.OMCOMM_CHECKPARTCMPT_FN (a.sales_ord_no) = 'Y'
          UNION
          SELECT           /* hansol paper jucksong partialCmpt Batch List  */
                 (SELECT comn_cd_nm
                    FROM tb_ma01015
                   WHERE clas_cd = 'ORD_STAT_CD'
                         AND comn_cd = a.sales_ord_stat_cd)
                    AS sales_ord_stat_nm,
                 a.sales_ord_no,
                 a.cust_ord_no,
                 a.aptd_req_ymd,
                 (SELECT ptn_nm
                    FROM tb_ma01002
                   WHERE ptn_cd = a.ctrt_cust_cd)
                    AS entp_nm,
                 (SELECT dept_nm
                    FROM tb_ma01009
                   WHERE corp_cd = a.corp_cd
                         AND dept_cd = a.ord_mngt_exce_dept_cd)
                    AS dept_nm,
                 (SELECT ord_type_nm
                    FROM tb_ma01006
                   WHERE ord_type_cd = a.ord_type_cd)
                    AS ord_type_nm,
                 a.sales_ord_creat_ymd,
                 CASE
                    WHEN a.dpt_ar_type_cd = '02'
                    THEN
                       (SELECT name
                          FROM vw_ma01_01
                         WHERE     code = a.dpt_ar_cd
                               AND PTN_CD = a.RPT_CUST_CD
                               AND work_sctn_cd = a.dpt_ar_type_cd)
                    ELSE
                       (SELECT name
                          FROM vw_ma01_01
                         WHERE     code = a.dpt_ar_cd
                               AND work_sctn_cd = a.dpt_ar_type_cd
                               AND ROWNUM = 1)
                 END
                    AS dpt_ar_nm,
                 CASE
                    WHEN a.arv_ar_type_cd = '02'
                    THEN
                       (SELECT name
                          FROM vw_ma01_01
                         WHERE     code = a.arv_ar_cd
                               AND PTN_CD = a.RPT_CUST_CD
                               AND work_sctn_cd = a.arv_ar_type_cd)
                    ELSE
                       (SELECT name
                          FROM vw_ma01_01
                         WHERE     code = a.arv_ar_cd
                               AND work_sctn_cd = a.arv_ar_type_cd
                               AND ROWNUM = 1)
                 END
                    AS arv_ar_nm,
                 (SELECT WORK_PL_NM
                    FROM TB_MA01005
                   WHERE WORK_PL_CD = a.work_pl_cd)
                    AS work_pl_nm,
                 (SELECT user_nm
                    FROM tb_ma01011
                   WHERE user_id = a.ord_mngt_fwd_ofcr_id)
                    AS fwd_nm,
                 (SELECT user_nm
                    FROM tb_ma01011
                   WHERE user_id = a.ord_mngt_exce_ofcr_id)
                    AS user_nm,
                 sales_ord_cmpt_sctn_cd,
                 (SELECT comn_cd_nm
                    FROM tb_ma01015
                   WHERE clas_cd = 'SALES_ORD_CMPT_SCTN_CD'
                         AND comn_cd = sales_ord_cmpt_sctn_cd)
                    AS sales_ord_cmpt_sctn_nm,
                  (SELECT LOGIS_SVC_SCTN_CD 
                      FROM TB_MA01006 
                    WHERE ORD_TYPE_CD = a.ORD_TYPE_CD)
                  AS LOGIS_SVC_SCTN_CD,
                 a.ORD_TYPE_CD,
                 a.sales_ord_stat_cd
            FROM tb_om02001 a
           WHERE     a.rpt_cust_cd IN ('P1000', 'P1591')
                 AND a.ord_type_cd = '1028'
                 AND a.sales_ord_stat_cd IN ('01', '02', '03', '04')
                 AND a.sales_ord_cmpt_sctn_cd IS NULL
                 AND a.sales_ord_cncl_yn != 'Y'
                 AND a.exp_imp_dom_sctn_cd = '03'       -- 내수오더
                 AND (a.sales_ord_creat_ymd BETWEEN TO_CHAR (SYSDATE - 70,
                                                             'YYYYMMDD')
                                                AND TO_CHAR (SYSDATE,
                                                             'YYYYMMDD'))
                 AND a.sales_ord_creat_ymd &lt;= TO_CHAR (SYSDATE - 60, 'YYYYMMDD') -- 오더생성일로 부터 2달경과되었으나 종결되지 않은 적송
                 AND IDUSR.OMCOMM_CHECKPARTCMPT_FN (a.sales_ord_no) = 'Y'
          UNION
          SELECT           /* hansol paper jucksong partialCmpt Batch List  */
                 (SELECT comn_cd_nm
                    FROM tb_ma01015
                   WHERE clas_cd = 'ORD_STAT_CD'
                         AND comn_cd = a.sales_ord_stat_cd)
                    AS sales_ord_stat_nm,
                 a.sales_ord_no,
                 a.cust_ord_no,
                 a.aptd_req_ymd,
                 (SELECT ptn_nm
                    FROM tb_ma01002
                   WHERE ptn_cd = a.ctrt_cust_cd)
                    AS entp_nm,
                 (SELECT dept_nm
                    FROM tb_ma01009
                   WHERE corp_cd = a.corp_cd
                         AND dept_cd = a.ord_mngt_exce_dept_cd)
                    AS dept_nm,
                 (SELECT ord_type_nm
                    FROM tb_ma01006
                   WHERE ord_type_cd = a.ord_type_cd)
                    AS ord_type_nm,
                 a.sales_ord_creat_ymd,
                 CASE
                    WHEN a.dpt_ar_type_cd = '02'
                    THEN
                       (SELECT name
                          FROM vw_ma01_01
                         WHERE     code = a.dpt_ar_cd
                               AND PTN_CD = a.RPT_CUST_CD
                               AND work_sctn_cd = a.dpt_ar_type_cd)
                    ELSE
                       (SELECT name
                          FROM vw_ma01_01
                         WHERE     code = a.dpt_ar_cd
                               AND work_sctn_cd = a.dpt_ar_type_cd
                               AND ROWNUM = 1)
                 END
                    AS dpt_ar_nm,
                 CASE
                    WHEN a.arv_ar_type_cd = '02'
                    THEN
                       (SELECT name
                          FROM vw_ma01_01
                         WHERE     code = a.arv_ar_cd
                               AND PTN_CD = a.RPT_CUST_CD
                               AND work_sctn_cd = a.arv_ar_type_cd)
                    ELSE
                       (SELECT name
                          FROM vw_ma01_01
                         WHERE     code = a.arv_ar_cd
                               AND work_sctn_cd = a.arv_ar_type_cd
                               AND ROWNUM = 1)
                 END
                    AS arv_ar_nm,
                 (SELECT WORK_PL_NM
                    FROM TB_MA01005
                   WHERE WORK_PL_CD = a.work_pl_cd)
                    AS work_pl_nm,
                 (SELECT user_nm
                    FROM tb_ma01011
                   WHERE user_id = a.ord_mngt_fwd_ofcr_id)
                    AS fwd_nm,
                 (SELECT user_nm
                    FROM tb_ma01011
                   WHERE user_id = a.ord_mngt_exce_ofcr_id)
                    AS user_nm,
                 sales_ord_cmpt_sctn_cd,
                 (SELECT comn_cd_nm
                    FROM tb_ma01015
                   WHERE clas_cd = 'SALES_ORD_CMPT_SCTN_CD'
                         AND comn_cd = sales_ord_cmpt_sctn_cd)
                    AS sales_ord_cmpt_sctn_nm,
                  (SELECT LOGIS_SVC_SCTN_CD 
                      FROM TB_MA01006 
                    WHERE ORD_TYPE_CD = a.ORD_TYPE_CD)
                  AS LOGIS_SVC_SCTN_CD,
                 a.ORD_TYPE_CD,
                 a.sales_ord_stat_cd
            FROM tb_om02001 a
           WHERE     a.rpt_cust_cd IN ('P1000', 'P1591')
                 --AND a.ord_type_cd != '1028'
                 AND a.ord_type_cd IN ('1024' , '1026') -- 국내내수판매출고/출고운송오더유형만
                 AND a.sales_ord_stat_cd IN ('01', '02', '03', '04', '05')
                 AND a.sales_ord_cmpt_sctn_cd IS NULL
                 AND a.sales_ord_cncl_yn != 'Y'
                 AND a.exp_imp_dom_sctn_cd = '03'       -- 내수오더
                 and a.if_Id = 'IF_HPP_OM_SalesOrder'   -- 판매오더만
                 --AND a.if_id NOT IN ('IF_HPP_OM_PO',  'IF_HPP_OM_TransferOrder') -- 입고/예약오더제외
                 AND (a.sales_ord_creat_ymd BETWEEN TO_CHAR (SYSDATE - 70,
                                                             'YYYYMMDD')
                                                AND TO_CHAR (SYSDATE,
                                                             'YYYYMMDD'))
                 AND a.sales_ord_creat_ymd &lt;= TO_CHAR (SYSDATE - 60, 'YYYYMMDD') -- 오더생성일로 부터 2달경과되었으나 종결되지 않은 일반오더
                 AND IDUSR.OMCOMM_CHECKPARTCMPT_FN (a.sales_ord_no) = 'Y') a
           ORDER BY a.sales_ord_no DESC
  </statement> 

  <statement name="retrieveHppPartCmptDetail">
       select *
         from (
       	       SELECT 
       			      a.sales_ord_no 
       			    , a.line_no 
       			    , a.cust_cd
       			    , a.item_cd 
       			    , b.item_nm
       			    , a.basis_item_cd
       			    , a.cust_ord_line_no
       			    , DECODE(NVL(a.item_grade_cd, ''), '', idusr.OMCOMM_GET_ITEM_INFO_FN(A.CUST_CD, A.ITEM_CD, 'ITEM_GRADE_CD', A.BAT_NO, A.ITEM_GRADE_CD)
       											     , A.ITEM_GRADE_CD) AS ITEM_GRADE_CD_MST
       		        , a.item_grade_cd
       			    , a.ord_qty 
       			    , a.ord_qty as org_ord_qty
       			    , a.qty_unit_cd 
       			    , NVL(f.rslt_qty, 0) rslt_qty 
       			    , a.ord_qty - NVL(f.rslt_qty, 0) remain_qty
       			    , a.ord_wgt 
       			    , a.ord_wgt as org_ord_wgt
       			    , a.wgt_unit_cd 
       			    , NVL(f.rslt_wgt, 0) rslt_wgt 
       			    , a.ord_wgt - NVL(f.rslt_wgt, 0) remain_wgt
       			    , a.admt
       			    , a.ord_cbm 
       			    , a.ord_cbm as org_ord_cbm
       			    , NVL(f.rslt_cbm , 0) rslt_cbm
       			    , a.ord_cbm - NVL(f.rslt_cbm, 0) remain_cbm
       			    , a.basis_unit_cd
       			    , (select x.fltr_conts1 from tb_ma01015 x where x.clas_cd = 'BASIC_UNIT_CD' and x.comn_cd = a.basis_unit_cd) unit_cd
       			    , a.bat_no 
       			    , a.cust_bat_no
       			    , a.mnf_no
       			    , a.lot_no 
       			    , a.prdt_req_no 
       			    , a.prdt_prar_ymd 
       			    , DECODE(NVL(a.plant_cd, ''), '', idusr.OMCOMM_GET_ITEM_INFO_FN(A.CUST_CD, A.ITEM_CD, 'PLANT_CD', A.BAT_NO, A.plant_cd)
       					    						, A.plant_cd) AS plant_cd
       			    , MACOMM_GETCD_FN('PLANT_CD', DECODE(NVL(a.plant_cd, ''), '', idusr.OMCOMM_GET_ITEM_INFO_FN(A.CUST_CD, A.ITEM_CD, 'PLANT_CD', A.BAT_NO, A.plant_cd)
       						    					, A.plant_cd)) AS plant_nm								
       			    , a.sales_uprice 
       			    , a.cust_ref_no  
       			    , a.fe_sctn_cd
       			    , a.cntr_size_cd
       			    , a.cntr_no
       			    , a.danger_sctn_cd
       			    , a.seal_no1
       			    , a.seal_no2
       			    , a.pckg_unit_cd
       			    , a.pckg_qty
       			    , a.max_tmpt
       			    , a.min_tmpt
       			    , a.dpt_ar_cd 
       			    , a.dpt_ar_type_cd 
       			    , CASE WHEN a.dpt_ar_type_cd = '02' THEN
       			          ( SELECT name 
       			              FROM vw_ma01_01 
       			             WHERE code         = a.dpt_ar_cd 
       			               AND PTN_CD       = C.RPT_CUST_CD
       			               AND work_sctn_cd = a.dpt_ar_type_cd) 
       			       ELSE
       			          ( SELECT name 
       			              FROM vw_ma01_01 
       			             WHERE code         = a.dpt_ar_cd 
       			               AND work_sctn_cd = a.dpt_ar_type_cd
       			               AND ROWNUM       = 1) 
       			      END  as dpt_ar_nm
       			    , a.dpt_ar_zip_cd 
       			    , a.dpt_ar_zip_addr 
       			    , a.dpt_ar_dtl_addr 
       			    , a.dpt_ar_ofcr_nm 
       			    , a.dpt_ar_ofcr_tel_no 
       			    , a.arv_ar_cd 
       			    , a.arv_ar_type_cd 
       			    , CASE WHEN a.arv_ar_type_cd = '02' THEN
       			          ( SELECT name 
       			              FROM vw_ma01_01 
       			             WHERE code         = a.arv_ar_cd 
       			               AND PTN_CD       = C.RPT_CUST_CD
       			               AND work_sctn_cd = a.arv_ar_type_cd) 
       			       ELSE
       			          ( SELECT name 
       			              FROM vw_ma01_01 
       			             WHERE code         = a.arv_ar_cd 
       			               AND work_sctn_cd = a.arv_ar_type_cd
       			               AND ROWNUM       = 1) 
       			      END  as arv_ar_nm
       			     , a.arv_ar_zip_cd 
       			     , a.arv_ar_zip_addr 
       			     , a.arv_ar_dtl_addr 
       			     , a.arv_ar_ofcr_nm 
       			     , a.arv_ar_ofcr_tel_no 
       			     , a.strt_req_ymd 
       			     , a.strt_req_hm 
       			     , a.strt_req_ymd || a.strt_req_hm strt_req_date
       			     , a.aptd_req_ymd 
       			     , a.aptd_req_hm 
       			     , a.aptd_req_ymd || a.aptd_req_hm aptd_req_date	    
       			     , 'SYS' as ord_reason_cd  -- a.ord_reason_cd
       			     , IDUSR.OMCOMM_GETCUSTREASONNM_FN(c.rpt_cust_cd, '01') AS ord_reason_nm
       			     , a.booking_no
       			     , a.prog_stat_cd 
       			     , MACOMM_GETCD_FN('EXP_PROG_STAT_CD', a.prog_stat_cd) AS prog_stat_nm			
       			     , a.vanning_grp_id
       			     , a.prdt_ymd
       			     , a.pol_cd
       			     , a.schd_no
       			     , a.sctn_cd
       			     , a.rpt_item_nm
       			     , a.cls_expr_yn
       			     , a.lead_time_expr_yn
       			     , a.ltrm_ord_yn
       			     , a.rmk
       			     , a.exp_ord_no
       			     , a.dpt_port_prar_ymd
       			     , a.gi_req_ymd
       			     , a.std_wgt
       			     , a.pallet_qty
       			     , a.more_pmsr
       			     , a.less_pmsr
       			     , a.cntr_dcsn_ofcr_id
       			     , to_char(a.cntr_dcsn_date, 'yyyymmddhh24miss') cntr_dcsn_date
       			     , DECODE(NVL(a.pcul_cd, ''), '', idusr.OMCOMM_GET_ITEM_INFO_FN(A.CUST_CD, A.ITEM_CD, 'PCUL_CD', A.BAT_NO, A.pcul_cd)
       									            , A.PCUL_CD) PCUL_CD_MST
       			     , DECODE(NVL(a.mn_cd, ''), '', idusr.OMCOMM_GET_ITEM_INFO_FN(A.CUST_CD, A.ITEM_CD, 'MN_CD', A.BAT_NO, A.mn_cd)
       								              , A.mn_cd) mn_cd_MST
       			     , a.pcul_cd
       			     , a.mn_cd
       			     , a.cmpt_ymd
       			     , a.dcsn_yn
       			     , a.del_yn
       			     , nvl(a.ord_verify_yn, 'Y') ord_verify_yn
       			     , c.cust_ord_no
       			     , b.ITEM_LVL2_CD
       			     , d.col01
       			     , d.col02
       			     , d.col03
       			     , d.col04
       			     , d.col05
       			     , d.col06
       			     , d.col07
       			     , d.col08
       			     , d.col09
       			     , d.col10
       			     , d.col11
       			     , d.col12
       			     , d.col13
       			     , d.col14
       			     , d.col15
       			     , d.col16
       			     , d.col17
       			     , d.col18
       			     , d.col19
       			     , d.col20
       			     , d.col21
       			     , d.col22
       			     , d.col23
       			     , d.col24
       			     , d.col25
       			     , d.col26
       			     , d.col27
       			     , d.col28
       			     , d.col29
       			     , decode(a.ord_verify_yn, 'N', d.col30, '') col30
       			     , '' as UPD_FLAG
       			     , 0 as sales_ord_chg_seq
       			     , c.ord_type_cd
       			     , c.sales_ord_stat_cd
                  FROM TB_OM02002 A
       	             , TB_MA02010 B
       	             , TB_OM02001 C
       	             , TB_OM02005 D
        		     , (SELECT ee.line_no, SUM(ee.rslt_qty) rslt_qty, SUM(ee.rslt_wgt) rslt_wgt, SUM(ee.rslt_cbm) rslt_cbm
       		  	          FROM tb_om03001 e, tb_om03002 ee
        		         WHERE e.SALES_ORD_NO = ${salesOrdNo}
        		           AND e.SALES_ORD_NO = ee.SALES_ORD_NO
        		           AND e.WORK_ROUTE_SEQ = ee.WORK_ROUTE_SEQ
        		           AND e.del_yn = 'N'
       		             GROUP BY ee.line_no) F
       	         WHERE A.cust_cd = B.Ptn_Cd
       	           AND A.item_cd = B.Item_Cd
       	           AND A.DEL_YN  != 'Y'
       	           AND A.Sales_Ord_No = C.Sales_Ord_No
       	           AND A.SALES_ORD_NO = D.SALES_ORD_NO(+)
       	           AND A.LINE_NO	  = D.LINE_NO(+)
       	           AND A.LINE_NO	  = F.LINE_NO(+)
       	           AND A.SALES_ORD_NO = ${salesOrdNo}   
       	           {#1}
       	           {#2} 
       	           and a.ord_reason_cd is null
       	         )
      where (unit_cd='QTY_UNIT_CD' and ord_qty > rslt_qty) or (unit_cd='WGT_UNIT_CD' and ord_wgt > rslt_wgt)       

	
	 <append condition="${lineNo}.NOTEMPTY" id="#1">
		           AND A.LINE_NO = ${lineNo}
	 </append>

	 <append condition="${ordTypeCd}.NOTEMPTY&amp;${ordTypeCd}.EQ.1028&amp;${salesOrdStatCd}.NOTEMPTY&amp;${salesOrdStatCd}.EQ.05" id="#2">
		          and IDUSR.OMCOMM_CHECKSTEPCMPT_FN(A.Sales_Ord_No,A.LINE_NO) = 'Y'
	 </append>
	
   </statement> 

  <statement name="retrieveHppPartCmptDetail_1123BAK">
       select *
         from (
       	       SELECT 
       			      a.sales_ord_no 
       			    , a.line_no 
       			    , a.cust_cd
       			    , a.item_cd 
       			    , b.item_nm
       			    , a.basis_item_cd
       			    , a.cust_ord_line_no
       			    , DECODE(NVL(a.item_grade_cd, ''), '', idusr.OMCOMM_GET_ITEM_INFO_FN(A.CUST_CD, A.ITEM_CD, 'ITEM_GRADE_CD', A.BAT_NO, A.ITEM_GRADE_CD)
       											     , A.ITEM_GRADE_CD) AS ITEM_GRADE_CD_MST
       		        , a.item_grade_cd
       			    , a.ord_qty 
       			    , a.ord_qty as org_ord_qty
       			    , a.qty_unit_cd 
       			    , NVL(f.rslt_qty, 0) rslt_qty 
       			    , a.ord_qty - NVL(f.rslt_qty, 0) remain_qty
       			    , a.ord_wgt 
       			    , a.ord_wgt as org_ord_wgt
       			    , a.wgt_unit_cd 
       			    , NVL(f.rslt_wgt, 0) rslt_wgt 
       			    , a.ord_wgt - NVL(f.rslt_wgt, 0) remain_wgt
       			    , a.admt
       			    , a.ord_cbm 
       			    , a.ord_cbm as org_ord_cbm
       			    , NVL(f.rslt_cbm , 0) rslt_cbm
       			    , a.ord_cbm - NVL(f.rslt_cbm, 0) remain_cbm
       			    , a.basis_unit_cd
       			    , (select x.fltr_conts1 from tb_ma01015 x where x.clas_cd = 'BASIC_UNIT_CD' and x.comn_cd = a.basis_unit_cd) unit_cd
       			    , a.bat_no 
       			    , a.cust_bat_no
       			    , a.mnf_no
       			    , a.lot_no 
       			    , a.prdt_req_no 
       			    , a.prdt_prar_ymd 
       			    , DECODE(NVL(a.plant_cd, ''), '', idusr.OMCOMM_GET_ITEM_INFO_FN(A.CUST_CD, A.ITEM_CD, 'PLANT_CD', A.BAT_NO, A.plant_cd)
       					    						, A.plant_cd) AS plant_cd
       			    , MACOMM_GETCD_FN('PLANT_CD', DECODE(NVL(a.plant_cd, ''), '', idusr.OMCOMM_GET_ITEM_INFO_FN(A.CUST_CD, A.ITEM_CD, 'PLANT_CD', A.BAT_NO, A.plant_cd)
       						    					, A.plant_cd)) AS plant_nm								
       			    , a.sales_uprice 
       			    , a.cust_ref_no  
       			    , a.fe_sctn_cd
       			    , a.cntr_size_cd
       			    , a.cntr_no
       			    , a.danger_sctn_cd
       			    , a.seal_no1
       			    , a.seal_no2
       			    , a.pckg_unit_cd
       			    , a.pckg_qty
       			    , a.max_tmpt
       			    , a.min_tmpt
       			    , a.dpt_ar_cd 
       			    , a.dpt_ar_type_cd 
       			    , CASE WHEN a.dpt_ar_type_cd = '02' THEN
       			          ( SELECT name 
       			              FROM vw_ma01_01 
       			             WHERE code         = a.dpt_ar_cd 
       			               AND PTN_CD       = C.RPT_CUST_CD
       			               AND work_sctn_cd = a.dpt_ar_type_cd) 
       			       ELSE
       			          ( SELECT name 
       			              FROM vw_ma01_01 
       			             WHERE code         = a.dpt_ar_cd 
       			               AND work_sctn_cd = a.dpt_ar_type_cd
       			               AND ROWNUM       = 1) 
       			      END  as dpt_ar_nm
       			    , a.dpt_ar_zip_cd 
       			    , a.dpt_ar_zip_addr 
       			    , a.dpt_ar_dtl_addr 
       			    , a.dpt_ar_ofcr_nm 
       			    , a.dpt_ar_ofcr_tel_no 
       			    , a.arv_ar_cd 
       			    , a.arv_ar_type_cd 
       			    , CASE WHEN a.arv_ar_type_cd = '02' THEN
       			          ( SELECT name 
       			              FROM vw_ma01_01 
       			             WHERE code         = a.arv_ar_cd 
       			               AND PTN_CD       = C.RPT_CUST_CD
       			               AND work_sctn_cd = a.arv_ar_type_cd) 
       			       ELSE
       			          ( SELECT name 
       			              FROM vw_ma01_01 
       			             WHERE code         = a.arv_ar_cd 
       			               AND work_sctn_cd = a.arv_ar_type_cd
       			               AND ROWNUM       = 1) 
       			      END  as arv_ar_nm
       			     , a.arv_ar_zip_cd 
       			     , a.arv_ar_zip_addr 
       			     , a.arv_ar_dtl_addr 
       			     , a.arv_ar_ofcr_nm 
       			     , a.arv_ar_ofcr_tel_no 
       			     , a.strt_req_ymd 
       			     , a.strt_req_hm 
       			     , a.strt_req_ymd || a.strt_req_hm strt_req_date
       			     , a.aptd_req_ymd 
       			     , a.aptd_req_hm 
       			     , a.aptd_req_ymd || a.aptd_req_hm aptd_req_date	    
       			     , 'SYS' as ord_reason_cd  -- a.ord_reason_cd
       			     , IDUSR.OMCOMM_GETCUSTREASONNM_FN(c.rpt_cust_cd, '01') AS ord_reason_nm
       			     , a.booking_no
       			     , a.prog_stat_cd 
       			     , MACOMM_GETCD_FN('EXP_PROG_STAT_CD', a.prog_stat_cd) AS prog_stat_nm			
       			     , a.vanning_grp_id
       			     , a.prdt_ymd
       			     , a.pol_cd
       			     , a.schd_no
       			     , a.sctn_cd
       			     , a.rpt_item_nm
       			     , a.cls_expr_yn
       			     , a.lead_time_expr_yn
       			     , a.ltrm_ord_yn
       			     , a.rmk
       			     , a.exp_ord_no
       			     , a.dpt_port_prar_ymd
       			     , a.gi_req_ymd
       			     , a.std_wgt
       			     , a.pallet_qty
       			     , a.more_pmsr
       			     , a.less_pmsr
       			     , a.cntr_dcsn_ofcr_id
       			     , to_char(a.cntr_dcsn_date, 'yyyymmddhh24miss') cntr_dcsn_date
       			     , DECODE(NVL(a.pcul_cd, ''), '', idusr.OMCOMM_GET_ITEM_INFO_FN(A.CUST_CD, A.ITEM_CD, 'PCUL_CD', A.BAT_NO, A.pcul_cd)
       									            , A.PCUL_CD) PCUL_CD_MST
       			     , DECODE(NVL(a.mn_cd, ''), '', idusr.OMCOMM_GET_ITEM_INFO_FN(A.CUST_CD, A.ITEM_CD, 'MN_CD', A.BAT_NO, A.mn_cd)
       								              , A.mn_cd) mn_cd_MST
       			     , a.pcul_cd
       			     , a.mn_cd
       			     , a.cmpt_ymd
       			     , a.dcsn_yn
       			     , a.del_yn
       			     , nvl(a.ord_verify_yn, 'Y') ord_verify_yn
       			     , c.cust_ord_no
       			     , b.ITEM_LVL2_CD
       			     , d.col01
       			     , d.col02
       			     , d.col03
       			     , d.col04
       			     , d.col05
       			     , d.col06
       			     , d.col07
       			     , d.col08
       			     , d.col09
       			     , d.col10
       			     , d.col11
       			     , d.col12
       			     , d.col13
       			     , d.col14
       			     , d.col15
       			     , d.col16
       			     , d.col17
       			     , d.col18
       			     , d.col19
       			     , d.col20
       			     , d.col21
       			     , d.col22
       			     , d.col23
       			     , d.col24
       			     , d.col25
       			     , d.col26
       			     , d.col27
       			     , d.col28
       			     , d.col29
       			     , decode(a.ord_verify_yn, 'N', d.col30, '') col30
       			     , '' as UPD_FLAG
       			     , 0 as sales_ord_chg_seq
                  FROM TB_OM02002 A
       	             , TB_MA02010 B
       	             , TB_OM02001 C
       	             , TB_OM02005 D
        		     , (SELECT ee.line_no, SUM(ee.rslt_qty) rslt_qty, SUM(ee.rslt_wgt) rslt_wgt, SUM(ee.rslt_cbm) rslt_cbm
       		  	          FROM tb_om03001 e, tb_om03002 ee
        		         WHERE e.SALES_ORD_NO = ${salesOrdNo}
        		           AND e.SALES_ORD_NO = ee.SALES_ORD_NO
        		           AND e.WORK_ROUTE_SEQ = ee.WORK_ROUTE_SEQ
        		           AND e.del_yn = 'N'
       		             GROUP BY ee.line_no) F
       	         WHERE A.cust_cd = B.Ptn_Cd
       	           AND A.item_cd = B.Item_Cd
       	           AND A.DEL_YN  != 'Y'
       	           AND A.Sales_Ord_No = C.Sales_Ord_No
       	           AND A.SALES_ORD_NO = D.SALES_ORD_NO(+)
       	           AND A.LINE_NO	  = D.LINE_NO(+)
       	           AND A.LINE_NO	  = F.LINE_NO(+)
       	           AND A.SALES_ORD_NO = ${salesOrdNo}   
       	           {#1} 
       	           and a.ord_reason_cd is null
       	           and IDUSR.OMCOMM_CHECKSTEPCMPT_FN(A.Sales_Ord_No,A.LINE_NO) = 'Y' -- 출고진행중이 아닌 오더 (현재 출고이후 입고전인 실행오더가 있는 오더는 제외)
       	         )
      where (unit_cd='QTY_UNIT_CD' and ord_qty > rslt_qty) or (unit_cd='WGT_UNIT_CD' and ord_wgt > rslt_wgt)       

	
	 <append condition="${lineNo}.NOTEMPTY" id="#1">
		           AND A.LINE_NO = ${lineNo}
	 </append>
	
   </statement> 

  <statement name="retrieveHppPartCmptHeader_addNsk">
       SELECT  /* hansol paper jucksong partialCmpt Batch List  */
              (SELECT comn_cd_nm FROM tb_ma01015 WHERE clas_cd = 'ORD_STAT_CD' AND comn_cd = a.sales_ord_stat_cd) as sales_ord_stat_nm
             ,a.sales_ord_no
             ,a.cust_ord_no
             ,a.aptd_req_ymd
             ,(SELECT ptn_nm  FROM tb_ma01002 WHERE ptn_cd = a.ctrt_cust_cd) as entp_nm
             ,(SELECT dept_nm FROM tb_ma01009 WHERE corp_cd = a.corp_cd 
                                                and dept_cd = a.ord_mngt_exce_dept_cd) as dept_nm
             ,(SELECT ord_type_nm FROM tb_ma01006 WHERE ord_type_cd = a.ord_type_cd) as ord_type_nm
             ,a.sales_ord_creat_ymd 
             ,case when a.dpt_ar_type_cd = '02' then
                       (select name 
                          from vw_ma01_01 
                         where code = a.dpt_ar_cd 
                           AND PTN_CD = a.RPT_CUST_CD
                           and work_sctn_cd = a.dpt_ar_type_cd) 
                   else          
                       (select name 
                          from vw_ma01_01 
                         where code = a.dpt_ar_cd 
                           and work_sctn_cd = a.dpt_ar_type_cd
                           and rownum = 1) 
              end  as dpt_ar_nm
             ,case when a.arv_ar_type_cd = '02' then
                        (select name 
                           from vw_ma01_01 
                          where code = a.arv_ar_cd 
                            AND PTN_CD = a.RPT_CUST_CD
                            and work_sctn_cd = a.arv_ar_type_cd) 
                   else          
                        (select name 
                           from vw_ma01_01 
                          where code = a.arv_ar_cd 
                            and work_sctn_cd = a.arv_ar_type_cd
                            and rownum = 1) 
              end  as arv_ar_nm
             ,(select WORK_PL_NM 
                       from TB_MA01005 
                       where WORK_PL_CD = a.work_pl_cd ) as work_pl_nm
             ,(SELECT user_nm FROM tb_ma01011 WHERE user_id = a.ord_mngt_fwd_ofcr_id) as fwd_nm
             ,(SELECT user_nm FROM tb_ma01011 WHERE user_id = a.ord_mngt_exce_ofcr_id) as user_nm
             ,sales_ord_cmpt_sctn_cd
             ,(SELECT comn_cd_nm 
                 FROM tb_ma01015
                WHERE clas_cd = 'SALES_ORD_CMPT_SCTN_CD' AND comn_cd = sales_ord_cmpt_sctn_cd) as sales_ord_cmpt_sctn_nm
             ,'06' as LOGIS_SVC_SCTN_CD
        FROM  tb_om02001 a
       WHERE  (
                (a.rpt_cust_cd='P1000' and a.dpt_ar_cd='1100' AND a.ord_type_cd='1028' 
                                       and a.ord_mngt_exce_dept_cd = '0000160060')   -- 장항센터
                 or 
                (a.rpt_cust_cd='P1100' and a.dpt_ar_cd='1000' AND a.ord_type_cd in ('1026','1024','1028') 
                                       and a.ord_mngt_exce_dept_cd = '0000160050')   -- 전주센터
              )
         and  a.sales_ord_stat_cd = '05'
         and  a.sales_ord_cmpt_sctn_cd is null 
         AND  a.sales_ord_cncl_yn != 'Y'  
         and  (a.cust_ord_recp_date between (sysdate - 30) and sysdate)
         and  a.cust_ord_recp_date &lt;= (sysdate - 7)  -- 오더생성일로 부터 1주일경과되었으나 종결되지 않은 적송오더
         AND  IDUSR.OMCOMM_CHECKPARTCMPT_FN(a.sales_ord_no) = 'Y'
        -- and   a.exp_imp_dom_sctn_cd = '03'      
       ORDER BY a.sales_ord_no desc 
	
  </statement> 

  <statement name="retrieveHppPartCmptDetail_addNsk">
       select *
         from (
       	       SELECT 
       			      a.sales_ord_no 
       			    , a.line_no 
       			    , a.cust_cd
       			    , a.item_cd 
       			    , b.item_nm
       			    , a.basis_item_cd
       			    , a.cust_ord_line_no
       			    , DECODE(NVL(a.item_grade_cd, ''), '', idusr.OMCOMM_GET_ITEM_INFO_FN(A.CUST_CD, A.ITEM_CD, 'ITEM_GRADE_CD', A.BAT_NO, A.ITEM_GRADE_CD)
       											     , A.ITEM_GRADE_CD) AS ITEM_GRADE_CD_MST
       		        , a.item_grade_cd
       			    , a.ord_qty 
       			    , a.ord_qty as org_ord_qty
       			    , a.qty_unit_cd 
       			    , NVL(f.rslt_qty, 0) rslt_qty 
       			    , a.ord_qty - NVL(f.rslt_qty, 0) remain_qty
       			    , a.ord_wgt 
       			    , a.ord_wgt as org_ord_wgt
       			    , a.wgt_unit_cd 
       			    , NVL(f.rslt_wgt, 0) rslt_wgt 
       			    , a.ord_wgt - NVL(f.rslt_wgt, 0) remain_wgt
       			    , a.admt
       			    , a.ord_cbm 
       			    , a.ord_cbm as org_ord_cbm
       			    , NVL(f.rslt_cbm , 0) rslt_cbm
       			    , a.ord_cbm - NVL(f.rslt_cbm, 0) remain_cbm
       			    , a.basis_unit_cd
       			    , (select x.fltr_conts1 from tb_ma01015 x where x.clas_cd = 'BASIC_UNIT_CD' and x.comn_cd = a.basis_unit_cd) unit_cd
       			    , a.bat_no 
       			    , a.cust_bat_no
       			    , a.mnf_no
       			    , a.lot_no 
       			    , a.prdt_req_no 
       			    , a.prdt_prar_ymd 
       			    , DECODE(NVL(a.plant_cd, ''), '', idusr.OMCOMM_GET_ITEM_INFO_FN(A.CUST_CD, A.ITEM_CD, 'PLANT_CD', A.BAT_NO, A.plant_cd)
       					    						, A.plant_cd) AS plant_cd
       			    , MACOMM_GETCD_FN('PLANT_CD', DECODE(NVL(a.plant_cd, ''), '', idusr.OMCOMM_GET_ITEM_INFO_FN(A.CUST_CD, A.ITEM_CD, 'PLANT_CD', A.BAT_NO, A.plant_cd)
       						    					, A.plant_cd)) AS plant_nm								
       			    , a.sales_uprice 
       			    , a.cust_ref_no  
       			    , a.fe_sctn_cd
       			    , a.cntr_size_cd
       			    , a.cntr_no
       			    , a.danger_sctn_cd
       			    , a.seal_no1
       			    , a.seal_no2
       			    , a.pckg_unit_cd
       			    , a.pckg_qty
       			    , a.max_tmpt
       			    , a.min_tmpt
       			    , a.dpt_ar_cd 
       			    , a.dpt_ar_type_cd 
       			    , CASE WHEN a.dpt_ar_type_cd = '02' THEN
       			          ( SELECT name 
       			              FROM vw_ma01_01 
       			             WHERE code         = a.dpt_ar_cd 
       			               AND PTN_CD       = C.RPT_CUST_CD
       			               AND work_sctn_cd = a.dpt_ar_type_cd) 
       			       ELSE
       			          ( SELECT name 
       			              FROM vw_ma01_01 
       			             WHERE code         = a.dpt_ar_cd 
       			               AND work_sctn_cd = a.dpt_ar_type_cd
       			               AND ROWNUM       = 1) 
       			      END  as dpt_ar_nm
       			    , a.dpt_ar_zip_cd 
       			    , a.dpt_ar_zip_addr 
       			    , a.dpt_ar_dtl_addr 
       			    , a.dpt_ar_ofcr_nm 
       			    , a.dpt_ar_ofcr_tel_no 
       			    , a.arv_ar_cd 
       			    , a.arv_ar_type_cd 
       			    , CASE WHEN a.arv_ar_type_cd = '02' THEN
       			          ( SELECT name 
       			              FROM vw_ma01_01 
       			             WHERE code         = a.arv_ar_cd 
       			               AND PTN_CD       = C.RPT_CUST_CD
       			               AND work_sctn_cd = a.arv_ar_type_cd) 
       			       ELSE
       			          ( SELECT name 
       			              FROM vw_ma01_01 
       			             WHERE code         = a.arv_ar_cd 
       			               AND work_sctn_cd = a.arv_ar_type_cd
       			               AND ROWNUM       = 1) 
       			      END  as arv_ar_nm
       			     , a.arv_ar_zip_cd 
       			     , a.arv_ar_zip_addr 
       			     , a.arv_ar_dtl_addr 
       			     , a.arv_ar_ofcr_nm 
       			     , a.arv_ar_ofcr_tel_no 
       			     , a.strt_req_ymd 
       			     , a.strt_req_hm 
       			     , a.strt_req_ymd || a.strt_req_hm strt_req_date
       			     , a.aptd_req_ymd 
       			     , a.aptd_req_hm 
       			     , a.aptd_req_ymd || a.aptd_req_hm aptd_req_date	    
       			     , 'SYS' as ord_reason_cd  -- a.ord_reason_cd
       			     , IDUSR.OMCOMM_GETCUSTREASONNM_FN(c.rpt_cust_cd, '01') AS ord_reason_nm
       			     , a.booking_no
       			     , a.prog_stat_cd 
       			     , MACOMM_GETCD_FN('EXP_PROG_STAT_CD', a.prog_stat_cd) AS prog_stat_nm			
       			     , a.vanning_grp_id
       			     , a.prdt_ymd
       			     , a.pol_cd
       			     , a.schd_no
       			     , a.sctn_cd
       			     , a.rpt_item_nm
       			     , a.cls_expr_yn
       			     , a.lead_time_expr_yn
       			     , a.ltrm_ord_yn
       			     , a.rmk
       			     , a.exp_ord_no
       			     , a.dpt_port_prar_ymd
       			     , a.gi_req_ymd
       			     , a.std_wgt
       			     , a.pallet_qty
       			     , a.more_pmsr
       			     , a.less_pmsr
       			     , a.cntr_dcsn_ofcr_id
       			     , to_char(a.cntr_dcsn_date, 'yyyymmddhh24miss') cntr_dcsn_date
       			     , DECODE(NVL(a.pcul_cd, ''), '', idusr.OMCOMM_GET_ITEM_INFO_FN(A.CUST_CD, A.ITEM_CD, 'PCUL_CD', A.BAT_NO, A.pcul_cd)
       									            , A.PCUL_CD) PCUL_CD_MST
       			     , DECODE(NVL(a.mn_cd, ''), '', idusr.OMCOMM_GET_ITEM_INFO_FN(A.CUST_CD, A.ITEM_CD, 'MN_CD', A.BAT_NO, A.mn_cd)
       								              , A.mn_cd) mn_cd_MST
       			     , a.pcul_cd
       			     , a.mn_cd
       			     , a.cmpt_ymd
       			     , a.dcsn_yn
       			     , a.del_yn
       			     , nvl(a.ord_verify_yn, 'Y') ord_verify_yn
       			     , c.cust_ord_no
       			     , b.ITEM_LVL2_CD
       			     , d.col01
       			     , d.col02
       			     , d.col03
       			     , d.col04
       			     , d.col05
       			     , d.col06
       			     , d.col07
       			     , d.col08
       			     , d.col09
       			     , d.col10
       			     , d.col11
       			     , d.col12
       			     , d.col13
       			     , d.col14
       			     , d.col15
       			     , d.col16
       			     , d.col17
       			     , d.col18
       			     , d.col19
       			     , d.col20
       			     , d.col21
       			     , d.col22
       			     , d.col23
       			     , d.col24
       			     , d.col25
       			     , d.col26
       			     , d.col27
       			     , d.col28
       			     , d.col29
       			     , decode(a.ord_verify_yn, 'N', d.col30, '') col30
       			     , '' as UPD_FLAG
       			     , 0 as sales_ord_chg_seq
                  FROM TB_OM02002 A
       	             , TB_MA02010 B
       	             , TB_OM02001 C
       	             , TB_OM02005 D
        		     , (SELECT ee.line_no, SUM(ee.rslt_qty) rslt_qty, SUM(ee.rslt_wgt) rslt_wgt, SUM(ee.rslt_cbm) rslt_cbm
       		  	          FROM tb_om03001 e, tb_om03002 ee
        		         WHERE e.SALES_ORD_NO = ${salesOrdNo}
        		           AND e.SALES_ORD_NO = ee.SALES_ORD_NO
        		           AND e.WORK_ROUTE_SEQ = ee.WORK_ROUTE_SEQ
        		           AND e.del_yn = 'N'
       		             GROUP BY ee.line_no) F
       	         WHERE A.cust_cd = B.Ptn_Cd
       	           AND A.item_cd = B.Item_Cd
       	           AND A.DEL_YN  != 'Y'
       	           AND A.Sales_Ord_No = C.Sales_Ord_No
       	           AND A.SALES_ORD_NO = D.SALES_ORD_NO(+)
       	           AND A.LINE_NO	  = D.LINE_NO(+)
       	           AND A.LINE_NO	  = F.LINE_NO(+)
       	           AND A.SALES_ORD_NO = ${salesOrdNo}   
       	           {#1} 
       	           and a.ord_reason_cd is null
       	           -- 출고진행중이 아닌 오더 (현재 출고이후 입고전인 실행오더가 있는 오더는 제외)
       	           and (
       	                (c.rpt_cust_cd='P1000' and IDUSR.OMCOMM_CHECKSTEPCMPT_FN(A.Sales_Ord_No,A.LINE_NO) = 'Y')
       	                 or
       	                (c.rpt_cust_cd='P1100' and c.ord_type_cd='1028' 
       	                                       and IDUSR.OMCOMM_CHECKSTEPCMPT_FN(A.Sales_Ord_No,A.LINE_NO) = 'Y') 
       	                 or
       	                 IDUSR.OMCOMM_CHECKSTEPCMPT_FN(A.Sales_Ord_No,A.LINE_NO) = 'N'
       	               )
       	         )
      where (unit_cd='QTY_UNIT_CD' and ord_qty > rslt_qty) or (unit_cd='WGT_UNIT_CD' and ord_wgt > rslt_wgt)       

	
	 <append condition="${lineNo}.NOTEMPTY" id="#1">
		           AND A.LINE_NO = ${lineNo}
	 </append>
	
   </statement>

   <statement name="retrieveHppJuksongWating">
		SELECT a.sales_ord_no
		FROM tb_om04010 a
		WHERE a.work_sctn_cd = 'M'
   </statement>

   <statement name="retrieveHppJuksongWorkingList">
      SELECT a.sales_ord_no, a.line_no, b.ord_type_cd, b.sales_ord_stat_cd
        FROM tb_om04010 a, tb_om02001 b
        WHERE a.sales_ord_no = b.sales_ord_no
             and a.work_sctn_cd = 'M'
        order by a.sales_ord_no, a.line_no
   </statement>	
	
   <statement name="retrieveHppJuksongWorkingList_bak">
		SELECT a.sales_ord_no, a.line_no
		FROM tb_om04010 a
		WHERE a.work_sctn_cd = 'M'
		order by a.sales_ord_no, a.line_no
   </statement>	

   <statement name="callFuncPartCmptWmCheck">
		select {#1} wm_yn
  		  from dual
  		  
		<append condition="${wmWorkPlCd}.NOTEMPTY" id="#1">
		    ${wmWorkPlCd:not}.UFN_CHECKITEMCMPTYN@dl_wms_if(${salesOrdNo}, ${salesOrdLineNo}, ${wmWorkPlCd}) 
		</append>  		  
  
   </statement>

   <statement name="callFuncPartCmptInhWmCheck">
		select {#1} wm_yn
  		  from dual
  		  
		<append condition="${wmWorkPlCd}.NOTEMPTY" id="#1">
		    IDWMS.UFN_CHECKITEMCMPTYN(${salesOrdNo}, ${salesOrdLineNo}, ${wmWorkPlCd}) 
		</append>  		  
  
   </statement>

   <statement name="callFuncPartCmptIvCheck">
		select idusr.ivcomm_confirmcheck_close_fn(${salesOrdNo}, ${salesOrdLineNo}) iv_yn
  		  from dual
   </statement>

   <statement name="getRptCustCd">
		select nvl(rpt_cust_cd,cust_cd) rpt_cust_cd
  		  from tb_om02001
  		 where sales_ord_no = ${salesOrdNo}
   </statement>

   <statement name="getRptCustCdByEo">
		select nvl(rpt_cust_cd,cust_cd) rpt_cust_cd
  		  from tb_om02001
  		 where sales_ord_no = substr(${eoNo},1,10)
   </statement>

   <statement name="checkGiSuccessYn">
		select decode(count(*),0,'Y','N') succ_Yn 
  		  from tb_om03009i 
         where  sales_ord_no = ${salesOrdNo}
           and wrhs_eo_no &lt;   ${eoNo}
           and if_yn = 'E'
   </statement>

   <statement name="checkGrSuccessYn">
		select decode(count(*),0,'Y','N') succ_Yn 
  		  from tb_om03005i 
         where  sales_ord_no = ${salesOrdNo}
           and wrhs_eo_no &lt;   ${eoNo}
           and if_yn = 'E'
   </statement>

   <statement name="retrivePalletInfo">
		select CUST_CD,CUST_ORD_NO,LINE_NO,PALLET_NO,PALLET_SEQ,ITEM_CD,BAT_NO,ORD_QTY,QTY_UNIT_CD,ORD_WGT,WGT_UNIT_CD 
  		  from tb_om01011 
         where  cust_ord_no in ( select cust_ord_no from tb_om02001 where sales_ord_no=${salesOrdNo})

   </statement>

  <statement name="retrieveBackOrderItemList2">
  <![CDATA[
	SELECT 
		  'F' as chk
		, a.sales_ord_no
		, a.line_no
		, a.cust_cd
		, a.item_cd
		, b.item_nm
		, a.basis_item_cd
		, DECODE(NVL(a.item_grade_cd, ''), '', DECODE(A.CUST_CD, 'P1000', (SELECT GRADE_CD FROM TB_MA02010 WHERE PTN_CD = A.CUST_CD AND ITEM_CD = A.ITEM_CD)
															   , 'P1591', (SELECT GRADE_CD FROM TB_MA02010 WHERE PTN_CD = A.CUST_CD AND ITEM_CD = A.ITEM_CD)
															   , 'P1100', (SELECT GRADE_CD FROM TB_MA02011 WHERE PTN_CD = A.CUST_CD AND ITEM_CD = A.ITEM_CD AND CUST_BAT_NO = A.BAT_NO)
															   , 'P1200', (SELECT GRADE_CD FROM TB_MA02011 WHERE PTN_CD = A.CUST_CD AND ITEM_CD = A.ITEM_CD AND CUST_BAT_NO = A.BAT_NO)
															   , A.ITEM_GRADE_CD)
											 , A.ITEM_GRADE_CD) AS ITEM_GRADE_CD
		, a.basis_unit_cd
		, a.bat_no
		, ord_qty
		, ord_wgt
		, ord_CBM
		, 0 avail_stock_cnt
		, a.aptd_req_ymd || a.aptd_req_hm  AS aptd_req_time
		, a.aptd_req_ymd
		, a.aptd_req_hm
	    , a.dpt_ar_cd
	    , a.dpt_ar_type_cd
	    , a.arv_ar_cd
	    , a.arv_ar_type_cd
	    , b.wgt_unit_cd
	    , b.qty_unit_cd
	    , b.cbm
		, C.DPT_AR_ZIP_CD
		, C.DPT_AR_ZIP_ADDR
		, C.DPT_AR_DTL_ADDR
		, C.ARV_AR_CD AS MASTER_ARV_AR_CD
		, C.ARV_AR_ZIP_CD
		, C.ARV_AR_ZIP_ADDR
		, C.ARV_AR_DTL_ADDR
		, C.ORD_TYPE_CD
		, C.STRT_REQ_YMD
		, C.STRT_REQ_HM
		, C.APTD_REQ_YMD as master_aptd_req_ymd
		, C.APTD_REQ_HM as master_aptd_req_hm
		, C.rpt_cust_cd
		, a.plant_cd
		, A.deliv_dly_yn
		, a.pcul_cd
		, a.mn_cd
		, a.rmk
		, e.col01
		, e.col03
	 FROM TB_OM02002 A, TB_OM02001 C, TB_MA02010 B, TB_MA01015 D, TB_OM02005 E
    WHERE A.SALES_ORD_NO = C.SALES_ORD_NO
      and a.sales_ord_no  = e.sales_ord_no(+)
      and a.line_no       = e.line_no(+)
      AND C.SALES_ORD_CNCL_YN != 'Y'
      AND A.CUST_CD = B.PTN_CD
      AND A.ITEM_CD = B.ITEM_CD
      AND D.clas_cd = 'BASIC_UNIT_CD'
      AND A.basis_unit_cd = d.comn_cd
      AND a.ORD_REASON_CD IS NULL
      AND A.DEL_YN != 'Y'
      {#1}
      {#2}
    ORDER BY to_number(a.line_no)
    ]]>
   <append condition="${salesOrdNo}.NOTEMPTY" id="#1">
      AND A.sales_ord_no = ${salesOrdNo}
   </append>
   <append condition="${lineNo}.NOTEMPTY" id="#2">
      AND A.line_no = ${lineNo}
   </append>
  </statement>

   <statement name="getCorpCd">
		select corp_cd 
  		  from tb_ma01002 
         where  ptn_cd = ${rptCustCd}
   </statement>

   <statement name="retrieveDupTbOm03015">
	   select count(*) cnt
		  from tb_om03015
		 where sales_ord_no = ${salesOrdNo}
		   and work_route_seq = ${workRouteSeq}
		   and work_step_seq = ${workStepSeq}
		   and gi_work_step_seq = ${giWorkStepSeq}
		   and rslt_dgr_cnt = ${rsltDgrCnt}
   </statement>

   <statement name="retrieveDupTbOm02001">
		select count(*) cnt
		  from tb_om02001
		 where RLTD_GI_EO_NO = ${eoNo}
		   and ORD_DIV_DGR_CNT = ${ordDivDgrCnt}
   </statement>

   <statement name="getOrdTypeChgYn">
	   SELECT a.ord_type_chg_yn
		 FROM tb_om02102 a
		WHERE a.cust_cd = ${rptCustCd}
		  AND a.ord_type_cd = ${ordTypeCd}
		  and rownum = 1
   </statement>

	<statement name="retrieveSmsSendInfo">
		
      SELECT ORD_MNGT_EXCE_DEPT_CD
            ,WORK_PL_CD
            ,RCV_TEL_CNT
            ,SND_TEL1
            ,SND_TEL2
            ,SND_TEL3
            ,RCV1_TEL1
            ,RCV1_TEL2
            ,RCV1_TEL3
            ,RCV2_TEL1
            ,RCV2_TEL2
            ,RCV2_TEL3
            ,RCV3_TEL1
            ,RCV3_TEL2
            ,RCV3_TEL3
            ,RCV4_TEL1
            ,RCV4_TEL2
            ,RCV4_TEL3
            ,SND_MSG
        FROM TB_SMS_SEND_INFO
       WHERE ORD_MNGT_EXCE_DEPT_CD = ${ordMngtExceDeptCd}
         AND USE_YN='Y'  
         AND ROWNUM = 1      
         
	</statement>  

   <statement name="getCustOrdNo">
       select ${custOrdNo}||'-'||LPAD(count(*),3,'0') as cust_ord_no
         from tb_om02001 
        where cust_ref_no= ${custOrdNo}
   </statement>

   <statement name="retrieveGiCnclPossYn4">
	  SELECT decode((rslt.r_cnt + dcsn.d_cnt), 0, 'Y', 'N') cancel_gi_yn
        FROM (SELECT COUNT(ROWNUM) r_cnt
                FROM tb_om03015 a
                    ,tb_om04001 b
               WHERE a.sales_ord_no   = b.sales_ord_no
                 AND a.work_route_seq = b.work_route_seq
                 AND a.work_step_seq  = b.work_step_seq
                 AND a.eo_no          = b.eo_no
                 AND a.sales_ord_no   = (select sales_ord_no 
                                           from tb_om02001 
                                          where LOAD_DLY_RLTD_SALES_ORD_NO=${salesOrdNo})
             ) rslt
            ,(SELECT COUNT(ROWNUM) d_cnt
                FROM tb_om03015 a
                    ,tb_om03022 b
               WHERE a.eo_no          = b.eo_no
                 AND a.sales_ord_no   = b.sales_ord_no
                 AND a.sales_ord_no   = (select sales_ord_no 
                                           from tb_om02001 
                                          where LOAD_DLY_RLTD_SALES_ORD_NO=${salesOrdNo})
             ) dcsn
   </statement>

   <statement name="retrieveBookingSheetEmptyBookingList">
       SELECT 'F' as chk
		     , a.sales_ord_no
		     , a.cust_ord_no
		     , a.rpt_cust_cd
		     , b.dlv_pl_nm
		     , b.dpt_port_prar_ymd  as orig_dpt_port_prar_ymd
		     , a.cust_exca_ofcr_nm
		     , a.cargo_form_cd
		     , a.exp_imp_dom_sctn_cd
		     , b.exp_type_cd
		     , c.booking_no
		     , c.ship_co_booking_no
		     , c.booking_ymd
		     , c.schd_no
		     , '' schd_type
		     , c.schd_ofcr_nm
		     , c.ship_co_cd
		     , c.ship_co_nm
		     , c.ship_co_ofcr_nm
		     , c.ship_co_tel_no
		     , c.ship_co_fax_no
		     , c.ship_nm
		     , c.port_cnt
		     , c.pol_cd
		     , c.pol_nm
		     , c.pod_cd
		     , c.pod_nm
		     , c.dpt_port_prar_ymd
		     , c.arv_port_prar_ymd
		     , c.cy_cls_ymd
		     , c.cy_cls_hms
		     , c.sr_cls_ymd
		     , c.sr_cls_hms
		     , c.cntr_kind_cd1
		     , c.cntr_qty1
		     , c.cntr_kind_cd2
		     , c.cntr_qty2
		     , c.cntr_kind_cd3
		     , c.cntr_qty3
		     , c.cntr_kind_cd4
		     , c.cntr_qty4
		     , c.cntr_kind_cd5
		     , c.cntr_qty5
		     , c.booking_wgt
		     , c.wgt_unit_cd
		     , c.cy_dtl_conts
		     , c.FWD_EO_NO
		     , c.VANNING_CMPT_YN
		     , c.bl_no 
		     , c.cntr_no 
		     , c.incoterms_cd 
		     , c.cust_ptn_nm
		     , c.tran_co_nm
		     , c.sell_ofcr_nm
		     , c.mill_out_ymd
		     , c.custom_po_no
		     , c.commodity_hts
		     , c.add_yn
		     , c.tri_axle
		     , c.rmk 
		     , '' inland_Port_Cd
		     , '' inland_Port_Nm
		     , '' as upd_flag
		  FROM tb_om02001 a, tb_om02003 b, tb_om02019 c
		 WHERE a.sales_ord_no        = b.sales_ord_no
		   AND a.sales_ord_no        = c.sales_ord_no(+)
		  {#1}
		   AND a.exp_imp_dom_sctn_cd = '01'
		   AND a.cust_ord_no is not null
		   AND b.exp_type_cd         = '01'
		   AND b.OCEAN_AIR_SCTN_CD   = 'S'
		   AND A.SALES_ORD_CNCL_YN   = 'N'
		   AND NOT EXISTS ( select 1 from tb_om02019 where sales_ord_no = a.sales_ord_no)
		 Order by a.cust_ord_no, a.sales_ord_no
	 <append condition="${sOrdNo}.NOTEMPTY" id="#1">
           AND a.sales_ord_no      = ${sOrdNo}
	 </append>		 
     <append condition="${cOrdNo}.NOTEMPTY" id="#1">
		   AND a.cust_ord_no      = ${cOrdNo}
	 </append>		 
	    <append condition="${custCd}.NOTEMPTY" id="#1">
			AND    a.ctrt_Cust_cd      = ${custCd}
            </append>
	    <append condition="${dptPortPrarYmdFrom}.NOTEMPTY&amp;${dptPortPrarYmdTo}.NOTEMPTY&amp;${dateType}.EQ.E" id="#1">
			AND    a.sales_ord_creat_ymd between ${dptPortPrarYmdFrom} and ${dptPortPrarYmdTo}
		</append>
	    <append condition="${dptPortPrarYmdFrom}.NOTEMPTY&amp;${dptPortPrarYmdTo}.NOTEMPTY&amp;${dateType}.EQ.D" id="#1">
			AND    b.ARV_PORT_PRAR_YMD between ${dptPortPrarYmdFrom} and ${dptPortPrarYmdTo}
		</append>
	    <append condition="${dptArCd}.NOTEMPTY" id="#1">
			AND    a.dpt_ar_cd         = ${dptArCd}
		</append>
	    <append condition="${ctryCd}.NOTEMPTY" id="#1">
			AND    b.ctry_cd        = ${ctryCd}
		</append>
	    <append condition="${custOfcrNm}.NOTEMPTY" id="#1">
			AND    a.CUST_OFCR_NM      = ${custOfcrNm}
            </append>
	</statement>

   <statement name="retrieveBookingSheetExistBookingList">
       SELECT 'F' as chk
		     , a.sales_ord_no
		     , a.cust_ord_no
		     , a.rpt_cust_cd
		     , b.dlv_pl_nm
		     , b.dpt_port_prar_ymd  as orig_dpt_port_prar_ymd
		     , a.cust_exca_ofcr_nm
		     , a.cargo_form_cd
		     , a.exp_imp_dom_sctn_cd
		     , b.exp_type_cd
		     , c.booking_no
		     , c.ship_co_booking_no
		     , c.booking_ymd
		     , c.schd_no
		     , '' schd_type
		     , c.schd_ofcr_nm
		     , c.ship_co_cd
		     , c.ship_co_nm
		     , c.ship_co_ofcr_nm
		     , c.ship_co_tel_no
		     , c.ship_co_fax_no
		     , c.ship_nm
		     , c.port_cnt
		     , c.pol_cd
		     , c.pol_nm
		     , c.pod_cd
		     , c.pod_nm
		     , c.dpt_port_prar_ymd
		     , c.arv_port_prar_ymd
		     , c.cy_cls_ymd
		     , c.cy_cls_hms
		     , c.sr_cls_ymd
		     , c.sr_cls_hms
		     , c.cntr_kind_cd1
		     , c.cntr_qty1
		     , c.cntr_kind_cd2
		     , c.cntr_qty2
		     , c.cntr_kind_cd3
		     , c.cntr_qty3
		     , c.cntr_kind_cd4
		     , c.cntr_qty4
		     , c.cntr_kind_cd5
		     , c.cntr_qty5
		     , c.booking_wgt
		     , c.wgt_unit_cd
		     , c.cy_dtl_conts
		     , c.FWD_EO_NO
		     , c.VANNING_CMPT_YN
		     , c.bl_no 
		     , c.cntr_no 
		     , c.incoterms_cd 
		     , c.cust_ptn_nm
		     , c.tran_co_nm
		     , c.sell_ofcr_nm
		     , c.mill_out_ymd
		     , c.custom_po_no
		     , c.commodity_hts
		     , c.add_yn
		     , c.tri_axle
		     , c.rmk 
		     , '' inland_Port_Cd
		     , '' inland_Port_Nm
		     , '' as upd_flag
		  FROM tb_om02001 a, tb_om02003 b, tb_om02019 c
		 WHERE a.sales_ord_no        = b.sales_ord_no
		   AND a.sales_ord_no        = c.sales_ord_no
		  {#1}
		   AND a.exp_imp_dom_sctn_cd = '01'
		   AND a.cust_ord_no is not null
		   AND b.exp_type_cd         = '01'
		   AND b.OCEAN_AIR_SCTN_CD   = 'S'
		   AND A.SALES_ORD_CNCL_YN   = 'N'
		 Order by a.cust_ord_no, a.sales_ord_no
	 <append condition="${salesOrdNo}.NOTEMPTY" id="#1">
           AND a.sales_ord_no      = ${salesOrdNo}
	 </append>		 
     <append condition="${custOrdNo}.NOTEMPTY" id="#1">
		   AND a.cust_ord_no      = ${custOrdNo}
	 </append>		 
     <append condition="${rptCustCd}.NOTEMPTY" id="#1">
		   AND a.rpt_cust_cd      = ${rptCustCd}
	 </append>	
     <append condition="${polCd}.NOTEMPTY" id="#1">
		   AND c.pol_cd      = ${polCd}
	 </append>		 
     <append condition="${podCd}.NOTEMPTY" id="#1">
		   AND c.pod_cd      = ${podCd}
	 </append>		 
     <append condition="${shipCoCd}.NOTEMPTY" id="#1">
		   AND c.ship_Co_Cd      = ${shipCoCd}
	 </append>		 
     <append condition="${bookingNo}.NOTEMPTY" id="#1">
		   AND c.ship_co_booking_no     = ${bookingNo}
	 </append>		 	 
     <append condition="${blNo}.NOTEMPTY" id="#1">
           AND c.bl_no     = ${blNo}
 	 </append>		 
     <append condition="${modStartDate}.NOTEMPTY&amp;${modEndDate}.NOTEMPTY" id="#1">
		   AND c.mill_out_ymd  between ${modStartDate} and ${modEndDate}
	 </append>		 
     <append condition="${etdStartDate}.NOTEMPTY&amp;${etdEndDate}.NOTEMPTY" id="#1">
		   AND c.dpt_port_prar_ymd  between ${etdStartDate} and ${etdEndDate}
	 </append>		 
     <append condition="${shipNm}.NOTEMPTY" id="#1">
		   AND c.ship_nm   = ${shipNm}
	 </append>
     <append condition="${portCnt}.NOTEMPTY" id="#1">
		   AND c.port_Cnt   = ${portCnt}
 	 </append>		 		 
     <append condition="${sellOfcrNm}.NOTEMPTY" id="#1">
		   AND c.sell_Ofcr_Nm   = ${sellOfcrNm}
	 </append>
     <append condition="${regrId}.NOTEMPTY" id="#1">
		   AND c.regr_Id   = ${regrId}
	 </append>
     <append condition="${bookingYmdFrom}.NOTEMPTY&amp;${bookingYmdTo}.NOTEMPTY" id="#1">
		   AND c.booking_ymd  between ${bookingYmdFrom} and ${bookingYmdTo}
	 </append>	 
     <append condition="${custExcaOfcrNm}.NOTEMPTY" id="#1">
		   AND a.cust_exca_ofcr_nm   = ${custExcaOfcrNm}
	 </append>
     <append condition="${cntrNo}.NOTEMPTY" id="#1">
		   AND c.cntr_no   = ${cntrNo}
	 </append>


	</statement>

	<statement name="retrieveTransferFwdEoNew">
		SELECT	${eoNo} FWD_EO_NO
		      , (SELECT nvl(MAX(trms_seq), 0) + 1 FROM tb_om03011i WHERE FWD_EO_NO = ${eoNo}) AS trms_seq
			  , ${trmsSctnCd} TRMS_SCTN_CD
			  , a.SALES_ORD_NO
			  , a.CORP_CD
			  , a.EXP_IMP_DOM_SCTN_CD
			  , a.CARGO_FORM_CD
			  , a.sell_dept_cd as ORD_MNGT_FWD_DEPT_CD
			  , a.ORD_MNGT_FWD_OFCR_ID
			  , decode(nvl(a.CUST_ORD_NO, ''), '', a.cust_ref_no, a.cust_ord_no) cust_ord_no
			  , a.bilg_cust_cd as ctrt_cust_cd
			  , b.OCEAN_AIR_SCTN_CD
			  , b.FCL_LCL_SCTN_CD
			  , b.BL_KIND_CD
			  , b.HBL_NO
			  , b.MBL_NO
			  , decode(nvl(${bookingNo}, ''), '', b.booking_no, c.SHIP_CO_BOOKING_NO) booking_no
			  , decode(nvl(${bookingNo}, ''), '', '', c.BOOKING_YMD) booking_ymd
              , decode(nvl(${bookingNo}, ''), '', decode(b.POL_CD,'KRPUN','KRPUS',b.POL_CD), decode(c.pol_cd,'KRPUN','KRPUS',c.POL_CD)) pol_cd
			  , decode(nvl(${bookingNo}, ''), '', decode(b.POL_CD,'KRPUN','BUSAN, KOREA',b.POL_NM), decode(c.pol_cd,'KRPUN','BUSAN, KOREA',c.pol_nm))	pol_nm
				
              , decode(nvl(${bookingNo}, ''), '', b.POD_CD, c.pod_cd)	pod_cd
			  , decode(nvl(${bookingNo}, ''), '', b.POD_NM, c.pod_nm)	pod_nm
			  , b.DLV_PL_CD
			  , b.DLV_PL_NM
			  , b.FDEST_CD
			  , b.FDEST_NM
			  , decode(nvl(${bookingNo}, ''), '', b.SHIP_CO_CD, c.ship_co_cd) ship_co_cd
			  , substr(decode(nvl(${bookingNo}, ''), '', b.ship_co_nm, c.ship_co_nm), 1, 50) ship_co_nm
			  , decode(nvl(${bookingNo}, ''), '', '', c.SHIP_CO_OFCR_NM) SHIP_CO_OFCR_NM
			  , decode(nvl(${bookingNo}, ''), '', '', c.ship_co_tel_no) ship_co_tel_no
			  , decode(nvl(${bookingNo}, ''), '', '', c.ship_co_fax_no) ship_co_fax_no
			  , substr(decode(nvl(${bookingNo}, ''), '', b.SHIP_NM, c.SHIP_NM), 1, 25) SHIP_NM
			  , decode(nvl(${bookingNo}, ''), '', b.PORT_CNT, c.PORT_CNT) PORT_CNT
			  , b.airline_cd
			  , MACOMM_GETCD_FN('IATA_CD', B.AIRLINE_CD) AIRLINE_NM
			  , b.INCOTERMS_CD
			  , b.DPT_SVC_TERM_CD
			  , b.ARV_SVC_TERM_CD
			  , decode(nvl(${bookingNo}, ''), '', b.DPT_PORT_PRAR_YMD, c.DPT_PORT_PRAR_YMD) DPT_PORT_PRAR_YMD
			  , decode(nvl(${bookingNo}, ''), '', b.DPT_PORT_PRAR_HM, '') DPT_PORT_PRAR_HM
			  , decode(nvl(${bookingNo}, ''), '', b.ARV_PORT_PRAR_YMD, c.ARV_PORT_PRAR_YMD) ARV_PORT_PRAR_YMD
			  , decode(nvl(${bookingNo}, ''), '', b.ARV_PORT_PRAR_HM, '') ARV_PORT_PRAR_HM
			  , decode(nvl(${bookingNo}, ''), '', '', c.CY_CLS_YMD) CY_CLS_YMD
			  , decode(nvl(${bookingNo}, ''), '', '', c.CY_CLS_HMS) CY_CLS_HMS
			  , decode(nvl(${bookingNo}, ''), '', '', c.SR_CLS_YMD) SR_CLS_YMD
			  , decode(nvl(${bookingNo}, ''), '', '', c.SR_CLS_HMS) SR_CLS_HMS
			  , decode(nvl(${bookingNo}, ''), '', '', c.CY_DTL_CONTS) CY_DTL_CONTS
			  , b.SHIPPER_CD
			  , b.SHIPPER_NM
			  , b.SHIPPER_ADDR1
			  , b.SHIPPER_ADDR2
			  , b.SHIPPER_ADDR3
			  , b.SHIPPER_ADDR4
			  , b.CNEE_CD
			  , b.CNEE_NM
			  , b.CNEE_ADDR1
			  , b.CNEE_ADDR2
			  , b.CNEE_ADDR3
			  , b.CNEE_ADDR4
			  , b.NTFY_CD
			  , b.NTFY_NM
			  , b.NTFY_ADDR1
			  , b.NTFY_ADDR2
			  , b.NTFY_ADDR3
			  , b.NTFY_ADDR4
			  , b.PTN_CD
			  , b.PTN_NM
			  , b.PTN_OFCR_NM
			  , b.LC_NO
			  , b.CI_NO
			  , decode(nvl(${bookingNo}, ''), '', b.CNTR_KIND_CD1, c.CNTR_KIND_CD1) CNTR_KIND_CD1
			  , decode(nvl(${bookingNo}, ''), '', b.CNTR_QTY1, c.CNTR_QTY1) CNTR_QTY1
			  , decode(nvl(${bookingNo}, ''), '', b.CNTR_KIND_CD2, c.CNTR_KIND_CD2) CNTR_KIND_CD2
			  , decode(nvl(${bookingNo}, ''), '', b.CNTR_QTY2, c.CNTR_QTY2) CNTR_QTY2
			  , decode(nvl(${bookingNo}, ''), '', b.CNTR_KIND_CD3, c.CNTR_KIND_CD3) CNTR_KIND_CD3
			  , decode(nvl(${bookingNo}, ''), '', b.CNTR_QTY3, c.CNTR_QTY3) CNTR_QTY3
			  , decode(nvl(${bookingNo}, ''), '', b.CNTR_KIND_CD4, c.CNTR_KIND_CD4) CNTR_KIND_CD4
			  , decode(nvl(${bookingNo}, ''), '', b.CNTR_QTY4, c.CNTR_QTY4) CNTR_QTY4
			  , decode(nvl(${bookingNo}, ''), '', b.CNTR_KIND_CD5, c.CNTR_KIND_CD5) CNTR_KIND_CD5
			  , decode(nvl(${bookingNo}, ''), '', b.CNTR_QTY5, c.CNTR_QTY5) CNTR_QTY5
			  , b.PCKG_UNIT_CD
			  , b.PCKG_QTY
			  , b.TOT_WGT
			  , b.TRAN_COST_WGT
			  , b.TOT_CBM
			  , b.RPT_ITEM_NM
			  , b.DANGER_SCTN_CD
			  , b.BOND_TRAN_YN
			  , b.TRAN_COST_PAY_COND_CD
			  , b.EXTR_EXPN_PAY_COND_CD
			  , b.MNFEST_DCLR_TGT_YN
			  , a.CUST_OFCR_NM
			  , a.CUST_OFCR_TEL_NO
		      , case when a.dpt_ar_type_cd = '02' then
		    	         (select name 
		    	            from vw_ma01_01 
		    	           where code = a.dpt_ar_cd 
		    	             AND PTN_CD = a.RPT_CUST_CD
		    	             and work_sctn_cd = a.dpt_ar_type_cd) 
			         else 	    	
		    	         (select name 
		    	            from vw_ma01_01 
		    	           where code = a.dpt_ar_cd 
		    	             and work_sctn_cd = a.dpt_ar_type_cd
		    	             and rownum = 1) 
		        end  as dpt_ar_nm
		      , a.DPT_AR_OFCR_NM
			  , a.DPT_AR_OFCR_TEL_NO
			  , a.STRT_REQ_YMD
			  , a.STRT_REQ_HM
			  , a.SALES_OFCR_ID
		      , MACOMM_GETUSERNM_FN( a.sales_ofcr_id ) AS sales_ofcr_nm
			  , idusr.omcomm_makermk_fn(a.sales_ord_no) as RMK
			  , b.TS_CD1
			  , b.TS_CD2
			  , b.TS_CD3
			  , b.CARR_CD1
			  , b.CARR_CD2
			  , b.CARR_CD3
			  , b.CO_LOAD_ENTP_CD
			  , b.MARK_CONTS
			  , b.DESC_CONTS
			  , b.LC_EXPI_YMD
			  , (SELECT min(CUSTOMS_DOC_NO) FROM tb_om02204i where cust_ord_no = a.cust_ord_no)	CUSTOMS_DOC_NO
			  , 'N' if_yn
			  , ${regrId} regr_id
			  , ${mdfrId} mdfr_id
			  , c.bl_no 
		      , c.cntr_no 
		      , c.incoterms_cd  as booking_incoterms_cd
		      , c.cust_ptn_nm
		      , c.tran_co_nm
		      , c.sell_ofcr_nm
		      , c.mill_out_ymd
		      , c.custom_po_no
		      , c.commodity_hts
		      , c.add_yn
		      , c.tri_axle
			  , c.rmk  as booking_rmk
		  FROM  tb_om02001 a
		      , tb_om02003 b
		      , tb_om02019 c
		 WHERE  a.sales_ord_no = b.sales_ord_no(+)
		   AND  a.sales_ord_no = c.sales_ord_no(+)
		   AND  a.sales_ord_no = ${salesOrdNo}
		  {#1}
		<append condition="${bookingNo}.NOTEMPTY" id="#1">
		   AND  c.booking_no(+) = ${bookingNo}
		</append>
	
	</statement>
	
	<statement name="retrieveHplOrderGb">
	    SELECT IDUSR.OM_HPL_ORD_GUBUN_FN( ${rptCustCd}, ${custOrdNo} ) o_gubun from dual
	</statement>
	
	<statement name="checkHonjukLineNoDup">
	    SELECT count(*) cnt
	      FROM tb_om02002
	     WHERE sales_ord_no = ${salesOrdNo}
	       AND cust_ord_line_no = ${custOrdLineNo}
	</statement>	
	
	<statement name="retrieveHplSms">	
	SELECT A.SALES_ORD_STAT_CD
	       , A.RPT_CUST_CD
	       , A.CUST_ORD_NO 
	       , (SELECT COMN_CD_NM FROM TB_MA01015 WHERE CLAS_CD = 'ORD_STAT_CD' AND COMN_CD = A.SALES_ORD_STAT_CD ) SALES_ORD_STAT_NM
	       , B.USER_NM      
	       , B.USER_MBP_NO AS OFCR_TEL_NO
	  FROM TB_OM02001 A, TB_HPL_SMS B
	WHERE A.TRAN_PLAN_CNTR_CD = B.WORK_CNTR_CD
	   AND A.CUST_CD = B.CUST_CD
	   AND B.USE_YN = 'Y'
	   AND A.CUST_CD = ${custCd}
	   AND A.CUST_ORD_TYPE_CD LIKE 'Z%'
	   AND A.SALES_ORD_NO = ${salesOrdNo}
	</statement>		

	<statement name="retrieveHplWorkCnt">	
	 select count(1) cnt 
	  from TB_OM02101
	where cust_cd = ${custCd}
	   and save_loc_cd = ${saveLocCd}
	   and grade_cd = 'P'
	</statement>

	<statement name="getCutOrderDcsnCnt">	
	    select decode(count(*),0,'N','Y') dcsn_yn 
	      from tb_om03022
	     where sales_ord_no in (select sales_ord_no
	                              from tb_om02002
	                             where cust_ref_no  = ${custOrdNo})
	</statement>
	
	<statement name="getSalesNoByCutOrder">	
	    select a.sales_ord_no, a.cust_ord_no, a.if_id,a.regr_Id,a.mdfr_Id,b.line_no,b.ord_reason_cd
	      from tb_om02001 a, tb_om02002 b, tb_om02005 c
	     where a.sales_ord_no = b.sales_ord_no
	       and b.sales_ord_no = c.sales_ord_no
	       and b.line_no   = c.line_no
	       and a.cust_ref_no = ${custOrdNo}
	</statement>	

	<statement name="getSalesNoByCutOrderList">	
	    select a.sales_ord_no, a.cust_ord_no, a.if_id,a.regr_Id,a.mdfr_Id,c.col14,c.col15,c.col16
	      from tb_om02001 a,tb_om02002 b, tb_om02005 c
	     where a.sales_ord_no = b.sales_ord_no
	       and b.sales_ord_no = c.sales_ord_no
	       and b.line_no = c.line_no
	       and a.cust_ord_no = ${custRefNo}
	</statement>

	<statement name="getCutSalesOrdNoByOrderList">	
	    select a.sales_ord_no, a.cust_ord_no, a.if_id,a.regr_Id,a.mdfr_Id,c.col14,c.col15,c.col16,c.col17,c.col18,c.col19
	      from tb_om02001 a,tb_om02002 b, tb_om02005 c
	     where a.sales_ord_no = b.sales_ord_no
	       and b.sales_ord_no = c.sales_ord_no
	       and b.line_no = c.line_no
	       and a.cust_ref_no = ${custOrdNo}
	</statement>

	<statement name="retrieveOrdReasonCdForPtnCd">	
		select COMN_CD code,COMN_CD_NM val
          from tb_ma01015
         where 1=1
           {#1}
      	<append condition="${ptnCd}.NOTEMPTY&amp;${ptnCd}.EQ.P1000" id="#1">
    	   and clas_cd ='HPP_ORD_REASON_CD'
    	</append>
      	<append condition="${ptnCd}.NOTEMPTY&amp;${ptnCd}.EQ.P1200" id="#1">
    	   and clas_cd ='HHP_ORD_REASON_CD'
    	</append>
      	<append condition="${ptnCd}.NOTEMPTY&amp;${ptnCd}.EQ.P1100" id="#1">
    	   and clas_cd ='NSK_ORD_REASON_CD'
    	</append>  
      	<append condition="${ptnCd}.NOTEMPTY&amp;${ptnCd}.EQ.P1591" id="#1">
    	   and clas_cd ='ART_ORD_REASON_CD'
    	</append>    	
      	<append condition="${ptnCd}.NOTEMPTY&amp;${ptnCd}.EQ.R1209" id="#1">
    	   and clas_cd ='EVE_ORD_REASON_CD'
    	</append>    	
      	<append condition="${ptnCd}.NOTEMPTY&amp;${ptnCd}.EQ.R1728" id="#1">
    	   and clas_cd ='EVE_ORD_REASON_CD'
    	</append>    	
      	<append condition="${ptnCd}.NOTEMPTY&amp;${ptnCd}.EQ.P1010" id="#1">
    	   and clas_cd ='HPL_ORD_REASON_CD'
    	</append>    	
      	<append condition="${ptnCd}.NOTEMPTY&amp;${ptnCd}.EQ.P1028" id="#1">
    	   and clas_cd ='HPL_ORD_REASON_CD'
    	</append>
    	<append condition="${ptnCd}.NE.P1000&amp;${ptnCd}.NE.P1100&amp;${ptnCd}.NE.P1200&amp;${ptnCd}.NE.P1591&amp;${ptnCd}.NE.R1209&amp;${ptnCd}.NE.R1728&amp;${ptnCd}.NE.P1010&amp;${ptnCd}.NE.P1028" id="#1">
    	   and clas_cd ='TPL_ORD_REASON_CD'
      	</append>    	  	
	</statement>


  <statement name="retrieveTransferJHGrEoRsltItemList">
	SELECT distinct a.sales_ord_no
	     , a.line_no
	     , a.rslt_qty
	     , a.rslt_wgt
	     , a.rslt_cbm
	     , a.prdt_ymd
	     , a.PRDT_LOT_NO
	     , a.DIA_SUPL
	     , a.PAPSTYLE_GDS_SUPL
	     , a.prdt_req_no
	     , to_char(b.work_date, 'yyyymmddHH24miss') work_date
	     , a.PCUL_MN_CD
	     , substr(a.DIA_SUPL,1,8) org_dia_supl
	     , substr(a.DIA_SUPL,9)   org_cntr_no
         , b.bl_no   
         , a.lot_no 
         , (select wm_work_pl_cd from tb_iv02007 where sales_ord_no = a.sales_ord_no and rownum = 1) whseid  	     
	FROM   tb_om04003 a
		 , tb_om04001 b
	WHERE  a.sales_ord_no 	 = b.sales_ord_no
	and	   a.work_route_seq  = b.work_route_seq
	and	   a.work_step_seq 	 = b.work_step_seq
	and	   a.rslt_dgr_cnt 	 = b.rslt_dgr_cnt
	AND    b.sales_ord_no 	 = ${salesOrdNo}
	AND    b.work_route_seq  = ${workRouteSeq}
	AND    b.work_step_seq 	 = ${rsltWorkStepSeq}
	and    b.rslt_dgr_cnt	 = ${rsltDgrCnt}
	and	   a.CNCL_ORD_NO is null
		{#1}
    <append condition="${trmsSctnCd}.NOTEMPTY&amp;${trmsSctnCd}.EQ.Z" id="#1">
    AND   A.LINE_NO  = ${lineNo}
    </append>
  </statement>

  <statement name="retrieveTransferJHLotInfo">
	select LOTTABLE01, LOTTABLE02, LOTTABLE03, LOTTABLE04
      from {#1}
     where 1=1
     {#2}
	<append condition="${whseid}.NOTEMPTY" id="#1">
		${whseid:not}.lotattribute@DL_WMS_IF
	</append>

	<append condition="${lotNo}.NOTEMPTY" id="#2">
	    AND lot = ${lotNo}
	</append>
  </statement>	
 
 	<statement name="getItemQty">	
		select trunc(${calWgt}/net_wgt) cal_qty
		  from tb_ma02010 
		 where ptn_cd  = ${calCustCd} 
		   and item_cd = ${calItemCd}
	</statement>
 
   <statement name="retrieveTransferGrEoSalesOrdItemShipmentBySpp">
	SELECT a.sales_ord_no
		 , a.line_no
	     , b.cust_cd
	     , b.basis_item_cd  as item_cd
	     , b.item_grade_cd
	     , b.bat_no
	     , a.ord_qty
	     , a.ord_wgt
	     , a.ord_cbm
	     , (SELECT FLTR_CONTS1 FROM tb_ma01015 WHERE clas_cd = 'BASIC_UNIT_CD' AND comn_cd = b.basis_unit_cd) basis_unit_attr
	     , b.qty_unit_cd
	     , b.wgt_unit_cd
	     , b.plant_cd
     	 , b.lot_no
	     , b.prdt_req_no
	     , b.prdt_ymd
	     , b.ord_reason_cd
	     , b.cntr_no
	     , b.cust_ord_line_no
	     , b.pallet_qty
         , case when b.cust_cd = 'P1100' then
	         		case when trim(b.pcul_cd) is null and trim(b.mn_cd) is null then
	         				''
	         			else 
	         				trim(b.pcul_cd) || '-' || trim(b.mn_cd)
	         		end
				else 
					''
			end as pcul_mn_cd 
		  , b.line_no as sales_ord_line_no
	FROM   (select sales_ord_no
				 , line_no
				 , shipment_no
				 , sum(plan_qty) ord_qty
				 , sum(plan_wgt) ord_wgt
				 , sum(plan_cbm) ord_cbm
		    from   tb_om03017 
		    where  sales_ord_no   = ${salesOrdNo}
			AND    work_route_seq = ${workRouteSeq}
			and	   shipment_no	  = ${shipmentNo}
		    group by sales_ord_no, line_no, shipment_no) a
		 , tb_om02002 b
	WHERE  a.sales_ord_no 	= b.sales_ord_no
	AND	   A.LINE_NO 		= B.LINE_NO
  </statement>

   <statement name="retrieveTransferGrEoSalesOrdItemShipmentByIrm">
	SELECT a.sales_ord_no
		 , a.line_no
	     , b.cust_cd
	     , b.basis_item_cd  as item_cd
	     , b.item_grade_cd
	     , b.bat_no
	     , a.ord_qty
   	     , case when b.qty_unit_cd = c.spec_unit_cd then c.pckg_qty * a.ord_qty
   	            else a.ord_qty
   	        end as pckg_qty
	     , a.ord_wgt
	     , a.ord_cbm
	     , (SELECT FLTR_CONTS1 FROM tb_ma01015 WHERE clas_cd = 'BASIC_UNIT_CD' AND comn_cd = b.basis_unit_cd) basis_unit_attr
	     , b.qty_unit_cd
	     , b.wgt_unit_cd
	     , b.plant_cd
     	 , b.lot_no
	     , b.prdt_req_no
	     , b.prdt_ymd
	     , b.ord_reason_cd
	     , b.cntr_no
	     , b.cust_ord_line_no
	     , b.pallet_qty
         , case when b.cust_cd = 'P1100' then
	         		case when trim(b.pcul_cd) is null and trim(b.mn_cd) is null then
	         				''
	         			else 
	         				trim(b.pcul_cd) || '-' || trim(b.mn_cd)
	         		end
				else 
					''
			end as pcul_mn_cd 
		  , b.line_no as sales_ord_line_no
	FROM   (select sales_ord_no
				 , line_no
				 , shipment_no
				 , sum(plan_qty) ord_qty
				 , sum(plan_wgt) ord_wgt
				 , sum(plan_cbm) ord_cbm
		    from   tb_om03017 
		    where  sales_ord_no   = ${salesOrdNo}
			AND    work_route_seq = ${workRouteSeq}
			and	   shipment_no	  = ${shipmentNo}
		    group by sales_ord_no, line_no, shipment_no) a
		 , tb_om02002 b
		 , tb_ma02010 c
	WHERE  a.sales_ord_no 	= b.sales_ord_no
	AND	   A.LINE_NO 		= B.LINE_NO
	and    b.cust_cd = c.ptn_cd
	and    b.item_cd = c.item_cd
  </statement>

	<statement name="retrieveSalesOfcrInfo">	 	 
      	SELECT a.bilg_cust_cd   /* 청구고객코드 */
                 , macomm_getptnnm_fn(a.bilg_cust_cd) AS bilg_cust_nm
                 , ltrim(a.sell_dept_cd,'0') as sell_dept_cd   /* 매출부서코드 */
                 , macomm_getdeptnm_fn(a.corp_cd, a.sell_dept_cd) AS sell_dept_nm
                 , a.sales_ofcr_id   /* 영업담당자ID */
                 , macomm_getusernm_fn(a.sales_ofcr_id) AS sales_ofcr_nm                        
                 , a.ctrt_no  /* 계약번호 */
                 ,  (   SELECT ac.ctrt_nm
			            FROM  tb_sm04110 aa,
			                  tb_sm07110 ac
			            WHERE  aa.corp_cd = a.corp_cd
			            AND    aa.corp_cd     = ac.corp_cd
			            AND    aa.prmt_biz_no  = ac.prmt_biz_no
			            and    aa.sell_ctrt_no = A.ctrt_no
			            and    rownum=1  ) ctrt_nm
          FROM tb_is05019 a
         where 1=1 
           and a.use_yn='Y'
         {#1}    
         group by A.corp_cd, a.bilg_cust_cd, a.sell_dept_cd, a.sales_ofcr_id, a.ctrt_no
     	<append condition="${corpCd}.NOTEMPTY" id="#1">
    		AND   a.corp_cd  = ${corpCd}
     	</append>
     	<append condition="${expImpDomSctnCd}.NOTEMPTY" id="#1">
    		AND   A.exp_imp_dom_sctn_cd  = ${expImpDomSctnCd}
     	</append>
     	<append condition="${ordTypeCd}.NOTEMPTY" id="#1">
    		AND   A.ord_type_cd  = ${ordTypeCd}
     	</append>
     	<append condition="${ctrtCustCd}.NOTEMPTY" id="#1">
    		AND   A.ctrt_cust_cd = ${ctrtCustCd}
    	</append>  
    	<append condition="${ctrtNo}.NOTEMPTY" id="#1">
    		AND   A.ctrt_no = ${ctrtNo}
    	</append>   
    	<append condition="${salesOfcrId}.NOTEMPTY" id="#1">
    		AND   a.sales_ofcr_id  = ${salesOfcrId}
    	</append>   
     	<append condition="${dptArCd}.NOTEMPTY" id="#1">
    		AND  (a.dpt_ar_cd  = ${dptArCd} OR a.dpt_ar_cd IS NULL)
    	</append> 
    	<append condition="${arvArCd}.NOTEMPTY" id="#1">
    		AND  (a.arv_ar_cd  = ${arvArCd} OR a.arv_ar_cd IS NULL)
    	</append> 	 
	 </statement>
	 
	 
  <statement name="callUspAutoAlloc">
  <![CDATA[
	{call IDWMS.USP_AUTO_ALLOC ( 	 
				${eoNo:string:inparam},
				${result1:string:outparam},
				${result2:string:outparam}
			)
	}
	]]> 
  </statement>
 
 	<statement name="callIsBilgCustSMS">
	<![CDATA[ 
	CALL IDUSR.IS_BILGCUST_SMSSEND_SP(
				${rptCustCd:string:inparam}, 
				${ordTypeCd:string:inparam}, 
				${rtnCd:string:outparam},
				${rtnMsg:string:outparam}
	)
	]]> 	
	</statement>

	<statement name="checkArvYn">
	    SELECT decode(count(*),0,'N','Y') arv_yn
	      FROM tb_om04001
	     WHERE eo_no = ${eoNo}
	       AND shipment_no = ${shipmentNo}
	       AND RSLT_SCTN_CD='02'
	</statement>

  <statement name="retrieveDopgOrd">
	 SELECT COUNT(*) CNT
	  FROM TB_OM02001 a, om_goods_gr_if b
	 WHERE a.cust_cd = b.cust_cd
	   AND a.sales_ord_no = b.sales_ord_no
	   AND a.cust_cd = ${rptCustCd}
	   AND a.cust_ord_type_Cd = 'DOPG'
	   AND a.sales_ord_no = ${salesOrdNo}
	   AND b.shipment_no = ${shipmentNo}  
  </statement>


  <statement name="retrievePnsOrd">
	SELECT COUNT(1) CNT
	  FROM TB_IV02007 IV
	 WHERE IV.CNCL_YN = 'N'                             
	   AND IV.SAP_TRMS_STAT_CD = 'Y'                         
	   AND IV.CTRT_CUST_CD = ${rptCustCd} 
	   AND IV.SALES_ORD_NO = ${salesOrdNo}                       
	   AND IV.CUST_ORD_TYPE_CD = 'DOOR'
	   AND IV.MOVE_TYPE_CD = '2101'
	   --AND IV.MES_TRMS_STAT_CD != 'Y'
	   AND IV.CUST_OF_CUST_CD IN ('100739', '101743')
	   AND IV.ARV_AR_CD IN
	              ('300001',
	               '306811',
	               '315821',
	               '314317',
	               '316406',
	               '316407',
	               '316408',
	               '300002',
	               '300003',
	               '300004')      
  </statement>
  
  <statement name="retrievePaperTecOrd">
	select count(*) CNT
      from idsap.tb_silk_result 
     where ord_no = (select cust_ord_no 
                      from tb_om02001 
                     where sales_ord_no = ${salesOrdNo} 
                       and ctrt_cust_cd = ${rptCustCd})
       and cncl_yn='N' 
       and if_yn = 'Y'
       and shipment_no = ${shipmentNo} 
  </statement>
 
 
   <statement name="retrieveFisSchdInfo">
	SELECT CUST_ID, SCH_MAG, SCH_VSL, SCH_VOY,
	       (SELECT SHIP_CO_NM FROM TB_MA01017 WHERE SHIP_CO_SIGN_CD = A.CUST_ID) AS CUST_NM
	  FROM TI_LTS_SCH@DL_FIS A
	 WHERE 1=1
	   {#1}
	   {#2}
	   {#3}
	   AND SCH_ETD = (SELECT MAX (DPT_PORT_PRAR_YMD)
	                    FROM TB_OM02002
	                   WHERE SALES_ORD_NO = ${salesOrdNo} ) 

   	    <append condition="${polCd}.NOTEMPTY" id="#1">
    		AND SCH_POL = ${polCd}
    	</append> 
   	    <append condition="${podCd}.NOTEMPTY" id="#2">
    		AND SCH_POD = ${podCd}
    	</append> 
    	<append condition="${arvArCd}.NOTEMPTY" id="#3">
    		AND SCH_INL = ${arvArCd}
    	</append> 
  </statement>
 
 
    <statement name="retrieveFisSchdInfo2">
	SELECT CUST_ID, SCH_MAG, SCH_VSL, SCH_VOY,
	       (SELECT SHIP_CO_NM FROM TB_MA01017 WHERE SHIP_CO_SIGN_CD = A.CUST_ID) AS CUST_NM
	  FROM TI_LTS_SCH@DL_FIS A
	 WHERE 1=1
	   {#1}
	   AND SCH_ETD = ( SELECT MAX(SCH_ETD) FROM TI_LTS_SCH@DL_FIS WHERE SCH_MAG = A.SCH_MAG)
       AND ROWNUM = 1
   	    <append condition="${schdNo}.NOTEMPTY" id="#1">
    		AND SCH_MAG = ${schdNo}
    	</append> 
  </statement>
  
    <statement name="retrieveCancelGiList">  
	SELECT RSLT_STD_YMD,
	       DPT_AR_CD,
	       DPT_AR_NM,
	       DPT_AR_TYPE_CD,
	       ARV_AR_CD,
	       ARV_AR_NM,
	       ARV_AR_TYPE_CD,
	       CTRT_CUST_CD,
	       CUST_NM,
	       EO_NO,
	       NVL(SHIPMENT_NO, SHIPMENT_NO2) AS SHIPMENT_NO,
	       CNCL_ORD_CREAT_TIME,
	       GI_CNCL_REASON_CD,
	       GI_CNCL_REASON_NM,
	       CNCL_GR_ORD_NO,
	       CNCL_GR_STAT_NM,
	       GI_CNCL_REASON_RMK,
	       GI_CNCL_ID,
	       (SELECT USER_NM
	          FROM TB_MA01011
	         WHERE USER_ID = GI_CNCL_ID)
	          AS GI_CNCL_NM
	  FROM (SELECT CASE WHEN C.SALES_ORD_STAT_CD = '06' THEN
                        (SELECT RSLT_STD_YMD
                                FROM TB_IV02007
                               WHERE SALES_ORD_NO = A.SALES_ORD_NO
                                 AND CNCL_YN = 'Y'
                                 AND EO_NO = B.EO_NO        
                                 AND ROWNUM = 1)
                   ELSE
                        (SELECT RSLT_STD_YMD
                           FROM TB_IV02007
                          WHERE SALES_ORD_NO = A.SALES_ORD_NO
                            AND EO_NO = B.EO_NO        
                            AND ROWNUM = 1)
                  END AS RSLT_STD_YMD,
                  A.DPT_AR_CD,
                  CASE
	                  WHEN A.DPT_AR_TYPE_CD = '01'
	                  THEN
	                     (SELECT Z.WORK_PL_NM
	                        FROM TB_MA01005 Z
	                       WHERE Z.WORK_PL_CD = A.DPT_AR_CD)
	                  WHEN A.DPT_AR_TYPE_CD = '02'
	                  THEN
	                     (SELECT Z.CUST_NM
	                        FROM TB_MA02020 Z
	                       WHERE Z.PTN_CD = A.RPT_CUST_CD
	                             AND Z.CUST_PTN_CD = A.DPT_AR_CD)
	                  ELSE
	                     (SELECT MACOMM_GETCD_FN ('ADDR_MCLAS_CD',
	                                              Z.ADDR_MCLAS_CD)
	                             || ' '
	                             || Z.ZIP_AR_NM
	                        FROM TB_MA01016 Z
	                       WHERE     Z.RPT_ZIP_CD > '0'
	                             AND Z.ZIP_CD = A.DPT_AR_CD
	                             AND ROWNUM = 1)
               		END DPT_AR_NM,
                    A.DPT_AR_TYPE_CD,
                    A.ARV_AR_CD,
	                CASE
	                  WHEN A.ARV_AR_TYPE_CD = '01'
	                  THEN
	                     (SELECT Z.WORK_PL_NM
	                        FROM TB_MA01005 Z
	                       WHERE Z.WORK_PL_CD = A.ARV_AR_CD)
	                  WHEN A.ARV_AR_TYPE_CD = '02'
	                  THEN
	                     (SELECT Z.CUST_NM
	                        FROM TB_MA02020 Z
	                       WHERE Z.PTN_CD = A.RPT_CUST_CD
	                             AND Z.CUST_PTN_CD = A.ARV_AR_CD)
	                  ELSE
	                     (SELECT MACOMM_GETCD_FN ('ADDR_MCLAS_CD',
	                                              Z.ADDR_MCLAS_CD)
	                             || ' '
	                             || Z.ZIP_AR_NM
	                        FROM TB_MA01016 Z
	                       WHERE     Z.RPT_ZIP_CD > '0'
	                             AND Z.ZIP_CD = A.ARV_AR_CD
	                             AND ROWNUM = 1)
	                END ARV_AR_NM,
	               A.ARV_AR_TYPE_CD,
	               A.CTRT_CUST_CD,
	               B.EO_NO,
	               MACOMM_GETPTNNM_FN (A.CTRT_CUST_CD) AS CUST_NM,
	               E.SHIPMENT_NO,
	               B.SHIPMENT_NO AS SHIPMENT_NO2,
	               C.SALES_ORD_CREAT_YMD||C.SALES_ORD_CREAT_HMS AS CNCL_ORD_CREAT_TIME,
	               C.GI_CNCL_REASON_CD,
	               C.SALES_ORD_NO AS CNCL_GR_ORD_NO,
	               MACOMM_GETCD_FN ('GI_CNCL_REASON_CD', C.GI_CNCL_REASON_CD)
	                  AS GI_CNCL_REASON_NM,
	               C.REGR_ID AS GI_CNCL_ID,
	               MACOMM_GETCD_FN ('SALES_ORD_STAT_CD', C.SALES_ORD_STAT_CD)  AS CNCL_GR_STAT_NM,
	               (SELECT COL01
	                  FROM TB_OM02004
	                 WHERE SALES_ORD_NO = C.SALES_ORD_NO)
	                  AS GI_CNCL_REASON_RMK
	          FROM TB_OM02001 A,
	               TB_OM04001H B,
	               TB_OM02001 C,
	               TB_OM03016 E
	         -- ,TB_OM02004  G
	         WHERE     A.SALES_ORD_NO = B.SALES_ORD_NO
	               AND B.RSLT_SCTN_CD = '04'
	               AND B.EO_NO = C.RLTD_GI_EO_NO
	               --AND   C.SALES_ORD_NO      = G.SALES_ORD_NO
	               AND C.SALES_ORD_CNCL_YN = 'N'
	               AND C.ORD_TYPE_CD = '1043'
	               AND B.SALES_ORD_NO = E.SALES_ORD_NO(+)
	               AND B.WORK_ROUTE_SEQ = E.WORK_ROUTE_SEQ(+)
	               AND B.SHIPMENT_NO = E.SHIPMENT_NO(+)
	               {#1}
	               {#2}
	               {#3}
	               {#4}
	               {#5}
	               {#6}
	               --AND A.SALES_ORD_CREAT_YMD BETWEEN '20140101' AND '20140131'
	               AND EXISTS
	                      (SELECT 1
	                         FROM TB_OM04003H Z
	                        WHERE     Z.SALES_ORD_NO = B.SALES_ORD_NO
	                              AND Z.WORK_ROUTE_SEQ = B.WORK_ROUTE_SEQ
	                              AND Z.WORK_STEP_SEQ = B.WORK_STEP_SEQ
	                              AND Z.RSLT_DGR_CNT = B.RSLT_DGR_CNT
	                              AND Z.CNCL_ORD_NO IS NOT NULL)
	         ) 
    GROUP BY RSLT_STD_YMD,
	         DPT_AR_CD,
	         DPT_AR_NM,
	         DPT_AR_TYPE_CD,
	         ARV_AR_CD,
	         ARV_AR_NM,
	         ARV_AR_TYPE_CD,
	         CTRT_CUST_CD,
	         CUST_NM,
	         EO_NO,
	         NVL(SHIPMENT_NO, SHIPMENT_NO2),
	         CNCL_ORD_CREAT_TIME,
	         GI_CNCL_REASON_CD,
	         GI_CNCL_REASON_NM,
	         CNCL_GR_ORD_NO,
	         CNCL_GR_STAT_NM,
	         GI_CNCL_REASON_RMK,
	         GI_CNCL_ID
	ORDER BY RSLT_STD_YMD, EO_NO        
 
 	<append condition="${frDate}.NOTEMPTY&amp;${toDate}.NOTEMPTY" id="#1">
	    AND C.SALES_ORD_CREAT_YMD BETWEEN ${frDate} AND ${toDate}
	</append>   
 
 	<append condition="${ctrtCustCd}.NOTEMPTY" id="#2">
	    AND A.CTRT_CUST_CD = ${ctrtCustCd}
	</append>   

 	<append condition="${workCntrCd}.NOTEMPTY" id="#3">
	    AND A.DPT_AR_CD = ${workCntrCd}
	</append>   

 	<append condition="${shipmentNo}.NOTEMPTY" id="#4">
	    AND B.SHIPMENT_NO = ${shipmentNo}
	</append>  

 	<append condition="${sOrdNo}.NOTEMPTY" id="#5">
	    AND A.SALES_ORD_NO = ${sOrdNo}
	</append>  
	
 	<append condition="${cOrdNo}.NOTEMPTY" id="#6">
	    AND A.CUST_ORD_NO = ${cOrdNo}
	</append>  
   </statement>
   
     <statement name="retrievePartCmptList"> 
		SELECT  T.CHK_FLAG
		        , T.CTRT_CUST_CD
		        , T.CUST_ORD_NO
		        , T.SALES_ORD_NO
		        , T.SALES_ORD_CMPT_SCTN_CD
		        , T.SALES_ORD_CMPT_SCTN_NM
		        , T.SALES_ORD_CMPT_DATE 
		        , T.LOGIS_AR_CD
		        , T.ORD_TYPE_NM
		        , T.LOGIS_SVC_SCTN_CD
		        , T.LOGIS_SVC_SCTN_NM   
		        , T.CUST_ORD_TYPE_CD
		        , T.CUST_MOVE_TYPE_CD
		        , T.ORD_TYPE_CD
		        , T.SELF_TRAN_YN
		        , T.PART_CMPT_TRMS_SCTN_CD
		        , T.RMK
          FROM (
							SELECT  'F' AS CHK_FLAG
							        , A.CTRT_CUST_CD
							        , A.CUST_ORD_NO
							        , A.SALES_ORD_NO
							        , A.SALES_ORD_CMPT_SCTN_CD
							        , MACOMM_GETCD_FN( 'SALES_ORD_CMPT_SCTN_CD',  A.SALES_ORD_CMPT_SCTN_CD) AS SALES_ORD_CMPT_SCTN_NM
							        , TO_CHAR(A.SALES_ORD_CMPT_DATE, 'YYYYMMDD') AS SALES_ORD_CMPT_DATE 
							        , B.LOGIS_AR_CD
							        , B.ORD_TYPE_NM
							        , B.LOGIS_SVC_SCTN_CD
							        , MACOMM_GETCD_FN( 'LOGIS_SVC_SCTN_CD',  B.LOGIS_SVC_SCTN_CD) as LOGIS_SVC_SCTN_NM   
							        , A.CUST_ORD_TYPE_CD
							        , A.CUST_MOVE_TYPE_CD
							        , A.ORD_TYPE_CD
							        , A.SELF_TRAN_YN
							        ,  CASE WHEN CUST_ORD_TYPE_CD IS NOT NULL AND CUST_MOVE_TYPE_CD IS NULL THEN
							             (SELECT PART_CMPT_TRMS_SCTN_CD FROM TB_OM02102 WHERE CUST_CD = A.CTRT_CUST_CD AND CUST_ORD_TYPE_CD = A.CUST_ORD_TYPE_CD   AND ROWNUM = 1)
							           WHEN  CUST_ORD_TYPE_CD IS NULL AND CUST_MOVE_TYPE_CD IS NOT NULL THEN
							             ( SELECT PART_CMPT_TRMS_SCTN_CD FROM TB_OM02102 WHERE CUST_CD = A.CTRT_CUST_CD AND CUST_MOVE_TYPE_CD = A.CUST_MOVE_TYPE_CD   AND ROWNUM = 1)
							           ELSE ''
							           END   PART_CMPT_TRMS_SCTN_CD
							        , '' AS RMK
							  FROM TB_OM02001 A, TB_MA01006 B
							  WHERE A.ORD_TYPE_CD = B.ORD_TYPE_CD 
							    AND A.SALES_ORD_CMPT_SCTN_CD IS NOT NULL
							    {#1}  
							    {#2}
							    {#3}
							    {#4}     
		      ) T
		WHERE 1= 1
		{#5}
		{#6}
		ORDER BY T.SALES_ORD_NO
  	<append condition="${frDate}.NOTEMPTY&amp;${toDate}.NOTEMPTY" id="#1">
	    AND TO_CHAR(A.SALES_ORD_CMPT_DATE, 'YYYYMMDD') BETWEEN ${frDate} AND ${toDate}
	</append>   
 
 	<append condition="${ctrtCustCd}.NOTEMPTY" id="#2">
	    AND A.CTRT_CUST_CD = ${ctrtCustCd}
	</append>   

 	<append condition="${sOrdNo}.NOTEMPTY" id="#3">
	    AND A.SALES_ORD_NO = ${sOrdNo}
	</append>  
	
 	<append condition="${cOrdNo}.NOTEMPTY" id="#4">
	    AND A.CUST_ORD_NO = ${cOrdNo}
	</append>  

 	<append condition="${partCmptYn}.NOTEMPTY&amp;${partCmptYn}.EQ.Y" id="#5">
	    AND T.PART_CMPT_TRMS_SCTN_CD IS NOT NULL
	</append>  

 	<append condition="${partCmptYn}.NOTEMPTY&amp;${partCmptYn}.EQ.N" id="#6">
	    AND T.PART_CMPT_TRMS_SCTN_CD IS NULL
	</append>  
 
   </statement>
 
   <statement name="retrievePickCnt">
	SELECT COUNT(*) AS CNT 
	  FROM IDWMS.SHIPMENTORDER A, IDWMS.ORDERDETAIL B
	 WHERE A.WHSEID = B.WHSEID
	   AND A.EXTERNORDERKEY = B.EXTERNORDERKEY
	   AND A.LINENO = B.EXTERNLINENO
	   AND A.EXTERNORDERKEY LIKE ${salesOrdNo}||'%'
	   AND B.EXTERNLINENO = ${lineNo}
	   AND B.STATUS IN ('14', '15', '16', '17')
	   AND B.QTYALLOCATED + B.QTYPICKED  > 0
	   AND A.GI_YN = 'N'
  </statement>

   <statement name="retrieveInCnt">
	SELECT COUNT(*) AS CNT 
	  FROM IDWMS.RECEIPT A
	 WHERE A.EXTERNRECEIPTKEY LIKE  ${salesOrdNo}||'%'
	   AND A.STATUS = '9'
  </statement>

   <statement name="retrieveAgentChk">
	SELECT (SELECT COUNT (*)
	          FROM TB_IV02007
	         WHERE     SALES_ORD_NO = A.SALES_ORD_NO
	               AND CTRT_CUST_CD = A.CUST_CD
	               AND SAP_TRMS_STAT_CD = 'Y'
	               AND CNCL_YN = 'N'
	               AND SHIPMENT_NO = A.SHIPMENT_NO
	               AND MES_TRMS_STAT_CD = 'Y'
	               AND CUST_ORD_TYPE_CD = 'DOOR'
	               AND MOVE_TYPE_CD = '2101'
	               AND CUST_OF_CUST_CD IN ('100739', '101743')
	               AND ARV_AR_CD IN  ('300001',
	                   '306811',
	                   '315821',
	                   '314317',
	                   '316406',
	                   '316407',
	                   '316408',
	                   '300002',
	                   '300003',
	                   '300004')      
	               )
	          AS AGENT_CNT,
	       (SELECT COUNT (*)
	          FROM IDWMS.RECEIPT H, IDWMS.RECEIPTDETAIL I
	         WHERE  H.STORERKEY = I.STORERKEY
	               AND H.WHSEID = I.WHSEID
	               AND H.RECEIPTKEY = I.RECEIPTKEY
	               AND H. STORERKEY = 'P1028'
	               AND H.POKEY = A.PNS_ORD_NO
	               AND H.CHGFLAG IN ('C', 'U')
	               AND H.STATUS = '9')
	          AS PNS_CNT,
	       A.CUST_ORD_NO,
	       A.PNS_ORD_LINE_NO,
	       A.SALES_ORD_NO,
	       A.PNS_ORD_NO,
	       A.CUST_CD
	  FROM (SELECT CUST_ORD_NO,
	               SALES_ORD_NO,
	               CASE
	                  WHEN COL15 IS NOT NULL
	                  THEN
	                     CASE
	                        WHEN LENGTH (COL15) > 10 THEN SUBSTR (COL15, 0, 10)
	                        ELSE COL15
	                     END
	                  ELSE
	                     COL15
	               END
	                  AS PNS_ORD_NO,
	               CASE WHEN  LENGTH(COL15) > 10 THEN
	                   SUBSTR (COL15, 11)
	               ELSE 
	                   NULL
	               END 
                      AS PNS_ORD_LINE_NO,
	               CUST_CD,
	               ${shipmentNo} AS SHIPMENT_NO
	          FROM TB_OM01001
	         WHERE SALES_ORD_NO = ${salesOrdNo}) A
  </statement>
 
   <statement name="retrieveEveSalesYn">
        SELECT decode(count(*),0,'N','Y') AS sales_yn
          FROM TB_MA02020
         WHERE ptn_cd      = ${custCd}
           AND cust_ptn_cd = ${custPtnCd}
           AND use_yn  = 'Y'
           AND col30 = 'Y'
  </statement>
  
<!--made by 구희성 -->

  <statement name="insertBLStatusList"> //sqlDeveloper에서 쿼리문을 확인해야한다. 
	<![CDATA[
	
		INSERT INTO GIT_MA01001 (
		                          GIT_GRP_CD
		                        , GIT_GRP_NM
		                        , RMK
		                        , USE_YN
		                        , REGR_ID
		                        , REG_DATE
		                        , MDFR_ID
		                        , MDF_DATE
		                       )
		VALUES(
		         (SELECT 'G'||LPAD(SUBSTR(MAX(GIT_GRP_CD),2,7)+1,6,0) AS GIT_SEQ FROM GIT_MA01001)
		       , ${gitGrpNm}
		       , ${rmk}
		       , ${useYn}
		       , ${userId}
		       , SYSDATE
		       , ${userId}
		       , SYSDATE
		      )
	]]>
	</statement>
	

	
	<statement name="deleteBLStatusList">
	<![CDATA[
		/****************************
		*	GIT분석그룹 삭제
		****************************/	
		DELETE FROM GIT_MA01001 A
		WHERE A.GIT_GRP_CD = ${gitGrpCd}
	]]>
	</statement>
	

   <statement name="retrieveBLStatusList">
   
	  SELECT CUST_ORD_RECP_YMD,
	         CUST_ORD_RECP_HMS,
	         MBL_NO,
	         POD_CD,
	         ARV_PORT_PRAR_YMD,
	         CARGO_FORM_CD,
	         TRAN_COND_CD,
	         ITEM_CD,
	         ITEM_NM,
	         ORD_QTY,
	         ORD_ADMT,
	         ORD_WGT,
	         DECODE(STATUS, '3', 'Y', 'N') AS STATUS_YN,
	         STATUS,
	         (SELECT DESCRIPTION FROM IDWMS.CODELKUP WHERE LISTNAME = 'RECSTATUS' AND CODE = T.STATUS) AS STATUS_NM,
	         CLNC_DATE,
	         DECODE(T.STATUS, '0', '', '5', '', ACTUALRECORDDATE) AS ACTUALRECORDDATE,
	         CUST_ORD_NO,
	         CUST_ORD_LINE_NO,
	         LINE_NO,
	         CUST_CD,
	         BASIS_UNIT_CD,
	         QTY_UNIT_CD,
	         WGT_UNIT_CD,
	         ORG_ITEM_CD,
	         BAT_NO,
	         BASIS_ITEM_CD,
	         WORK_CNTR_CD,
	         PLANT_CD,
	         SALES_ORD_NO,

	         DET_FRTIME_DAYS,
	         DEM_FRTIME_DAYS,
	         TOT_FRTIME_DAYS
	         
	    FROM (SELECT TO_CHAR (B.CUST_ORD_RECP_DATE, 'YYYYMMDD') CUST_ORD_RECP_YMD,
                     TO_CHAR (B.CUST_ORD_RECP_DATE, 'HH24MISS') CUST_ORD_RECP_HMS,
                     B.MBL_NO,
                     NVL(C.ARV_AR_CD, D.POD_CD)  AS POD_CD,
                     B.ARV_PORT_PRAR_YMD,
                     B.CARGO_FORM_CD,
                     (SELECT TRAN_COND_CD
                        FROM TB_OM02001
                       WHERE SALES_ORD_NO = B.SALES_ORD_NO
                             AND SALES_ORD_CNCL_YN = 'N')
                        AS TRAN_COND_CD,
                     DECODE (A.CUST_CD,
                             'P1000', A.COL04 || A.CSN_BAT_NO,
                             'P1591', A.COL04 || A.CSN_BAT_NO,
                             A.COL01 || A.CSN_BAT_NO)
                        AS ITEM_CD,
                     (SELECT ITEM_NM
                        FROM TB_MA02010 X, TB_MA01002 Y
                       WHERE X.ITEM_CD =
                                DECODE (A.CUST_CD,
                                        'P1000', A.COL04 || A.CSN_BAT_NO,
                                        'P1591', A.COL04 || A.CSN_BAT_NO,
                                        A.COL01 || A.CSN_BAT_NO)
                             AND X.PTN_CD = Y.UPPER_PTN_CD
                             AND Y.PTN_CD = A.CUST_CD)
                        ITEM_NM,
                     A.ORD_QTY,
                    DECODE (A.CUST_CD, 'P1200', A.ORD_WGT, A.COL02) ORD_ADMT,
                     CASE
                        WHEN B.SALES_ORD_NO IS NOT NULL
                             AND C.SALES_ORD_CNCL_YN = 'N'
                        THEN
                           (SELECT ORD_WGT
                              FROM TB_OM02002
                             WHERE     CUST_CD = B.CUST_CD
                                   AND SALES_ORD_NO = B.SALES_ORD_NO
                                   AND CUST_ORD_LINE_NO = A.CUST_ORD_LINE_NO)
                        ELSE
                           A.ORD_WGT
                     END
                        AS ORD_WGT,
                     (SELECT min(R2.STATUS)
                        FROM IDWMS.RECEIPT R, IDWMS.RECEIPTDETAIL R2
                       WHERE     R.WHSEID = R2.WHSEID
                             AND R.STORERKEY = R2.STORERKEY
                             AND R.RECEIPTKEY = R2.RECEIPTKEY
                             AND R.POKEY = A.CUST_ORD_NO
                             AND R.SOKEY = B.SALES_ORD_NO
                             AND R.STORERKEY  = A.CUST_CD
                             AND R2.POLINENO =   A.CUST_ORD_LINE_NO
                             AND R.CHGFLAG != 'D'
                             AND R2.ITEM_CMPT_YN = 'N'
                             AND R2.STATUS NOT IN ('19', '20'))
                        AS STATUS,
                     NVL (
                        (SELECT CLNC_DATE
                           FROM IDWAS.BL_CLNC_INFORM
                          WHERE     POKEY = A.CUST_ORD_NO
                                AND POLINENO = A.CUST_ORD_LINE_NO
                                AND BLNO = B.MBL_NO
                                AND DATA_END_STATUS != 'Y'
                                AND ROWNUM = 1),
                        '')
                        AS CLNC_DATE,
                     (SELECT max(R2.ACTUALRECORDDATE)
                         FROM IDWMS.RECEIPT R, IDWMS.RECEIPTDETAIL R2
                       WHERE     R.WHSEID = R2.WHSEID
                             AND R.STORERKEY = R2.STORERKEY
                             AND R.RECEIPTKEY = R2.RECEIPTKEY
                             AND R.POKEY = A.CUST_ORD_NO
                             AND R.SOKEY = B.SALES_ORD_NO
                             AND R.STORERKEY  = A.CUST_CD
                             AND R2.POLINENO =   A.CUST_ORD_LINE_NO
                             AND R.CHGFLAG != 'D'
                             AND R2.ITEM_CMPT_YN = 'N'
                             AND R2.STATUS NOT IN ('19', '20'))
                        AS ACTUALRECORDDATE,
                     B.CUST_ORD_NO,   
                     CUST_ORD_LINE_NO,
                     TO_CHAR (ROWNUM * 10) LINE_NO,
                     A.CUST_CD,
                     (SELECT BASIS_UNIT_CD
                        FROM TB_MA02010 X, TB_MA01002 Y
                       WHERE X.ITEM_CD =
                                DECODE (A.CUST_CD,
                                        'P1000', A.COL04 || A.CSN_BAT_NO,
                                        'P1591', A.COL04 || A.CSN_BAT_NO,
                                        A.COL01 || A.CSN_BAT_NO)
                             AND X.PTN_CD = Y.UPPER_PTN_CD
                             AND Y.PTN_CD = A.CUST_CD)
                        BASIS_UNIT_CD-- , DECODE(B.CARGO_FORM_CD, 'C', 'VAN', A.QTY_UNIT_CD) QTY_UNIT_CD
                     ,
                     DECODE (B.CARGO_FORM_CD,
                             'C', 'VAN',
                             'B', DECODE (A.CUST_CD, 'P1100', 'EA', A.QTY_UNIT_CD),
                             A.QTY_UNIT_CD)
                        QTY_UNIT_CD,
                     A.WGT_UNIT_CD,
                     DECODE (A.CUST_CD,
                             'P1000', A.COL04,
                             'P1591', A.COL04,
                             A.COL01)
                        AS ORG_ITEM_CD,
                     CSN_BAT_NO AS BAT_NO,
                     '' ARV_AR_CD,
                     '' APTD_REQ_YMD,
                     (SELECT X.BASIS_ITEM_CD
                        FROM TB_MA02010 X, TB_MA01002 Y
                       WHERE X.ITEM_CD =
                                DECODE (A.CUST_CD,
                                        'P1000', A.COL04 || A.CSN_BAT_NO,
                                        'P1591', A.COL04 || A.CSN_BAT_NO,
                                        A.COL01 || A.CSN_BAT_NO)
                             AND X.PTN_CD = Y.UPPER_PTN_CD
                             AND Y.PTN_CD = A.CUST_CD)
                             
                        BASIS_ITEM_CD,
                     A.WORK_CNTR_CD,
                     '' WORK_CNTR_NM,
                     '' FLAG,
                     CASE  
                        WHEN A.CUST_CD IN ('P1000', 'P1591')
                        THEN
                           (SELECT PLANT_CD
                              FROM TB_OM02101
                             WHERE     WORK_CNTR_CD = A.WORK_CNTR_CD
                                   AND CUST_CD = A.CUST_CD
                                   AND PLANT_CD IS NOT NULL
                                   AND ROWNUM = 1)
                        ELSE
                           A.PLANT_CD
                     END
                        AS PLANT_CD 
                        ,E.DET_FRTIME_DAYS , E.DEM_FRTIME_DAYS , E.TOT_FRTIME_DAYS, E.SALES_ORD_NO 
                        
                FROM TB_OM01002 A, TB_OM01001 B, TB_OM02001 C, TB_FW02001 D, TB_OM02003 E
                
               WHERE     A.CUST_CD IN ('P1000', 'P1200')
                     AND A.CUST_CD = B.CUST_CD
                     AND A.CUST_ORD_NO = B.CUST_ORD_NO
                     AND B.CUST_CD = C.CUST_CD(+)
                     AND B.CUST_ORD_NO = C.CUST_ORD_NO(+)
                     AND B.SALES_ORD_NO = C.SALES_ORD_NO(+)
                     AND B.SALES_ORD_NO = E.SALES_ORD_NO(+)
                     AND B.MBL_NO =  D.HBL_NO(+)
                     AND B.DEL_YN != 'Y'
                     AND B.IF_ID IN ( 'IF_HPP_OM_ImportBL', 'IF_HHP_OM_ImportBL')
                     {#1}
                     {#2}
                     {#3}
                     {#4} ) T
                     
	ORDER BY T.CUST_ORD_RECP_YMD, T.CUST_ORD_NO, T.CUST_ORD_LINE_NO

 		<append condition="${q_ptnCd}.NOTEMPTY" id="#1">
		  AND A.CUST_CD = ${q_ptnCd}
		</append>

 		<append condition="${q_workPlCd}.NOTEMPTY" id="#2">
		  AND (C.ARV_AR_CD = ${q_workPlCd} OR D.POD_CD = ${q_workPlCd})
		</append>

 		<append condition="${frDate}.NOTEMPTY&amp;${toDate}.NOTEMPTY" id="#3">
	      AND B.CUST_ORD_RECP_DATE between to_date(CONCAT(${frDate},'000000'), 'yyyymmddhh24miss') 
			                           and to_date(CONCAT(${toDate},'235959'), 'yyyymmddhh24miss')
		</append>
		
		<append condition="${q_ptnCd}.NOTEMPTY&amp;${q_ptnCd}.EQ.P1000" id="#4">
    	   AND A.COL04 IS NOT NULL
    	</append>

		<append condition="${q_ptnCd}.NOTEMPTY&amp;${q_ptnCd}.EQ.P1591" id="#4">
    	   AND A.COL04 IS NOT NULL
    	</append>

  </statement>
    
 </statements>

